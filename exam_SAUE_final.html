<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sigurd SAUE">

<title>Exam Scoring</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TPnotéScoring_files/libs/clipboard/clipboard.min.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/quarto.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/popper.min.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/anchor.min.js"></script>
<link href="TPnotéScoring_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TPnotéScoring_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TPnotéScoring_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TPnotéScoring_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TPnotéScoring_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Exam Scoring</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sigurd SAUE </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="we-first-upload-the-data" class="level3">
<h3 class="anchored" data-anchor-id="we-first-upload-the-data">We first upload the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'exam/data/data_fin_exam.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="desbois-ratios" class="level1">
<h1>Desbois ratios</h1>
<section id="descriptive-statistics" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive statistics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical summary of the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Y             capx               che                cogs         
 0:4129   Min.   :   -0.03   Min.   :    0.00   Min.   :   -52.0  
 1: 224   1st Qu.:    1.95   1st Qu.:    2.48   1st Qu.:    27.0  
          Median :   10.08   Median :   14.70   Median :   113.0  
          Mean   :  183.30   Mean   :  239.18   Mean   :  1324.9  
          3rd Qu.:   54.44   3rd Qu.:   77.36   3rd Qu.:   487.5  
          Max.   :45110.00   Max.   :41032.00   Max.   :396044.0  
       dp                 act                 lct                 ebit         
 Min.   :    0.000   Min.   :     0.10   Min.   :     0.05   Min.   :-1012.07  
 1st Qu.:    2.213   1st Qu.:    24.46   1st Qu.:    11.96   1st Qu.:    0.67  
 Median :    9.400   Median :    90.31   Median :    43.94   Median :   11.23  
 Mean   :  133.437   Mean   :   839.43   Mean   :   618.92   Mean   :  235.17  
 3rd Qu.:   46.363   3rd Qu.:   334.84   3rd Qu.:   189.98   3rd Qu.:   71.07  
 Max.   :17513.788   Max.   :168618.00   Max.   :119109.00   Max.   :36683.00  
     ebitda               re                  gp                  ib           
 Min.   : -627.82   Min.   :-13340.35   Min.   :  -578.72   Min.   :-7987.000  
 1st Qu.:    3.55   1st Qu.:   -16.08   1st Qu.:    19.67   1st Qu.:   -1.355  
 Median :   22.49   Median :     6.24   Median :    70.92   Median :    3.691  
 Mean   :  368.61   Mean   :   568.90   Mean   :   731.08   Mean   :  126.709  
 3rd Qu.:  124.12   3rd Qu.:    92.66   3rd Qu.:   282.22   3rd Qu.:   29.301  
 Max.   :52075.00   Max.   :188057.00   Max.   :101541.00   Max.   :26592.000  
      xint               dltt                 ni                ppent          
 Min.   :  -0.003   Min.   :     0.00   Min.   :-8101.000   Min.   :     0.00  
 1st Qu.:   0.277   1st Qu.:     0.73   1st Qu.:   -1.559   1st Qu.:     7.88  
 Median :   2.402   Median :    21.12   Median :    3.583   Median :    46.41  
 Mean   :  42.798   Mean   :   643.73   Mean   :  127.192   Mean   :   979.52  
 3rd Qu.:  18.316   3rd Qu.:   229.09   3rd Qu.:   29.419   3rd Qu.:   299.44  
 Max.   :7071.000   Max.   :106540.00   Max.   :26592.000   Max.   :227901.00  
      sale               seq                  at                 lt           
 Min.   :     0.3   Min.   :-12567.00   Min.   :     0.7   Min.   :     0.10  
 1st Qu.:    52.3   1st Qu.:    22.77   1st Qu.:    53.0   1st Qu.:    20.55  
 Median :   205.6   Median :    90.69   Median :   215.4   Median :    93.09  
 Mean   :  2056.0   Mean   :  1052.40   Mean   :  2669.0   Mean   :  1580.22  
 3rd Qu.:   819.4   3rd Qu.:   371.76   3rd Qu.:   968.2   3rd Qu.:   530.50  
 Max.   :467153.0   Max.   :188494.00   Max.   :360325.0   Max.   :275732.00  
      invt                rect                wcap               mktval        
 Min.   :    0.000   Min.   :     0.00   Min.   :-21718.79   Min.   :     0.0  
 1st Qu.:    0.814   1st Qu.:     7.58   1st Qu.:     4.19   1st Qu.:    38.5  
 Median :   11.749   Median :    30.52   Median :    29.90   Median :   167.0  
 Mean   :  200.220   Mean   :   319.63   Mean   :   220.51   Mean   :  2683.9  
 3rd Qu.:   71.336   3rd Qu.:   122.93   3rd Qu.:   126.74   3rd Qu.:   825.5  
 Max.   :30781.000   Max.   :116720.00   Max.   : 49509.00   Max.   :461691.9  
       r1                r2                r3                 r4          
 Min.   :0.02369   Min.   :-2.0803   Min.   :0.008584   Min.   :0.005934  
 1st Qu.:0.33597   1st Qu.: 0.5361   1st Qu.:0.311835   1st Qu.:0.145297  
 Median :0.50457   Median : 0.7476   Median :0.524404   Median :0.221092  
 Mean   :0.51380   Mean   : 0.6997   Mean   :0.551137   Mean   :0.254551  
 3rd Qu.:0.65920   3rd Qu.: 0.9633   3rd Qu.:0.801777   3rd Qu.:0.325875  
 Max.   :1.97206   Max.   : 2.4706   Max.   :1.000000   Max.   :1.444394  
       r5               r6                r7                r8         
 Min.   :0.0000   Min.   :-5.3564   Min.   :-4.1907   Min.   :-3.6310  
 1st Qu.:0.0672   1st Qu.: 0.7865   1st Qu.: 0.1533   1st Qu.: 0.4160  
 Median :0.2227   Median : 1.4141   Median : 0.5961   Median : 0.6189  
 Mean   :0.2593   Mean   : 1.8294   Mean   : 1.0435   Mean   : 0.7859  
 3rd Qu.:0.3971   3rd Qu.: 2.4221   3rd Qu.: 1.4855   3rd Qu.: 0.9710  
 Max.   :1.5422   Max.   :21.1953   Max.   :16.0701   Max.   : 7.9560  
      r11               r12                r14                r17            
 Min.   :-4.3488   Min.   :-1.52136   Min.   :0.007171   Min.   :-1.290e-06  
 1st Qu.: 0.1731   1st Qu.: 0.07408   1st Qu.:0.363975   1st Qu.: 1.231e-02  
 Median : 0.5528   Median : 0.21545   Median :0.545748   Median : 3.060e-02  
 Mean   : 0.6491   Mean   : 0.29417   Mean   :0.643761   Mean   : 3.436e-02  
 3rd Qu.: 0.9955   3rd Qu.: 0.43254   3rd Qu.:0.801389   3rd Qu.: 5.024e-02  
 Max.   : 4.5952   Max.   : 2.12526   Max.   :4.064504   Max.   : 1.812e-01  
      r18                r21                r24                r28         
 Min.   :-0.38286   Min.   :-2.59906   Min.   :-0.63207   Min.   :-2.2963  
 1st Qu.: 0.01088   1st Qu.: 0.01290   1st Qu.: 0.06492   1st Qu.: 0.1859  
 Median : 0.04197   Median : 0.09428   Median : 0.11515   Median : 0.3580  
 Mean   : 0.07284   Mean   : 0.14928   Mean   : 0.10081   Mean   : 0.3343  
 3rd Qu.: 0.10136   3rd Qu.: 0.23631   3rd Qu.: 0.16825   3rd Qu.: 0.5675  
 Max.   : 1.13042   Max.   : 3.18458   Max.   : 0.69067   Max.   : 2.1403  
      r30                r32               r36              r37         
 Min.   :-5.60614   Min.   :-2.5229   Min.   :-8.225   Min.   :-0.5073  
 1st Qu.:-0.06749   1st Qu.: 0.1285   1st Qu.: 0.655   1st Qu.: 0.2221  
 Median : 0.09824   Median : 0.2885   Median : 1.418   Median : 0.3389  
 Mean   : 0.00259   Mean   : 0.2615   Mean   : 2.074   Mean   : 0.3838  
 3rd Qu.: 0.20320   3rd Qu.: 0.4690   3rd Qu.: 2.800   3rd Qu.: 0.4965  
 Max.   : 2.84407   Max.   : 2.3115   Max.   :18.526   Max.   : 1.3997  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between Y and r1:r37</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Y</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(Y))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>data_r<span class="ot">&lt;-</span> data[, <span class="dv">25</span><span class="sc">:</span><span class="fu">ncol</span>(data)]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>compte <span class="ot">&lt;-</span> <span class="fu">table</span>(Y)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(compte)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y
   0    1 
4129  224 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(compte)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Y
   0    1 
4129  224 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            r1         r2         r3        r4        r5        r6        r7
[1,] 0.3332894 -0.2732609 -0.0925612 0.1499643 0.2493621 0.3404333 0.2904463
            r8        r11        r12       r14       r17       r18      r21
[1,] 0.2527205 -0.1044007 -0.1317994 0.1653351 0.1708959 0.3654288 0.215301
            r24         r28        r30        r32      r36         r37
[1,] -0.1238764 -0.08072658 -0.2898251 -0.1727997 0.125581 -0.08553172</code></pre>
</div>
</div>
<p>We can see that the correlation between Y and the variables r1 to r37 is very low.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strong_correlations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Variable1 Variable2 Correlation
1        r32       r28   0.9690406
2        r28       r32   0.9690406
3         r7        r6   0.9269850
4         r6        r7   0.9269850
5         r5        r2  -0.8767279
6         r2        r5  -0.8767279
7         r5        r3  -0.8422275
8         r3        r5  -0.8422275
9         r2        r1  -0.7880348
10        r1        r2  -0.7880348
11       r18        r6   0.7763700
12        r6       r18   0.7763700
13       r18        r7   0.7736328
14        r7       r18   0.7736328
15        r5        r1   0.7709597
16        r1        r5   0.7709597
17       r36        r7   0.7659710
18        r7       r36   0.7659710
19       r36        r6   0.7474222
20        r6       r36   0.7474222
21        r7        r5   0.7326392
22        r5        r7   0.7326392
23       r14       r11  -0.7055432
24       r11       r14  -0.7055432
25       r32       r30   0.7006163
26       r30       r32   0.7006163</code></pre>
</div>
</div>
<p>We observe very strong coreelation (positive, but also negative) between some variables.</p>
<p>Now, we will plot interactions between the response variable Y and some of the numerical features r1 to r37.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>correlation_df_r <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>strongest_corr <span class="ot">&lt;-</span> correlation_df_r <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Var1 Var2        Freq
1     A  r18  0.36542881
2     A   r6  0.34043326
3     A   r1  0.33328939
4     A   r7  0.29044633
5     A  r30 -0.28982515
6     A   r2 -0.27326093
7     A   r8  0.25272052
8     A   r5  0.24936206
9     A  r21  0.21530102
10    A  r32 -0.17279969
11    A  r17  0.17089590
12    A  r14  0.16533509
13    A   r4  0.14996426
14    A  r12 -0.13179936
15    A  r36  0.12558098
16    A  r24 -0.12387635
17    A  r11 -0.10440070
18    A   r3 -0.09256120
19    A  r37 -0.08553172
20    A  r28 -0.08072658</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r18, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r18"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r6, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r6"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r30, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r30"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r28, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r28"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot confirms that r18 and r6 are correlated with Y, while r30 is negatively correlated with Y and r28 is not correlated with Y.</p>
</section>
<section id="cleaning-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-the-dataset">Cleaning the dataset</h3>
<p>Looking for NaN:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span><span class="fu">cbind</span>(Y, data_r)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We delete any rows with NaN values</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We check if there is no duplicate rows</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">distinct</span>(df)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We remove columns that are too correlated (r32 with r28 and r7 with r6, and r2 with r5)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>df_clean <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r32, r7, r5))</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># We also remove all the variable with a correlation lower than abs(0.2 with Y)</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>df_clean <span class="ot">&lt;-</span> df_clean <span class="sc">%&gt;%</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r2, r17, r14, r4, r12, r36, r24, r11, r3, r37, r28))</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>remove_outliers <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  Q1 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, <span class="fl">0.10</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  Q3 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, <span class="fl">0.90</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  IQR <span class="ot">&lt;-</span> Q3 <span class="sc">-</span> Q1</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>  lower_bound <span class="ot">&lt;-</span> Q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  upper_bound <span class="ot">&lt;-</span> Q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">&gt;=</span> lower_bound <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> upper_bound)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>df_clean <span class="ot">&lt;-</span> df_clean[<span class="fu">apply</span>(df_clean[ , <span class="sc">!</span><span class="fu">names</span>(df_clean) <span class="sc">%in%</span> <span class="st">'Y'</span>], <span class="dv">1</span>, <span class="cf">function</span>(row) <span class="fu">all</span>(<span class="fu">remove_outliers</span>(row))), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic regression</h3>
<p>Now that we have a clean dataset, we can try a logistic regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>full_model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df_clean, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = binomial, data = df_clean, maxit = 1000)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -6.75686    0.29104 -23.216  &lt; 2e-16 ***
r1           3.85163    0.36421  10.575  &lt; 2e-16 ***
r6           0.04921    0.06112   0.805 0.420779    
r8           0.41431    0.11893   3.484 0.000494 ***
r18          3.41315    0.96083   3.552 0.000382 ***
r21          0.78222    0.20990   3.727 0.000194 ***
r30         -0.98276    0.15703  -6.258 3.89e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1153.8  on 4346  degrees of freedom
AIC: 1167.8

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
<section id="stepwise-model" class="level3">
<h3 class="anchored" data-anchor-id="stepwise-model">Stepwise model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Effectuer la sélection pas à pas en utilisant le critère AIC</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois <span class="ot">&lt;-</span> <span class="fu">step</span>(full_model_desbois, <span class="at">direction =</span> <span class="st">"both"</span>, <span class="at">trace =</span> <span class="dv">0</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Résumé du modèle final</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stepwise_model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ r1 + r8 + r18 + r21 + r30, family = binomial, 
    data = df_clean, maxit = 1000)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -6.76110    0.29161 -23.185  &lt; 2e-16 ***
r1           3.88596    0.36217  10.730  &lt; 2e-16 ***
r8           0.46677    0.09974   4.680 2.87e-06 ***
r18          3.88634    0.75323   5.160 2.48e-07 ***
r21          0.78622    0.20920   3.758 0.000171 ***
r30         -0.97241    0.15585  -6.240 4.39e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1154.5  on 4347  degrees of freedom
AIC: 1166.5

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
<section id="comparing-both-model-with-a-log-likelihood-ratio-test" class="level3">
<h3 class="anchored" data-anchor-id="comparing-both-model-with-a-log-likelihood-ratio-test">Comparing both model with a Log-likelihood ratio test</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log Likelihood ratio test</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>lrt_result <span class="ot">&lt;-</span> <span class="fu">anova</span>(full_model_desbois, stepwise_model_desbois, <span class="at">test =</span> <span class="st">"LRT"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lrt_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: Y ~ r1 + r6 + r8 + r18 + r21 + r30
Model 2: Y ~ r1 + r8 + r18 + r21 + r30
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1      4346     1153.8                     
2      4347     1154.5 -1 -0.65741   0.4175</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate predictef </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>predicted_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(stepwise_model_desbois, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Effectuer le test de Hosmer-Lemeshow</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>hosmer_lemeshow_result <span class="ot">&lt;-</span> <span class="fu">hoslem.test</span>(df_clean<span class="sc">$</span>Y, predicted_probs)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats du test</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hosmer_lemeshow_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hosmer and Lemeshow goodness of fit (GOF) test

data:  df_clean$Y, predicted_probs
X-squared = 17.363, df = 8, p-value = 0.02655</code></pre>
</div>
</div>
</section>
</section>
<section id="altman-ratios" class="level1">
<h1>Altman ratios</h1>
<p>We create the new predictor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">=</span> data<span class="sc">$</span>wcap <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> data<span class="sc">$</span>re <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">=</span> data<span class="sc">$</span>ebit <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>X4 <span class="ot">=</span> data<span class="sc">$</span>mktval <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>X5 <span class="ot">=</span> data<span class="sc">$</span>sale <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">=</span> <span class="fl">0.012</span><span class="sc">*</span>X1 <span class="sc">+</span> <span class="fl">0.014</span><span class="sc">*</span>X2 <span class="sc">+</span> <span class="fl">0.033</span><span class="sc">*</span>X3 <span class="sc">+</span> <span class="fl">0.006</span><span class="sc">*</span>X4 <span class="sc">+</span> <span class="fl">0.999</span><span class="sc">*</span>X5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit a logistic regression with X1 to X5</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_altman <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> data<span class="sc">$</span>Y,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">X3 =</span> X3,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">X4 =</span> X4,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">X5 =</span> X5</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>model_altman <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df_altman,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_altman)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = binomial, data = df_altman, maxit = 1000)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -0.5497     0.1787  -3.077  0.00209 ** 
X1           -1.8618     0.3869  -4.813 1.49e-06 ***
X2           -0.1696     0.1267  -1.338  0.18089    
X3           -2.8661     0.5998  -4.779 1.76e-06 ***
X4           -4.9684     0.3819 -13.011  &lt; 2e-16 ***
X5            0.2498     0.1039   2.403  0.01624 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1192.5  on 4347  degrees of freedom
AIC: 1204.5

Number of Fisher Scoring iterations: 9</code></pre>
</div>
</div>
<p>The coefficient for X3 represents the change in the log odds (log ) of the response variable Y for a one-unit increase in X3. Here it’s negative which means a higher value of X3 increase the probability of Y = 0.</p>
<p>The p-value is close to zero, which means that X3 is significant for Y.</p>
<p>Now we calculate a confidence interval at 95% for X3’s coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>conf_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(model_altman)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x3_conf_int <span class="ot">&lt;-</span> conf_int[<span class="st">"X3"</span>, ]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x3_conf_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.5 %    97.5 % 
-4.036042 -1.679595 </code></pre>
</div>
</div>
</section>
<section id="financial-items-lasso" class="level1">
<h1>Financial Items / Lasso</h1>
<section id="descriptive-statistics-1" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics-1">Descriptive statistics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We create the variable capx/mktval</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data[, <span class="dv">2</span><span class="sc">:</span><span class="dv">24</span>]</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>correlations2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            capx         che        cogs          dp         act         lct
[1,] -0.01650222 -0.02111689 -0.00789613 -0.01598514 -0.01986023 -0.01512229
            ebit      ebitda          re          gp          ib       xint
[1,] -0.03379025 -0.02857028 -0.03761522 -0.02745454 -0.05162787 0.02642513
            dltt         ni       ppent        sale         seq          at
[1,] 0.005396866 -0.0538078 -0.01323953 -0.01487638 -0.03302175 -0.01900003
               lt       invt        rect        wcap      mktval
[1,] -0.006062534 -0.0151559 -0.01665686 -0.02369163 -0.03681769</code></pre>
</div>
</div>
<p>We observe really low correlations between the variables and Y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>correlation_matrix2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>correlation_df2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix2)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df2 <span class="sc">%&gt;%</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We observe really strong correlations between a lot of variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>correlation_df_l <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations2))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>strongest_corr2 <span class="ot">&lt;-</span> correlation_df_l <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Var1   Var2         Freq
1     A     ni -0.053807796
2     A     ib -0.051627873
3     A     re -0.037615216
4     A mktval -0.036817694
5     A   ebit -0.033790250
6     A    seq -0.033021745
7     A ebitda -0.028570282
8     A     gp -0.027454542
9     A   xint  0.026425135
10    A   wcap -0.023691629
11    A    che -0.021116892
12    A    act -0.019860234
13    A     at -0.019000030
14    A   rect -0.016656863
15    A   capx -0.016502221
16    A     dp -0.015985144
17    A   invt -0.015155905
18    A    lct -0.015122288
19    A   sale -0.014876377
20    A  ppent -0.013239529
21    A   cogs -0.007896130
22    A     lt -0.006062534
23    A   dltt  0.005396866</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> ni, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"ni"</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> xint, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"xint"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> dltt, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"dltt"</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot confirms that ni are a bit correlated with Y, while xint is smally negatively correlated with Y and sltt is not correlated with Y.</p>
<p>Now, we delete variables with to much correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>to_drop <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(correlation_matrix2, <span class="at">cutoff =</span> threshold)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data_l[, <span class="sc">-</span>to_drop]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression-1" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-1">Logistic regression</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data_lasso <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, data_l)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>full_model_items <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> data_lasso, </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_items)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = binomial, data = data_lasso, maxit = 1000)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.677e+00  8.046e-02 -33.271  &lt; 2e-16 ***
capx        -8.865e-04  1.069e-03  -0.829   0.4070    
che         -1.350e-03  7.451e-04  -1.812   0.0700 .  
cogs         4.285e-04  1.024e-04   4.185 2.85e-05 ***
re          -1.303e-03  1.801e-04  -7.239 4.53e-13 ***
xint         1.438e-02  1.846e-03   7.790 6.72e-15 ***
rect        -7.269e-05  7.112e-04  -0.102   0.9186    
wcap        -1.198e-03  4.949e-04  -2.420   0.0155 *  
mktval      -1.869e-03  2.246e-04  -8.323  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1467.5  on 4344  degrees of freedom
AIC: 1485.5

Number of Fisher Scoring iterations: 12</code></pre>
</div>
</div>
</section>
</section>
<section id="models-assessment" class="level1">
<h1>Models assessment</h1>
<section id="altman-predictors" class="level3">
<h3 class="anchored" data-anchor-id="altman-predictors">Altman predictors</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading data and inspecting it:</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'exam/data/data_fin_holdout.rds'</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>Y</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">=</span> data_fin_holdout[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(data_fin_holdout) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Y"</span>))]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Altman model</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(Y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 461</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>X1_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>wcap <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>X2_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>re <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>X3_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>ebit <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>X4_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>mktval <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>X5_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>sale <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>df_altman_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_test,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1_2,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2_2,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">X3 =</span> X3_2,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">X4 =</span> X4_2,</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">X5 =</span> X5_2</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>model_altman_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_altman, <span class="at">newdata =</span> df_altman_test, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="roc-curves" class="level3">
<h3 class="anchored" data-anchor-id="roc-curves">ROC curves</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Full Model Desbois</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>full_model_desbois_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_model_desbois, <span class="at">newdata =</span> X_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Stepwise Model Desbois</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(stepwise_model_desbois, <span class="at">newdata =</span> X_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Full Model Items</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>full_model_items_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_model_items, <span class="at">newdata =</span> X_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We calculate the ROC curves</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>roc_full_model_desbois <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, full_model_desbois_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>roc_stepwise_model_desbois <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, stepwise_model_desbois_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>roc_model_altman <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, model_altman_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>roc_full_model_items <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, full_model_items_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for each model</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>auc_full_model_desbois <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_full_model_desbois)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>auc_stepwise_model_desbois <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_stepwise_model_desbois)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>auc_model_altman <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_model_altman)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>auc_full_model_items <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_full_model_items)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print AUCs</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Full Model Desbois: "</span>, auc_full_model_desbois, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC for Full Model Desbois:  0.8571226 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Stepwise Model Desbois: "</span>, auc_stepwise_model_desbois, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC for Stepwise Model Desbois:  0.8557066 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Model Altman: "</span>, auc_model_altman, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC for Model Altman:  0.949731 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Full Model Items: "</span>, auc_full_model_items, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC for Full Model Items:  0.8969839 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curves</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>roc_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">specificity =</span> <span class="fu">c</span>(roc_full_model_desbois<span class="sc">$</span>specificities,  </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>                  roc_stepwise_model_desbois<span class="sc">$</span>specificities,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                  roc_model_altman<span class="sc">$</span>specificities,  </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                  roc_full_model_items<span class="sc">$</span>specificities),</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sensitivity =</span> <span class="fu">c</span>(roc_full_model_desbois<span class="sc">$</span>sensitivities,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>                  roc_stepwise_model_desbois<span class="sc">$</span>sensitivities,</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>                  roc_model_altman<span class="sc">$</span>sensitivities, roc_full_model_items<span class="sc">$</span>sensitivities),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Full Model Desbois"</span>, <span class="st">"Stepwise Model"</span>,  <span class="st">"Model Altman"</span>, </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Full Model Items"</span>), </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">times =</span> <span class="fu">c</span>(<span class="fu">length</span>(roc_full_model_desbois<span class="sc">$</span>specificities),</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">length</span>(roc_stepwise_model_desbois<span class="sc">$</span>specificities),</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">length</span>(roc_model_altman<span class="sc">$</span>specificities),</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">length</span>(roc_full_model_items<span class="sc">$</span>specificities)))</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, <span class="at">y =</span> sensitivity, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ROC Curves for Different Models"</span>, <span class="at">x =</span> <span class="st">"1 - Specificity"</span>, <span class="at">y =</span> <span class="st">"Sensitivity"</span>) <span class="sc">+</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The Altman model looks to be the best one.</p>
</section>
</section>
<section id="simulation-and-boundary-decision" class="level1">
<h1>Simulation and boundary decision</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation and boundary decision</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">25</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to simulate data</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>simulate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_train =</span> <span class="dv">200</span>, <span class="at">n_test =</span> <span class="dv">2000</span>) {</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Class 0: mixture of two Gaussians</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  mu0a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  mu0b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  Sigma0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Class 1: only one Gaussian</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  mu1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  Sigma1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train set</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  n_train_class0 <span class="ot">&lt;-</span> n_train <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>  n_train_class1 <span class="ot">&lt;-</span> n_train <span class="sc">-</span> n_train_class0</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  X_train_class0a <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_train_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0a, Sigma0)</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>  X_train_class0b <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_train_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0b, Sigma0)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  X_train_class1 <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_train_class1, mu1, Sigma1)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  y_train_class0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_train_class0)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  y_train_class1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_train_class1)</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>  X_train <span class="ot">&lt;-</span> <span class="fu">rbind</span>(X_train_class0a, X_train_class0b, X_train_class1)</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>  y_train <span class="ot">&lt;-</span> <span class="fu">c</span>(y_train_class0, y_train_class1)</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test set</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>  n_test_class0 <span class="ot">&lt;-</span> n_test <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>  n_test_class1 <span class="ot">&lt;-</span> n_test <span class="sc">-</span> n_test_class0</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>  X_test_class0a <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_test_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0a, Sigma0)</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>  X_test_class0b <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_test_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0b, Sigma0)</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  X_test_class1 <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_test_class1, mu1, Sigma1)</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>  y_test_class0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_test_class0)</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>  y_test_class1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_test_class1)</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>  X_test <span class="ot">&lt;-</span> <span class="fu">rbind</span>(X_test_class0a, X_test_class0b, X_test_class1)</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>  y_test <span class="ot">&lt;-</span> <span class="fu">c</span>(y_test_class0, y_test_class1)</span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">X_train =</span> X_train, <span class="at">y_train =</span> y_train, <span class="at">X_test =</span> X_test, <span class="at">y_test =</span> y_test)</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a><span class="co"># We simulate the data</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">simulate_data</span>()</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame from test set</span></span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> data<span class="sc">$</span>X_train[, <span class="dv">1</span>], <span class="at">x2 =</span> data<span class="sc">$</span>X_train[, <span class="dv">2</span>], <span class="at">y =</span> data<span class="sc">$</span>y_train)</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> data<span class="sc">$</span>X_test[, <span class="dv">1</span>], <span class="at">x2 =</span> data<span class="sc">$</span>X_test[, <span class="dv">2</span>], <span class="at">y =</span> data<span class="sc">$</span>y_test)</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: simple logistic regression (Y ~ x1 + x2)</span></span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> train_data, <span class="at">family =</span> binomial)</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>pred_model1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model1, test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>pred_class1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_model1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: Logistic regression with interaction terms and quadratic terms (Y ~ x1 * x2 + I(x1^2) + I(x2^2))</span></span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">*</span> x2 <span class="sc">+</span> <span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> train_data, <span class="at">family =</span> binomial)</span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>pred_model2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model2, test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>pred_class2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_model2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Misclassification error</span></span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>error_model1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(pred_class1 <span class="sc">!=</span> test_data<span class="sc">$</span>y)</span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>error_model2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(pred_class2 <span class="sc">!=</span> test_data<span class="sc">$</span>y)</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Erreur de classification du Modèle 1 :"</span>, error_model1, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Erreur de classification du Modèle 1 : 0.1015 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Erreur de classification du Modèle 2 :"</span>, error_model2, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Erreur de classification du Modèle 2 : 0.0985 </code></pre>
</div>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb84" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Exam Scoring"</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Sigurd SAUE"</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="an">theme:</span><span class="co"> united</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="fu">### We first upload the data</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'exam/data/data_fin_exam.rds'</span>)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Package names</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"ROCR"</span>, <span class="st">"car"</span>, <span class="st">"aod"</span>, <span class="st">"broom"</span>, <span class="st">"rsample"</span>, <span class="st">"bestglm"</span>, <span class="st">"glmnet"</span>, <span class="st">"glmnetUtils"</span>, <span class="st">"splines"</span>, <span class="st">"dplyr"</span>, <span class="st">"reshape2"</span>, <span class="st">"caret"</span>, <span class="st">"ResourceSelection"</span>, <span class="st">"pROC"</span>)</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages not yet installed</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>installed_packages <span class="ot">&lt;-</span> packages <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">installed.packages</span>())</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(installed_packages <span class="sc">==</span> <span class="cn">FALSE</span>)) {</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(packages[<span class="sc">!</span>installed_packages]) }</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # Packages loading</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional packages used throughout the course but not needed for the analysis</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>additional_packages <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"purrr"</span>, <span class="st">"pROC"</span>, <span class="st">"foreign"</span>, <span class="st">"patchwork"</span>, <span class="st">"class"</span>,</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a><span class="st">"scales"</span>, <span class="st">"rpart"</span>, <span class="st">"rpart.plot"</span>, <span class="st">"DescTools"</span>)</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Desbois ratios</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a><span class="fu">### Descriptive statistics</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical summary of the data</span></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between Y and r1:r37</span></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Y</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(Y))</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>data_r<span class="ot">&lt;-</span> data[, <span class="dv">25</span><span class="sc">:</span><span class="fu">ncol</span>(data)]</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>compte <span class="ot">&lt;-</span> <span class="fu">table</span>(Y)</span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(compte)</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(compte)</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations)</span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a>We can see that the correlation between Y and the variables r1 to r37 is very low.</span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix)</span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df <span class="sc">%&gt;%</span></span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strong_correlations)</span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-79"><a href="#cb84-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a>We observe very strong coreelation (positive, but also negative) between some variables.</span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a>Now, we will plot interactions between the response variable Y and some of the numerical features r1 to r37.</span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-89"><a href="#cb84-89" aria-hidden="true" tabindex="-1"></a>correlation_df_r <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations))</span>
<span id="cb84-90"><a href="#cb84-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a>strongest_corr <span class="ot">&lt;-</span> correlation_df_r <span class="sc">%&gt;%</span></span>
<span id="cb84-92"><a href="#cb84-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb84-93"><a href="#cb84-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-94"><a href="#cb84-94" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr)</span>
<span id="cb84-95"><a href="#cb84-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-96"><a href="#cb84-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb84-97"><a href="#cb84-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-98"><a href="#cb84-98" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r18, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb84-99"><a href="#cb84-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb84-100"><a href="#cb84-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb84-101"><a href="#cb84-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb84-102"><a href="#cb84-102" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r18"</span>,</span>
<span id="cb84-103"><a href="#cb84-103" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb84-104"><a href="#cb84-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-105"><a href="#cb84-105" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r6, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb84-106"><a href="#cb84-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb84-107"><a href="#cb84-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb84-108"><a href="#cb84-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb84-109"><a href="#cb84-109" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r6"</span>,</span>
<span id="cb84-110"><a href="#cb84-110" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb84-111"><a href="#cb84-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-112"><a href="#cb84-112" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r30, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb84-113"><a href="#cb84-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb84-114"><a href="#cb84-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb84-115"><a href="#cb84-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb84-116"><a href="#cb84-116" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r30"</span>,</span>
<span id="cb84-117"><a href="#cb84-117" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb84-118"><a href="#cb84-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-119"><a href="#cb84-119" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r28, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb84-120"><a href="#cb84-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb84-121"><a href="#cb84-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb84-122"><a href="#cb84-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb84-123"><a href="#cb84-123" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r28"</span>,</span>
<span id="cb84-124"><a href="#cb84-124" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb84-125"><a href="#cb84-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-126"><a href="#cb84-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-127"><a href="#cb84-127" aria-hidden="true" tabindex="-1"></a>The plot confirms that r18 and r6 are correlated with Y, while r30 is negatively correlated with Y and r28 is not correlated with Y.</span>
<span id="cb84-128"><a href="#cb84-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-129"><a href="#cb84-129" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cleaning the dataset</span></span>
<span id="cb84-130"><a href="#cb84-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-131"><a href="#cb84-131" aria-hidden="true" tabindex="-1"></a>Looking for NaN:</span>
<span id="cb84-132"><a href="#cb84-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-135"><a href="#cb84-135" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-136"><a href="#cb84-136" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span><span class="fu">cbind</span>(Y, data_r)</span>
<span id="cb84-137"><a href="#cb84-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-138"><a href="#cb84-138" aria-hidden="true" tabindex="-1"></a><span class="co"># We delete any rows with NaN values</span></span>
<span id="cb84-139"><a href="#cb84-139" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df)</span>
<span id="cb84-140"><a href="#cb84-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-141"><a href="#cb84-141" aria-hidden="true" tabindex="-1"></a><span class="co"># We check if there is no duplicate rows</span></span>
<span id="cb84-142"><a href="#cb84-142" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">distinct</span>(df)</span>
<span id="cb84-143"><a href="#cb84-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-144"><a href="#cb84-144" aria-hidden="true" tabindex="-1"></a><span class="co"># We remove columns that are too correlated (r32 with r28 and r7 with r6, and r2 with r5)</span></span>
<span id="cb84-145"><a href="#cb84-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-146"><a href="#cb84-146" aria-hidden="true" tabindex="-1"></a>df_clean <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb84-147"><a href="#cb84-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r32, r7, r5))</span>
<span id="cb84-148"><a href="#cb84-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-149"><a href="#cb84-149" aria-hidden="true" tabindex="-1"></a><span class="co"># We also remove all the variable with a correlation lower than abs(0.2 with Y)</span></span>
<span id="cb84-150"><a href="#cb84-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-151"><a href="#cb84-151" aria-hidden="true" tabindex="-1"></a>df_clean <span class="ot">&lt;-</span> df_clean <span class="sc">%&gt;%</span></span>
<span id="cb84-152"><a href="#cb84-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r2, r17, r14, r4, r12, r36, r24, r11, r3, r37, r28))</span>
<span id="cb84-153"><a href="#cb84-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-154"><a href="#cb84-154" aria-hidden="true" tabindex="-1"></a>remove_outliers <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb84-155"><a href="#cb84-155" aria-hidden="true" tabindex="-1"></a>  Q1 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, <span class="fl">0.10</span>)</span>
<span id="cb84-156"><a href="#cb84-156" aria-hidden="true" tabindex="-1"></a>  Q3 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(x, <span class="fl">0.90</span>)</span>
<span id="cb84-157"><a href="#cb84-157" aria-hidden="true" tabindex="-1"></a>  IQR <span class="ot">&lt;-</span> Q3 <span class="sc">-</span> Q1</span>
<span id="cb84-158"><a href="#cb84-158" aria-hidden="true" tabindex="-1"></a>  lower_bound <span class="ot">&lt;-</span> Q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb84-159"><a href="#cb84-159" aria-hidden="true" tabindex="-1"></a>  upper_bound <span class="ot">&lt;-</span> Q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR</span>
<span id="cb84-160"><a href="#cb84-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">&gt;=</span> lower_bound <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> upper_bound)</span>
<span id="cb84-161"><a href="#cb84-161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-162"><a href="#cb84-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-163"><a href="#cb84-163" aria-hidden="true" tabindex="-1"></a>df_clean <span class="ot">&lt;-</span> df_clean[<span class="fu">apply</span>(df_clean[ , <span class="sc">!</span><span class="fu">names</span>(df_clean) <span class="sc">%in%</span> <span class="st">'Y'</span>], <span class="dv">1</span>, <span class="cf">function</span>(row) <span class="fu">all</span>(<span class="fu">remove_outliers</span>(row))), ]</span>
<span id="cb84-164"><a href="#cb84-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-165"><a href="#cb84-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-166"><a href="#cb84-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-167"><a href="#cb84-167" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression</span></span>
<span id="cb84-168"><a href="#cb84-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-169"><a href="#cb84-169" aria-hidden="true" tabindex="-1"></a>Now that we have a clean dataset, we can try a logistic regression.</span>
<span id="cb84-170"><a href="#cb84-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-173"><a href="#cb84-173" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-174"><a href="#cb84-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb84-175"><a href="#cb84-175" aria-hidden="true" tabindex="-1"></a>full_model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb84-176"><a href="#cb84-176" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df_clean, </span>
<span id="cb84-177"><a href="#cb84-177" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb84-178"><a href="#cb84-178" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb84-179"><a href="#cb84-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-180"><a href="#cb84-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb84-181"><a href="#cb84-181" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_desbois)</span>
<span id="cb84-182"><a href="#cb84-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-183"><a href="#cb84-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-184"><a href="#cb84-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-185"><a href="#cb84-185" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stepwise model</span></span>
<span id="cb84-186"><a href="#cb84-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-189"><a href="#cb84-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-190"><a href="#cb84-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Effectuer la sélection pas à pas en utilisant le critère AIC</span></span>
<span id="cb84-191"><a href="#cb84-191" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois <span class="ot">&lt;-</span> <span class="fu">step</span>(full_model_desbois, <span class="at">direction =</span> <span class="st">"both"</span>, <span class="at">trace =</span> <span class="dv">0</span>)</span>
<span id="cb84-192"><a href="#cb84-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-193"><a href="#cb84-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Résumé du modèle final</span></span>
<span id="cb84-194"><a href="#cb84-194" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stepwise_model_desbois)</span>
<span id="cb84-195"><a href="#cb84-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-196"><a href="#cb84-196" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing both model with a Log-likelihood ratio test</span></span>
<span id="cb84-197"><a href="#cb84-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-200"><a href="#cb84-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-201"><a href="#cb84-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Log Likelihood ratio test</span></span>
<span id="cb84-202"><a href="#cb84-202" aria-hidden="true" tabindex="-1"></a>lrt_result <span class="ot">&lt;-</span> <span class="fu">anova</span>(full_model_desbois, stepwise_model_desbois, <span class="at">test =</span> <span class="st">"LRT"</span>)</span>
<span id="cb84-203"><a href="#cb84-203" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lrt_result)</span>
<span id="cb84-204"><a href="#cb84-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-205"><a href="#cb84-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-208"><a href="#cb84-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-209"><a href="#cb84-209" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate predictef </span></span>
<span id="cb84-210"><a href="#cb84-210" aria-hidden="true" tabindex="-1"></a>predicted_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(stepwise_model_desbois, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-211"><a href="#cb84-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-212"><a href="#cb84-212" aria-hidden="true" tabindex="-1"></a><span class="co"># Effectuer le test de Hosmer-Lemeshow</span></span>
<span id="cb84-213"><a href="#cb84-213" aria-hidden="true" tabindex="-1"></a>hosmer_lemeshow_result <span class="ot">&lt;-</span> <span class="fu">hoslem.test</span>(df_clean<span class="sc">$</span>Y, predicted_probs)</span>
<span id="cb84-214"><a href="#cb84-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-215"><a href="#cb84-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats du test</span></span>
<span id="cb84-216"><a href="#cb84-216" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hosmer_lemeshow_result)</span>
<span id="cb84-217"><a href="#cb84-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-218"><a href="#cb84-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-219"><a href="#cb84-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-220"><a href="#cb84-220" aria-hidden="true" tabindex="-1"></a><span class="fu"># Altman ratios</span></span>
<span id="cb84-221"><a href="#cb84-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-222"><a href="#cb84-222" aria-hidden="true" tabindex="-1"></a>We create the new predictor</span>
<span id="cb84-223"><a href="#cb84-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-226"><a href="#cb84-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-227"><a href="#cb84-227" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">=</span> data<span class="sc">$</span>wcap <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb84-228"><a href="#cb84-228" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> data<span class="sc">$</span>re <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb84-229"><a href="#cb84-229" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">=</span> data<span class="sc">$</span>ebit <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb84-230"><a href="#cb84-230" aria-hidden="true" tabindex="-1"></a>X4 <span class="ot">=</span> data<span class="sc">$</span>mktval <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb84-231"><a href="#cb84-231" aria-hidden="true" tabindex="-1"></a>X5 <span class="ot">=</span> data<span class="sc">$</span>sale <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb84-232"><a href="#cb84-232" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">=</span> <span class="fl">0.012</span><span class="sc">*</span>X1 <span class="sc">+</span> <span class="fl">0.014</span><span class="sc">*</span>X2 <span class="sc">+</span> <span class="fl">0.033</span><span class="sc">*</span>X3 <span class="sc">+</span> <span class="fl">0.006</span><span class="sc">*</span>X4 <span class="sc">+</span> <span class="fl">0.999</span><span class="sc">*</span>X5</span>
<span id="cb84-233"><a href="#cb84-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-234"><a href="#cb84-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-235"><a href="#cb84-235" aria-hidden="true" tabindex="-1"></a>We fit a logistic regression with X1 to X5</span>
<span id="cb84-236"><a href="#cb84-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-239"><a href="#cb84-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-240"><a href="#cb84-240" aria-hidden="true" tabindex="-1"></a>df_altman <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-241"><a href="#cb84-241" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> data<span class="sc">$</span>Y,</span>
<span id="cb84-242"><a href="#cb84-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1,</span>
<span id="cb84-243"><a href="#cb84-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2,</span>
<span id="cb84-244"><a href="#cb84-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">X3 =</span> X3,</span>
<span id="cb84-245"><a href="#cb84-245" aria-hidden="true" tabindex="-1"></a>  <span class="at">X4 =</span> X4,</span>
<span id="cb84-246"><a href="#cb84-246" aria-hidden="true" tabindex="-1"></a>  <span class="at">X5 =</span> X5</span>
<span id="cb84-247"><a href="#cb84-247" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-248"><a href="#cb84-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-249"><a href="#cb84-249" aria-hidden="true" tabindex="-1"></a>model_altman <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb84-250"><a href="#cb84-250" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df_altman,</span>
<span id="cb84-251"><a href="#cb84-251" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb84-252"><a href="#cb84-252" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb84-253"><a href="#cb84-253" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_altman)</span>
<span id="cb84-254"><a href="#cb84-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-255"><a href="#cb84-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-256"><a href="#cb84-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-257"><a href="#cb84-257" aria-hidden="true" tabindex="-1"></a>The coefficient for X3 represents the change in the log odds (log ) of the response variable Y for a one-unit increase in X3. Here it's negative which means a higher value of X3 increase the probability of Y = 0.</span>
<span id="cb84-258"><a href="#cb84-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-259"><a href="#cb84-259" aria-hidden="true" tabindex="-1"></a>The p-value is close to zero, which means that X3 is significant for Y.</span>
<span id="cb84-260"><a href="#cb84-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-261"><a href="#cb84-261" aria-hidden="true" tabindex="-1"></a>Now we calculate a confidence interval at 95% for X3's coefficient.</span>
<span id="cb84-262"><a href="#cb84-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-263"><a href="#cb84-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb84-264"><a href="#cb84-264" aria-hidden="true" tabindex="-1"></a>conf_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(model_altman)</span>
<span id="cb84-265"><a href="#cb84-265" aria-hidden="true" tabindex="-1"></a>x3_conf_int <span class="ot">&lt;-</span> conf_int[<span class="st">"X3"</span>, ]</span>
<span id="cb84-266"><a href="#cb84-266" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x3_conf_int)</span>
<span id="cb84-267"><a href="#cb84-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-268"><a href="#cb84-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-269"><a href="#cb84-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-270"><a href="#cb84-270" aria-hidden="true" tabindex="-1"></a><span class="fu"># Financial Items / Lasso</span></span>
<span id="cb84-271"><a href="#cb84-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-272"><a href="#cb84-272" aria-hidden="true" tabindex="-1"></a><span class="fu">### Descriptive statistics</span></span>
<span id="cb84-273"><a href="#cb84-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-276"><a href="#cb84-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-277"><a href="#cb84-277" aria-hidden="true" tabindex="-1"></a><span class="co"># We create the variable capx/mktval</span></span>
<span id="cb84-278"><a href="#cb84-278" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data[, <span class="dv">2</span><span class="sc">:</span><span class="dv">24</span>]</span>
<span id="cb84-279"><a href="#cb84-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-280"><a href="#cb84-280" aria-hidden="true" tabindex="-1"></a>correlations2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb84-281"><a href="#cb84-281" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations2)</span>
<span id="cb84-282"><a href="#cb84-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-283"><a href="#cb84-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-284"><a href="#cb84-284" aria-hidden="true" tabindex="-1"></a>We observe really low correlations between the variables and Y.</span>
<span id="cb84-285"><a href="#cb84-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-288"><a href="#cb84-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-289"><a href="#cb84-289" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb84-290"><a href="#cb84-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-291"><a href="#cb84-291" aria-hidden="true" tabindex="-1"></a>correlation_matrix2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb84-292"><a href="#cb84-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-293"><a href="#cb84-293" aria-hidden="true" tabindex="-1"></a>correlation_df2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix2)</span>
<span id="cb84-294"><a href="#cb84-294" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb84-295"><a href="#cb84-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-296"><a href="#cb84-296" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb84-297"><a href="#cb84-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-298"><a href="#cb84-298" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df2 <span class="sc">%&gt;%</span></span>
<span id="cb84-299"><a href="#cb84-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb84-300"><a href="#cb84-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span>
<span id="cb84-301"><a href="#cb84-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-302"><a href="#cb84-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-303"><a href="#cb84-303" aria-hidden="true" tabindex="-1"></a>We observe really strong correlations between a lot of variables.</span>
<span id="cb84-304"><a href="#cb84-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-307"><a href="#cb84-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-308"><a href="#cb84-308" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb84-309"><a href="#cb84-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-310"><a href="#cb84-310" aria-hidden="true" tabindex="-1"></a>correlation_df_l <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations2))</span>
<span id="cb84-311"><a href="#cb84-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-312"><a href="#cb84-312" aria-hidden="true" tabindex="-1"></a>strongest_corr2 <span class="ot">&lt;-</span> correlation_df_l <span class="sc">%&gt;%</span></span>
<span id="cb84-313"><a href="#cb84-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb84-314"><a href="#cb84-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-315"><a href="#cb84-315" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr2)</span>
<span id="cb84-316"><a href="#cb84-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-317"><a href="#cb84-317" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb84-318"><a href="#cb84-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-319"><a href="#cb84-319" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> ni, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb84-320"><a href="#cb84-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb84-321"><a href="#cb84-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb84-322"><a href="#cb84-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb84-323"><a href="#cb84-323" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"ni"</span>,</span>
<span id="cb84-324"><a href="#cb84-324" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb84-325"><a href="#cb84-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-326"><a href="#cb84-326" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> xint, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb84-327"><a href="#cb84-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb84-328"><a href="#cb84-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb84-329"><a href="#cb84-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb84-330"><a href="#cb84-330" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"xint"</span>,</span>
<span id="cb84-331"><a href="#cb84-331" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb84-332"><a href="#cb84-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-333"><a href="#cb84-333" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> dltt, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb84-334"><a href="#cb84-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb84-335"><a href="#cb84-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb84-336"><a href="#cb84-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb84-337"><a href="#cb84-337" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"dltt"</span>,</span>
<span id="cb84-338"><a href="#cb84-338" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb84-339"><a href="#cb84-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-340"><a href="#cb84-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-341"><a href="#cb84-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-342"><a href="#cb84-342" aria-hidden="true" tabindex="-1"></a>The plot confirms that ni are a bit correlated with Y, while xint is smally negatively correlated with Y and sltt is not correlated with Y.</span>
<span id="cb84-343"><a href="#cb84-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-344"><a href="#cb84-344" aria-hidden="true" tabindex="-1"></a>Now, we delete variables with to much correlation.</span>
<span id="cb84-345"><a href="#cb84-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-348"><a href="#cb84-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-349"><a href="#cb84-349" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb84-350"><a href="#cb84-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-351"><a href="#cb84-351" aria-hidden="true" tabindex="-1"></a>to_drop <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(correlation_matrix2, <span class="at">cutoff =</span> threshold)</span>
<span id="cb84-352"><a href="#cb84-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-353"><a href="#cb84-353" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data_l[, <span class="sc">-</span>to_drop]</span>
<span id="cb84-354"><a href="#cb84-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-355"><a href="#cb84-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-356"><a href="#cb84-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-357"><a href="#cb84-357" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression</span></span>
<span id="cb84-358"><a href="#cb84-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-361"><a href="#cb84-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-362"><a href="#cb84-362" aria-hidden="true" tabindex="-1"></a>data_lasso <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, data_l)</span>
<span id="cb84-363"><a href="#cb84-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-364"><a href="#cb84-364" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb84-365"><a href="#cb84-365" aria-hidden="true" tabindex="-1"></a>full_model_items <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb84-366"><a href="#cb84-366" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> data_lasso, </span>
<span id="cb84-367"><a href="#cb84-367" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb84-368"><a href="#cb84-368" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb84-369"><a href="#cb84-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-370"><a href="#cb84-370" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb84-371"><a href="#cb84-371" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_items)</span>
<span id="cb84-372"><a href="#cb84-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-373"><a href="#cb84-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-374"><a href="#cb84-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-375"><a href="#cb84-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-376"><a href="#cb84-376" aria-hidden="true" tabindex="-1"></a><span class="fu"># Models assessment</span></span>
<span id="cb84-377"><a href="#cb84-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-378"><a href="#cb84-378" aria-hidden="true" tabindex="-1"></a><span class="fu">### Altman predictors</span></span>
<span id="cb84-379"><a href="#cb84-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-382"><a href="#cb84-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-383"><a href="#cb84-383" aria-hidden="true" tabindex="-1"></a><span class="co"># loading data and inspecting it:</span></span>
<span id="cb84-384"><a href="#cb84-384" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'exam/data/data_fin_holdout.rds'</span>)</span>
<span id="cb84-385"><a href="#cb84-385" aria-hidden="true" tabindex="-1"></a>Y_test <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>Y</span>
<span id="cb84-386"><a href="#cb84-386" aria-hidden="true" tabindex="-1"></a>X_test <span class="ot">=</span> data_fin_holdout[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(data_fin_holdout) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Y"</span>))]</span>
<span id="cb84-387"><a href="#cb84-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-388"><a href="#cb84-388" aria-hidden="true" tabindex="-1"></a><span class="co"># Altman model</span></span>
<span id="cb84-389"><a href="#cb84-389" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(Y_test)</span>
<span id="cb84-390"><a href="#cb84-390" aria-hidden="true" tabindex="-1"></a>X1_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>wcap <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb84-391"><a href="#cb84-391" aria-hidden="true" tabindex="-1"></a>X2_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>re <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb84-392"><a href="#cb84-392" aria-hidden="true" tabindex="-1"></a>X3_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>ebit <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb84-393"><a href="#cb84-393" aria-hidden="true" tabindex="-1"></a>X4_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>mktval <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb84-394"><a href="#cb84-394" aria-hidden="true" tabindex="-1"></a>X5_2 <span class="ot">=</span> data_fin_holdout<span class="sc">$</span>sale <span class="sc">/</span> data_fin_holdout<span class="sc">$</span>at</span>
<span id="cb84-395"><a href="#cb84-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-396"><a href="#cb84-396" aria-hidden="true" tabindex="-1"></a>df_altman_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-397"><a href="#cb84-397" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y_test,</span>
<span id="cb84-398"><a href="#cb84-398" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1_2,</span>
<span id="cb84-399"><a href="#cb84-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2_2,</span>
<span id="cb84-400"><a href="#cb84-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">X3 =</span> X3_2,</span>
<span id="cb84-401"><a href="#cb84-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">X4 =</span> X4_2,</span>
<span id="cb84-402"><a href="#cb84-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">X5 =</span> X5_2</span>
<span id="cb84-403"><a href="#cb84-403" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-404"><a href="#cb84-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-405"><a href="#cb84-405" aria-hidden="true" tabindex="-1"></a>model_altman_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_altman, <span class="at">newdata =</span> df_altman_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-406"><a href="#cb84-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-407"><a href="#cb84-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-408"><a href="#cb84-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-409"><a href="#cb84-409" aria-hidden="true" tabindex="-1"></a><span class="fu">### ROC curves</span></span>
<span id="cb84-410"><a href="#cb84-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-411"><a href="#cb84-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb84-412"><a href="#cb84-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-413"><a href="#cb84-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Full Model Desbois</span></span>
<span id="cb84-414"><a href="#cb84-414" aria-hidden="true" tabindex="-1"></a>full_model_desbois_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_model_desbois, <span class="at">newdata =</span> X_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-415"><a href="#cb84-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-416"><a href="#cb84-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Stepwise Model Desbois</span></span>
<span id="cb84-417"><a href="#cb84-417" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(stepwise_model_desbois, <span class="at">newdata =</span> X_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-418"><a href="#cb84-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-419"><a href="#cb84-419" aria-hidden="true" tabindex="-1"></a><span class="co"># Full Model Items</span></span>
<span id="cb84-420"><a href="#cb84-420" aria-hidden="true" tabindex="-1"></a>full_model_items_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_model_items, <span class="at">newdata =</span> X_test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-421"><a href="#cb84-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-422"><a href="#cb84-422" aria-hidden="true" tabindex="-1"></a><span class="co"># We calculate the ROC curves</span></span>
<span id="cb84-423"><a href="#cb84-423" aria-hidden="true" tabindex="-1"></a>roc_full_model_desbois <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, full_model_desbois_pred)</span>
<span id="cb84-424"><a href="#cb84-424" aria-hidden="true" tabindex="-1"></a>roc_stepwise_model_desbois <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, stepwise_model_desbois_pred)</span>
<span id="cb84-425"><a href="#cb84-425" aria-hidden="true" tabindex="-1"></a>roc_model_altman <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, model_altman_pred)</span>
<span id="cb84-426"><a href="#cb84-426" aria-hidden="true" tabindex="-1"></a>roc_full_model_items <span class="ot">&lt;-</span> <span class="fu">roc</span>(Y_test, full_model_items_pred)</span>
<span id="cb84-427"><a href="#cb84-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-428"><a href="#cb84-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for each model</span></span>
<span id="cb84-429"><a href="#cb84-429" aria-hidden="true" tabindex="-1"></a>auc_full_model_desbois <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_full_model_desbois)</span>
<span id="cb84-430"><a href="#cb84-430" aria-hidden="true" tabindex="-1"></a>auc_stepwise_model_desbois <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_stepwise_model_desbois)</span>
<span id="cb84-431"><a href="#cb84-431" aria-hidden="true" tabindex="-1"></a>auc_model_altman <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_model_altman)</span>
<span id="cb84-432"><a href="#cb84-432" aria-hidden="true" tabindex="-1"></a>auc_full_model_items <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_full_model_items)</span>
<span id="cb84-433"><a href="#cb84-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-434"><a href="#cb84-434" aria-hidden="true" tabindex="-1"></a><span class="co"># Print AUCs</span></span>
<span id="cb84-435"><a href="#cb84-435" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Full Model Desbois: "</span>, auc_full_model_desbois, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-436"><a href="#cb84-436" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Stepwise Model Desbois: "</span>, auc_stepwise_model_desbois, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-437"><a href="#cb84-437" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Model Altman: "</span>, auc_model_altman, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-438"><a href="#cb84-438" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for Full Model Items: "</span>, auc_full_model_items, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-439"><a href="#cb84-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-440"><a href="#cb84-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curves</span></span>
<span id="cb84-441"><a href="#cb84-441" aria-hidden="true" tabindex="-1"></a>roc_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-442"><a href="#cb84-442" aria-hidden="true" tabindex="-1"></a>  <span class="at">specificity =</span> <span class="fu">c</span>(roc_full_model_desbois<span class="sc">$</span>specificities,  </span>
<span id="cb84-443"><a href="#cb84-443" aria-hidden="true" tabindex="-1"></a>                  roc_stepwise_model_desbois<span class="sc">$</span>specificities,</span>
<span id="cb84-444"><a href="#cb84-444" aria-hidden="true" tabindex="-1"></a>                  roc_model_altman<span class="sc">$</span>specificities,  </span>
<span id="cb84-445"><a href="#cb84-445" aria-hidden="true" tabindex="-1"></a>                  roc_full_model_items<span class="sc">$</span>specificities),</span>
<span id="cb84-446"><a href="#cb84-446" aria-hidden="true" tabindex="-1"></a>  <span class="at">sensitivity =</span> <span class="fu">c</span>(roc_full_model_desbois<span class="sc">$</span>sensitivities,</span>
<span id="cb84-447"><a href="#cb84-447" aria-hidden="true" tabindex="-1"></a>                  roc_stepwise_model_desbois<span class="sc">$</span>sensitivities,</span>
<span id="cb84-448"><a href="#cb84-448" aria-hidden="true" tabindex="-1"></a>                  roc_model_altman<span class="sc">$</span>sensitivities, roc_full_model_items<span class="sc">$</span>sensitivities),</span>
<span id="cb84-449"><a href="#cb84-449" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Full Model Desbois"</span>, <span class="st">"Stepwise Model"</span>,  <span class="st">"Model Altman"</span>, </span>
<span id="cb84-450"><a href="#cb84-450" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Full Model Items"</span>), </span>
<span id="cb84-451"><a href="#cb84-451" aria-hidden="true" tabindex="-1"></a>              <span class="at">times =</span> <span class="fu">c</span>(<span class="fu">length</span>(roc_full_model_desbois<span class="sc">$</span>specificities),</span>
<span id="cb84-452"><a href="#cb84-452" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">length</span>(roc_stepwise_model_desbois<span class="sc">$</span>specificities),</span>
<span id="cb84-453"><a href="#cb84-453" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">length</span>(roc_model_altman<span class="sc">$</span>specificities),</span>
<span id="cb84-454"><a href="#cb84-454" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">length</span>(roc_full_model_items<span class="sc">$</span>specificities)))</span>
<span id="cb84-455"><a href="#cb84-455" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-456"><a href="#cb84-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-457"><a href="#cb84-457" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(roc_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, <span class="at">y =</span> sensitivity, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb84-458"><a href="#cb84-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb84-459"><a href="#cb84-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb84-460"><a href="#cb84-460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ROC Curves for Different Models"</span>, <span class="at">x =</span> <span class="st">"1 - Specificity"</span>, <span class="at">y =</span> <span class="st">"Sensitivity"</span>) <span class="sc">+</span></span>
<span id="cb84-461"><a href="#cb84-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb84-462"><a href="#cb84-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb84-463"><a href="#cb84-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb84-464"><a href="#cb84-464" aria-hidden="true" tabindex="-1"></a>The Altman model looks to be the best one.</span>
<span id="cb84-465"><a href="#cb84-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-466"><a href="#cb84-466" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulation and boundary decision</span></span>
<span id="cb84-469"><a href="#cb84-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb84-470"><a href="#cb84-470" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation and boundary decision</span></span>
<span id="cb84-471"><a href="#cb84-471" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">25</span>)</span>
<span id="cb84-472"><a href="#cb84-472" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb84-473"><a href="#cb84-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-474"><a href="#cb84-474" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to simulate data</span></span>
<span id="cb84-475"><a href="#cb84-475" aria-hidden="true" tabindex="-1"></a>simulate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_train =</span> <span class="dv">200</span>, <span class="at">n_test =</span> <span class="dv">2000</span>) {</span>
<span id="cb84-476"><a href="#cb84-476" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Class 0: mixture of two Gaussians</span></span>
<span id="cb84-477"><a href="#cb84-477" aria-hidden="true" tabindex="-1"></a>  mu0a <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb84-478"><a href="#cb84-478" aria-hidden="true" tabindex="-1"></a>  mu0b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb84-479"><a href="#cb84-479" aria-hidden="true" tabindex="-1"></a>  Sigma0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb84-480"><a href="#cb84-480" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-481"><a href="#cb84-481" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Class 1: only one Gaussian</span></span>
<span id="cb84-482"><a href="#cb84-482" aria-hidden="true" tabindex="-1"></a>  mu1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb84-483"><a href="#cb84-483" aria-hidden="true" tabindex="-1"></a>  Sigma1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb84-484"><a href="#cb84-484" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-485"><a href="#cb84-485" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Train set</span></span>
<span id="cb84-486"><a href="#cb84-486" aria-hidden="true" tabindex="-1"></a>  n_train_class0 <span class="ot">&lt;-</span> n_train <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb84-487"><a href="#cb84-487" aria-hidden="true" tabindex="-1"></a>  n_train_class1 <span class="ot">&lt;-</span> n_train <span class="sc">-</span> n_train_class0</span>
<span id="cb84-488"><a href="#cb84-488" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-489"><a href="#cb84-489" aria-hidden="true" tabindex="-1"></a>  X_train_class0a <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_train_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0a, Sigma0)</span>
<span id="cb84-490"><a href="#cb84-490" aria-hidden="true" tabindex="-1"></a>  X_train_class0b <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_train_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0b, Sigma0)</span>
<span id="cb84-491"><a href="#cb84-491" aria-hidden="true" tabindex="-1"></a>  X_train_class1 <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_train_class1, mu1, Sigma1)</span>
<span id="cb84-492"><a href="#cb84-492" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-493"><a href="#cb84-493" aria-hidden="true" tabindex="-1"></a>  y_train_class0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_train_class0)</span>
<span id="cb84-494"><a href="#cb84-494" aria-hidden="true" tabindex="-1"></a>  y_train_class1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_train_class1)</span>
<span id="cb84-495"><a href="#cb84-495" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-496"><a href="#cb84-496" aria-hidden="true" tabindex="-1"></a>  X_train <span class="ot">&lt;-</span> <span class="fu">rbind</span>(X_train_class0a, X_train_class0b, X_train_class1)</span>
<span id="cb84-497"><a href="#cb84-497" aria-hidden="true" tabindex="-1"></a>  y_train <span class="ot">&lt;-</span> <span class="fu">c</span>(y_train_class0, y_train_class1)</span>
<span id="cb84-498"><a href="#cb84-498" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-499"><a href="#cb84-499" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test set</span></span>
<span id="cb84-500"><a href="#cb84-500" aria-hidden="true" tabindex="-1"></a>  n_test_class0 <span class="ot">&lt;-</span> n_test <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb84-501"><a href="#cb84-501" aria-hidden="true" tabindex="-1"></a>  n_test_class1 <span class="ot">&lt;-</span> n_test <span class="sc">-</span> n_test_class0</span>
<span id="cb84-502"><a href="#cb84-502" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-503"><a href="#cb84-503" aria-hidden="true" tabindex="-1"></a>  X_test_class0a <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_test_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0a, Sigma0)</span>
<span id="cb84-504"><a href="#cb84-504" aria-hidden="true" tabindex="-1"></a>  X_test_class0b <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_test_class0 <span class="sc">/</span> <span class="dv">2</span>, mu0b, Sigma0)</span>
<span id="cb84-505"><a href="#cb84-505" aria-hidden="true" tabindex="-1"></a>  X_test_class1 <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_test_class1, mu1, Sigma1)</span>
<span id="cb84-506"><a href="#cb84-506" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-507"><a href="#cb84-507" aria-hidden="true" tabindex="-1"></a>  y_test_class0 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_test_class0)</span>
<span id="cb84-508"><a href="#cb84-508" aria-hidden="true" tabindex="-1"></a>  y_test_class1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_test_class1)</span>
<span id="cb84-509"><a href="#cb84-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-510"><a href="#cb84-510" aria-hidden="true" tabindex="-1"></a>  X_test <span class="ot">&lt;-</span> <span class="fu">rbind</span>(X_test_class0a, X_test_class0b, X_test_class1)</span>
<span id="cb84-511"><a href="#cb84-511" aria-hidden="true" tabindex="-1"></a>  y_test <span class="ot">&lt;-</span> <span class="fu">c</span>(y_test_class0, y_test_class1)</span>
<span id="cb84-512"><a href="#cb84-512" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-513"><a href="#cb84-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">X_train =</span> X_train, <span class="at">y_train =</span> y_train, <span class="at">X_test =</span> X_test, <span class="at">y_test =</span> y_test)</span>
<span id="cb84-514"><a href="#cb84-514" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-515"><a href="#cb84-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-516"><a href="#cb84-516" aria-hidden="true" tabindex="-1"></a><span class="co"># We simulate the data</span></span>
<span id="cb84-517"><a href="#cb84-517" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">simulate_data</span>()</span>
<span id="cb84-518"><a href="#cb84-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-519"><a href="#cb84-519" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frame from test set</span></span>
<span id="cb84-520"><a href="#cb84-520" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> data<span class="sc">$</span>X_train[, <span class="dv">1</span>], <span class="at">x2 =</span> data<span class="sc">$</span>X_train[, <span class="dv">2</span>], <span class="at">y =</span> data<span class="sc">$</span>y_train)</span>
<span id="cb84-521"><a href="#cb84-521" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> data<span class="sc">$</span>X_test[, <span class="dv">1</span>], <span class="at">x2 =</span> data<span class="sc">$</span>X_test[, <span class="dv">2</span>], <span class="at">y =</span> data<span class="sc">$</span>y_test)</span>
<span id="cb84-522"><a href="#cb84-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-523"><a href="#cb84-523" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: simple logistic regression (Y ~ x1 + x2)</span></span>
<span id="cb84-524"><a href="#cb84-524" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> train_data, <span class="at">family =</span> binomial)</span>
<span id="cb84-525"><a href="#cb84-525" aria-hidden="true" tabindex="-1"></a>pred_model1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model1, test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-526"><a href="#cb84-526" aria-hidden="true" tabindex="-1"></a>pred_class1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_model1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb84-527"><a href="#cb84-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-528"><a href="#cb84-528" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: Logistic regression with interaction terms and quadratic terms (Y ~ x1 * x2 + I(x1^2) + I(x2^2))</span></span>
<span id="cb84-529"><a href="#cb84-529" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x1 <span class="sc">*</span> x2 <span class="sc">+</span> <span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> train_data, <span class="at">family =</span> binomial)</span>
<span id="cb84-530"><a href="#cb84-530" aria-hidden="true" tabindex="-1"></a>pred_model2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model2, test_data, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-531"><a href="#cb84-531" aria-hidden="true" tabindex="-1"></a>pred_class2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_model2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb84-532"><a href="#cb84-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-533"><a href="#cb84-533" aria-hidden="true" tabindex="-1"></a><span class="co"># Misclassification error</span></span>
<span id="cb84-534"><a href="#cb84-534" aria-hidden="true" tabindex="-1"></a>error_model1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(pred_class1 <span class="sc">!=</span> test_data<span class="sc">$</span>y)</span>
<span id="cb84-535"><a href="#cb84-535" aria-hidden="true" tabindex="-1"></a>error_model2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(pred_class2 <span class="sc">!=</span> test_data<span class="sc">$</span>y)</span>
<span id="cb84-536"><a href="#cb84-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-537"><a href="#cb84-537" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Erreur de classification du Modèle 1 :"</span>, error_model1, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-538"><a href="#cb84-538" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Erreur de classification du Modèle 2 :"</span>, error_model2, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-539"><a href="#cb84-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>