<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Louis OLIVE">

<title>Classification trees and ensemble methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Classification trees and ensemble methods_files/libs/clipboard/clipboard.min.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/quarto.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/popper.min.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Classification trees and ensemble methods_files/libs/quarto-html/anchor.min.js"></script>
<link href="Classification trees and ensemble methods_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Classification trees and ensemble methods_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Classification trees and ensemble methods_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Classification trees and ensemble methods_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Classification trees and ensemble methods_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script>
  MathJax = {
    tex: {
      tags: 'ams'  // should be 'ams', 'none', or 'all'
    }
  };
</script>

<link href="Classification trees and ensemble methods_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="Classification trees and ensemble methods_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#cart" id="toc-cart" class="nav-link active" data-scroll-target="#cart"><span class="header-section-number">1</span> CART</a>
  <ul class="collapse">
  <li><a href="#splitting-criterion" id="toc-splitting-criterion" class="nav-link" data-scroll-target="#splitting-criterion"><span class="header-section-number">1.1</span> Splitting criterion</a></li>
  <li><a href="#tree-building-process" id="toc-tree-building-process" class="nav-link" data-scroll-target="#tree-building-process"><span class="header-section-number">1.2</span> Tree-building process</a></li>
  <li><a href="#building-strategy---pruning" id="toc-building-strategy---pruning" class="nav-link" data-scroll-target="#building-strategy---pruning"><span class="header-section-number">1.3</span> Building strategy - Pruning</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">1.4</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#exercice-1" id="toc-exercice-1" class="nav-link" data-scroll-target="#exercice-1"><span class="header-section-number">1.4.1</span> Exercice 1</a></li>
  <li><a href="#exercice-2-inspired-from-a.-géron-book" id="toc-exercice-2-inspired-from-a.-géron-book" class="nav-link" data-scroll-target="#exercice-2-inspired-from-a.-géron-book"><span class="header-section-number">1.4.2</span> Exercice 2 (Inspired from A. Géron book)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ensemble-methods---boosting" id="toc-ensemble-methods---boosting" class="nav-link" data-scroll-target="#ensemble-methods---boosting"><span class="header-section-number">2</span> Ensemble methods - Boosting</a>
  <ul class="collapse">
  <li><a href="#adaboost" id="toc-adaboost" class="nav-link" data-scroll-target="#adaboost"><span class="header-section-number">2.1</span> Adaboost</a></li>
  <li><a href="#derivation-of-adaboost-statistical-view" id="toc-derivation-of-adaboost-statistical-view" class="nav-link" data-scroll-target="#derivation-of-adaboost-statistical-view"><span class="header-section-number">2.2</span> Derivation of AdaBoost: statistical view</a>
  <ul class="collapse">
  <li><a href="#adaboost-fits-an-additive-model" id="toc-adaboost-fits-an-additive-model" class="nav-link" data-scroll-target="#adaboost-fits-an-additive-model"><span class="header-section-number">2.2.1</span> AdaBoost fits an additive model</a></li>
  <li><a href="#forward-stagewise-additive-model-fsam" id="toc-forward-stagewise-additive-model-fsam" class="nav-link" data-scroll-target="#forward-stagewise-additive-model-fsam"><span class="header-section-number">2.2.2</span> Forward Stagewise Additive Model (FSAM)</a></li>
  <li><a href="#adaboost-fits-a-fsam-for-exponential-loss" id="toc-adaboost-fits-a-fsam-for-exponential-loss" class="nav-link" data-scroll-target="#adaboost-fits-a-fsam-for-exponential-loss"><span class="header-section-number">2.2.3</span> AdaBoost fits a FSAM for exponential loss</a></li>
  <li><a href="#loss-functions-for-binary-classification-margin-draft" id="toc-loss-functions-for-binary-classification-margin-draft" class="nav-link" data-scroll-target="#loss-functions-for-binary-classification-margin-draft"><span class="header-section-number">2.2.4</span> Loss functions for binary classification / margin [DRAFT]</a></li>
  </ul></li>
  <li><a href="#introducing-logitboost-as-an-optimisation-method-in-function-space" id="toc-introducing-logitboost-as-an-optimisation-method-in-function-space" class="nav-link" data-scroll-target="#introducing-logitboost-as-an-optimisation-method-in-function-space"><span class="header-section-number">2.3</span> Introducing LogitBoost as an optimisation method in “function space”</a></li>
  <li><a href="#practical-implementations" id="toc-practical-implementations" class="nav-link" data-scroll-target="#practical-implementations"><span class="header-section-number">2.4</span> Practical Implementations</a>
  <ul class="collapse">
  <li><a href="#original-logitboost" id="toc-original-logitboost" class="nav-link" data-scroll-target="#original-logitboost"><span class="header-section-number">2.4.1</span> Original LogitBoost</a></li>
  <li><a href="#mart-gradient-boosting-version-of-logitboost" id="toc-mart-gradient-boosting-version-of-logitboost" class="nav-link" data-scroll-target="#mart-gradient-boosting-version-of-logitboost"><span class="header-section-number">2.4.2</span> MART: Gradient Boosting version of LogitBoost</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise"><span class="header-section-number">2.4.3</span> Exercise</a></li>
  <li><a href="#ping-li-robust-logitboost" id="toc-ping-li-robust-logitboost" class="nav-link" data-scroll-target="#ping-li-robust-logitboost"><span class="header-section-number">2.4.4</span> Ping Li Robust LogitBoost</a></li>
  </ul></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">2.5</span> Appendix</a>
  <ul class="collapse">
  <li><a href="#cp-plots" id="toc-cp-plots" class="nav-link" data-scroll-target="#cp-plots"><span class="header-section-number">2.5.1</span> Cp plots</a></li>
  <li><a href="#checking-our-implementation-vs-r-packages-and-scikit-learn" id="toc-checking-our-implementation-vs-r-packages-and-scikit-learn" class="nav-link" data-scroll-target="#checking-our-implementation-vs-r-packages-and-scikit-learn"><span class="header-section-number">2.5.2</span> Checking our implementation vs R packages and scikit-learn</a></li>
  </ul></li>
  <li><a href="#gradient-boosting-machines" id="toc-gradient-boosting-machines" class="nav-link" data-scroll-target="#gradient-boosting-machines"><span class="header-section-number">2.6</span> Gradient Boosting (Machines)</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">3</span> References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Classification trees and ensemble methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Louis OLIVE </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>In the first lessons, we have mainly used a Logistic Regression model to deal with a binary classification / scoring problem.</p>
<p>Logistic regression models may prove inadequate<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> when dealing with scenarios characterized by non-linearity in the input-output relationship or when there are interactions among the input variables. This is when decision trees come to the forefront.</p>
<p>Decision trees recursively partition the data by applying specific cutoff values to the features. This process creates various subsets of the data set, with each data point belonging to one of these subsets. The final subsets are known as Terminal or Leaf nodes, while the intermediate ones are referred to as Internal, Split or Decision nodes.</p>
<p><img src="images/decison_tree.png" class="img-fluid"></p>
<p>In order to make predictions within each leaf node, the average outcome of the training data contained in that node is utilized.</p>
<p>Numerous algorithms exist for growing decision trees, each differing in aspects such as the potential structure of the tree, the criteria for identifying splits, when to cease the splitting process…</p>
<section id="cart" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> CART</h1>
<p>We describe bellow a popular method for tree-based regression and classification called CART. We follow the terminology of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> (chapter 9.2).</p>
<p>Classification And Regression Tree (CART) (<span class="citation" data-cites="Breiman83">Breiman et al. (<a href="#ref-Breiman83" role="doc-biblioref">1983</a>)</span>), is a recursive method:</p>
<ul>
<li><p>At the root of the tree we find the entire sample.</p></li>
<li><p>Each node of the tree divides the sample into 2 branches, according to a feature variable (discrete, continuous or ordinal variable (threshold) or a nominal variable (set of categories).</p></li>
<li><p>A terminal node is called a leaf. Usually the tree is represented upside down with its root at the top</p></li>
</ul>
<p>The tree is built by the following process: first the single variable is found which best splits the data into two groups (‘best’ will be defined later). The data is separated, and then this process is applied separately to each sub-group, and so on recursively until a stopping rule occurs (either no improvement can be made or the subgroups reach a minimum size).</p>
<p>To illustrate the process we start with a Classification Tree on <span class="math inline">\(x_1,x_2\in\mathbb R^2\)</span> for the <strong>Mixture</strong> data set:</p>
<p>The 10 centers for BLUE/ORANGE classes:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated mixture (ORANGE/BLUE) from ESLII/ISLR</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">TODO</span><span class="co"> change path</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file=</span><span class="st">'../data/mixture.example.RData'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>x1_means <span class="ot">&lt;-</span> mixture.example<span class="sc">$</span>means[,<span class="dv">1</span>]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>x2_means <span class="ot">&lt;-</span> mixture.example<span class="sc">$</span>means[,<span class="dv">2</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>mixture_means <span class="ot">&lt;-</span> <span class="fu">tibble</span>(x1_means, x2_means) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowid_to_column</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(rowid <span class="sc">&lt;=</span> <span class="dv">10</span>, <span class="st">"BLUE"</span>, <span class="st">"ORANGE"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mixture_means) <span class="sc">+</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_means, <span class="at">y =</span> x2_means, <span class="at">col =</span> Y), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The 100 originals samples for each class from <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009, 12–16</a>)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> mixture.example<span class="sc">$</span>y</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> mixture.example<span class="sc">$</span>x[,<span class="dv">1</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> mixture.example<span class="sc">$</span>x[,<span class="dv">2</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>data_mixture_example <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Y, x1, x2) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as_factor</span>(Y))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw dataset</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>250 additional samples for each class simulated using <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> recipe, we show them together with the class centers:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>new_mixture <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../1_Scoring_and_Logistic_Regression/new_mixture.rds"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_mixture[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">250</span>,<span class="dv">5001</span><span class="sc">:</span><span class="dv">5251</span>),]) <span class="sc">+</span> <span class="co"># we plot only the first 250 of each class</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> mixture_means, <span class="fu">aes</span>(<span class="at">x =</span> x1_means, <span class="at">y =</span> x2_means, <span class="at">col =</span>Y), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We use the R package <code>rpart</code> (Recursive PARTitioning), an open source implementation closely following the ideas from CART (<span class="citation" data-cites="Breiman83">Breiman et al. (<a href="#ref-Breiman83" role="doc-biblioref">1983</a>)</span>). Details on the implementation are available <a href="https://cran.r-project.org/web/packages/rpart/vignettes/longintro.pdf">here</a>.</p>
<p>We use here the default parameters, for each node we display the class label BLUE/ORANGE (B/O), the observed probabilities/populations of classes B/O per node:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot) </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>mixture_example_CART <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data_mixture_example, <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rpart.plot(mixture_example_CART, digits=4)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>mixture_example_CART_plot <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>.,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="st">"BLUE"</span>, <span class="st">"ORANGE"</span>)),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(mixture_example_CART_plot, <span class="at">type =</span> <span class="dv">2</span>, <span class="at">extra =</span> <span class="dv">4</span>, <span class="at">fallen.leaves =</span> <span class="cn">TRUE</span>, <span class="at">digits=</span><span class="dv">3</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.col =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)[mixture_example_CART<span class="sc">$</span>frame<span class="sc">$</span>yval],</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we indicate both Class 0-1 probabilities and number of observations for each node</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">node.fun =</span> <span class="cf">function</span>(x, labs, digits, varlen) <span class="fu">paste</span>(labs, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="st">"B/O: "</span>, x<span class="sc">$</span>frame<span class="sc">$</span>yval2[,<span class="dv">2</span>], <span class="st">" - "</span>, x<span class="sc">$</span>frame<span class="sc">$</span>yval2[,<span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Starting from the top of the tree and going down the <code>CART/rpart</code> algorithm splits at each node according to a binary decision.</p>
<p>It ends up splitting the space into six regions, and then models the output by the mode/majority (classification) or proportion (scoring/probability) of <span class="math inline">\(Y\)</span> in each region. The result is the following:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>cutoff_1 <span class="ot">&lt;-</span> <span class="fl">0.14</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>cutoff_2 <span class="ot">&lt;-</span> <span class="fl">2.2</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>cutoff_3 <span class="ot">&lt;-</span> <span class="fl">3.1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>cutoff_4 <span class="ot">&lt;-</span> <span class="fl">0.98</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>cutoff_5 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>x1_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">3</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>x1_max <span class="ot">&lt;-</span> <span class="fl">4.5</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>x2_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>x2_max <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>r1x <span class="ot">&lt;-</span> (x1_min <span class="sc">+</span> x1_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>r1y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> x2_min) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>r2x <span class="ot">&lt;-</span> (cutoff_2 <span class="sc">+</span> cutoff_3) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>r2y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> x2_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>r3x <span class="ot">&lt;-</span> (cutoff_3 <span class="sc">+</span> x1_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>r3y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> x2_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>r4x <span class="ot">&lt;-</span> (x1_min <span class="sc">+</span> cutoff_2) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>r4y <span class="ot">&lt;-</span> (cutoff_4 <span class="sc">+</span> x2_max) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>r5x <span class="ot">&lt;-</span> (x1_min <span class="sc">+</span> cutoff_5) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>r5y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> cutoff_4) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>r6x <span class="ot">&lt;-</span> (cutoff_2 <span class="sc">+</span> cutoff_5) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>r6y <span class="ot">&lt;-</span> (cutoff_1 <span class="sc">+</span> cutoff_4) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw dataset</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_min, <span class="at">y =</span> cutoff_4, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_5, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_5, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>At each step, the input variable and splitting rule is chosen to achieve a best fit given some criterion. Then one or both of the resulting regions are split into two more regions, and this process is continued, until some stopping rule is applied.</p>
<p>For example, with the Mixture data, <code>CART/rpart</code> first splits at <span class="math inline">\(x_2=s_1=0.14\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then, the region <span class="math inline">\(x_2 \geq s_1\)</span> is split at <span class="math inline">\(x_1 = s_2 = 2.2\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then, the region <span class="math inline">\(x_2 \geq s_1, \mbox{ } x_1 &gt; s_2\)</span> is split at <span class="math inline">\(x_1 = s_3 = 3.1\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r2x, <span class="at">y=</span>r2y, <span class="at">label =</span> <span class="st">"R[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_3, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r3x, <span class="at">y=</span>r3y, <span class="at">label =</span> <span class="st">"R[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And the region <span class="math inline">\(x_2 \geq s_1, \mbox{ } x_1 \leq s_2\)</span> is split at <span class="math inline">\(x_2 = s_4 = 0.98\)</span>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r2x, <span class="at">y=</span>r2y, <span class="at">label =</span> <span class="st">"R[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_3, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r3x, <span class="at">y=</span>r3y, <span class="at">label =</span> <span class="st">"R[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_min, <span class="at">y =</span> cutoff_4, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_4, <span class="at">label =</span> <span class="st">"s[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r4x, <span class="at">y=</span>r4y, <span class="at">label =</span> <span class="st">"R[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally only the region <span class="math inline">\(x_2 \geq s_1, \mbox{ } x_1 \leq s_2, \mbox{ } x_2 &lt; s_4\)</span> is split at <span class="math inline">\(x_1 = s_5 = 1\)</span>.</p>
<p>The result of this process is a partition into the six regions <span class="math inline">\(R_1, R_2, . . . , R_6\)</span> shown below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_mixture_example) <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cutoff_1) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r1x, <span class="at">y=</span>r1y, <span class="at">label =</span> <span class="st">"R[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_1, <span class="at">label =</span> <span class="st">"s[1]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_2, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_2, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_3, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_3, <span class="at">yend =</span> x2_max)) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r2x, <span class="at">y=</span>r2y, <span class="at">label =</span> <span class="st">"R[2]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_3, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r3x, <span class="at">y=</span>r3y, <span class="at">label =</span> <span class="st">"R[3]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1_min, <span class="at">y =</span> cutoff_4, <span class="at">xend =</span> cutoff_2, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>x1_min<span class="fl">-0.25</span>, <span class="at">y=</span>cutoff_4, <span class="at">label =</span> <span class="st">"s[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r4x, <span class="at">y=</span>r4y, <span class="at">label =</span> <span class="st">"R[4]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutoff_5, <span class="at">y =</span> cutoff_1, <span class="at">xend =</span> cutoff_5, <span class="at">yend =</span> cutoff_4)) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r5x, <span class="at">y=</span>r5y, <span class="at">label =</span> <span class="st">"R[5]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>cutoff_5, <span class="at">y=</span>x2_max<span class="fl">+0.2</span>, <span class="at">label =</span> <span class="st">"s[5]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x=</span>r6x, <span class="at">y=</span>r6y, <span class="at">label =</span> <span class="st">"R[6]"</span>, <span class="at">parse=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x1_min, x1_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(x2_min, x2_max, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(x1_min, x1_max), <span class="at">ylim =</span> <span class="fu">c</span>(x2_min, x2_max), <span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">'off'</span>) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>),</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"inches"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We now seek to understand how <code>CART/rpart</code> proceeds to grow a decision tree.</p>
<p>The data set consists of <span class="math inline">\(p\)</span> inputs or predictors and a response variable or output <span class="math inline">\(Y\)</span>, with <span class="math inline">\(n\)</span> observations: <span class="math inline">\((x_i, y_i)\)</span> for <span class="math inline">\(i = 1,\cdots,n\)</span>, and <span class="math inline">\(x_i = (x_{i1},\cdots,x_{ip})\)</span>.</p>
<p>The CART algorithm needs to automatically decide which variables to split on and which split points or threshold to use.</p>
<p>Suppose first that we have a partition into <span class="math inline">\(M\)</span> regions <span class="math inline">\(R_1, R_2, . . . , R_M\)</span>. Given a leaf node <span class="math inline">\(m\)</span> representing a region <span class="math inline">\(R_m\)</span> containing <span class="math inline">\(n_m\)</span> observations, we define for <span class="math inline">\(k \in \{0,1\}\)</span>:</p>
<p><span class="math display">\[
\hat p^m_{k}=\frac{1}{\textrm{Card}\{x_i \in R_m\}}\sum_{x_i \in R_m}\mathbb{1}_{y_i=k}
\]</span></p>
<p>the proportion of response <span class="math inline">\(1\)</span> or <span class="math inline">\(0\)</span> in leaf node <span class="math inline">\(m\)</span>.</p>
<p>CART models the class of output variable as a constant in each region <span class="math inline">\(m\)</span>.</p>
<p>Let <span class="math inline">\(C_m\)</span> be the class of output variable in region <span class="math inline">\(m\)</span>, for <span class="math inline">\(k \in \{0,1\}\)</span> we estimate <span class="math inline">\(\mathbf P(C_m=k)\)</span> with <span class="math inline">\(\hat p^m_{k}\)</span>.</p>
<p>And we classify the region <span class="math inline">\(m\)</span> with <span class="math inline">\(\hat C_m = \underset{k \in \{0,1\}}{\operatorname{argmax}}\hat p^m_{k}\)</span>.</p>
<p>The CART algorithm is recursive (we will propose below a simplified implementation) so that we just have to understand how CART splits a node at any step and more precisely what criterion is used.</p>
<section id="splitting-criterion" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="splitting-criterion"><span class="header-section-number">1.1</span> Splitting criterion</h2>
<p>In order to classify well the data, CART seeks as much as possible to obtain pure leaf nodes (i.e.&nbsp;high probability for one class).</p>
<p>At each step CART selects a predictor <span class="math inline">\(X_j\)</span> and a split-point <span class="math inline">\(s\)</span> such that splitting the current region <span class="math inline">\(\mathcal R\)</span> into the regions <span class="math inline">\(\mathcal R_L(j,s)=\{X|Xj &lt; s\}\)</span> and <span class="math inline">\(\mathcal R_R(j,s)=\{X|Xj ≥ s\}\)</span> leads to the greatest possible reduction in a well chosen measure of impurity.</p>
<p>Given a leaf node <span class="math inline">\(m\)</span> representing a region <span class="math inline">\(R_m\)</span> containing <span class="math inline">\(n_m\)</span> observations we denote <span class="math inline">\(\mathcal I_m\)</span> a measure of node impurity, three measures are usually retained:</p>
<ul>
<li><p>the misclassification error: <span class="math inline">\(\mathcal I_m =\frac{1}{n_m}\sum_{x_i \in R_m}\mathbb{1}_{y_i\neq \hat C_m}= 1-\hat p^m_{\hat C_m}=1-\max(\hat p^m, 1-\hat p^m)\)</span> the fraction of observations in the region that do not belong to the most common class</p></li>
<li><p>the Gini index: <span class="math inline">\(\mathcal I_m=\sum_{k}\hat p^m_{k}(1-\hat p^m_{k})=2\hat p^m(1-\hat p^m)\)</span></p></li>
<li><p>the cross-entropy or deviance: <span class="math inline">\(\mathcal I_m=-\sum_{k} \hat p^m_{k}\log(1-\hat p^m_{k})=-\hat p^m\log(\hat p^m)- (1-\hat p^m)\log(1-\hat p^m)\)</span></p></li>
</ul>
<p>where we have denoted <span class="math inline">\(\hat p^m=\hat p^m_{1}=1-\hat p^m_{0}\)</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>imp_plot <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">by=</span><span class="fl">0.01</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>imp_gini <span class="ot">&lt;-</span> <span class="cf">function</span>(p){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span><span class="sc">*</span>p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>imp_gini_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(imp_gini)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>imp_entropy <span class="ot">&lt;-</span> <span class="cf">function</span>(p){</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p<span class="sc">==</span><span class="dv">0</span> <span class="sc">|</span> p<span class="sc">==</span><span class="dv">1</span>){</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    ent <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    ent <span class="ot">=</span> <span class="sc">-</span>p<span class="sc">*</span><span class="fu">log</span>(p) <span class="sc">-</span> (<span class="dv">1</span><span class="sc">-</span>p)<span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  ent</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>imp_entropy_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(imp_entropy)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>imp_misclass <span class="ot">&lt;-</span> <span class="cf">function</span>(p){</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">-</span><span class="fu">max</span>(p,<span class="dv">1</span><span class="sc">-</span>p)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>imp_misclass_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(imp_misclass)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>imp_plot <span class="ot">&lt;-</span> imp_plot  <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gini =</span> <span class="fu">imp_gini_V</span>(x),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">entropy =</span> <span class="fu">imp_entropy_V</span>(x),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">misclass =</span> <span class="fu">imp_misclass_V</span>(x)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>x, <span class="at">names_to =</span> <span class="st">"impurity"</span>, <span class="at">values_to =</span> <span class="st">"val"</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(imp_plot, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>val, <span class="at">col=</span>impurity))<span class="sc">+</span><span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We consider <span class="math inline">\(\mathcal R_L(j,s)\)</span> and <span class="math inline">\(\mathcal R_R(j,s)\)</span> two nodes/regions corresponding to a potential node/region <span class="math inline">\(\mathcal R\)</span> split. Having chosen an impurity measure CART seeks to minimize the weighted average of <span class="math inline">\(\mathcal R_L(j,s)\)</span> and <span class="math inline">\(\mathcal R_R(j,s)\)</span> impurities :</p>
<p><span class="math display">\[
n_L\mathcal I(\mathcal R_L(j,s))+n_R\mathcal I(\mathcal R_R(j,s))
\]</span></p>
<p>A justification to use Gini or Entropy instead of Misclassification is given in <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span>: first these two measures are differentiable, hence more amenable to numerical optimization, also considering the following example they favor purity within the nodes:</p>
<ul>
<li>a binary classification problem with <span class="math inline">\(400\)</span> observations per class <span class="math inline">\((400, 400)\)</span></li>
<li>first split: <span class="math inline">\((300, 100)\)</span> with <span class="math inline">\(\hat p^m_0=0.75\)</span> and <span class="math inline">\((100, 300)\)</span> with <span class="math inline">\(\hat p^m_1=0.75\)</span></li>
<li>second split: <span class="math inline">\((200, 400)\)</span> with <span class="math inline">\(\hat p^m_1=0.666\)</span> and <span class="math inline">\((200, 0)\)</span> with with <span class="math inline">\(\hat p^m_0=1\)</span></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>n_l_1 <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>n_r_1 <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>p_l_1 <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>p_r_1<span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>gini_1 <span class="ot">&lt;-</span> (n_l_1 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_l_1) <span class="sc">+</span> n_r_1 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_r_1)) <span class="sc">/</span> (n_l_1  <span class="sc">+</span> n_r_1 )</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>entropy_1 <span class="ot">&lt;-</span> (n_l_1 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_l_1) <span class="sc">+</span> n_r_1 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_r_1)) <span class="sc">/</span> (n_l_1  <span class="sc">+</span> n_r_1 )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>misclass_1 <span class="ot">&lt;-</span> (n_l_1 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_l_1) <span class="sc">+</span> n_r_1 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_r_1)) <span class="sc">/</span> (n_l_1  <span class="sc">+</span> n_r_1 )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>n_l_2 <span class="ot">&lt;-</span> <span class="dv">600</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>n_r_2 <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>p_l_2 <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>p_r_2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>gini_2 <span class="ot">&lt;-</span> (n_l_2 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_l_2) <span class="sc">+</span> n_r_2 <span class="sc">*</span> <span class="fu">imp_gini</span>(p_r_2)) <span class="sc">/</span> (n_l_2  <span class="sc">+</span> n_r_2 )</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>entropy_2 <span class="ot">&lt;-</span> (n_l_2 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_l_2) <span class="sc">+</span> n_r_2 <span class="sc">*</span> <span class="fu">imp_entropy</span>(p_r_2)) <span class="sc">/</span> (n_l_2  <span class="sc">+</span> n_r_2 )</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>misclass_2 <span class="ot">&lt;-</span> (n_l_2 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_l_2) <span class="sc">+</span> n_r_2 <span class="sc">*</span> <span class="fu">imp_misclass</span>(p_r_2)) <span class="sc">/</span> (n_l_2  <span class="sc">+</span> n_r_2 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We now look at the weighted average impurities for each split:</p>
<ul>
<li>first split : Gini: 0.38 / Entropy: 0.56 / Misclassification: 0.25</li>
<li>second split : Gini: 0.33 / Entropy: 0.48 / Misclassification: 0.25</li>
</ul>
<p>Both splits share a Misclassification rate of <span class="math inline">\(0.25\)</span> while Gini and Entropy are decreasing for second split. Intuitively, these two measures will favor purer node than Misclassification and are usually preferred in decision tree algorithms.</p>
</section>
<section id="tree-building-process" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="tree-building-process"><span class="header-section-number">1.2</span> Tree-building process</h2>
<p>Having chosen a criterion, the CART algorithm uses a top-down, greedy approach that is known as recursive binary splitting:</p>
<ul>
<li><p>top-down: begins at the top of the tree and then recursively splits the input space; each split produces two new branches further down on the tree.</p></li>
<li><p>greedy: at each step of the building process, the best split is made without looking ahead and trying to pick a split that will lead to a better tree in some future step.</p></li>
</ul>
<p><strong>Categorical predictors</strong></p>
<p>Assuming we have a categorical feature with <span class="math inline">\(p\)</span> possible values. We seek the best split into two groups, there is <span class="math inline">\(2^{p-1}-1\)</span> possible splits, which can be prohibitive for large <span class="math inline">\(p\)</span>.</p>
<p>A trick usually implemented, working only for binary classification, is to transform categorical predictors. Usually the proportion of class <span class="math inline">\(1\)</span> for each category is computed, and the algorithm splits on this numerical/ordinal column only needing <span class="math inline">\(p\)</span> splits. This trick and its proof are available in <span class="citation" data-cites="Breiman83">Breiman et al. (<a href="#ref-Breiman83" role="doc-biblioref">1983</a>)</span>.</p>
<p>In <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> it is noted that categorical predictors with many levels usually lead to severe overfitting in the context of decision trees, so that such variables might have to be transformed (by regrouping categories) or avoided.</p>
<p><strong>Implementation for quantitative predictors</strong></p>
<p>We implement below a simple (only working with quantitative variables), naive (not optimized with virtually no exception handling) and unsafe recursive method reproducing roughly the <code>CART/rpart</code> algorithm.</p>
<p>First we define helper functions for the impurity measures:</p>
<p>Entropy:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>entropy <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, y, <span class="at">verbose =</span> <span class="cn">FALSE</span>){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assumes y is a factor</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> tbl <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>y) <span class="sc">%&gt;%</span> <span class="fu">table</span>()<span class="sc">/</span><span class="fu">nrow</span>(tbl)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verbose) {<span class="fu">print</span>(p)}</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="sc">-</span>p<span class="sc">*</span><span class="fu">log2</span>(p<span class="fl">+1e-9</span>))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>and Gini:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gini <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, y, <span class="at">verbose =</span> <span class="cn">FALSE</span>){</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assumes y if a factor</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(tbl) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># computes the proportion of class 0-1 per node</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   Y</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  0   1 </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  1-p% p% </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> tbl <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">!!</span>y) <span class="sc">%&gt;%</span> <span class="fu">table</span>()<span class="sc">/</span><span class="fu">nrow</span>(tbl)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verbose) {<span class="fu">print</span>(p)}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(p<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we define a function returning for a given choice of continuous variable and split value, the impurity of the two children nodes and their weighted average impurity:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>impurity_decrease <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl_node, y_name, x_name, split_value, <span class="at">impurity =</span> gini, <span class="at">min_leaf =</span> <span class="dv">5</span>){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Whenever any of left/right child node contains less than min_leaf observations we return a default value for impurity</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># excluding de facto the split to be taken into account</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    ret_default <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"impurity_left"</span><span class="ot">=</span><span class="dv">666</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_right"</span><span class="ot">=</span><span class="dv">666</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_total"</span><span class="ot">=</span><span class="dv">666</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    tbl_left <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name <span class="sc">&lt;</span> <span class="sc">!!</span>split_value)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    n_left <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tbl_left)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_left <span class="sc">&lt;</span> min_leaf){<span class="fu">return</span>(ret_default)} </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    impurity_left <span class="ot">&lt;-</span> <span class="fu">impurity</span>(tbl_left, y_name)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    tbl_right <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name <span class="sc">&gt;=!!</span>split_value)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    n_right <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tbl_right)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_right <span class="sc">&lt;</span> min_leaf){<span class="fu">return</span>(ret_default)}</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    impurity_right <span class="ot">&lt;-</span> <span class="fu">impurity</span>(tbl_right, y_name)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"impurity_left"</span><span class="ot">=</span>impurity_left,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_right"</span><span class="ot">=</span>impurity_right,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_total"</span><span class="ot">=</span>n_left<span class="sc">/</span>(n_left<span class="sc">+</span>n_right)<span class="sc">*</span>impurity_left<span class="sc">+</span> n_right<span class="sc">/</span>(n_left<span class="sc">+</span>n_right)<span class="sc">*</span>impurity_right))</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using this <code>impurity_decrease</code> function and given a node, the following <code>max_impurity_decrease</code> function computes for each variable <span class="math inline">\(j\)</span> and split value <span class="math inline">\(s\)</span> the impurity decrease, ultimately seeking the best split in terms of weighted average impurity:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>max_impurity_decrease <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl_node, y_name, x_names, <span class="at">impurity =</span> gini, <span class="at">min_leaf =</span> <span class="dv">5</span>, <span class="at">midpoint =</span> <span class="cn">FALSE</span>){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    imp_node <span class="ot">=</span> <span class="fu">impurity</span>(tbl_node, y_name)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    list_all_x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    tbl_res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">feature_split =</span> <span class="st">"zzz"</span>, <span class="at">split_rule =</span> <span class="sc">-</span><span class="dv">666</span>, <span class="at">imp_left =</span> <span class="dv">666</span>, <span class="at">imp_right =</span> <span class="dv">666</span>, <span class="at">imp_total =</span> <span class="dv">666</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (x_name <span class="cf">in</span> x_names){</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        list_x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>       <span class="co"># print(x_name)</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        splits <span class="ot">&lt;-</span> <span class="fu">unique</span>(tbl_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x_name))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># modify the algorithm to split on 'midpoint' value for continuous variable (some decision trees do (CART) other don't (C4.5))</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(midpoint){</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            splits <span class="ot">&lt;-</span> <span class="fu">sort</span>(splits)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            splits <span class="ot">&lt;-</span> splits[<span class="sc">-</span><span class="fu">length</span>(splits)] <span class="sc">+</span> <span class="fu">diff</span>(splits)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (split <span class="cf">in</span> splits){</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(split)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            imp_dec <span class="ot">&lt;-</span> <span class="fu">impurity_decrease</span>(tbl_node, y_name, x_name, split, impurity, min_leaf)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># list_x[[j]] &lt;- c(split, imp_dec)</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>            tbl_res <span class="ot">&lt;-</span>  <span class="fu">bind_rows</span>(tbl_res,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">tibble</span>(<span class="at">feature_split =</span> <span class="fu">as.character</span>(x_name),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">split_rule =</span> split,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_node =</span> imp_node,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_left =</span> imp_dec[[<span class="st">"impurity_left"</span>]],</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_right =</span> imp_dec[[<span class="st">"impurity_right"</span>]],</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_total =</span> imp_dec[[<span class="st">"impurity_total"</span>]]))</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        }   </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tbl_res)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We test this function with the mixture data set, starting at the root node using Gini impurity measure:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tbl_node <span class="ot">&lt;-</span> data_mixture_example</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">max_impurity_decrease</span>(tbl_node, y_name, x_names)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>(test <span class="ot">&lt;-</span>test <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(feature_split<span class="sc">!=</span><span class="st">"zzz"</span>, imp_total <span class="sc">!=</span> <span class="dv">666</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(imp_total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature_split"],"name":[1],"type":["chr"],"align":["left"]},{"label":["split_rule"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["imp_left"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["imp_right"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["imp_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["imp_node"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"x2","2":"0.150864353","3":"0.14201183","4":"0.4558072","5":"0.3742204","6":"0.5"},{"1":"x2","2":"0.551403559","3":"0.30764301","4":"0.4180042","5":"0.3744115","6":"0.5"},{"1":"x2","2":"0.137389748","3":"0.14455978","4":"0.4583577","5":"0.3783393","6":"0.5"},{"1":"x2","2":"0.544177695","3":"0.31065089","4":"0.4226015","5":"0.3789407","6":"0.5"},{"1":"x2","2":"0.556946627","3":"0.32000000","4":"0.4200000","5":"0.3800000","6":"0.5"},{"1":"x2","2":"0.165052639","3":"0.17087932","4":"0.4572169","5":"0.3813374","6":"0.5"},{"1":"x2","2":"0.102975324","3":"0.14720000","4":"0.4608000","5":"0.3824000","6":"0.5"},{"1":"x2","2":"0.525151558","3":"0.31371226","4":"0.4269945","5":"0.3833808","6":"0.5"},{"1":"x2","2":"0.404037972","3":"0.28408163","4":"0.4373964","5":"0.3837363","6":"0.5"},{"1":"x2","2":"0.936223312","3":"0.40123457","4":"0.3638941","5":"0.3840580","6":"0.5"},{"1":"x2","2":"0.186156137","3":"0.19438017","4":"0.4560285","5":"0.3840752","6":"0.5"},{"1":"x2","2":"0.918180475","3":"0.39747241","4":"0.3696243","5":"0.3843838","6":"0.5"},{"1":"x2","2":"0.470747125","3":"0.29591049","4":"0.4354248","5":"0.3851997","6":"0.5"},{"1":"x2","2":"0.585843888","3":"0.33165676","4":"0.4220041","5":"0.3854134","6":"0.5"},{"1":"x2","2":"0.361734172","3":"0.27444865","4":"0.4427610","5":"0.3863764","6":"0.5"},{"1":"x2","2":"0.073293605","3":"0.14993753","4":"0.4631376","5":"0.3864036","6":"0.5"},{"1":"x2","2":"0.215211634","3":"0.21545091","4":"0.4547900","5":"0.3865783","6":"0.5"},{"1":"x2","2":"0.505121685","3":"0.31682825","4":"0.4311915","5":"0.3877334","6":"0.5"},{"1":"x2","2":"0.379000419","3":"0.28733459","4":"0.4409999","5":"0.3879854","6":"0.5"},{"1":"x2","2":"0.184898617","3":"0.19753086","4":"0.4586226","5":"0.3881279","6":"0.5"},{"1":"x2","2":"0.725799603","3":"0.36056054","4":"0.4103563","5":"0.3881972","6":"0.5"},{"1":"x2","2":"0.959990564","3":"0.40703644","4":"0.3666224","5":"0.3886480","6":"0.5"},{"1":"x2","2":"0.742267953","3":"0.36662239","4":"0.4070364","5":"0.3886480","6":"0.5"},{"1":"x2","2":"0.919702238","3":"0.40352869","4":"0.3722974","5":"0.3890061","6":"0.5"},{"1":"x2","2":"0.910978474","3":"0.39981859","4":"0.3776177","5":"0.3892732","6":"0.5"},{"1":"x2","2":"0.413648012","3":"0.29914699","4":"0.4391563","5":"0.3894530","6":"0.5"},{"1":"x2","2":"0.070452553","3":"0.15277778","4":"0.4653740","5":"0.3903509","6":"0.5"},{"1":"x2","2":"0.358477769","3":"0.27777778","4":"0.4460904","5":"0.3905473","6":"0.5"},{"1":"x2","2":"0.207323551","3":"0.21875000","4":"0.4574653","5":"0.3906250","6":"0.5"},{"1":"x2","2":"0.649705578","3":"0.34265318","4":"0.4240161","5":"0.3906573","6":"0.5"},{"1":"x2","2":"0.481080499","3":"0.31000188","4":"0.4372249","5":"0.3907885","6":"0.5"},{"1":"x2","2":"0.490536018","3":"0.32000000","4":"0.4352000","5":"0.3920000","6":"0.5"},{"1":"x2","2":"0.362826378","3":"0.29065744","4":"0.4444444","5":"0.3921569","6":"0.5"},{"1":"x2","2":"0.717486166","3":"0.36337810","4":"0.4156569","5":"0.3926542","6":"0.5"},{"1":"x2","2":"0.979110495","3":"0.41565689","4":"0.3633781","5":"0.3926542","6":"0.5"},{"1":"x2","2":"0.240936940","3":"0.23781213","4":"0.4562587","5":"0.3929092","6":"0.5"},{"1":"x2","2":"0.738892516","3":"0.36938272","4":"0.4125620","5":"0.3931313","6":"0.5"},{"1":"x2","2":"0.961948009","3":"0.41256198","4":"0.3693827","5":"0.3931313","6":"0.5"},{"1":"x2","2":"0.771731486","3":"0.37500000","4":"0.4092936","5":"0.3935185","6":"0.5"},{"1":"x2","2":"0.801422708","3":"0.38026256","4":"0.4058384","5":"0.3938177","6":"0.5"},{"1":"x2","2":"0.901675787","3":"0.40218195","4":"0.3851997","5":"0.3940304","6":"0.5"},{"1":"x2","2":"0.031462099","3":"0.15572657","4":"0.4675125","5":"0.3942428","6":"0.5"},{"1":"x2","2":"0.347995798","3":"0.28118343","4":"0.4492730","5":"0.3946439","6":"0.5"},{"1":"x2","2":"0.020693004","3":"0.12706612","4":"0.4703320","5":"0.3948135","6":"0.5"},{"1":"x2","2":"0.654564443","3":"0.35302656","4":"0.4260355","5":"0.3957368","6":"0.5"},{"1":"x2","2":"0.484102460","3":"0.32322863","4":"0.4390275","5":"0.3961819","6":"0.5"},{"1":"x2","2":"1.026506205","3":"0.42344045","4":"0.3598616","5":"0.3964194","6":"0.5"},{"1":"x2","2":"0.705004818","3":"0.36623068","4":"0.4207064","5":"0.3970095","6":"0.5"},{"1":"x2","2":"0.992199616","3":"0.42070640","4":"0.3662307","5":"0.3970095","6":"0.5"},{"1":"x2","2":"0.973755498","3":"0.41782323","4":"0.3721752","5":"0.3975099","6":"0.5"},{"1":"x2","2":"0.025438551","3":"0.15879017","4":"0.4695564","5":"0.3980802","6":"0.5"},{"1":"x2","2":"0.777194034","3":"0.38293444","4":"0.4115643","5":"0.3982514","6":"0.5"},{"1":"x2","2":"0.809050152","3":"0.38781163","4":"0.4081633","5":"0.3984962","6":"0.5"},{"1":"x2","2":"0.017201649","3":"0.12979989","4":"0.4722301","5":"0.3986076","6":"0.5"},{"1":"x2","2":"0.886232609","3":"0.40456216","4":"0.3923903","5":"0.3986588","6":"0.5"},{"1":"x2","2":"0.326034294","3":"0.28466797","4":"0.4523140","5":"0.3986673","6":"0.5"},{"1":"x2","2":"0.272584762","3":"0.25854639","4":"0.4577235","5":"0.3989662","6":"0.5"},{"1":"x2","2":"1.038922700","3":"0.42806183","4":"0.3628118","5":"0.4006568","6":"0.5"},{"1":"x2","2":"0.665912397","3":"0.36281179","4":"0.4280618","5":"0.4006568","6":"0.5"},{"1":"x2","2":"0.306475077","3":"0.27411986","4":"0.4564981","5":"0.4008727","6":"0.5"},{"1":"x2","2":"1.008993039","3":"0.42551554","4":"0.3691184","5":"0.4012648","6":"0.5"},{"1":"x2","2":"0.693601574","3":"0.36911844","4":"0.4255155","5":"0.4012648","6":"0.5"},{"1":"x2","2":"0.022464061","3":"0.16197531","4":"0.4715088","5":"0.4018638","6":"0.5"},{"1":"x2","2":"0.009673168","3":"0.13265306","4":"0.4740426","5":"0.4023508","6":"0.5"},{"1":"x2","2":"0.323311979","3":"0.28823381","4":"0.4552187","5":"0.4026185","6":"0.5"},{"1":"x2","2":"0.812967619","3":"0.39496528","4":"0.4105030","5":"0.4030449","6":"0.5"},{"1":"x2","2":"0.883552173","3":"0.40695886","4":"0.3992087","5":"0.4031613","6":"0.5"},{"1":"x2","2":"0.287959243","3":"0.27777778","4":"0.4591837","5":"0.4047619","6":"0.5"},{"1":"x2","2":"1.039167443","3":"0.43246402","4":"0.3658006","5":"0.4047987","6":"0.5"},{"1":"x2","2":"0.672350664","3":"0.37204152","4":"0.4300945","5":"0.4054220","6":"0.5"},{"1":"x2","2":"-0.029746130","3":"0.13563355","4":"0.4757723","5":"0.4060439","6":"0.5"},{"1":"x2","2":"0.321050446","3":"0.29188345","4":"0.4579920","5":"0.4064984","6":"0.5"},{"1":"x2","2":"0.813721723","3":"0.40174301","4":"0.4128570","5":"0.4074667","6":"0.5"},{"1":"x2","2":"0.876644795","3":"0.40937163","4":"0.4056729","5":"0.4075408","6":"0.5"},{"1":"x2","2":"-0.330735232","3":"0.00000000","4":"0.4831764","5":"0.4082840","6":"0.5"},{"1":"x2","2":"1.039996187","3":"0.43665613","4":"0.3688281","5":"0.4088466","6":"0.5"},{"1":"x2","2":"-0.064545302","3":"0.13875000","4":"0.4774219","5":"0.4096875","6":"0.5"},{"1":"x2","2":"-0.357915928","3":"0.00000000","4":"0.4844291","5":"0.4117647","6":"0.5"},{"1":"x2","2":"0.852322687","3":"0.40816327","4":"0.4152249","5":"0.4117647","6":"0.5"},{"1":"x2","2":"0.867253738","3":"0.41180000","4":"0.4118000","5":"0.4118000","6":"0.5"},{"1":"x2","2":"1.052235708","3":"0.44064685","4":"0.3718945","5":"0.4128022","6":"0.5"},{"1":"x2","2":"-0.294440957","3":"0.05876951","4":"0.4827710","5":"0.4128107","6":"0.5"},{"1":"x2","2":"-0.166103051","3":"0.10493827","4":"0.4809637","5":"0.4132791","6":"0.5"},{"1":"x2","2":"-0.085187569","3":"0.14201183","4":"0.4789939","5":"0.4132824","6":"0.5"},{"1":"x2","2":"-0.418277898","3":"0.00000000","4":"0.4856195","5":"0.4152047","6":"0.5"},{"1":"x2","2":"1.170055270","3":"0.45568440","4":"0.3402647","5":"0.4158646","6":"0.5"},{"1":"x2","2":"1.085183909","3":"0.44625101","4":"0.3685076","5":"0.4159311","6":"0.5"},{"1":"x2","2":"0.855519879","3":"0.41424344","4":"0.4176061","5":"0.4159416","6":"0.5"},{"1":"x2","2":"-0.309811219","3":"0.06054688","4":"0.4840561","5":"0.4162946","6":"0.5"},{"1":"x2","2":"1.058147178","3":"0.44444444","4":"0.3750000","5":"0.4166667","6":"0.5"},{"1":"x2","2":"-0.271033290","3":"0.10775510","4":"0.4823508","5":"0.4167965","6":"0.5"},{"1":"x2","2":"-0.109150387","3":"0.14542936","4":"0.4804908","5":"0.4168291","6":"0.5"},{"1":"x2","2":"1.165593851","3":"0.45429962","4":"0.3491371","5":"0.4169669","6":"0.5"},{"1":"x2","2":"-0.454657409","3":"0.00000000","4":"0.4867496","5":"0.4186047","6":"0.5"},{"1":"x2","2":"1.174771281","3":"0.45856290","4":"0.3438581","5":"0.4195633","6":"0.5"},{"1":"x2","2":"1.090314031","3":"0.44973230","4":"0.3717322","5":"0.4197022","6":"0.5"},{"1":"x2","2":"-0.283878559","3":"0.11072664","4":"0.4836696","5":"0.4202693","6":"0.5"},{"1":"x2","2":"-0.165204649","3":"0.14901388","4":"0.4819150","5":"0.4203283","6":"0.5"},{"1":"x2","2":"1.079833767","3":"0.44805683","4":"0.3781445","5":"0.4204415","6":"0.5"},{"1":"x2","2":"1.167759713","3":"0.45727811","4":"0.3526531","5":"0.4206593","6":"0.5"},{"1":"x2","2":"1.154179996","3":"0.45593262","4":"0.3607253","5":"0.4216580","6":"0.5"},{"1":"x2","2":"-0.455959142","3":"0.00000000","4":"0.4878212","5":"0.4219653","6":"0.5"},{"1":"x2","2":"1.223981852","3":"0.46244170","4":"0.3379882","5":"0.4219943","6":"0.5"},{"1":"x2","2":"1.135668449","3":"0.45452255","4":"0.3681519","5":"0.4225654","6":"0.5"},{"1":"x2","2":"1.201221704","3":"0.46130364","4":"0.3475162","5":"0.4231848","6":"0.5"},{"1":"x2","2":"1.103914441","3":"0.45304370","4":"0.3750000","5":"0.4233871","6":"0.5"},{"1":"x2","2":"-0.479446546","3":"0.00000000","4":"0.4888360","5":"0.4252874","6":"0.5"},{"1":"x2","2":"1.242869428","3":"0.46496540","4":"0.3417969","5":"0.4255515","6":"0.5"},{"1":"x2","2":"1.148315275","3":"0.45756092","4":"0.3715519","5":"0.4261676","6":"0.5"},{"1":"x2","2":"1.216216381","3":"0.46391178","4":"0.3512397","5":"0.4267300","6":"0.5"},{"1":"x2","2":"1.107883553","3":"0.45619200","4":"0.3783111","5":"0.4269867","6":"0.5"},{"1":"x2","2":"-0.481920759","3":"0.00000000","4":"0.4897959","5":"0.4285714","6":"0.5"},{"1":"x2","2":"1.250357925","3":"0.46736640","4":"0.3456790","5":"0.4290349","6":"0.5"},{"1":"x2","2":"1.283185943","3":"0.47133505","4":"0.3281807","5":"0.4298203","6":"0.5"},{"1":"x2","2":"1.384068805","3":"0.47410226","4":"0.3200000","5":"0.4317241","6":"0.5"},{"1":"x2","2":"-0.530621080","3":"0.00000000","4":"0.4907025","5":"0.4318182","6":"0.5"},{"1":"x2","2":"1.250970789","3":"0.46964923","4":"0.3496358","5":"0.4324451","6":"0.5"},{"1":"x2","2":"1.357381623","3":"0.47337278","4":"0.3324100","5":"0.4331984","6":"0.5"},{"1":"x2","2":"1.276901247","3":"0.47261204","4":"0.3435794","5":"0.4345474","6":"0.5"},{"1":"x2","2":"-0.551650278","3":"0.00000000","4":"0.4915573","5":"0.4350282","6":"0.5"},{"1":"x2","2":"1.384600180","3":"0.47598048","4":"0.3244170","5":"0.4350583","6":"0.5"},{"1":"x2","2":"1.460543433","3":"0.47892636","4":"0.2998751","5":"0.4350588","6":"0.5"},{"1":"x2","2":"1.261365481","3":"0.47181823","4":"0.3536684","5":"0.4357825","6":"0.5"},{"1":"x2","2":"1.358509888","3":"0.47530864","4":"0.3367347","5":"0.4365079","6":"0.5"},{"1":"x2","2":"1.427912819","3":"0.47835683","4":"0.3152634","5":"0.4367680","6":"0.5"},{"1":"x2","2":"-0.733347412","3":"0.00000000","4":"0.4923621","5":"0.4382022","6":"0.5"},{"1":"x2","2":"1.489829603","3":"0.48052285","4":"0.3046875","5":"0.4383224","6":"0.5"},{"1":"x2","2":"1.398988842","3":"0.47776389","4":"0.3289427","5":"0.4383263","6":"0.5"},{"1":"x2","2":"1.273747315","3":"0.47387755","4":"0.3577778","5":"0.4390476","6":"0.5"},{"1":"x2","2":"1.457361044","3":"0.48000000","4":"0.3200000","5":"0.4400000","6":"0.5"},{"1":"x2","2":"-0.737176464","3":"0.00000000","4":"0.4931182","5":"0.4413408","6":"0.5"},{"1":"x2","2":"1.491832426","3":"0.48203682","4":"0.3096424","5":"0.4415241","6":"0.5"},{"1":"x2","2":"1.418180412","3":"0.47945581","4":"0.3335799","5":"0.4415281","6":"0.5"},{"1":"x2","2":"1.633062578","3":"0.48593804","4":"0.2603550","5":"0.4419494","6":"0.5"},{"1":"x2","2":"-0.742851486","3":"0.00000000","4":"0.4938272","5":"0.4444444","6":"0.5"},{"1":"x2","2":"1.545476693","3":"0.48347107","4":"0.3147448","5":"0.4446640","6":"0.5"},{"1":"x2","2":"1.647575574","3":"0.48712087","4":"0.2659280","5":"0.4450942","6":"0.5"},{"1":"x2","2":"1.625783044","3":"0.48679688","4":"0.2887500","5":"0.4471875","6":"0.5"},{"1":"x2","2":"-0.744933603","3":"0.00000000","4":"0.4944904","5":"0.4475138","6":"0.5"},{"1":"x2","2":"1.550985579","3":"0.48482830","4":"0.3200000","5":"0.4477419","6":"0.5"},{"1":"x2","2":"1.704139810","3":"0.48823817","4":"0.2717312","5":"0.4481844","6":"0.5"},{"1":"x2","2":"2.015033249","3":"0.49280000","4":"0.1472000","5":"0.4496000","6":"0.5"},{"1":"x2","2":"-0.761847144","3":"0.00000000","4":"0.4951093","5":"0.4505495","6":"0.5"},{"1":"x2","2":"1.565475021","3":"0.48611111","4":"0.3254132","5":"0.4507576","6":"0.5"},{"1":"x2","2":"1.714859663","3":"0.48929209","4":"0.2777778","5":"0.4512195","6":"0.5"},{"1":"x2","2":"1.608536949","3":"0.48763894","4":"0.3140988","5":"0.4520632","6":"0.5"},{"1":"x2","2":"2.041098516","3":"0.49354339","4":"0.1527778","5":"0.4526515","6":"0.5"},{"1":"x2","2":"2.002274242","3":"0.49263256","4":"0.1975309","5":"0.4527938","6":"0.5"},{"1":"x1","2":"-0.912620059","3":"0.00000000","4":"0.4956852","5":"0.4535519","6":"0.5"},{"1":"x2","2":"-0.787134923","3":"0.00000000","4":"0.4956852","5":"0.4535519","6":"0.5"},{"1":"x2","2":"1.577942178","3":"0.48732200","4":"0.3309897","5":"0.4537106","6":"0.5"},{"1":"x2","2":"1.718885398","3":"0.49028466","4":"0.2840816","5":"0.4541991","6":"0.5"},{"1":"x2","2":"2.052686203","3":"0.49423856","4":"0.1587902","5":"0.4556620","6":"0.5"},{"1":"x2","2":"2.007981737","3":"0.49339411","4":"0.2041420","5":"0.4557913","6":"0.5"},{"1":"x1","2":"-1.021784128","3":"0.00000000","4":"0.4962193","5":"0.4565217","6":"0.5"},{"1":"x2","2":"-0.830414760","3":"0.00000000","4":"0.4962193","5":"0.4565217","6":"0.5"},{"1":"x2","2":"1.580805445","3":"0.48846339","4":"0.3367347","5":"0.4566004","6":"0.5"},{"1":"x2","2":"1.735423774","3":"0.49121788","4":"0.2906574","5":"0.4571226","6":"0.5"},{"1":"x2","2":"1.930257493","3":"0.49323959","4":"0.2448980","5":"0.4584718","6":"0.5"},{"1":"x2","2":"2.075904398","3":"0.49488701","4":"0.1652893","5":"0.4586313","6":"0.5"},{"1":"x1","2":"-1.136539074","3":"0.00000000","4":"0.4967129","5":"0.4594595","6":"0.5"},{"1":"x2","2":"-0.901759351","3":"0.00000000","4":"0.4967129","5":"0.4594595","6":"0.5"},{"1":"x2","2":"1.757231990","3":"0.49209366","4":"0.2975207","5":"0.4599891","6":"0.5"},{"1":"x1","2":"-0.840369051","3":"0.10493827","4":"0.4961357","5":"0.4609280","6":"0.5"},{"1":"x2","2":"2.108804862","3":"0.49549015","4":"0.1723356","5":"0.4615589","6":"0.5"},{"1":"x1","2":"-0.109159157","3":"0.36938272","4":"0.4889906","5":"0.4620789","6":"0.5"},{"1":"x1","2":"-1.162763070","3":"0.00000000","4":"0.4971673","5":"0.4623656","6":"0.5"},{"1":"x2","2":"-0.903565594","3":"0.00000000","4":"0.4971673","5":"0.4623656","6":"0.5"},{"1":"x2","2":"1.805299380","3":"0.49291383","4":"0.3046875","5":"0.4627976","6":"0.5"},{"1":"x1","2":"-0.191272364","3":"0.36281179","4":"0.4903060","5":"0.4635322","6":"0.5"},{"1":"x2","2":"1.881741308","3":"0.49382716","4":"0.2853746","5":"0.4636015","6":"0.5"},{"1":"x1","2":"-0.727077155","3":"0.18000000","4":"0.4960494","5":"0.4644444","6":"0.5"},{"1":"x2","2":"2.125607235","3":"0.49604938","4":"0.1800000","5":"0.4644444","6":"0.5"},{"1":"x1","2":"-0.313007477","3":"0.32698962","4":"0.4927421","5":"0.4645641","6":"0.5"},{"1":"x1","2":"2.071415038","3":"0.49274205","4":"0.3269896","5":"0.4645641","6":"0.5"},{"1":"x1","2":"-0.152822409","3":"0.37500000","4":"0.4900559","5":"0.4647436","6":"0.5"},{"1":"x1","2":"-1.169258605","3":"0.00000000","4":"0.4975836","5":"0.4652406","6":"0.5"},{"1":"x2","2":"-0.919790286","3":"0.00000000","4":"0.4975836","5":"0.4652406","6":"0.5"},{"1":"x2","2":"1.860080951","3":"0.49368019","4":"0.3121748","5":"0.4655469","6":"0.5"},{"1":"x1","2":"0.066332192","3":"0.42000000","4":"0.4853061","5":"0.4657143","6":"0.5"},{"1":"x1","2":"1.640157488","3":"0.48979592","4":"0.3856333","5":"0.4658385","6":"0.5"},{"1":"x1","2":"-0.079583353","3":"0.38563327","4":"0.4897959","5":"0.4658385","6":"0.5"},{"1":"x1","2":"-0.302274664","3":"0.34567901","4":"0.4925640","5":"0.4661247","6":"0.5"},{"1":"x1","2":"-0.196246334","3":"0.36882808","4":"0.4912780","5":"0.4661758","6":"0.5"},{"1":"x1","2":"2.125104790","3":"0.49352791","4":"0.3342516","5":"0.4672473","6":"0.5"},{"1":"x1","2":"-0.368775793","3":"0.33425161","4":"0.4935279","5":"0.4672473","6":"0.5"},{"1":"x1","2":"-0.804293855","3":"0.18836565","4":"0.4965660","5":"0.4672870","6":"0.5"},{"1":"x2","2":"2.142041681","3":"0.49656604","4":"0.1883657","5":"0.4672870","6":"0.5"},{"1":"x1","2":"-0.167523862","3":"0.38074635","4":"0.4910544","5":"0.4673382","6":"0.5"},{"1":"x1","2":"0.033318463","3":"0.41859034","4":"0.4870654","5":"0.4675500","6":"0.5"},{"1":"x1","2":"-1.256441709","3":"0.00000000","4":"0.4979629","5":"0.4680851","6":"0.5"},{"1":"x2","2":"-1.014726822","3":"0.00000000","4":"0.4979629","5":"0.4680851","6":"0.5"},{"1":"x1","2":"0.061145537","3":"0.42401609","4":"0.4866958","5":"0.4682053","6":"0.5"},{"1":"x2","2":"1.877590719","3":"0.49439446","4":"0.3200000","5":"0.4682353","6":"0.5"},{"1":"x1","2":"1.642844649","3":"0.49082206","4":"0.3911111","5":"0.4683871","6":"0.5"},{"1":"x1","2":"-0.311647982","3":"0.35265306","4":"0.4933701","5":"0.4687446","6":"0.5"},{"1":"x1","2":"1.945429440","3":"0.49337006","4":"0.3526531","5":"0.4687446","6":"0.5"},{"1":"x1","2":"-0.200683161","3":"0.37500000","4":"0.4921875","5":"0.4687500","6":"0.5"},{"1":"x1","2":"0.087614787","3":"0.42891696","4":"0.4863102","5":"0.4688053","6":"0.5"},{"1":"x1","2":"-0.077114461","3":"0.40018108","4":"0.4905805","5":"0.4693367","6":"0.5"},{"1":"x1","2":"1.623801765","3":"0.49058055","4":"0.4001811","5":"0.4693367","6":"0.5"},{"1":"x1","2":"0.129985619","3":"0.43335853","4":"0.4859076","5":"0.4693547","6":"0.5"},{"1":"x1","2":"2.126868516","3":"0.49426020","4":"0.3417969","5":"0.4698661","6":"0.5"},{"1":"x1","2":"-0.369493348","3":"0.34179688","4":"0.4942602","5":"0.4698661","6":"0.5"},{"1":"x1","2":"0.013973130","3":"0.42283163","4":"0.4883295","5":"0.4699901","6":"0.5"},{"1":"x1","2":"-0.295362353","3":"0.36815194","4":"0.4932064","5":"0.4700713","6":"0.5"},{"1":"x1","2":"-0.715283835","3":"0.24489796","4":"0.4964889","5":"0.4700718","6":"0.5"},{"1":"x2","2":"2.181549767","3":"0.49704142","4":"0.1975309","5":"0.4700855","6":"0.5"},{"1":"x1","2":"0.056184431","3":"0.42806183","4":"0.4879984","5":"0.4706168","6":"0.5"},{"1":"x1","2":"2.262714148","3":"0.49505831","4":"0.3281807","5":"0.4708611","6":"0.5"},{"1":"x1","2":"1.715233331","3":"0.49178172","4":"0.3966942","5":"0.4708625","6":"0.5"},{"1":"x1","2":"-1.264860817","3":"0.00000000","4":"0.4983063","5":"0.4708995","6":"0.5"},{"1":"x2","2":"-1.023014058","3":"0.00000000","4":"0.4983063","5":"0.4708995","6":"0.5"},{"1":"x1","2":"-0.053430597","3":"0.41522491","4":"0.4900680","5":"0.4709830","6":"0.5"},{"1":"x1","2":"1.532257922","3":"0.49006801","4":"0.4152249","5":"0.4709830","6":"0.5"},{"1":"x1","2":"-0.257136280","3":"0.38132807","4":"0.4930365","5":"0.4712534","6":"0.5"},{"1":"x1","2":"1.520914290","3":"0.48979592","4":"0.4215023","5":"0.4716981","6":"0.5"},{"1":"x1","2":"0.125021393","3":"0.43704475","4":"0.4872926","5":"0.4717158","6":"0.5"},{"1":"x1","2":"0.134347469","3":"0.44091797","4":"0.4869161","5":"0.4721967","6":"0.5"},{"1":"x1","2":"1.749188014","3":"0.49286025","4":"0.3926234","5":"0.4723117","6":"0.5"},{"1":"x1","2":"0.008130556","3":"0.42710744","4":"0.4895125","5":"0.4723511","6":"0.5"},{"1":"x1","2":"2.196544935","3":"0.49494065","4":"0.3496358","5":"0.4724184","6":"0.5"},{"1":"x1","2":"-0.370309590","3":"0.34963580","4":"0.4949407","5":"0.4724184","6":"0.5"},{"1":"x1","2":"1.926571814","3":"0.49397680","4":"0.3750000","5":"0.4725610","6":"0.5"},{"1":"x1","2":"-0.074079101","3":"0.41319444","4":"0.4913435","5":"0.4725877","6":"0.5"},{"1":"x1","2":"1.613212710","3":"0.49134349","4":"0.4131944","5":"0.4725877","6":"0.5"},{"1":"x2","2":"2.207488935","3":"0.49747678","4":"0.2076125","5":"0.4728383","6":"0.5"},{"1":"x1","2":"1.725681429","3":"0.49267719","4":"0.4023797","5":"0.4732632","6":"0.5"},{"1":"x1","2":"1.576976508","3":"0.49111111","4":"0.4200000","5":"0.4733333","6":"0.5"},{"1":"x1","2":"-0.071295170","3":"0.42000000","4":"0.4911111","5":"0.4733333","6":"0.5"},{"1":"x1","2":"-0.429649585","3":"0.33673469","4":"0.4956733","5":"0.4734219","6":"0.5"},{"1":"x1","2":"2.285264980","3":"0.49567334","4":"0.3367347","5":"0.4734219","6":"0.5"},{"1":"x1","2":"-1.464690853","3":"0.00000000","4":"0.4986150","5":"0.4736842","6":"0.5"},{"1":"x2","2":"-1.082164290","3":"0.00000000","4":"0.4986150","5":"0.4736842","6":"0.5"},{"1":"x1","2":"1.897709107","3":"0.49382716","4":"0.3878116","5":"0.4736842","6":"0.5"},{"1":"x1","2":"-0.264756676","3":"0.38781163","4":"0.4938272","5":"0.4736842","6":"0.5"},{"1":"x1","2":"0.267442252","3":"0.45331790","4":"0.4852295","5":"0.4737413","6":"0.5"},{"1":"x1","2":"-0.019836616","3":"0.42603550","4":"0.4908692","5":"0.4740125","6":"0.5"},{"1":"x1","2":"1.522310375","3":"0.49086925","4":"0.4260355","5":"0.4740125","6":"0.5"},{"1":"x1","2":"0.005244683","3":"0.43141289","4":"0.4906174","5":"0.4746322","6":"0.5"},{"1":"x1","2":"1.518293955","3":"0.49061738","4":"0.4314129","5":"0.4746322","6":"0.5"},{"1":"x1","2":"1.816825183","3":"0.49367187","4":"0.3987500","5":"0.4746875","6":"0.5"},{"1":"x1","2":"0.192282525","3":"0.44781065","4":"0.4879012","5":"0.4748718","6":"0.5"},{"1":"x1","2":"-0.400761723","3":"0.35777778","4":"0.4955709","5":"0.4749020","6":"0.5"},{"1":"x1","2":"2.228716379","3":"0.49557093","4":"0.3577778","5":"0.4749020","6":"0.5"},{"1":"x1","2":"-0.681595736","3":"0.29752066","4":"0.4969070","5":"0.4749745","6":"0.5"},{"1":"x2","2":"2.242263910","3":"0.49787335","4":"0.2187500","5":"0.4755435","6":"0.5"},{"1":"x1","2":"1.741742104","3":"0.49351066","4":"0.4081633","5":"0.4755877","6":"0.5"},{"1":"x1","2":"-0.071974368","3":"0.42482299","4":"0.4920837","5":"0.4756048","6":"0.5"},{"1":"x1","2":"1.591324822","3":"0.49208368","4":"0.4248230","5":"0.4756048","6":"0.5"},{"1":"x1","2":"2.290042376","3":"0.49624110","4":"0.3456790","5":"0.4759152","6":"0.5"},{"1":"x1","2":"-0.487292651","3":"0.34567901","4":"0.4962411","5":"0.4759152","6":"0.5"},{"1":"x1","2":"0.259433566","3":"0.45625868","4":"0.4867496","5":"0.4759253","6":"0.5"},{"1":"x1","2":"1.925173384","3":"0.49456133","4":"0.3944485","5":"0.4760405","6":"0.5"},{"1":"x1","2":"0.310785039","3":"0.45862263","4":"0.4863290","5":"0.4762162","6":"0.5"},{"1":"x1","2":"-1.529105572","3":"0.00000000","4":"0.4988898","5":"0.4764398","6":"0.5"},{"1":"x2","2":"-1.095889767","3":"0.00000000","4":"0.4988898","5":"0.4764398","6":"0.5"},{"1":"x1","2":"-0.589045843","3":"0.32986111","4":"0.4968363","5":"0.4767992","6":"0.5"},{"1":"x1","2":"-0.019593015","3":"0.43574226","4":"0.4916470","5":"0.4768322","6":"0.5"},{"1":"x1","2":"1.870899745","3":"0.49442537","4":"0.4049967","5":"0.4769868","6":"0.5"},{"1":"x1","2":"-0.414441664","3":"0.36623068","4":"0.4961527","5":"0.4773140","6":"0.5"},{"1":"x1","2":"1.510827689","3":"0.49141498","4":"0.4403306","5":"0.4773668","6":"0.5"},{"1":"x1","2":"0.205190129","3":"0.45408632","4":"0.4888617","5":"0.4773858","6":"0.5"},{"1":"x1","2":"0.248728401","3":"0.45674740","4":"0.4885216","5":"0.4777184","6":"0.5"},{"1":"x1","2":"0.258880758","3":"0.45918367","4":"0.4881657","5":"0.4780220","6":"0.5"},{"1":"x2","2":"2.255267507","3":"0.49823229","4":"0.2311111","5":"0.4781982","6":"0.5"},{"1":"x1","2":"2.342765510","3":"0.49676311","4":"0.3550296","5":"0.4783378","6":"0.5"},{"1":"x1","2":"-0.570429501","3":"0.35502959","4":"0.4967631","5":"0.4783378","6":"0.5"},{"1":"x1","2":"0.319988146","3":"0.46347699","4":"0.4874024","5":"0.4785500","6":"0.5"},{"1":"x1","2":"-1.776926087","3":"0.00000000","4":"0.4991319","5":"0.4791667","6":"0.5"},{"1":"x2","2":"-1.113541170","3":"0.00000000","4":"0.4991319","5":"0.4791667","6":"0.5"},{"1":"x1","2":"-0.668445480","3":"0.34026465","4":"0.4973028","5":"0.4792434","6":"0.5"},{"1":"x1","2":"0.205456121","3":"0.45979060","4":"0.4897959","5":"0.4797441","6":"0.5"},{"1":"x1","2":"1.486247706","3":"0.49218750","4":"0.4483418","5":"0.4799107","6":"0.5"},{"1":"x1","2":"0.256750222","3":"0.46208780","4":"0.4894820","5":"0.4800310","6":"0.5"},{"1":"x1","2":"1.467109246","3":"0.49196588","4":"0.4518430","5":"0.4803303","6":"0.5"},{"1":"x1","2":"2.343730594","3":"0.49724082","4":"0.3648000","5":"0.4806857","6":"0.5"},{"1":"x1","2":"-0.582356684","3":"0.36480000","4":"0.4972408","5":"0.4806857","6":"0.5"},{"1":"x1","2":"0.323206613","3":"0.46791111","4":"0.4884480","5":"0.4807467","6":"0.5"},{"1":"x2","2":"2.281585046","3":"0.49855475","4":"0.2448980","5":"0.4807988","6":"0.5"},{"1":"x1","2":"-1.796286610","3":"0.00000000","4":"0.4993423","5":"0.4818653","6":"0.5"},{"1":"x2","2":"-1.161742789","3":"0.00000000","4":"0.4993423","5":"0.4818653","6":"0.5"},{"1":"x1","2":"1.486004801","3":"0.49293364","4":"0.4555248","5":"0.4822721","6":"0.5"},{"1":"x1","2":"1.442442554","3":"0.49273175","4":"0.4584889","5":"0.4826301","6":"0.5"},{"1":"x1","2":"0.325768984","3":"0.47195291","4":"0.4894641","5":"0.4828098","6":"0.5"},{"1":"x1","2":"2.432939360","3":"0.49767562","4":"0.3750000","5":"0.4829545","6":"0.5"},{"1":"x2","2":"2.293604575","3":"0.49884183","4":"0.2603550","5":"0.4833402","6":"0.5"},{"1":"x1","2":"0.574290652","3":"0.48000000","4":"0.4866116","5":"0.4836364","6":"0.5"},{"1":"x1","2":"-1.960779713","3":"0.00000000","4":"0.4995217","5":"0.4845361","6":"0.5"},{"1":"x2","2":"-1.241636702","3":"0.00000000","4":"0.4995217","5":"0.4845361","6":"0.5"},{"1":"x2","2":"2.519258089","3":"0.49952173","4":"0.0000000","5":"0.4845361","6":"0.5"},{"1":"x1","2":"0.366954472","3":"0.47562827","4":"0.4904488","5":"0.4847429","6":"0.5"},{"1":"x1","2":"1.436278077","3":"0.49346939","4":"0.4644444","5":"0.4847619","6":"0.5"},{"1":"x1","2":"1.419537021","3":"0.49327872","4":"0.4667014","5":"0.4850397","6":"0.5"},{"1":"x1","2":"2.482942028","3":"0.49806888","4":"0.3856333","5":"0.4851388","6":"0.5"},{"1":"x1","2":"0.571872338","3":"0.48175735","4":"0.4882721","5":"0.4853730","6":"0.5"},{"1":"x1","2":"0.659906227","3":"0.48255042","4":"0.4878377","5":"0.4854320","6":"0.5"},{"1":"x2","2":"2.473922169","3":"0.49932842","4":"0.1975309","5":"0.4857475","6":"0.5"},{"1":"x2","2":"2.421916511","3":"0.49909461","4":"0.2777778","5":"0.4858156","6":"0.5"},{"1":"x1","2":"0.425475683","3":"0.47896121","4":"0.4914002","5":"0.4865490","6":"0.5"},{"1":"x1","2":"0.434501300","3":"0.48000000","4":"0.4911111","5":"0.4866667","6":"0.5"},{"1":"x1","2":"1.432136010","3":"0.49417732","4":"0.4697662","5":"0.4867319","6":"0.5"},{"1":"x1","2":"0.516429077","3":"0.48269335","4":"0.4901508","5":"0.4869441","6":"0.5"},{"1":"x1","2":"1.391351682","3":"0.49400607","4":"0.4716553","5":"0.4869656","6":"0.5"},{"1":"x1","2":"0.566817311","3":"0.48347107","4":"0.4897959","5":"0.4870130","6":"0.5"},{"1":"x1","2":"0.687617592","3":"0.48487713","4":"0.4890261","5":"0.4871176","6":"0.5"},{"1":"x1","2":"0.693435680","3":"0.48551381","4":"0.4886080","5":"0.4871538","6":"0.5"},{"1":"x1","2":"-2.017570738","3":"0.00000000","4":"0.4996713","5":"0.4871795","6":"0.5"},{"1":"x2","2":"-1.314363134","3":"0.00000000","4":"0.4996713","5":"0.4871795","6":"0.5"},{"1":"x2","2":"2.664528311","3":"0.49967127","4":"0.0000000","5":"0.4871795","6":"0.5"},{"1":"x1","2":"2.489806031","3":"0.49842192","4":"0.3966942","5":"0.4872319","6":"0.5"},{"1":"x2","2":"2.433115748","3":"0.49931413","4":"0.2975207","5":"0.4882155","6":"0.5"},{"1":"x1","2":"0.433582885","3":"0.48197404","4":"0.4923161","5":"0.4882310","6":"0.5"},{"1":"x2","2":"2.477865286","3":"0.49951172","4":"0.2187500","5":"0.4882812","6":"0.5"},{"1":"x1","2":"0.437542376","3":"0.48285322","4":"0.4920556","5":"0.4883287","6":"0.5"},{"1":"x1","2":"0.470808790","3":"0.48366962","4":"0.4917817","5":"0.4884152","6":"0.5"},{"1":"x1","2":"0.508118067","3":"0.48442907","4":"0.4914934","5":"0.4884910","6":"0.5"},{"1":"x1","2":"0.528698093","3":"0.48513674","4":"0.4911896","5":"0.4885566","6":"0.5"},{"1":"x1","2":"0.692220033","3":"0.48699272","4":"0.4901738","5":"0.4886946","6":"0.5"},{"1":"x1","2":"0.708542916","3":"0.48753463","4":"0.4897959","5":"0.4887218","6":"0.5"},{"1":"x1","2":"0.768219076","3":"0.48804336","4":"0.4893958","5":"0.4887399","6":"0.5"},{"1":"x1","2":"1.385771564","3":"0.49470156","4":"0.4760742","5":"0.4887408","6":"0.5"},{"1":"x1","2":"1.348700546","3":"0.49454221","4":"0.4775023","5":"0.4889190","6":"0.5"},{"1":"x1","2":"2.490978713","3":"0.49873599","4":"0.4081633","5":"0.4892259","6":"0.5"},{"1":"x1","2":"0.455341779","3":"0.48542534","4":"0.4929618","5":"0.4898718","6":"0.5"},{"1":"x1","2":"0.488746502","3":"0.48611111","4":"0.4927170","5":"0.4899425","6":"0.5"},{"1":"x1","2":"0.752532941","3":"0.48936632","4":"0.4909393","5":"0.4901843","6":"0.5"},{"1":"x1","2":"0.818429991","3":"0.48979592","4":"0.4905805","5":"0.4901961","6":"0.5"},{"1":"x1","2":"0.887558794","3":"0.49058055","4":"0.4897959","5":"0.4901961","6":"0.5"},{"1":"x1","2":"0.878706588","3":"0.49020000","4":"0.4902000","5":"0.4902000","6":"0.5"},{"1":"x1","2":"1.351103591","3":"0.49536351","4":"0.4800000","5":"0.4903704","6":"0.5"},{"1":"x1","2":"1.334410988","3":"0.49522302","4":"0.4811762","5":"0.4905173","6":"0.5"},{"1":"x2","2":"2.453887785","3":"0.49950139","4":"0.3200000","5":"0.4905263","6":"0.5"},{"1":"x2","2":"2.493685703","3":"0.49966442","4":"0.2448980","5":"0.4907476","6":"0.5"},{"1":"x1","2":"1.279559523","3":"0.49476099","4":"0.4841434","5":"0.4908856","6":"0.5"},{"1":"x1","2":"2.499842651","3":"0.49901235","4":"0.4200000","5":"0.4911111","6":"0.5"},{"1":"x1","2":"0.915277236","3":"0.49203506","4":"0.4910192","5":"0.4915424","6":"0.5"},{"1":"x1","2":"0.880230865","3":"0.49171650","4":"0.4913784","5":"0.4915492","6":"0.5"},{"1":"x1","2":"0.840697451","3":"0.49137843","4":"0.4917165","5":"0.4915492","6":"0.5"},{"1":"x1","2":"1.301941035","3":"0.49586777","4":"0.4844291","5":"0.4919786","6":"0.5"},{"1":"x1","2":"1.297167310","3":"0.49573964","4":"0.4853061","5":"0.4920879","6":"0.5"},{"1":"x1","2":"1.282878941","3":"0.49560547","4":"0.4861111","5":"0.4921875","6":"0.5"},{"1":"x1","2":"1.270289602","3":"0.49546485","4":"0.4868517","5":"0.4922780","6":"0.5"},{"1":"x1","2":"0.916822986","3":"0.49334320","4":"0.4921875","5":"0.4927885","6":"0.5"},{"1":"x1","2":"2.526092968","3":"0.49925216","4":"0.4321330","5":"0.4928758","6":"0.5"},{"1":"x1","2":"1.301202425","3":"0.49647456","4":"0.4872926","5":"0.4933068","6":"0.5"},{"1":"x1","2":"1.287421847","3":"0.49636440","4":"0.4879984","5":"0.4933945","6":"0.5"},{"1":"x1","2":"1.269316909","3":"0.49612800","4":"0.4892444","5":"0.4935467","6":"0.5"},{"1":"x1","2":"0.946183859","3":"0.49451247","4":"0.4932964","5":"0.4939348","6":"0.5"},{"1":"x1","2":"2.551446154","3":"0.49945659","4":"0.4444444","5":"0.4945055","6":"0.5"},{"1":"x1","2":"1.244438442","3":"0.49674818","4":"0.4913435","5":"0.4946944","6":"0.5"},{"1":"x1","2":"1.149480708","3":"0.49652778","4":"0.4921875","5":"0.4947917","6":"0.5"},{"1":"x1","2":"0.951265099","3":"0.49555002","4":"0.4943413","5":"0.4949819","6":"0.5"},{"1":"x1","2":"1.238769995","3":"0.49732302","4":"0.4931692","5":"0.4957238","6":"0.5"},{"1":"x1","2":"1.210624499","3":"0.49723380","4":"0.4935107","5":"0.4957632","6":"0.5"},{"1":"x1","2":"1.126644806","3":"0.49714003","4":"0.4938272","5":"0.4957983","6":"0.5"},{"1":"x1","2":"1.084827301","3":"0.49704142","4":"0.4941211","5":"0.4958295","6":"0.5"},{"1":"x1","2":"1.071866057","3":"0.49682826","4":"0.4946492","5":"0.4958804","6":"0.5"},{"1":"x1","2":"1.053188784","3":"0.49671293","4":"0.4948870","5":"0.4959004","6":"0.5"},{"1":"x1","2":"1.040697342","3":"0.49659120","4":"0.4951093","5":"0.4959169","6":"0.5"},{"1":"x1","2":"0.953833479","3":"0.49646257","4":"0.4953174","5":"0.4959301","6":"0.5"},{"1":"x1","2":"2.576843426","3":"0.49962674","4":"0.4567474","5":"0.4959820","6":"0.5"},{"1":"x1","2":"1.224054162","3":"0.49785004","4":"0.4947403","5":"0.4966372","6":"0.5"},{"1":"x1","2":"3.166971551","3":"0.49987919","4":"0.4081633","5":"0.4966691","6":"0.5"},{"1":"x1","2":"1.098734773","3":"0.49770181","4":"0.4952409","5":"0.4966928","6":"0.5"},{"1":"x1","2":"1.079757235","3":"0.49762188","4":"0.4954649","5":"0.4967159","6":"0.5"},{"1":"x1","2":"1.072035946","3":"0.49753770","4":"0.4956733","5":"0.4967360","6":"0.5"},{"1":"x1","2":"1.058348565","3":"0.49744898","4":"0.4958678","5":"0.4967532","6":"0.5"},{"1":"x1","2":"1.047457586","3":"0.49735537","4":"0.4960494","5":"0.4967677","6":"0.5"},{"1":"x1","2":"1.028464289","3":"0.49725652","4":"0.4962193","5":"0.4967794","6":"0.5"},{"1":"x1","2":"2.624577968","3":"0.49976371","4":"0.4687500","5":"0.4972826","6":"0.5"},{"1":"x1","2":"1.076956974","3":"0.49814745","4":"0.4966090","5":"0.4974936","6":"0.5"},{"1":"x1","2":"3.503126460","3":"0.49994686","4":"0.4444444","5":"0.4982818","6":"0.5"},{"1":"x1","2":"2.693936802","3":"0.49986852","4":"0.4800000","5":"0.4983784","6":"0.5"},{"1":"x1","2":"2.988126490","3":"0.49994575","4":"0.4687500","5":"0.4986979","6":"0.5"},{"1":"x1","2":"2.710763558","3":"0.49994219","4":"0.4897959","5":"0.4992320","6":"0.5"},{"1":"x1","2":"3.529264199","3":"0.49998685","4":"0.4800000","5":"0.4994872","6":"0.5"},{"1":"x1","2":"2.929863726","3":"0.49998629","4":"0.4938272","5":"0.4997091","6":"0.5"},{"1":"x1","2":"2.887947028","3":"0.49998600","4":"0.4958678","5":"0.4997595","6":"0.5"},{"1":"x1","2":"2.742092422","3":"0.49998570","4":"0.4970414","5":"0.4997943","6":"0.5"},{"1":"x1","2":"2.813038608","3":"0.50000000","4":"0.5000000","5":"0.5000000","6":"0.5"},{"1":"x1","2":"2.892025340","3":"0.50000000","4":"0.5000000","5":"0.5000000","6":"0.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We plot for variables <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> the weighted average Gini index for each possible split of data:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test , <span class="fu">aes</span>(<span class="at">x=</span>split_rule, <span class="at">y =</span>imp_total, <span class="at">col =</span> feature_split)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The best split in terms of impurity decrease is shown below:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(node_val <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.min</span>(imp_total)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature_split"],"name":[1],"type":["chr"],"align":["left"]},{"label":["split_rule"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["imp_left"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["imp_right"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["imp_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["imp_node"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"x2","2":"0.1508644","3":"0.1420118","4":"0.4558072","5":"0.3742204","6":"0.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>It is achieved for <span class="math inline">\(x_2\)</span> and a value of <span class="math inline">\(0.15\)</span> which is consistent with the <code>R</code> implementation.</p>
<p>The slightly different value <span class="math inline">\(0.1509\)</span> found by our toy implementation vs <span class="math inline">\(0.1441\)</span> for <code>rpart</code> is because <code>CART/rpart</code> splits variables at a midpoint between successive values in data set, while we split ‘on’ the exact values, see for example discussion <a href="https://stackoverflow.com/questions/6290057/how-decision-tree-calculate-the-splitting-attribute?rq=3">here</a>).</p>
<p>Indeed when looking at the adjacent value to our split with minimum impurity:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(node_val_midpoint <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(feature_split<span class="sc">==</span><span class="st">'x2'</span>, split_rule <span class="sc">&lt;=</span> <span class="fl">0.1509</span>, ) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(split_rule)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature_split"],"name":[1],"type":["chr"],"align":["left"]},{"label":["split_rule"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["imp_left"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["imp_right"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["imp_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["imp_node"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"x2","2":"0.1508644","3":"0.1420118","4":"0.4558072","5":"0.3742204","6":"0.5"},{"1":"x2","2":"0.1373897","3":"0.1445598","4":"0.4583577","5":"0.3783393","6":"0.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>and taking the average value we verify that <code>rpart</code> splits on midpoint value:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(node_val_midpoint <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(split_rule <span class="sc">&lt;</span> <span class="fl">0.16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">midpoint=</span><span class="fu">mean</span>(split_rule)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pull</span>(midpoint))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1441271</code></pre>
</div>
</div>
<p>All of this nitpicking shows that each decision tree implementation is specific and when using a new one it is a good idea to check some details on simple cases.</p>
<p>As a matter of fact modern decision tree (boosting) algorithm optimize the way tree splitting is performed see for example <a href="https://lightgbm.readthedocs.io/en/stable/Features.html#optimization-in-speed-and-memory-usage">LightGBM</a> using histograms/binning for numerical variables and <a href="https://xgboost.readthedocs.io/en/stable/treemethod.html">XGBoost</a> using various methods from iterating over all values (<code>exact</code>) to histogram methods similar to LightGBM (<code>hist</code>). XGBoost developers even warn the package users that actual implementation of algorithm may differ from pure mathematical theory<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>So we have slightly modified our splitting algorithm implementation above (<code>max_impurity_decrease</code>) with the option to split on midpoints so that it matches the value from <code>CART/rpart</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>tbl_node <span class="ot">&lt;-</span> data_mixture_example</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>test_midpoint <span class="ot">&lt;-</span> <span class="fu">max_impurity_decrease</span>(tbl_node, y_name, x_names, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>(test_midpoint <span class="ot">&lt;-</span>test_midpoint <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(feature_split<span class="sc">!=</span><span class="st">"zzz"</span>, imp_total <span class="sc">!=</span> <span class="dv">666</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.min</span>(imp_total)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature_split"],"name":[1],"type":["chr"],"align":["left"]},{"label":["split_rule"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["imp_left"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["imp_right"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["imp_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["imp_node"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"x2","2":"0.1441271","3":"0.1420118","4":"0.4558072","5":"0.3742204","6":"0.5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We then implement the recursive splitting algorithm, specifying some stopping rules (the node is pure, a maximum tree depth is attained, a minimum number of observations per node is attained).</p>
<p>At each step a node/list stores the relevant information: the split variable and value, the left/right children (two nodes/lists), impurity for the node, number of observations for class <span class="math inline">\(0/1\)</span>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tbl_node <span class="ot">&lt;-</span> data_mixture_example</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>node <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_node,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"impurity"</span> <span class="ot">=</span> <span class="fl">0.5</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_zero"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_one"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>             <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We define a <code>break_at</code> function implementing the best split for a given node and returning the splitting rule (variable to split, split value):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>break_at <span class="ot">&lt;-</span> <span class="cf">function</span>(node, min_leaf, midpoint){</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    tbl_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    x_names <span class="ot">&lt;-</span> node[[<span class="st">"features"</span>]]</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    break_node <span class="ot">&lt;-</span> <span class="fu">max_impurity_decrease</span>(tbl_node, y_name, x_names, gini, min_leaf, midpoint)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    break_node <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(feature_split<span class="sc">!=</span><span class="st">"zzz"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>               imp_total <span class="sc">!=</span> <span class="dv">666</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>               imp_node <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="co"># don't split when node is pure (ie 0 impurity)</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.min</span>(imp_total))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(break_node)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The function below <code>conditional_split</code> looks at a provided children node (left or right) to check if it is terminal given a stopping rule (either the max tree depth is attained, or there is a single element in the node). If not the tree continues to grow (ie the recursion continues and the recursive function <code>grow_decision_tree</code> defined below is called). It also computes metrics (number of observations per class, probabilities of classes 0-1, vote …) to fill the given node with useful information:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>conditional_split <span class="ot">&lt;-</span> <span class="cf">function</span>(node, depth, max_depth, min_leaf, midpoint)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(node[[<span class="st">"data"</span>]]) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> depth <span class="sc">==</span> max_depth) {</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"is_leaf"</span>]] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>      y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]] </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>      table_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">!!</span>y_name) <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">table</span>()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># produces a table for 0-1 classes</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># target variable</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 0    1 </span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># n_0 n_1 </span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">#print(table_node)</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>      n_zero_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">1</span>])</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"n_zero"</span>]] <span class="ot">&lt;-</span> n_zero_node</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>      n_one_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">2</span>])</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"n_one"</span>]] <span class="ot">&lt;-</span> n_one_node</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>      prob_node <span class="ot">&lt;-</span> n_one_node <span class="sc">/</span> (n_zero_node<span class="sc">+</span> n_one_node)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">#print(prob_node)</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"p1"</span>]] <span class="ot">&lt;-</span> prob_node</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>      vote_node<span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n_one_node<span class="sc">&gt;</span> n_zero_node, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"vote"</span>]] <span class="ot">&lt;-</span> vote_node</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(node)}</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">grow_decision_tree</span>(node, depth <span class="sc">+</span> <span class="dv">1</span>, max_depth, min_leaf, midpoint)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>}    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally the function <code>grow_decision_tree</code> implements the recursion, breaking the current node into left and right children nodes and conditionally to the stopping rule splitting each child node:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>grow_decision_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(node, <span class="at">depth =</span> <span class="dv">1</span>, <span class="at">max_depth =</span> <span class="dv">2</span>, <span class="at">min_leaf =</span> <span class="dv">5</span>, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># before split</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  tbl_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]]  </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  x_names  <span class="ot">&lt;-</span> node[[<span class="st">"features"</span>]]  </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]]  </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  table_node <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">!!</span>y_name) <span class="sc">%&gt;%</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">table</span>()</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(table_node)</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  n_zero_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">1</span>])</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"n_zero"</span>]] <span class="ot">&lt;-</span> n_zero_node</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  n_one_node<span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(table_node[<span class="dv">2</span>])</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"n_one"</span>]] <span class="ot">&lt;-</span> n_one_node</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  prob_node <span class="ot">&lt;-</span> n_one_node <span class="sc">/</span> (n_zero_node<span class="sc">+</span> n_one_node)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(prob_node)</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"p1"</span>]] <span class="ot">&lt;-</span> prob_node</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  vote_node<span class="ot">&lt;-</span> <span class="fu">ifelse</span>(n_one_node<span class="sc">&gt;</span> n_zero_node, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"vote"</span>]] <span class="ot">&lt;-</span> vote_node</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># split using break node function</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  break_node <span class="ot">&lt;-</span> <span class="fu">break_at</span>(node, min_leaf, midpoint)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(break_node) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"is_leaf"</span>]] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(node)}</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  x_name_node <span class="ot">&lt;-</span> <span class="fu">as.name</span>(break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(feature_split))</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  split_value_node <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(split_rule)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"impurity"</span>]] <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(imp_node)</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"split"</span>]] <span class="ot">&lt;-</span> split_value_node</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"feature_split"</span>]] <span class="ot">&lt;-</span> x_name_node</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recursion, calling conditional split for left/right children</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  tbl_left <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name_node <span class="sc">&lt;</span> <span class="sc">!!</span>split_value_node)  </span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>  node_left <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_left,</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"impurity"</span> <span class="ot">=</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(imp_left),</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">666</span>)</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>  node_left <span class="ot">&lt;-</span> <span class="fu">conditional_split</span>(node_left, depth, max_depth, min_leaf, midpoint)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>  tbl_right <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name_node <span class="sc">&gt;=</span> <span class="sc">!!</span>split_value_node)  </span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>  node_right <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_right,</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"impurity"</span> <span class="ot">=</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(imp_right),</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">666</span>)</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>  node_right <span class="ot">&lt;-</span> <span class="fu">conditional_split</span>(node_right, depth, max_depth, min_leaf, midpoint)</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"left"</span>]] <span class="ot">&lt;-</span> node_left</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"right"</span>]] <span class="ot">&lt;-</span> node_right</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(node)</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a><span class="co"># inspired from this pattern:</span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/61621974/r-recursive-tree-algorithm-with-a-random-split</span></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a><span class="co"># mydata &lt;- data.frame(x = c(10, 20, 25, 35), y = c(-10.5, 6.5, 7.5, -7.5))</span></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a><span class="co"># conditional_split &lt;- function(df, depth, max_depth)</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a><span class="co"># {</span></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   if(nrow(df) == 1 | depth == max_depth) return(df)</span></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   else grow_tree(df, depth + 1, max_depth)</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a><span class="co"># grow_tree &lt;- function(df, depth = 1, max_depth = 3)</span></span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a><span class="co"># {</span></span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   break_at &lt;- sample(nrow(df) - 1, 1)</span></span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   branched &lt;- list(left = df[1:break_at,], right = df[-seq(break_at),])</span></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   lapply(branched, conditional_split, depth, max_depth)</span></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a><span class="co"># tree &lt;- grow_tree(mydata, max_depth = 2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We also define a recursive function to help visualize the decision tree once it is “fitted”:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>print_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(grown_tree, <span class="at">shift =</span><span class="st">''</span>, <span class="at">precision =</span> <span class="dv">3</span>){</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Node</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (grown_tree<span class="sc">$</span>is_leaf <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        p1 <span class="ot">&lt;-</span> <span class="fu">round</span>(grown_tree<span class="sc">$</span>p1,<span class="dv">2</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        class <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>vote</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        n_zero <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>n_zero</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        n_one <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>n_one</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        impurity <span class="ot">&lt;-</span> <span class="fu">round</span>(grown_tree<span class="sc">$</span>impurity,<span class="dv">3</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'prob 1: {p1}, class: {class}, 0-1: {n_zero}/{n_one}, impurity: {impurity}'</span>))</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Else recurse</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First print the splitting variable and rule</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(shift <span class="sc">==</span> <span class="st">''</span>){</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">'Root'</span> , <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>split</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        feature_split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>feature_split</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(glue::glue('Node {feature_split} &lt; {split} Y/N?'))</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &lt; {round(split, precision)}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_tree</span>(grown_tree<span class="sc">$</span>left, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &gt;= {round(split, precision)}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_tree</span>(grown_tree<span class="sc">$</span>right, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We test the recursive algorithm on the mixture data set:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>mixture_node <span class="ot">&lt;-</span> <span class="fu">grow_decision_tree</span>(node, <span class="at">max_depth =</span> <span class="dv">4</span>, <span class="at">min_leaf =</span> <span class="dv">7</span>, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We do the same specifying similar parameters to <code>rpart</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>mixture_example_CART <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>.,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> data_mixture_example,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="fl">0.000001</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">minsplit =</span> <span class="dv">7</span> ,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">minbucket =</span> <span class="dv">7</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">maxdepth =</span> <span class="dv">4</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To allow a precise check we show for each node/leaf both class 0/1 probabilities and number of observations (left: class O / BLUE, right: class 1 / ORANGE):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prp</span>(mixture_example_CART, <span class="at">type =</span> <span class="dv">2</span>, <span class="at">extra =</span> <span class="dv">4</span>, <span class="at">fallen.leaves =</span> <span class="cn">TRUE</span>, <span class="at">digits=</span><span class="dv">4</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.col =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)[mixture_example_CART<span class="sc">$</span>frame<span class="sc">$</span>yval],</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we indicate both Class 0-1 probabilities and number of observations for each node</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">node.fun =</span> <span class="cf">function</span>(x, labs, digits, varlen) <span class="fu">paste</span>(labs, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="st">"B/O: "</span>, x<span class="sc">$</span>frame<span class="sc">$</span>yval2[,<span class="dv">2</span>], <span class="st">" - "</span>, x<span class="sc">$</span>frame<span class="sc">$</span>yval2[,<span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We compare our implementation with <code>rpart</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_tree</span>(mixture_node, <span class="st">''</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Root 
   |&gt; x2 &lt; 0.1441 
     |&gt; x2 &lt; -0.344 
       prob 1: 0, class: 0, 0-1: 31/0, impurity: 0 
     |&gt; x2 &gt;= -0.344 
       |&gt; x2 &lt; -0.137 
         prob 1: 0.43, class: 0, 0-1: 4/3, impurity: 0.49 
       |&gt; x2 &gt;= -0.137 
         |&gt; x1 &lt; 0.993 
           prob 1: 0, class: 0, 0-1: 7/0, impurity: 0 
         |&gt; x1 &gt;= 0.993 
           prob 1: 0.14, class: 0, 0-1: 6/1, impurity: 0.245 
 
 
 
   |&gt; x2 &gt;= 0.1441 
     |&gt; x1 &lt; 2.246 
       |&gt; x2 &lt; 0.976 
         |&gt; x1 &lt; 1.017 
           prob 1: 0.24, class: 0, 0-1: 22/7, impurity: 0.366 
         |&gt; x1 &gt;= 1.017 
           prob 1: 0.95, class: 1, 0-1: 1/20, impurity: 0.091 
 
       |&gt; x2 &gt;= 0.976 
         |&gt; x1 &lt; -0.967 
           prob 1: 1, class: 1, 0-1: 0/15, impurity: 0 
         |&gt; x1 &gt;= -0.967 
           prob 1: 0.78, class: 1, 0-1: 14/49, impurity: 0.346 
 
 
     |&gt; x1 &gt;= 2.246 
       |&gt; x1 &lt; 3.078 
         prob 1: 0, class: 0, 0-1: 13/0, impurity: 0 
       |&gt; x1 &gt;= 3.078 
         prob 1: 0.71, class: 1, 0-1: 2/5, impurity: 0.408 
 
 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mixture_example_CART)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>n= 200 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 200 100 0 (0.50000000 0.50000000)  
   2) x2&lt; 0.1441271 52   4 0 (0.92307692 0.07692308) *
   3) x2&gt;=0.1441271 148  52 1 (0.35135135 0.64864865)  
     6) x1&gt;=2.245715 20   5 0 (0.75000000 0.25000000)  
      12) x1&lt; 3.077549 13   0 0 (1.00000000 0.00000000) *
      13) x1&gt;=3.077549 7   2 1 (0.28571429 0.71428571) *
     7) x1&lt; 2.245715 128  37 1 (0.28906250 0.71093750)  
      14) x2&lt; 0.976433 50  23 1 (0.46000000 0.54000000)  
        28) x1&lt; 1.016795 29   7 0 (0.75862069 0.24137931) *
        29) x1&gt;=1.016795 21   1 1 (0.04761905 0.95238095) *
      15) x2&gt;=0.976433 78  14 1 (0.17948718 0.82051282) *</code></pre>
</div>
</div>
<p>They are almost equivalent. The slight difference between our implementation and <code>rpart</code>: even if a split is admissible for terminal nodes improving the impurity, <code>rpart</code> seems to undo the split if it results in two terminal nodes predicting the same class).</p>
<p>To further verify this point we use the <code>Python/scikit-learn</code> implementation of decision trees using <code>reticulate</code> package. This packages allows <code>R</code> to interact with <code>Python</code>, more details <a href="#%20https://rstudio.github.io/reticulate">here</a> and <a href="#%20https://www.r-bloggers.com/2020/04/how-to-run-pythons-scikit-learn-in-r-in-5-minutes/">here</a>.</p>
<p>We first check and set our python environment:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">conda_list</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["python"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"base","2":"/Users/louisolive/miniconda3/bin/python"},{"1":"data-analysis","2":"/Users/louisolive/miniconda3/envs/data-analysis/bin/python"},{"1":"teaching-python","2":"/Users/louisolive/miniconda3/envs/teaching-python/bin/python"},{"1":"treasury","2":"/Users/louisolive/miniconda3/envs/treasury/bin/python"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We import the needed python packages:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We pass the data objects created within <code>R</code> chunks to <code>Python</code> using the <code>r</code> object (e.g.&nbsp;<code>r.x</code> would access to <code>x</code> variable created within <code>R</code> from <code>Python</code>):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Y_sk <span class="ot">=</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(Y)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>X_sk <span class="ot">=</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1,x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> r.X_sk</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> r.Y_sk</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>X.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         x1        x2
0  2.526093  0.321050
1  0.366954  0.031462
2  0.768219  0.717486
3  0.693436  0.777194
4 -0.019837  0.867254</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>Y[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   Y
0  0
1  0
2  0
3  0
4  0</code></pre>
</div>
</div>
<p>We then fit a <code>scikit-learn</code> <code>DecisionTreeCLassifier</code> implementing a version of CART, for more details see <a href="https://scikit-learn.org/stable/modules/tree.html">scikit-learn User Guide</a> and <a href="https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html#sklearn.tree.DecisionTreeClassifier">Documentation</a>.</p>
<p>We use similar parameters as before:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> tree.DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">4</span>, min_samples_leaf<span class="op">=</span><span class="dv">7</span>, min_samples_split<span class="op">=</span><span class="dv">7</span>, random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>clf.fit(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>DecisionTreeClassifier(max_depth=4, min_samples_leaf=7, min_samples_split=7,
                       random_state=0)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">DecisionTreeClassifier</label><div class="sk-toggleable__content"><pre>DecisionTreeClassifier(max_depth=4, min_samples_leaf=7, min_samples_split=7,
                       random_state=0)</pre></div></div></div></div></div>
</div>
</div>
<p>We then visualize the resulting decision tree:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">17</span>))</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>tree.plot_tree(clf, filled<span class="op">=</span><span class="va">True</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># basic plotting export unusable images</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig('images/check_tree_mixture.svg')</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># export instead rotated tree (idea from Matt Harrison XGBoost book) </span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>tree.export_graphviz(clf, <span class="st">'images/check_tree_mixture.dot'</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                     feature_names<span class="op">=</span>X.columns, filled<span class="op">=</span><span class="va">True</span>, rotate<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="2400"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"dot -Tsvg images/check_tree_mixture.dot -o images/check_tree_mixture.svg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We verify that our toy implementation of <code>CART</code> matches the <code>scikit-learn</code> implementation on the Mixture data set with comparable parameters (note that the default colors from <code>graphviz</code> are the opposite of the Mixture data set, ie Class 0 / BLUE filled in orange, Class 1 / ORANGE filled in blue): <img src="images/check_tree_mixture.svg" class="img-fluid"> It is comparable to our implementation:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_tree</span>(mixture_node, <span class="st">''</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Root 
   |&gt; x2 &lt; 0.1441 
     |&gt; x2 &lt; -0.344 
       prob 1: 0, class: 0, 0-1: 31/0, impurity: 0 
     |&gt; x2 &gt;= -0.344 
       |&gt; x2 &lt; -0.137 
         prob 1: 0.43, class: 0, 0-1: 4/3, impurity: 0.49 
       |&gt; x2 &gt;= -0.137 
         |&gt; x1 &lt; 0.993 
           prob 1: 0, class: 0, 0-1: 7/0, impurity: 0 
         |&gt; x1 &gt;= 0.993 
           prob 1: 0.14, class: 0, 0-1: 6/1, impurity: 0.245 
 
 
 
   |&gt; x2 &gt;= 0.1441 
     |&gt; x1 &lt; 2.246 
       |&gt; x2 &lt; 0.976 
         |&gt; x1 &lt; 1.017 
           prob 1: 0.24, class: 0, 0-1: 22/7, impurity: 0.366 
         |&gt; x1 &gt;= 1.017 
           prob 1: 0.95, class: 1, 0-1: 1/20, impurity: 0.091 
 
       |&gt; x2 &gt;= 0.976 
         |&gt; x1 &lt; -0.967 
           prob 1: 1, class: 1, 0-1: 0/15, impurity: 0 
         |&gt; x1 &gt;= -0.967 
           prob 1: 0.78, class: 1, 0-1: 14/49, impurity: 0.346 
 
 
     |&gt; x1 &gt;= 2.246 
       |&gt; x1 &lt; 3.078 
         prob 1: 0, class: 0, 0-1: 13/0, impurity: 0 
       |&gt; x1 &gt;= 3.078 
         prob 1: 0.71, class: 1, 0-1: 2/5, impurity: 0.408 
 
 </code></pre>
</div>
</div>
<p>We do the same job with the <code>Iris</code> data set which is a multivariate data set used and made famous by the British statistician and biologist Ronald Fisher in his 1936 paper about linear discriminant analysis, we restrict to a binary classification problem excluding the <code>setosa</code> family.</p>
<p>We fit a decision tree for with max depth 2:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>tbl_iris <span class="ot">=</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Species<span class="sc">!=</span><span class="st">'setosa'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">droplevels</span>()</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>node <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_iris,</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"impurity"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"target"</span> <span class="ot">=</span> <span class="fu">as.name</span>(<span class="st">"Species"</span>),</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">"features"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"Sepal.Length"</span>), <span class="fu">as.name</span>(<span class="st">"Sepal.Width"</span>), <span class="fu">as.name</span>(<span class="st">"Petal.Length"</span>), <span class="fu">as.name</span>(<span class="st">"Petal.Width"</span>)),</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_zero"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>             <span class="st">"n_one"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>             <span class="st">"p1"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>             <span class="st">"vote"</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>iris_node <span class="ot">&lt;-</span> <span class="fu">grow_decision_tree</span>(node, <span class="at">max_depth =</span> <span class="dv">2</span>, <span class="at">min_leaf =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_tree</span>((iris_node))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Root 
   |&gt; Petal.Width &lt; 1.75 
     |&gt; Petal.Length &lt; 4.95 
       prob 1: 0.02, class: 0, 0-1: 47/1, impurity: 0.041 
     |&gt; Petal.Length &gt;= 4.95 
       prob 1: 0.67, class: 1, 0-1: 2/4, impurity: 0.444 
 
   |&gt; Petal.Width &gt;= 1.75 
     |&gt; Petal.Length &lt; 4.95 
       prob 1: 0.83, class: 1, 0-1: 1/5, impurity: 0.278 
     |&gt; Petal.Length &gt;= 4.95 
       prob 1: 1, class: 1, 0-1: 0/40, impurity: 0 
 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.01</span>), <span class="cf">function</span>(x){</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  X_rpart <span class="ot">=</span> <span class="fu">rpart</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    Species <span class="sc">~</span> .,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"class"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tbl_iris,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">5</span>, <span class="at">minbucket =</span> <span class="dv">5</span>,<span class="at">cp=</span>x)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(l)) {</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(l[[i]])</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-44-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>Y_sk <span class="ot">=</span> tbl_iris<span class="sc">%&gt;%</span> <span class="fu">select</span>(Species)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>X_sk <span class="ot">=</span> tbl_iris <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> r.X_sk</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> r.Y_sk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><img src="images/check_tree_iris.svg" class="lightbox img-fluid"></p>
</section>
<section id="building-strategy---pruning" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="building-strategy---pruning"><span class="header-section-number">1.3</span> Building strategy - Pruning</h2>
<p>The tree-building process described just above is likely to produce good predictions on the training set, but is also likely to overfit the data, leading to poor predictions on testing set or new data. This is because the resulting tree might be too complex.</p>
<p>In an extreme case, if we do not restrict the tree depth and allow a low minimum number of observations per leaf, many observations could be alone in their own region/node.</p>
<p>Conversely, a smaller tree with fewer splits/nodes/regions might underfit, missing key patterns in the data.</p>
<p>The right balance leading to lower variance and better interpretation at the cost of a little bias.</p>
<p>We can see the number of nodes or tree size as a parameter allowing to tune the model complexity.</p>
<p>We have to select this parameter.</p>
<p>The CART algorithm mainly uses the number of terminal nodes. The tree depth can also be used.</p>
<p>The CART strategy is to build a large tree <span class="math inline">\(T_0\)</span> and then sequentially prune it to obtain a sequence of nested trees.</p>
<p>Then a Cost complexity criterion is defined as:</p>
<p><span class="math display">\[
C_\alpha(T)=\hat R(T)+\alpha|T|
\]</span> where <span class="math inline">\(\hat R(T)\)</span> denote the empirical risk or a similar metric, <span class="math inline">\(|T|\)</span> the number of terminal nodes in <span class="math inline">\(T\)</span> and <span class="math inline">\(\alpha\)</span> is a parameter.</p>
<p>The idea is for a sequence of <span class="math inline">\(\alpha\)</span>, find the subtree <span class="math inline">\(T_\alpha \subset T_0\)</span> minimizing <span class="math inline">\(C_\alpha(T)\)</span>.</p>
<p>Then cross-validation is chosen to find and ‘optimal’ value of <span class="math inline">\(\alpha\)</span>.</p>
</section>
<section id="exercises" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="exercises"><span class="header-section-number">1.4</span> Exercises</h2>
<section id="exercice-1" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="exercice-1"><span class="header-section-number">1.4.1</span> Exercice 1</h3>
<p>Using the Desbois data set, build and draw a decision tree using <code>rpart</code>.</p>
<p>Compare a large tree and a smaller tree in terms of ROC/AUC/prediction on a testing set.</p>
<p>Try to understand the output of the <code>printcp</code> function.</p>
<p>Choose a terminal number of leafs and prune the tree using the <code>prune</code> function.</p>
<p>Select the optimal <code>cp</code> for your tree (you can use a plot) and compare to the large and small models in terms of AUC.</p>
</section>
<section id="exercice-2-inspired-from-a.-géron-book" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="exercice-2-inspired-from-a.-géron-book"><span class="header-section-number">1.4.2</span> Exercice 2 (Inspired from A. Géron book)</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/ageron/handson-ml3/blob/main/06_decision_trees.ipynb </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">6</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>X_square <span class="op">=</span> np.random.rand(<span class="dv">10</span>, <span class="dv">2</span>) <span class="op">-</span> <span class="fl">0.5</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>y_square <span class="op">=</span> (X_square[:, <span class="dv">0</span>] <span class="op">&gt;</span> <span class="dv">0</span>).astype(np.int64)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print(X_square)</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print(X_square[:, 0])</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(y_square)</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>angle <span class="op">=</span> np.pi <span class="op">/</span> <span class="dv">4</span>  <span class="co"># 45 degrees</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>rotation_matrix <span class="op">=</span> np.array([[np.cos(angle), <span class="op">-</span>np.sin(angle)],</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>                            [np.sin(angle), np.cos(angle)]])</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>X_rotated_square <span class="op">=</span> X_square.dot(rotation_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adapted from Aurélien Géron </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Géron, A. (2022). Hands-On Machine Learning with Scikit-Learn, Keras, and TensorFlow</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Chapter 6. Decision Trees / Sensitivity to axis orientation</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1987</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">200</span>), <span class="at">nrow=</span><span class="dv">100</span>, <span class="at">ncol=</span><span class="dv">2</span>) <span class="sc">-</span> <span class="fl">0.5</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(X[,<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>angle <span class="ot">&lt;-</span> pi <span class="sc">/</span> <span class="dv">4</span> </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>rotation_matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="fu">cos</span>(angle),<span class="sc">-</span><span class="fu">sin</span>(angle)),</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">c</span>(<span class="fu">sin</span>(angle), <span class="fu">cos</span>(angle)))</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>X_rotated <span class="ot">&lt;-</span> X <span class="sc">%*%</span> rotation_matrix</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Y, <span class="at">x1 =</span> X[,<span class="dv">1</span>], <span class="at">x2 =</span> X[,<span class="dv">2</span>])</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>data_rotated <span class="ot">&lt;-</span> <span class="fu">tibble</span>(Y, <span class="at">x1 =</span> X_rotated[,<span class="dv">1</span>], <span class="at">x2 =</span> X_rotated[,<span class="dv">2</span>])</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_rotated <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">as.factor</span>(Y)), <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2, <span class="at">col =</span> Y)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Fit a decision tree on the rotated dataset.</p>
<p>Plot and comment the decision boundary in terms of generalization/test error.</p>
<p>Can you do better? Think of PCA for example.</p>
</section>
</section>
</section>
<section id="ensemble-methods---boosting" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Ensemble methods - Boosting</h1>
<p>Boosting is a machine learning technique developed in the nineties. It was originally introduced for binary classification problems and it has been extended to other supervised learning problems (multiclass, regression, ranking, survival).</p>
<p>The core idea behind Boosting is to combine the predictions of several “weak” classifiers (ie slighlty better than random classifiers) to form a more robust and accurate model.</p>
<p>We start by introducing <code>AdaBoost</code> which was (one of<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>) the first successful implementation of the Boosting idea, introduced by Freund and Schapire in <span class="citation" data-cites="adaboost1996">Freund and Schapire (<a href="#ref-adaboost1996" role="doc-biblioref">1996</a>)</span>.</p>
<section id="adaboost" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="adaboost"><span class="header-section-number">2.1</span> Adaboost</h2>
<p>The algorithm is described for example in Chapter 1 of <span class="citation" data-cites="boosting2012">Schapire and Freund (<a href="#ref-boosting2012" role="doc-biblioref">2012</a>)</span> (Algorithm 1.1):</p>
<p><img src="images/adaboost_algo.png" class="img-fluid" data-fig-align="center"> or in Chapter 10 of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> (Algorithm 10.1):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/adaboost_algo_esl.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>A toy example is also introduced in the book, showing graphically the first three iterations of the algorithm on a simplified data set:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/adaboost_toy_example.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/adaboost_toy_example2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Following this algorithm description or pseudo code we implement a simplified version of AdaBoost using <code>rpart</code> decision trees as base/weak classifiers.</p>
<p>We implement here a version with stumps (ie decision tree with depth 1), but any kind of weak learner can be used:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function implementing the original AdaBoost algorithm (Algorithm 1.1)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># as described in:</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Schapire, R., Freund, Y. (2012). Boosting: Foundations and Algorithms</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># freely available here:</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># https://direct.mit.edu/books/oa-monograph/5342/BoostingFoundations-and-Algorithms</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterative fitting of the weak learners (here cesision tree stumps) to data</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>fit_original_adaboost <span class="ot">&lt;-</span> <span class="cf">function</span>(data, M, <span class="at">smoothing=</span><span class="cn">FALSE</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>){</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data is a tibble, we assume target variable is Y with labels in {-1, 1}</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># M is an integer</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize observation weights: w^1_i = 1/n for i = 1,...,n</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span>  <span class="fu">nrow</span>(data)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span>  <span class="fu">rep</span>(<span class="dv">1</span>, n) <span class="sc">/</span> n</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Smoothing parameter see below</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(smoothing){eps <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>n}</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="fu">numeric</span>(M)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  G <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  weak_learner <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  weights[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> w</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  Y_target <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(data<span class="sc">$</span>Y))</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For m = 1,...,M:</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M) {</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Train weak learner G^m(x) using distribution w^m</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    weak_learner[[m]] <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data, <span class="at">weights =</span> w, </span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>                               <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp=</span><span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">maxdepth =</span> <span class="dv">1</span>,</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">minsplit =</span> <span class="dv">0</span>,</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">minbucket =</span> <span class="dv">1</span>,</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">maxsurrogate =</span> <span class="dv">0</span>,</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">maxcompete =</span> <span class="dv">0</span>), <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute error:</span></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># err^m = [Sum_n w^m_i * 11(y_i&lt;&gt;G^m(x_i)]</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>    G[[m]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(<span class="fu">predict</span>(weak_learner[[m]], <span class="at">type =</span><span class="st">"class"</span>)))</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store 11(y_i&lt;&gt;G^m(x_i)</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>    misclass <span class="ot">&lt;-</span> (G[[m]]<span class="sc">!=</span>Y_target)</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># In Freund Schapire 2012: no rescaling of error but rescaling of weights</span></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>    <span class="co">#err &lt;- sum(w * misclass) </span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Alt. in ESLII rescaling of error but no rescaling of weights in the end</span></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    err <span class="ot">&lt;-</span> <span class="fu">sum</span>(w <span class="sc">*</span> misclass) <span class="sc">/</span> <span class="fu">sum</span>(w)</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(verbose){<span class="fu">print</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'error at iteration {m}: {round(err,3)}'</span>))}</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (Schapire 2012 formulation)</span></span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose alpha^m = 1/2 * log((1-err^m)/err^m)</span></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#alpha[m] &lt;- 0.5 * log((1 - err) / err)</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Avoiding dividing by 0 as error decreases</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># From 'Schapire, Singer (1999) Improved Boosting Algorithms Using Confidence-rated Predictions'</span></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># section 4.2. Smoothing the predictions:</span></span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "In our experiments, we have typically used eps on the order of 1/n where n is the number of training examples"</span></span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (AdaBoost.M1 from ESL II) with eps trick from Schapire</span></span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>    alpha[m] <span class="ot">&lt;-</span> <span class="fu">log</span>((<span class="dv">1</span> <span class="sc">-</span> err <span class="sc">+</span> eps) <span class="sc">/</span> (err <span class="sc">+</span> eps))</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (Schapire 2012 formulation)</span></span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update w^(m+1)_i = w^m_i / Z_m * exp[-alpha^m * y_i * G^m(x_i)],</span></span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z_m so that Sum_i w^(m+1)_i = 1 </span></span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># w &lt;- w * exp(-alpha[m] * G[[m]] * Y_target)</span></span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># w &lt;- w / sum(w)</span></span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (ESLII 2009 formulation)</span></span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update w^(m+1)_i = w^m_i* exp[-alpha^m * y_i * G^m(x_i)],</span></span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update w^(m+1)_i = w^m_i * exp[alpha^m * 11(y_i&lt;&gt;G^m(x_i))]  (AdaBoost.M1 from ESL II)</span></span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">&lt;-</span> w <span class="sc">*</span> <span class="fu">exp</span>(alpha[m] <span class="sc">*</span> misclass)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>alpha[m]<span class="sc">/</span><span class="dv">2</span>) <span class="co"># the last exp(-alpha/2) if found in AdaBoost derivation</span></span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(verbose){<span class="fu">print</span>(w)}</span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>    weights[[m<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> w</span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Output list of weights:alpha^m,  weak learners: G^m(.) for the predict function</span></span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">alphas=</span>alpha, <span class="at">classifiers=</span>G, <span class="at">weak_learners=</span>weak_learner, <span class="at">weights=</span>weights))</span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Final prediction as the sign of weighted sum of weak classifiers</span></span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Last step of algorithm / pseudocode</span></span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a>predict_original_adaboost <span class="ot">&lt;-</span> <span class="cf">function</span>(fitted_adaboost, new_data, <span class="at">num_tree =</span> <span class="sc">-</span><span class="dv">1</span>){</span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Output G(x) = sign[Sum_m alpha^mG^m(x)]</span></span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">length</span>(fitted_adaboost<span class="sc">$</span>alphas)</span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_tree <span class="sc">&gt;=</span><span class="dv">1</span> <span class="sc">&amp;</span> num_tree <span class="sc">&lt;</span> M){</span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> num_tree</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>  G <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a>    G_m <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(<span class="fu">predict</span>(fitted_adaboost<span class="sc">$</span>weak_learners[[m]], new_data, <span class="at">type =</span><span class="st">"class"</span>)))</span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a>    G <span class="ot">&lt;-</span> G <span class="sc">+</span> fitted_adaboost<span class="sc">$</span>alpha[[m]] <span class="sc">*</span> G_m</span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sign</span>(G))</span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then illustrate AdaBoost on the Mixture data set. We first convert the target <span class="math inline">\(Y\)</span> to be in <span class="math inline">\(\{-1,1\}\)</span> then fit AdaBoost with <span class="math inline">\(3\)</span> iterations:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>data_ada <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">as.factor</span>(<span class="fu">if_else</span>(Y<span class="sc">==</span><span class="dv">0</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>adaboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_adaboost</span>(data_ada, <span class="dv">3</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity checks (sum of weighted classifiers == predict_adaboost)</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># g1 &lt;- adaboost_M$alphas[1] * adaboost_M$classifiers[[1]]</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># g2 &lt;- adaboost_M$alphas[2] * adaboost_M$classifiers[[2]]</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># g3 &lt;- adaboost_M$alphas[3] * adaboost_M$classifiers[[3]]</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># g &lt;- g1+g2+g3</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sign(g)</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># sign(g)==predict_original_adaboost(adaboost_M, data_ada %&gt;% select(x1,x2))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We represent weak learners (here decision tree stumps) boundary decisions, as well as re-weighted data after each step:</p>
<ul>
<li>Step 1:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("remotes")</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("grantmcdermott/parttree")</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parttree)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle plot orientation issue </span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co"># https://grantmcdermott.com/parttree/articles/parttree-intro.html#plot-orientation</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>variable_split <span class="ot">&lt;-</span> <span class="fu">rownames</span>(adaboost_M<span class="sc">$</span>weak_learners[[step]]<span class="sc">$</span>splits)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(data_ada, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Y),<span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[step]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Weak learner at step {step}"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reweighted data</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_ada)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># breaks</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(data_ada<span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight=</span>adaboost_M<span class="sc">$</span>weights[[step<span class="sc">+</span><span class="dv">1</span>]]<span class="sc">*</span>n), <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Y, <span class="at">size=</span>weight)) <span class="sc">+</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[step]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># playing with size scale we ensure a weight of 1/n has size 1.5 (ie standard ggplot size for points)</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">guide=</span><span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Reweighted data after step {step}"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-57-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Step 2:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>variable_split <span class="ot">&lt;-</span> <span class="fu">rownames</span>(adaboost_M<span class="sc">$</span>weak_learners[[step]]<span class="sc">$</span>splits)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(data_ada, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Y),<span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[step]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Weak learner at step {step}"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reweighted data</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_ada)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># breaks</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(data_ada<span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight=</span>adaboost_M<span class="sc">$</span>weights[[step<span class="sc">+</span><span class="dv">1</span>]]<span class="sc">*</span>n), <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Y, <span class="at">size=</span>weight)) <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[step]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># playing with size scale we ensure a weight of 1/n has size 1.5 (ie standard ggplot size for points)</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">guide=</span><span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Reweighted data after step {step}"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-58-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>Step 3:</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>variable_split <span class="ot">&lt;-</span> <span class="fu">rownames</span>(adaboost_M<span class="sc">$</span>weak_learners[[step]]<span class="sc">$</span>splits)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(data_ada, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Y),<span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[step]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Weak learner at step {step}"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reweighted data</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_ada)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># breaks</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(data_ada<span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight=</span>adaboost_M<span class="sc">$</span>weights[[step<span class="sc">+</span><span class="dv">1</span>]]<span class="sc">*</span>n), <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Y, <span class="at">size=</span>weight)) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[step]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># playing with size scale we ensure a weight of 1/n has size 1.5 (ie standard ggplot size for points)</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">guide=</span><span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtitle</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Reweighted data after step {step}"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-59-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We run more iterations of AdaBoost</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction function used to classify areas on the grid and imply the decision boundary</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>predict_oracle <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2){</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    obj <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>       obj <span class="ot">&lt;-</span> obj <span class="sc">+</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>((x1<span class="sc">-</span>x1_means[i])<span class="sc">**</span><span class="dv">2</span><span class="sc">+</span>(x2<span class="sc">-</span>x2_means[i])<span class="sc">**</span><span class="dv">2</span>)) <span class="sc">-</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">5</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>((x1<span class="sc">-</span>x1_means[i<span class="sc">+</span><span class="dv">10</span>])<span class="sc">**</span><span class="dv">2</span><span class="sc">+</span>(x2<span class="sc">-</span>x2_means[i<span class="sc">+</span><span class="dv">10</span>])<span class="sc">**</span><span class="dv">2</span>))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">*</span> (obj <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>predict_oracle_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(predict_oracle)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tree_number <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>adaboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_adaboost</span>(data_ada, tree_number)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>variable_split <span class="ot">&lt;-</span> <span class="fu">rownames</span>(adaboost_M<span class="sc">$</span>weak_learners[[tree_number ]]<span class="sc">$</span>splits)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>(stump <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_ada, <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> Y),<span class="at">size=</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[tree_number ]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[tree_number ]],<span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"black"</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>),</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.24</span>, <span class="fl">3.09</span>),</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">expand =</span> <span class="cn">FALSE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/7705345/how-can-i-extract-plot-axes-ranges-for-a-ggplot2-object</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot_build(stump)$layout$panel_scales_x[[1]]$range$range </span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot_build(stump)$layout$panel_scales_y[[1]]$range$range</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] -2.520820  4.170746</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] -1.999853  2.855805</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot_build(obj)$layout$panel_params[[1]]$x.range</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] -2.855398  4.505325</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot_build(obj)$layout$panel_params[[1]]$y.range</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] -2.242636  3.098588</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># reweighted data</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_ada)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co"># See this hack (https://stackoverflow.com/a/63024297) to ensure weights of 1/n have ggplot default size</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co"># here we have a ceiling weight value around 10</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>default_size <span class="ot">&lt;-</span> ggplot2<span class="sc">:::</span><span class="fu">check_subclass</span>(<span class="st">"point"</span>, <span class="st">"Geom"</span>)<span class="sc">$</span>default_aes<span class="sc">$</span>size</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>default_size_val <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>max_size <span class="ot">&lt;-</span> default_size<span class="sc">/</span>(<span class="fu">sqrt</span>(default_size_val<span class="sc">/</span><span class="dv">10</span>))</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="co"># max_size &lt;- default_size/(sqrt(log1p(default_size_val)/log1p(10))) for log1p scale</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>(<span class="fu">ggplot</span>(data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">weight =</span> adaboost_M<span class="sc">$</span>weights[[tree_number <span class="sc">+</span> <span class="dv">1</span>]]<span class="sc">*</span>n,</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">misclass =</span> adaboost_M<span class="sc">$</span>classifiers[[tree_number ]]<span class="sc">!=</span>data_ada<span class="sc">$</span>Y), <span class="fu">aes</span>(<span class="at">x=</span>x1, <span class="at">y=</span>x2)) <span class="sc">+</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># change observation size with weights at step tree_number (used for next fit)</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span>Y, <span class="at">size=</span>weight)) <span class="sc">+</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># circle misclassified (in red) by current fit</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size=</span>weight, <span class="at">stroke=</span><span class="fu">if_else</span>(misclass,<span class="dv">1</span>,<span class="dv">0</span>)), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">col=</span><span class="st">"red3"</span>, <span class="at">fill=</span><span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot stump decision surface</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_parttree</span>(<span class="at">data=</span>adaboost_M<span class="sc">$</span>weak_learners[[tree_number]], <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Y), <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_parttree</span>(<span class="at">data =</span> adaboost_M<span class="sc">$</span>weak_learners[[tree_number]], <span class="at">flipaxes =</span> variable_split<span class="sc">==</span><span class="st">"x2"</span>) <span class="sc">+</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">'colour'</span>, <span class="st">'fill'</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># playing with size scale (max_size) we ensure a weight of 1/n has size 1.5 (ie ggplot default size)</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, max_size), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">guide=</span><span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>),</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.24</span>, <span class="fl">3.09</span>),</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"black"</span>),</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"pt"</span>)) <span class="sc">+</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>( <span class="at">size=</span><span class="st">"none"</span>, <span class="at">strike=</span><span class="st">"none"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-61-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>grid_precision <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, grid_precision), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, grid_precision)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_ADA =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, grid, <span class="at">num_tree =</span> tree_number))) <span class="sc">%&gt;%</span> </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_ADA =</span> <span class="fl">0.5</span> <span class="sc">*</span> (predict_ADA <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>(ada_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> grid_precision, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA),</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">-</span>grid_precision, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">-</span>grid_precision,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"-1"</span>, <span class="st">"1"</span>),</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># guide="legend",</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># guide="legend",</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"-1"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>),</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.24</span>, <span class="fl">3.09</span>),</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>),</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>          <span class="co"># https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/</span></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"black"</span>),</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"pt"</span>)</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">stroke=</span><span class="st">"none"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-61-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>adaboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_adaboost</span>(data_ada, M)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pre &lt;- predict_original_adaboost(adaboost_M, data_ada %&gt;% select(x1,x2))</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Y_target &lt;- as.integer(as.character(data_ada %&gt;% pull(Y)))</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># table(tibble(pred=pre, target=Y_target)) </span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_ADA =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, grid))) <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_ADA =</span> <span class="fl">0.5</span> <span class="sc">*</span> (predict_ADA <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>(ada_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> <span class="fl">0.01</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA),</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fl">0.99999</span>, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.99999</span>,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ada_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, new_mixture)) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fl">0.5</span> <span class="sc">*</span> (class <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>(ada_risk <span class="ot">&lt;-</span> ada_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3039</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>adaboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_adaboost</span>(data_ada, M)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pre &lt;- predict_original_adaboost(adaboost_M, data_ada %&gt;% select(x1,x2))</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Y_target &lt;- as.integer(as.character(data_ada %&gt;% pull(Y)))</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># table(tibble(pred=pre, target=Y_target)) </span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_ADA =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, grid))) <span class="sc">%&gt;%</span> </span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_ADA =</span> <span class="fl">0.5</span> <span class="sc">*</span> (predict_ADA <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>(ada_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> <span class="fl">0.01</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA),</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fl">0.99999</span>, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.99999</span>,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>ada_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, new_mixture)) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fl">0.5</span> <span class="sc">*</span> (class <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>(ada_risk <span class="ot">&lt;-</span> ada_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2486</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>adaboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_adaboost</span>(data_ada, M)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pre &lt;- predict_original_adaboost(adaboost_M, data_ada %&gt;% select(x1,x2))</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Y_target &lt;- as.integer(as.character(data_ada %&gt;% pull(Y)))</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="co"># table(tibble(pred=pre, target=Y_target)) </span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, .<span class="dv">01</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_ADA =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, grid))) <span class="sc">%&gt;%</span> </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_ADA =</span> <span class="fl">0.5</span> <span class="sc">*</span> (predict_ADA <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>(ada_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> <span class="fl">0.01</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA),</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fl">0.99999</span>, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.99999</span>,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>ada_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, new_mixture)) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fl">0.5</span> <span class="sc">*</span> (class <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>(ada_risk <span class="ot">&lt;-</span> ada_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2626</code></pre>
</div>
</div>
</section>
<section id="derivation-of-adaboost-statistical-view" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="derivation-of-adaboost-statistical-view"><span class="header-section-number">2.2</span> Derivation of AdaBoost: statistical view</h2>
<p>In <span class="citation" data-cites="fht2000">Friedman (<a href="#ref-fht2000" role="doc-biblioref">2000</a>)</span>, authors derive AdaBoost as a Forward Stagewise Additive Model (FSAM) that minimizes the exponential loss. They also develop the approach in <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> (Chapter 10, Boosting and Additive Trees).</p>
<section id="adaboost-fits-an-additive-model" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="adaboost-fits-an-additive-model"><span class="header-section-number">2.2.1</span> AdaBoost fits an additive model</h3>
<p>First they remark that the Adaboost classifier after <span class="math inline">\(M\)</span> iterations is related to a “basis” function expansion or additive model:</p>
<p><span class="math display">\[
H(x) = \text{sign}(f_M(x))
\]</span> where: <span class="math display">\[
f_M(x) = \sum_{m=1}^M \alpha_m h(x,\gamma_m)
\]</span> <span class="math inline">\(\alpha\)</span> are the expansion coefficients or weights and <span class="math inline">\(h(x,\gamma_m)\)</span> are the “basis” functions or “learners”, usually “simple” functions of <span class="math inline">\(x\)</span> parameterized by <span class="math inline">\(\gamma\)</span>.</p>
<p>We can express <span class="math inline">\(f\)</span> iteratively as:</p>
<p><span class="math display">\[
f_m(x) = f_{m-1}(x) + \alpha_m h(x,\gamma_m)
\]</span></p>
<p>For example “learners” can be decision trees as seen before, where <span class="math inline">\(\gamma\)</span> refers to split variables/thresholds and leaf values.</p>
<p>Such additive models are fit by minimizing a loss function of the training data <span class="math inline">\(L(y,f(x))\)</span>:</p>
<p><span class="math display">\[
\underset{\{\alpha_m, \gamma_m\}_1^M}{\operatorname{min}}\sum_{i=1}^n L(y_i,\sum_{m=1}^M \alpha_m h(x_i,\gamma_m))
\]</span> Such optimization is in general intractable. A “greedy” approach is usually taken to approximate a solution.</p>
</section>
<section id="forward-stagewise-additive-model-fsam" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="forward-stagewise-additive-model-fsam"><span class="header-section-number">2.2.2</span> Forward Stagewise Additive Model (FSAM)</h3>
<p>To simplify the preceding optimization, a “forward stagewise” or “greedy” approach is taken.</p>
<p>At a given iteration <span class="math inline">\(m\)</span>, the expansion <span class="math inline">\(f_{m-1}\)</span> is fixed and we only optimize the weights <span class="math inline">\(\alpha_m\)</span> and current “learner” parameters <span class="math inline">\(\gamma_m\)</span>. <span class="math inline">\(f_{m}\)</span> is obtained and the procedure repeats. Note that in the next step <span class="math inline">\(f_{m}\)</span> is fixed and we only optimize the weights and parameters for learner <span class="math inline">\(m+1\)</span>.</p>
</section>
<section id="adaboost-fits-a-fsam-for-exponential-loss" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="adaboost-fits-a-fsam-for-exponential-loss"><span class="header-section-number">2.2.3</span> AdaBoost fits a FSAM for exponential loss</h3>
<p>Let us first define or introduce the exponential loss:</p>
<p><span class="math display">\[
L(y,f(x)) = \exp(-yf(x)) = \exp(-\text{margin})
\]</span> Given a classifier <span class="math inline">\(f(x)\)</span>, it is usual to define the margin as <span class="math inline">\(yf(x)\)</span>.</p>
<p>We then show that AdaBoost is equivalent to fitting FSAM for the exponential loss.</p>
<p>We consider the problem:</p>
<p><span class="math display">\[
\begin{align*}
(\alpha_m, \gamma_m) &amp;=\underset{\{\alpha, \gamma\}}{\operatorname{argmin}}\sum_{i=1}^n \exp(-y_i f_m(x_i))  \\
                              &amp;=\underset{\{\alpha, \gamma\}}{\operatorname{argmin}}\sum_{i=1}^n \exp(-y_i(f_{m-1}(x_i) + \alpha h(x_i,\gamma)) \\
                              &amp;= \underset{\{\alpha, \gamma\}}{\operatorname{argmin}}\sum_{i=1}^n \omega_{m,i}\exp(-y_i \alpha h(x_i,\gamma))
\end{align*}
\]</span></p>
<p>where <span class="math inline">\(\omega_{m,i}=\exp(-y_i f_{m-1}(x_i))\)</span> acts as a weight and does not depend on <span class="math inline">\((\alpha, \gamma)\)</span>.</p>
<p>The last expression rewrites: <span class="math display">\[
\begin{align*}
\sum_{i=1}^n \omega_{m,i}\exp(-y_i \alpha h(x_i,\gamma)) &amp;=e^{-\alpha}\sum_{i=1}^n \omega_{m,i}\mathbf 1_{y_i=h(x_i,\gamma)}+ e^{\alpha}\sum_{i=1}^n \omega_{m,i} 1_{y_i\neq h(x_i,\gamma)}\\
&amp;= (e^{\alpha}-e^{-\alpha})\sum_{i=1}^n \omega_{m,i} 1_{y_i\neq h(x_i,\gamma)} + e^{-\alpha}\sum_{i=1}^n \omega_{m,i}\\
&amp;= (e^{\alpha}-e^{-\alpha})\Omega_{m,err} + e^{-\alpha}\Omega_{m}
\end{align*}
\]</span> Having in mind that the term <span class="math inline">\(\Omega_m =\sum_{i=1}^n \omega_{m,i}\)</span> does not depend on <span class="math inline">\((\alpha, \gamma)\)</span>, for any <span class="math inline">\(\alpha&gt;0\)</span> we have <span class="math inline">\(e^{\alpha}-e^{-\alpha}&gt;0\)</span>, so solving for <span class="math inline">\(\gamma\)</span> the problem:</p>
<p><span class="math display">\[
\begin{align*}
\gamma_m &amp;=\underset{\gamma}{\operatorname{argmin}}\sum_{i=1}^n \exp(-y_i f_m(x_i)) \\
           &amp;=\underset{\gamma}{\operatorname{argmin}}(e^{\alpha}-e^{-\alpha})\sum_{i=1}^n \omega_{m,i} 1_{y_i\neq h(x_i,\gamma)} + e^{-\alpha_m}\Omega_{m}
\end{align*}
\]</span></p>
<p>is equivalent to solving:</p>
<p><span class="math display">\[\begin{align*}
\gamma_m &amp;=\underset{\gamma}{\operatorname{argmin}}\sum_{i=1}^n \omega_{m,i} 1_{y_i\neq h(x_i,\gamma)}\\
         &amp;=\underset{\gamma}{\operatorname{argmin}}\Omega_{m,err}
\end{align*}
\]</span> which does not depend on <span class="math inline">\(\alpha_m\)</span>.</p>
<p>This problem is specific to the base learners <span class="math inline">\(h(x, \gamma)\)</span> at stake, but amounts to solving a weighted (with <span class="math inline">\(\omega_{m,i}\)</span>) classification problem.</p>
<p>For example when <span class="math inline">\(h(x, \gamma)\)</span> are decision trees, we obtain <span class="math inline">\(\gamma_m\)</span> by fitting a tree on the weighted training data.</p>
<p>Having minimized <span class="math inline">\(\Omega_{m,err}\)</span> with respect to <span class="math inline">\(\gamma\)</span> (ie having fitted the learner), the <span class="math inline">\(m\text{-th}\)</span> iteration of FSAM is then solved by minimizing with respect to <span class="math inline">\(\alpha\)</span>:</p>
<p><span class="math display">\[
(e^{\alpha}-e^{-\alpha})\Omega_{m,err} + e^{-\alpha}\Omega_{m}
\]</span></p>
<p>Taking the derivative with respect to <span class="math inline">\(\alpha\)</span> of this expression (for <span class="math inline">\(\alpha&gt;0\)</span> the expression is convex in <span class="math inline">\(\alpha\)</span>), we seek:</p>
<p><span class="math display">\[
\begin{align*}
0 &amp;=\alpha(e^{\alpha}+e^{-\alpha})\Omega_{m,err} -\alpha e^{-\alpha}\Omega_{m}\\
         &amp;\Leftrightarrow \\
0  &amp;=(e^{2\alpha}+1)\Omega_{m,err} -\Omega_{m} \\
         &amp;\Leftrightarrow \\
\alpha  &amp;=\frac{1}{2}\log(\frac{\Omega_{m}}{\Omega_{m,err}}-1) \\
        &amp;=\frac{1}{2}\log(\frac{1-\epsilon_{m}}{\epsilon_{m}})
\end{align*}
\]</span> where:</p>
<p><span class="math display">\[
\epsilon_{m}=\frac{\Omega_{m,err}}{\Omega_{m}}= \frac{\sum_{i=1}^n \omega_{m,i} 1_{y_i\neq h(x_i,\gamma_m)}}{\sum_{i=1}^n \omega_{m,i}}
\]</span> is a weighted misclassification error.</p>
<p>We retrieve the expression of the weights in AdaBoost algorithm <span class="math inline">\(\alpha_m=\frac{1}2{}\log(\frac{1-\epsilon_{m}}{\epsilon_{m}})\)</span> from Freund and Schapire.</p>
<p>In all the derivation we have assumed that <span class="math inline">\(\alpha&gt;0\)</span>.</p>
<p>Looking at the AdaBoost expression of <span class="math inline">\(\alpha_m\)</span> we see that it is equivalent to having <span class="math inline">\(\epsilon_{m}&lt;\frac{1}{2}\)</span>. This means that learner at step <span class="math inline">\(m\)</span> has to be better then random. If by any chance <span class="math inline">\(\epsilon_{m}&gt;\frac{1}{2}\)</span> for <span class="math inline">\(h(x,\gamma_m)\)</span>, one could take <span class="math inline">\(-h(x,\gamma_m)\)</span> as the classifier.</p>
<p>We now look at the update of weights <span class="math inline">\(\omega_{m+1,i}=\exp(-y_i f_{m}(x_i))\)</span> after this step, we have the recursion:</p>
<p><span class="math display">\[
\omega_{m+1,i}=\omega_{m,i}\exp(-y_i \alpha_m h(x_i,\gamma_m))
\]</span> which looks like the weight in Freund &amp; Schapire Algortihm 1.1.</p>
<p>It can be rewritten as in <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span>, defining <span class="math inline">\(\hat\alpha_m=2\alpha_m=\log(\frac{1-\epsilon_{m}}{\epsilon_{m}})\)</span>:</p>
<p><span class="math display">\[
\omega_{m+1,i}=\omega_{m,i}\exp(\hat\alpha_m 1_{y_i\neq h(x_i,\gamma_m)})\exp(-\frac{\hat\alpha_m}{2})
\]</span> using the fact that <span class="math inline">\(-y_i h(x_i,\gamma_m) =2\times1_{y_i\neq h(x_i,\gamma_m)})+1\)</span>.</p>
<p>In the implementation of AdaBoost algorithm proposed before <code>fit_original_adaboost</code>, we tested both Freund &amp; Schapire and <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> formulations which perform identically.</p>
<p>Note that this FSAM view of AdaBoost was derived years after the Algorithm was proposed. Motivations and justifications of the original algorithm were not directly linked to an optimization / minimization of risk problem, see for example <span class="citation" data-cites="boosting2012">Schapire and Freund (<a href="#ref-boosting2012" role="doc-biblioref">2012</a>)</span>. But at some point, the use of exponential function in the algorithm has allow tractable formulas, allowing for example to express simple recursions.</p>
</section>
<section id="loss-functions-for-binary-classification-margin-draft" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="loss-functions-for-binary-classification-margin-draft"><span class="header-section-number">2.2.4</span> Loss functions for binary classification / margin [DRAFT]</h3>
<section id="theoretical-minimizer-for-exponential-loss" class="level4" data-number="2.2.4.1">
<h4 data-number="2.2.4.1" class="anchored" data-anchor-id="theoretical-minimizer-for-exponential-loss"><span class="header-section-number">2.2.4.1</span> Theoretical minimizer for exponential loss</h4>
<p>Starting from this FSAM view of AdaBoost for a specific loss function, the exponential loss, the authors of <span class="citation" data-cites="fht2000">Friedman (<a href="#ref-fht2000" role="doc-biblioref">2000</a>)</span> started to assess if alternative loss functions could be used in the context of Boosting.</p>
<p>First they try to understand what optimum function is approximated by the AdaBoost approach and show that the function that minimizes the risk for exponential loss is (see for example exercise 10.2 of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span>):</p>
<p><span class="math display">\[
\begin{align*}
f^*(x)&amp;=\underset{f}{\operatorname{argmin}}\mathbb{E}[\ell(Y,f(x))|x]\\
      &amp;=\underset{f}{\operatorname{argmin}}\mathbb{E}[e^{-Yf(x)}|x] \\
      &amp;=\frac{1}{2}\log(\frac{\mathbb{P}[Y=1|X=x)]}{\mathbb{P}[Y=-1|X=x)]})
\end{align*}
\]</span> So the <span class="math inline">\(f_M\)</span> estimated by AdaBoost approximates half the log odds of the data generating distribution <span class="math inline">\(\mathbf P_{\mathrm X \times \mathrm Y}\)</span>.</p>
<p>Conversely: <span class="math inline">\(\mathbb{P}[Y=1|X=x)]=\frac{e^{f^{*}(x)}}{e^{-f^{*}(x)}+e^{f^{*}(x)}}=\frac{1}{1+e^{-2f^{*}(x)}}\)</span></p>
</section>
<section id="another-view-on-logistic-loss" class="level4" data-number="2.2.4.2">
<h4 data-number="2.2.4.2" class="anchored" data-anchor-id="another-view-on-logistic-loss"><span class="header-section-number">2.2.4.2</span> Another view on logistic loss:</h4>
<p>In the first lesson we briefly saw that the Logistic Regression model was seeking to minimize the Risk for a specific loss (ie maximize a log-likelihood). Having modeled <span class="math inline">\(p_\beta(x)=\mathbb{P}[Y=1|X=x)]\)</span> as <span class="math inline">\(p_\beta(x)=\sigma(x^T\beta)=\frac{e^{x^{T} \beta}}{1+e^{x^{T} \beta}}\)</span> the problem was to maximize the log likelihood on the observations which was equivalent to minimizing the Risk for the logistic loss:</p>
<p><span class="math display">\[
\begin{align*}
\ell(Y,\beta)=\log L(Y,\beta) &amp;=\sum_{i=1}^n \left(y_i \log(p_{\beta}(x_i))+(1-y_i) \log(1- p_{\beta}(x_i))\right) \\
                              &amp;=-\sum_{i=1}^{n} \ell_{logistic} \left(p_{\beta}(x_i),y_i\right) \\
                              &amp;= -n\hat{\mathrm R}(p_\beta)
\end{align*}
\]</span></p>
<p><span class="math display">\[
\ell_{logistic}(y,\eta(x)) = -y\log(\eta(x))-(1-y)\log(1-\eta(x))=\left\{ \begin{array}{ll}
    -\log(\eta) &amp;  \mbox{if } y = 1\cr
    -\log(1-\eta) &amp;  \mbox{if } y = 0\cr
\end{array} \right.
\]</span> Here the authors parameterize the binomial probabilities using <span class="math inline">\(f\)</span> by:</p>
<p><span class="math display">\[
p(x)=\frac{e^{f(x)}}{e^{f(x)}+e^{-f(x)}}=\frac{1}{1+e^{-2f(x)}}
\]</span></p>
<p>slighlty differently than the standard logistic regression model:</p>
<p><span class="math display">\[
p_{\beta}(x)=\sigma(x^T\beta) = = \frac{e^{x^T\beta}}{1+e^{x^T\beta}} = \frac{e^{f(x,\beta)}}{1+e^{f(x,\beta)}} = \frac{1}{1+e^{-f(x,\beta)}}  
\]</span></p>
<p>they introduce <span class="math inline">\(Y' = \frac{Y+1}{2} \in \{0, 1\}\)</span> for <span class="math inline">\(Y \in \{-1, 1\}\)</span>.</p>
<p><span class="math display">\[\begin{align*}
\ell_{logistic}(Y',p(x)) &amp;= -Y'\log(p(x))-(1-Y')\log(1-p(x)) \\
                         &amp;= Y'\log(1+e^{-2f(x)})+(1-Y')\log(1+e^{2f(x)}) \\
                         &amp;= (\frac{Y+1}{2})\log(1+e^{-2f(x)})-(\frac{Y-1}{2})\log(1+e^{2f(x)}) \\
\end{align*}
\]</span></p>
<p>so that:</p>
<p><span class="math display">\[
\ell_{logistic}(Y',p(x))=\left\{ \begin{array}{ll}
    \log(1+e^{-2f(x)}) &amp;  \mbox{if } Y = 1\cr
    \log(1+e^{2f(x)}) &amp;  \mbox{if } Y= -1\cr
\end{array} = \log(1+e^{-2Yf(x)})\right.
\]</span></p>
<p><span class="math inline">\(f\)</span> minimizing the Risk for logistic loss is also minimizing half the log-odds of <span class="math inline">\(p\)</span>:</p>
<p><span class="math display">\[
\begin{align*}
f^*(x)&amp;=\underset{f}{\operatorname{argmin}}\mathbb{E}[\ell_{logistic}(Y,f(x))|x]\\
      &amp;=\underset{f}{\operatorname{argmin}}\mathbb{E}[\log(1+e^{-2Yf(x)})|x] \\
      &amp;=\frac{1}{2}\log(\frac{\mathbb{P}[Y=1|X=x)]}{\mathbb{P}[Y=-1|X=x)]})
\end{align*}
\]</span></p>
</section>
<section id="convex-surrogates-for-0-1-loss-draft" class="level4" data-number="2.2.4.3">
<h4 data-number="2.2.4.3" class="anchored" data-anchor-id="convex-surrogates-for-0-1-loss-draft"><span class="header-section-number">2.2.4.3</span> Convex surrogates for 0-1 loss [DRAFT]</h4>
<p>As we have seen before for the exponential loss, we can rewrite loss functions for binary classification in terms of margin. Given a classifier <span class="math inline">\(f(x)\)</span>, margin is defined as <span class="math inline">\(yf(x)\)</span>.</p>
<p>Then the loss function assigning a small value to positive margins (ie correct classifications) and a large value to negative margins (ie wrong classifications).</p>
<p>A key concept in machine learning is the use of convex surrogate losses, where we replace the 0-1 loss or misclassification by another loss allowing to perform numerical optimization (due to convexity).</p>
<p>Outside the scope of this course: one can show that for binary classification, optimal predictions can be achieved with convex surrogates of the 0–1 loss (see for example <span class="citation" data-cites="bartlett2006">Bartlett, Jordan, and Mcauliffe (<a href="#ref-bartlett2006" role="doc-biblioref">2006</a>)</span> or Francis Bach - Learning Theory from First Principles (Chapter 4)).</p>
<p>We display below loss functions for binary classification expressed in terms of margin:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>losses <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">margin =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>, <span class="at">length.out=</span><span class="dv">1000</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">0-1 loss</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(margin<span class="sc">&lt;</span><span class="dv">0</span>),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Logistic =</span> <span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>margin)),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Hinge =</span> <span class="fu">pmax</span>(<span class="dv">1</span><span class="sc">-</span>margin, <span class="dv">0</span>),</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Logistic =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">log</span>(<span class="dv">2</span>)<span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>margin)), <span class="co"># rescaled to be 1 at 0</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># Logistic = log(1+ exp(-margin)),</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Exponential =</span> <span class="fu">exp</span>(<span class="sc">-</span>margin),</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Square =</span> (<span class="dv">1</span><span class="sc">-</span>margin)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">pivot_longer</span>(<span class="sc">!</span>margin, <span class="at">names_to =</span> <span class="st">"Loss"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(losses, <span class="fu">aes</span>(<span class="at">x=</span>margin, <span class="at">y=</span>value, <span class="at">color=</span>Loss)) <span class="sc">+</span> </span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"margin=y.f(x)"</span>) <span class="sc">+</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Loss(margin)"</span>) <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="introducing-logitboost-as-an-optimisation-method-in-function-space" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="introducing-logitboost-as-an-optimisation-method-in-function-space"><span class="header-section-number">2.3</span> Introducing LogitBoost as an optimisation method in “function space”</h2>
<p>In <span class="citation" data-cites="gbm2021">(<a href="#ref-gbm2021" role="doc-biblioref"><strong>gbm2021?</strong></a>)</span> Friedman introduces the concept of numerical optimization (ie Gradient descent) in “function space” to solve the general problem:</p>
<p><span class="math display">\[
f^*=\underset{f}{\operatorname{argmin}}\mathrm R(f)=\underset{f}{\operatorname{argmin}}\mathbb{E}[L(Y,f(X))]
\]</span></p>
<p>or for each <span class="math inline">\(x\)</span> in <span class="math inline">\(\mathrm X\)</span>: $$</p>
<p>f^*(x)=R(f(x))=[L(Y,f(x))|X=x] $$</p>
<p>and more practically at each point of the given training data <span class="math inline">\(x_i\)</span>, <span class="math inline">\(i = 1, \cdots ,n\)</span>.</p>
<p>Similarly to what we have seen with Forward Stagewise Additive Modeling we estimate <span class="math inline">\(f\)</span> iteratively as:</p>
<p><span class="math display">\[
f_m(x) = f_{m-1}(x) + f^{m}(x)
\]</span></p>
<p>with <span class="math inline">\(f^{m}(x)\)</span> a step in the function space, similar to a gradient boosting or Newton Raphson step in an usual iterative algorithm.</p>
<p>Indeed starting from an initial guess <span class="math inline">\(f^0\)</span>, one sequentially add steps: <span class="math display">\[
f_M(x) = \sum_{m=0}^M f^m(x)
\]</span></p>
<p>At the start of iteration <span class="math inline">\(m\)</span>, the current estimate is given by <span class="math inline">\(f_{m-1}\)</span>. At that “point” in function space, the direction to the steepest descent of the Risk we seek to minimize, is given by the opposite of the gradient with respect to <span class="math inline">\(f(x)\)</span>:</p>
<p><span class="math display">\[
\text{grad}^m(x)=\left.\frac{\partial\mathrm R(f)}{\partial f(x)}\right|_{f(x)=f_{m-1}(x)}=\left.\frac{\partial \mathbb{E}[L(Y,f(x))|X=x]}{\partial f(x)}\right|_{f(x)=f_{m-1}(x)} =  \mathbb{E} \left[\frac{\partial L(Y,f(x))}{\partial f(x)}|X=x\right]_{f(x)=f_{m-1}(x)}
\]</span></p>
<p>Friedman also introduces a step length or “learning rate” to take in the opposite direction of the gradient, this step is determined using “line search”, that is:</p>
<p><span class="math display">\[
\rho^m=\underset{\rho}{\operatorname{argmin}}\mathbb{E}[L(Y,f_{m-1}(x) -\rho \text{grad}^m(x)]
\]</span></p>
<p>giving a step <span class="math inline">\(f^m(x) =-\rho_m \text{grad}^m(x)\)</span></p>
<p>Similarly a Newton Raphson method in function space can be defined. The problem is solved at each step <span class="math inline">\(m\)</span>:</p>
<p><span class="math display">\[
\left.\frac{\partial \mathbb{E}[L(Y,f_{m-1}(x)+f^m(x))|X=x]}{\partial f^m(x)}\right.=0
\]</span> using a second-order expansion of <span class="math inline">\(\mathbb{E}[L(Y,f_{m-1}(x)+f^m(x))|X=x]\approx\mathbb{E}[L(Y,f_{m-1}(x)|X=x]+\text{grad}^m(x)f^m(x)+\frac{1}{2}\text{hessian}^m(x)f^m(x)^2\)</span></p>
<p>where hessian is:</p>
<p><span class="math display">\[
\text{hessian}^m(x)=\left.\frac{\partial^2\mathrm R(f)}{\partial f(x)^2}\right|_{f(x)=f_{m-1}(x)}=\left.\frac{\partial^2 \mathbb{E}[L(Y,f(x))|X=x]}{\partial f(x)^2}\right|_{f(x)=f_{m-1}(x)} =  \mathbb{E} \left[\frac{\partial^2 L(Y,f(x))}{\partial f(x)^2}|X=x\right]_{f(x)=f_{m-1}(x)}
\]</span> Thus:</p>
<p><span class="math display">\[
\left.\frac{\partial \mathbb{E}[L(Y,f_{m-1}(x)+f^m(x))|X=x]}{\partial f^m(x)}\right.\approx \text{grad}^m(x)+\text{hessian}^m(x)f^m(x)=0
\]</span> giving a Newton-Raphson step in function space:</p>
<p><span class="math display">\[
f^m(x) = -\frac{\text{grad}^m(x)}{\text{hessian}^m(x)}
\]</span></p>
</section>
<section id="practical-implementations" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="practical-implementations"><span class="header-section-number">2.4</span> Practical Implementations</h2>
<section id="original-logitboost" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="original-logitboost"><span class="header-section-number">2.4.1</span> Original LogitBoost</h3>
<p>We first start by implementing the original LogitBoost algorithm as described in <span class="citation" data-cites="fht2000">Friedman (<a href="#ref-fht2000" role="doc-biblioref">2000</a>)</span>:</p>
<p><img src="images/logitboost_algo.png" class="img-fluid" data-fig-align="center"> It is a Forward Stagewise Additive Method, at each iteration a Newton step is performed, in the context of Decision Trees, this step is equivalent to fitting a Regression Tree on weighted residuals.</p>
<p>We check our implementation against <code>xgboost</code> in the context where our weak learner is a stump (ie decision trees with maximum depth 1).</p>
<p>To do that, we ensure that <code>xgboost</code> is minimizing the logistic loss (<code>objective = "binary:logistic"</code>), and using stumps as weak learners (<code>max.depth = 1</code>), we also do not shrink the Gradient/Newton step (<code>eta = 1</code>) and do not use any penalties (see <a href="https://xgboost.readthedocs.io/en/stable/parameter.html">here</a> for more details on <code>xgboost</code> parameters).</p>
<p>We perform the comparison on the Mixture data set, for <span class="math inline">\(6\)</span> boosting iterations:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>num_tree <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Degenerate xgboost to compare with our implementation (ie no penalty, using stumps and similar parameters)</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>xgb_deg <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1, x2)),</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y),</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">max.depth =</span> <span class="dv">1</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">eta =</span> <span class="dv">1</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">nthread =</span> <span class="dv">1</span>,</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">nrounds =</span> num_tree,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># xgboost does not have a minbucket parameter (ie minimum of obs per leaf)</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># it allows to control the min weight in a leaf </span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># minimum sum of instance weight (hessian) needed in a child</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># to allow comparison we allow a 0 weight </span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># which will be compared with a minbucket of 1 in the rpart implementation</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_child_weight =</span> <span class="dv">0</span>, </span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">tree_method =</span> <span class="st">"exact"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-logloss:0.557536 
[2] train-logloss:0.517095 
[3] train-logloss:0.482379 
[4] train-logloss:0.464733 
[5] train-logloss:0.439040 
[6] train-logloss:0.428613 </code></pre>
</div>
</div>
<p>We extract here the fitted trees/stumps decision rules and node predictions using <code>xgboost</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>xgb_trees <span class="ot">&lt;-</span> <span class="fu">xgb.dump</span>(xgb_deg, <span class="at">with_stats =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>(xgb_clean_tree <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">stump =</span> xgb_trees[<span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">4</span><span class="sc">*</span>(num_tree<span class="dv">-1</span>) <span class="sc">+</span> <span class="dv">2</span>, <span class="dv">4</span>)],</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">left =</span> xgb_trees[<span class="fu">seq</span>(<span class="dv">3</span>, <span class="dv">4</span><span class="sc">*</span>(num_tree<span class="dv">-1</span>) <span class="sc">+</span> <span class="dv">3</span>, <span class="dv">4</span>)],</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">right =</span> xgb_trees[<span class="fu">seq</span>(<span class="dv">4</span>, <span class="dv">4</span><span class="sc">*</span>(num_tree<span class="dv">-1</span>) <span class="sc">+</span> <span class="dv">4</span>, <span class="dv">4</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">extract</span>(stump, <span class="fu">c</span>(<span class="st">"rule"</span>, <span class="st">"gain"</span>, <span class="st">"cover"</span>), <span class="st">"0:</span><span class="sc">\\</span><span class="st">[(.+)</span><span class="sc">\\</span><span class="st">] yes</span><span class="sc">\\</span><span class="st">=1.*gain=(.*),cover=(.*)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">extract</span>(left, <span class="fu">c</span>(<span class="st">"left_pred"</span>, <span class="st">"left_cover"</span>), <span class="st">"1:leaf=(.+),cover=(.*)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">extract</span>(right, <span class="fu">c</span>(<span class="st">"right_pred"</span>, <span class="st">"right_cover"</span>), <span class="st">"2:leaf=(.+),cover=(.*)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">left_pred =</span> <span class="fu">as.numeric</span>(left_pred),</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">right_pred =</span> <span class="fu">as.numeric</span>(right_pred)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rule"],"name":[1],"type":["chr"],"align":["left"]},{"label":["gain"],"name":[2],"type":["chr"],"align":["left"]},{"label":["cover"],"name":[3],"type":["chr"],"align":["left"]},{"label":["left_pred"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["left_cover"],"name":[5],"type":["chr"],"align":["left"]},{"label":["right_pred"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["right_cover"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"f1<0.144127041","2":"50.3118515","3":"50","4":"-1.6923077","5":"13","6":"0.5945946","7":"37"},{"1":"f1<0.92796278","2":"15.3671589","3":"40.7408447","4":"-0.7208678","5":"19.6596661","6":"0.5082014","7":"21.0811787"},{"1":"f0<2.00842214","2":"13.7423573","3":"35.0801315","4":"0.2841503","5":"29.5016251","6":"-1.4273592","7":"5.57850552"},{"1":"f0<0.991148889","2":"7.2006321","3":"32.8221512","4":"-0.4121352","5":"18.6063728","6":"0.5331278","7":"14.2157774"},{"1":"f0<-0.967202127","2":"8.66294575","3":"34.7944908","4":"1.5064100","5":"3.4753406","6":"-0.1577089","7":"31.319149"},{"1":"f1<-0.344325602","2":"3.37158489","3":"33.0037079","4":"-1.1271961","5":"2.26858115","6":"0.1360959","7":"30.7351265"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>xgb_clean_tree <span class="sc">%&gt;%</span> <span class="fu">select</span>(rule, left_pred, right_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rule"],"name":[1],"type":["chr"],"align":["left"]},{"label":["left_pred"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["right_pred"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"f1<0.144127041","2":"-1.6923077","3":"0.5945946"},{"1":"f1<0.92796278","2":"-0.7208678","3":"0.5082014"},{"1":"f0<2.00842214","2":"0.2841503","3":"-1.4273592"},{"1":"f0<0.991148889","2":"-0.4121352","3":"0.5331278"},{"1":"f0<-0.967202127","2":"1.5064100","3":"-0.1577089"},{"1":"f1<-0.344325602","2":"-1.1271961","3":"0.1360959"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 × 3</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   rule            left_pred right_pred</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 f1&lt;0.144127041     -1.69       0.595</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 f1&lt;0.92796278      -0.721      0.508</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 f0&lt;2.00842214       0.284     -1.43 </span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 f0&lt;0.991148889     -0.412      0.533</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 f0&lt;-0.967202127     1.51      -0.158</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 f1&lt;-0.344325602    -1.13       0.136</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We implement below the Logitboost algorithm for binary classification as described in <span class="citation" data-cites="fht2000">Friedman (<a href="#ref-fht2000" role="doc-biblioref">2000</a>)</span>, using <code>rpart</code> decision trees as weak learners:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementing original Logitboost algorithm FHT2000 using rpart</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>data_train <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>fit_original_logitboost <span class="ot">&lt;-</span> <span class="cf">function</span>(data_train, M, <span class="at">minbucket=</span><span class="dv">1</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>){</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expect data with Y column in {0, 1}, with only additional predictors (as we will use formula Y ~ .)</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># should test unique(data %&gt;% pull(Y)) == c(0, 1) and classs(data %&gt;% pull(Y)) is numeric</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract Y</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data_train <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y)</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Length of training data</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span>  <span class="fu">nrow</span>(data_train)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  weak_learner <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialization of additive function f and probabilities p</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)             </span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, n)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rpart parameters for Stump</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>  cntrl <span class="ot">&lt;-</span> <span class="fu">rpart.control</span>(<span class="at">maxdepth =</span> <span class="dv">1</span>,</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">minsplit =</span> <span class="dv">0</span>,</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">minbucket =</span> minbucket,</span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">maxsurrogate =</span> <span class="dv">0</span>,</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">maxcompete =</span> <span class="dv">0</span>,</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cp =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Boosting Iterations</span></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the working response/residuals and weights</span></span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enforce a lower threshold on the weights: w = max(w, 2 × machine-zero).</span></span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">&lt;-</span> <span class="fu">pmax</span>(p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p), .Machine<span class="sc">$</span>double.eps <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># flooring with 2 times machine precision as suggested FHT00 p353</span></span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute residuals</span></span>
<span id="cb83-37"><a href="#cb83-37" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> (y <span class="sc">-</span> p) <span class="sc">/</span> w               </span>
<span id="cb83-38"><a href="#cb83-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-39"><a href="#cb83-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the function f^m(x) by a weighted least-squares regression of z to x_i </span></span>
<span id="cb83-40"><a href="#cb83-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># using weights w_i (weak learner is a stump)</span></span>
<span id="cb83-41"><a href="#cb83-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-42"><a href="#cb83-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store tree for predict on new data</span></span>
<span id="cb83-43"><a href="#cb83-43" aria-hidden="true" tabindex="-1"></a>    weak_learner[[m]] <span class="ot">&lt;-</span> <span class="fu">rpart</span>(z <span class="sc">~</span> .,</span>
<span id="cb83-44"><a href="#cb83-44" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> data_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Y), </span>
<span id="cb83-45"><a href="#cb83-45" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># we replace Y by z as a target, keeping all X to predict (~.)</span></span>
<span id="cb83-46"><a href="#cb83-46" aria-hidden="true" tabindex="-1"></a>                               <span class="at">weights =</span> w,</span>
<span id="cb83-47"><a href="#cb83-47" aria-hidden="true" tabindex="-1"></a>                               <span class="at">control =</span> cntrl,</span>
<span id="cb83-48"><a href="#cb83-48" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb83-49"><a href="#cb83-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-50"><a href="#cb83-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(verbose){</span>
<span id="cb83-51"><a href="#cb83-51" aria-hidden="true" tabindex="-1"></a>      fit <span class="ot">&lt;-</span> weak_learner[[m]]</span>
<span id="cb83-52"><a href="#cb83-52" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-53"><a href="#cb83-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Sanity checks</span></span>
<span id="cb83-54"><a href="#cb83-54" aria-hidden="true" tabindex="-1"></a>      weighted_data <span class="ot">&lt;-</span> data_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">y =</span> y, <span class="at">weights =</span> w, <span class="at">z =</span> z, <span class="at">p =</span> p) </span>
<span id="cb83-55"><a href="#cb83-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rpart.plot</span>(fit, <span class="at">type=</span><span class="dv">2</span>, <span class="at">extra=</span><span class="dv">101</span>, <span class="at">digits=</span><span class="dv">3</span>)</span>
<span id="cb83-56"><a href="#cb83-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-57"><a href="#cb83-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Manually compute weighted anova/sum of squares/leaf values</span></span>
<span id="cb83-58"><a href="#cb83-58" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Parent Node</span></span>
<span id="cb83-59"><a href="#cb83-59" aria-hidden="true" tabindex="-1"></a>      n_parent <span class="ot">&lt;-</span> <span class="fu">nrow</span>(weighted_data)</span>
<span id="cb83-60"><a href="#cb83-60" aria-hidden="true" tabindex="-1"></a>      sst <span class="ot">&lt;-</span> weighted_data <span class="sc">%&gt;%</span></span>
<span id="cb83-61"><a href="#cb83-61" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">weighted_mean =</span> <span class="fu">sum</span>(y <span class="sc">*</span> weights) <span class="sc">/</span> <span class="fu">sum</span>(weights),</span>
<span id="cb83-62"><a href="#cb83-62" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rss =</span> weights <span class="sc">*</span> (y <span class="sc">-</span> weighted_mean)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb83-63"><a href="#cb83-63" aria-hidden="true" tabindex="-1"></a>                 <span class="at">value =</span> weights <span class="sc">*</span> z) </span>
<span id="cb83-64"><a href="#cb83-64" aria-hidden="true" tabindex="-1"></a>      (SST <span class="ot">&lt;-</span> sst <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">rss=</span><span class="fu">sum</span>(rss), <span class="at">val =</span> <span class="fu">sum</span>(value) <span class="sc">/</span> <span class="fu">sum</span>(weights)))</span>
<span id="cb83-65"><a href="#cb83-65" aria-hidden="true" tabindex="-1"></a>      (SST <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rss))</span>
<span id="cb83-66"><a href="#cb83-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-67"><a href="#cb83-67" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Left Node</span></span>
<span id="cb83-68"><a href="#cb83-68" aria-hidden="true" tabindex="-1"></a>      left_weighted_data <span class="ot">&lt;-</span> weighted_data <span class="sc">%&gt;%</span></span>
<span id="cb83-69"><a href="#cb83-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">as.name</span>(<span class="fu">rownames</span>(fit<span class="sc">$</span>splits)[<span class="dv">1</span>])<span class="sc">&lt;</span>fit<span class="sc">$</span>splits[<span class="dv">1</span>, <span class="st">"index"</span>])</span>
<span id="cb83-70"><a href="#cb83-70" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-71"><a href="#cb83-71" aria-hidden="true" tabindex="-1"></a>      n_left <span class="ot">&lt;-</span> <span class="fu">nrow</span>(left_weighted_data)</span>
<span id="cb83-72"><a href="#cb83-72" aria-hidden="true" tabindex="-1"></a>      ssl <span class="ot">&lt;-</span> left_weighted_data <span class="sc">%&gt;%</span></span>
<span id="cb83-73"><a href="#cb83-73" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">weighted_mean =</span> <span class="fu">sum</span>(y <span class="sc">*</span> weights) <span class="sc">/</span> <span class="fu">sum</span>(weights),</span>
<span id="cb83-74"><a href="#cb83-74" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rss =</span> weights <span class="sc">*</span> (y <span class="sc">-</span> weighted_mean)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb83-75"><a href="#cb83-75" aria-hidden="true" tabindex="-1"></a>                 <span class="at">value =</span> weights <span class="sc">*</span> z) </span>
<span id="cb83-76"><a href="#cb83-76" aria-hidden="true" tabindex="-1"></a>      (SSL <span class="ot">&lt;-</span> ssl <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">rss=</span><span class="fu">sum</span>(rss), <span class="at">val =</span> <span class="fu">sum</span>(value) <span class="sc">/</span> <span class="fu">sum</span>(weights), <span class="at">wrong_val =</span> <span class="fu">mean</span>(z)))</span>
<span id="cb83-77"><a href="#cb83-77" aria-hidden="true" tabindex="-1"></a>      (SSL <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rss))</span>
<span id="cb83-78"><a href="#cb83-78" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-79"><a href="#cb83-79" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Right Node</span></span>
<span id="cb83-80"><a href="#cb83-80" aria-hidden="true" tabindex="-1"></a>      right_weighted_data <span class="ot">&lt;-</span> weighted_data <span class="sc">%&gt;%</span></span>
<span id="cb83-81"><a href="#cb83-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">as.name</span>(<span class="fu">rownames</span>(fit<span class="sc">$</span>splits)[<span class="dv">1</span>])<span class="sc">&gt;=</span>fit<span class="sc">$</span>splits[<span class="dv">1</span>, <span class="st">"index"</span>])</span>
<span id="cb83-82"><a href="#cb83-82" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-83"><a href="#cb83-83" aria-hidden="true" tabindex="-1"></a>      n_right <span class="ot">&lt;-</span> <span class="fu">nrow</span>(right_weighted_data)</span>
<span id="cb83-84"><a href="#cb83-84" aria-hidden="true" tabindex="-1"></a>      ssr <span class="ot">&lt;-</span> right_weighted_data <span class="sc">%&gt;%</span></span>
<span id="cb83-85"><a href="#cb83-85" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">weighted_mean =</span> <span class="fu">sum</span>(y <span class="sc">*</span> weights) <span class="sc">/</span> <span class="fu">sum</span>(weights),</span>
<span id="cb83-86"><a href="#cb83-86" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rss =</span> weights <span class="sc">*</span> (y <span class="sc">-</span> weighted_mean)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb83-87"><a href="#cb83-87" aria-hidden="true" tabindex="-1"></a>                 <span class="at">value =</span> weights <span class="sc">*</span> z) </span>
<span id="cb83-88"><a href="#cb83-88" aria-hidden="true" tabindex="-1"></a>      (SSR <span class="ot">&lt;-</span> ssr <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">rss=</span><span class="fu">sum</span>(rss), <span class="at">val =</span> <span class="fu">sum</span>(value) <span class="sc">/</span> <span class="fu">sum</span>(weights)))</span>
<span id="cb83-89"><a href="#cb83-89" aria-hidden="true" tabindex="-1"></a>      (SSR <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rss))</span>
<span id="cb83-90"><a href="#cb83-90" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb83-91"><a href="#cb83-91" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Compute gain</span></span>
<span id="cb83-92"><a href="#cb83-92" aria-hidden="true" tabindex="-1"></a>      (SST <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rss) <span class="sc">-</span> n_left<span class="sc">/</span>n_parent <span class="sc">*</span> SSL <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rss) <span class="sc">-</span> n_right<span class="sc">/</span>n_parent <span class="sc">*</span> SSR <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rss))</span>
<span id="cb83-93"><a href="#cb83-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb83-94"><a href="#cb83-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-95"><a href="#cb83-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-96"><a href="#cb83-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict f as weighted least square z~x, weight=w using CART</span></span>
<span id="cb83-97"><a href="#cb83-97" aria-hidden="true" tabindex="-1"></a>    f_m <span class="ot">&lt;-</span> <span class="fu">predict</span>(weak_learner[[m]])</span>
<span id="cb83-98"><a href="#cb83-98" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb83-99"><a href="#cb83-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update Newton Boosted Stumps (ie Forward Stagewise Additive Model) and probabilities</span></span>
<span id="cb83-100"><a href="#cb83-100" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> f <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> f_m</span>
<span id="cb83-101"><a href="#cb83-101" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> f))</span>
<span id="cb83-102"><a href="#cb83-102" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-103"><a href="#cb83-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-104"><a href="#cb83-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Output list of weak learners (here stumps) for the predict function</span></span>
<span id="cb83-105"><a href="#cb83-105" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="at">weak_learners=</span>weak_learner, <span class="at">probs=</span>p))</span>
<span id="cb83-106"><a href="#cb83-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-107"><a href="#cb83-107" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-108"><a href="#cb83-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-109"><a href="#cb83-109" aria-hidden="true" tabindex="-1"></a>logitboost_mixture <span class="ot">&lt;-</span> <span class="fu">fit_original_logitboost</span>(data_train, num_tree, <span class="cn">TRUE</span>)</span>
<span id="cb83-110"><a href="#cb83-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-111"><a href="#cb83-111" aria-hidden="true" tabindex="-1"></a>predict_original_logitboost <span class="ot">&lt;-</span> <span class="cf">function</span>(fitted_logitboost, new_data, <span class="at">num_tree =</span> <span class="sc">-</span><span class="dv">1</span>){</span>
<span id="cb83-112"><a href="#cb83-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-113"><a href="#cb83-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Allowing to use m &lt; M number of rounds</span></span>
<span id="cb83-114"><a href="#cb83-114" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">length</span>(fitted_logitboost<span class="sc">$</span>weak_learners)</span>
<span id="cb83-115"><a href="#cb83-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_tree <span class="sc">&gt;=</span><span class="dv">1</span> <span class="sc">&amp;</span> num_tree <span class="sc">&lt;</span> M){</span>
<span id="cb83-116"><a href="#cb83-116" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> num_tree</span>
<span id="cb83-117"><a href="#cb83-117" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb83-118"><a href="#cb83-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-119"><a href="#cb83-119" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb83-120"><a href="#cb83-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-121"><a href="#cb83-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predicting on new data with Newton Boosted Stumps </span></span>
<span id="cb83-122"><a href="#cb83-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (ie f function as Forward Stagewise Additive Model of Tress (depth 1)) and probabilities</span></span>
<span id="cb83-123"><a href="#cb83-123" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb83-124"><a href="#cb83-124" aria-hidden="true" tabindex="-1"></a>    f_m <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitted_logitboost<span class="sc">$</span>weak_learners[[m]], <span class="at">newdata =</span> new_data)</span>
<span id="cb83-125"><a href="#cb83-125" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> f <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> f_m</span>
<span id="cb83-126"><a href="#cb83-126" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-127"><a href="#cb83-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-128"><a href="#cb83-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get probability from Newton Boosted Stumps </span></span>
<span id="cb83-129"><a href="#cb83-129" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> f))</span>
<span id="cb83-130"><a href="#cb83-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb83-131"><a href="#cb83-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb83-132"><a href="#cb83-132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-133"><a href="#cb83-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-134"><a href="#cb83-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check: Compare predict(data_train) with original fit on data_train</span></span>
<span id="cb83-135"><a href="#cb83-135" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> <span class="fu">predict_original_logitboost</span>(logitboost_mixture, data_train, <span class="dv">6</span>)</span>
<span id="cb83-136"><a href="#cb83-136" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(logitboost_mixture<span class="sc">$</span>probs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(p_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(p_test)<span class="sc">==</span><span class="fu">sum</span>(logitboost_mixture<span class="sc">$</span>probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We compare below the <code>xgboost</code> predicted probabilities with our algorithm which are strictly equal up to the numerical precision:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare xgboost prediction (without penalties etc, and using stumps) </span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with logitboost original fit on data_train</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>pred_xgb <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_deg, <span class="fu">as.matrix</span>(data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1, x2)))</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(logitboost_mixture<span class="sc">$</span>probs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(pred_xgb))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">sum</span>(pred_xgb)<span class="sc">-</span><span class="fu">sum</span>(logitboost_mixture<span class="sc">$</span>probs))<span class="sc">&lt;</span><span class="fl">1e-6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We show below the LogitBoost decision boundary, here after <span class="math inline">\(100\)</span> iterations using our version of the algorithm:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>tree_number <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>logitboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_logitboost</span>(data_train, tree_number, <span class="cn">FALSE</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>tree_number_predict <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_train)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>grid_precision <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, grid_precision), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, grid_precision)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_logitboost =</span> <span class="fu">predict_original_logitboost</span>(logitboost_M, grid, <span class="at">num_tree =</span> tree_number_predict))) <span class="sc">%&gt;%</span> </span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>(logitboost_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> grid_precision, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_logitboost),</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fl">0.5</span><span class="sc">-</span>grid_precision, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_logitboost), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span><span class="sc">-</span>grid_precision,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>),</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>),</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.24</span>, <span class="fl">3.09</span>),</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>),</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>          <span class="co"># https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/</span></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"black"</span>),</span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"pt"</span>)</span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">stroke=</span><span class="st">"none"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>logitboost_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">predict_original_logitboost</span>(logitboost_M, new_mixture, <span class="at">num_tree =</span> tree_number)) <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">if_else</span>(class <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>(logitboost_risk <span class="ot">&lt;-</span> logitboost_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2725</code></pre>
</div>
</div>
<p>Here after <span class="math inline">\(100\)</span> iterations using <code>xgboost</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>tree_number <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>data_train_xgboost <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1, x2))</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>xgboost_M <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(data_train_xgboost),</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y),</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">max.depth =</span> <span class="dv">1</span>,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">eta =</span> <span class="dv">1</span>,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">nthread =</span> <span class="dv">1</span>,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">nrounds =</span> tree_number,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_child_weight =</span> <span class="dv">0</span>,</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># updater = "grow_colmaker",</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">tree_method =</span> <span class="st">"exact"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-logloss:0.557536 
[2] train-logloss:0.517095 
[3] train-logloss:0.482379 
[4] train-logloss:0.464733 
[5] train-logloss:0.439040 
[6] train-logloss:0.428613 
[7] train-logloss:0.421634 
[8] train-logloss:0.415460 
[9] train-logloss:0.405906 
[10]    train-logloss:0.397807 
[11]    train-logloss:0.392707 
[12]    train-logloss:0.387810 
[13]    train-logloss:0.382128 
[14]    train-logloss:0.376295 
[15]    train-logloss:0.371604 
[16]    train-logloss:0.363542 
[17]    train-logloss:0.359677 
[18]    train-logloss:0.354242 
[19]    train-logloss:0.351158 
[20]    train-logloss:0.348154 
[21]    train-logloss:0.345137 
[22]    train-logloss:0.341081 
[23]    train-logloss:0.336736 
[24]    train-logloss:0.333953 
[25]    train-logloss:0.330863 
[26]    train-logloss:0.324764 
[27]    train-logloss:0.322573 
[28]    train-logloss:0.318035 
[29]    train-logloss:0.315651 
[30]    train-logloss:0.313430 
[31]    train-logloss:0.311079 
[32]    train-logloss:0.308457 
[33]    train-logloss:0.305876 
[34]    train-logloss:0.303883 
[35]    train-logloss:0.301263 
[36]    train-logloss:0.299475 
[37]    train-logloss:0.297933 
[38]    train-logloss:0.296046 
[39]    train-logloss:0.294299 
[40]    train-logloss:0.292522 
[41]    train-logloss:0.291128 
[42]    train-logloss:0.289768 
[43]    train-logloss:0.288307 
[44]    train-logloss:0.286371 
[45]    train-logloss:0.285141 
[46]    train-logloss:0.282878 
[47]    train-logloss:0.281072 
[48]    train-logloss:0.279604 
[49]    train-logloss:0.277540 
[50]    train-logloss:0.276502 
[51]    train-logloss:0.274211 
[52]    train-logloss:0.272993 
[53]    train-logloss:0.271407 
[54]    train-logloss:0.269792 
[55]    train-logloss:0.267808 
[56]    train-logloss:0.266370 
[57]    train-logloss:0.264821 
[58]    train-logloss:0.263535 
[59]    train-logloss:0.262189 
[60]    train-logloss:0.261077 
[61]    train-logloss:0.259800 
[62]    train-logloss:0.258307 
[63]    train-logloss:0.257104 
[64]    train-logloss:0.255873 
[65]    train-logloss:0.254564 
[66]    train-logloss:0.253632 
[67]    train-logloss:0.252294 
[68]    train-logloss:0.251358 
[69]    train-logloss:0.249666 
[70]    train-logloss:0.248822 
[71]    train-logloss:0.247424 
[72]    train-logloss:0.246328 
[73]    train-logloss:0.245357 
[74]    train-logloss:0.243857 
[75]    train-logloss:0.242724 
[76]    train-logloss:0.241264 
[77]    train-logloss:0.239869 
[78]    train-logloss:0.238678 
[79]    train-logloss:0.237596 
[80]    train-logloss:0.236328 
[81]    train-logloss:0.235022 
[82]    train-logloss:0.233405 
[83]    train-logloss:0.231914 
[84]    train-logloss:0.230429 
[85]    train-logloss:0.229113 
[86]    train-logloss:0.227837 
[87]    train-logloss:0.226749 
[88]    train-logloss:0.225731 
[89]    train-logloss:0.224790 
[90]    train-logloss:0.223345 
[91]    train-logloss:0.222217 
[92]    train-logloss:0.221070 
[93]    train-logloss:0.220140 
[94]    train-logloss:0.219118 
[95]    train-logloss:0.218303 
[96]    train-logloss:0.217553 
[97]    train-logloss:0.216449 
[98]    train-logloss:0.215601 
[99]    train-logloss:0.214300 
[100]   train-logloss:0.213359 </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_train_xgboost)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>tree_number_predict <span class="ot">&lt;-</span> tree_number</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tree_number_predict &lt;- 20</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>grid_precision <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, grid_precision), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, grid_precision)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_logitboost =</span> <span class="fu">predict</span>(xgboost_M, <span class="fu">as.matrix</span>(grid), <span class="at">iterationrange=</span><span class="fu">c</span>(<span class="dv">1</span>, tree_number_predict <span class="sc">+</span> <span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>(logitboost_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> grid_precision, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_logitboost),</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fl">0.5</span><span class="sc">-</span>grid_precision, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_logitboost), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span><span class="sc">-</span>grid_precision,<span class="dv">1</span>), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>),</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>),</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.24</span>, <span class="fl">3.09</span>),</span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>),</span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>          <span class="co"># https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/</span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"black"</span>),</span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"pt"</span>)</span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">stroke=</span><span class="st">"none"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="mart-gradient-boosting-version-of-logitboost" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="mart-gradient-boosting-version-of-logitboost"><span class="header-section-number">2.4.2</span> MART: Gradient Boosting version of LogitBoost</h3>
<p>https://stats.stackexchange.com/questions/444267/spelling-out-a-detail-in-the-gradient-boosting-machine-algorithm-for-binary-clas</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mart_algo1.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mart_algo2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>fit_l01_treeboost <span class="ot">&lt;-</span> <span class="cf">function</span>(data_train, M, <span class="at">shrink =</span> <span class="fl">1.0</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>){</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fits friedman2001 version of LogitBoost (so called LK_TreeBoost or MART, Algorithm 5)</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expect data with Y column in {-1, 1}, with only additional predictors (as we will use formula Y ~ .)</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># can rewrite it for Y in {0, 1} cf p387 ESLII</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># should test unique(data %&gt;% pull(Y)) == c(0, 1) and classs(data %&gt;% pull(Y)) is numeric</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract Y ({0, 1})</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data_train <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Length of training data</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span>  <span class="fu">nrow</span>(data_train)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  weak_learner <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialization of additive function f and probability p</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)             </span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, n)</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rpart parameters for Stumps</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>  cntrl <span class="ot">&lt;-</span> <span class="fu">rpart.control</span>(<span class="at">maxdepth =</span> <span class="dv">1</span>,</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">minsplit =</span> <span class="dv">0</span>,</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">minbucket =</span> <span class="dv">1</span>,</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">maxsurrogate =</span> <span class="dv">0</span>,</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">maxcompete =</span> <span class="dv">0</span>,</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cp =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Boosting Iterations</span></span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute residual</span></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> y <span class="sc">-</span> p</span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Friedman gbm2001 version y in {-1, 1}</span></span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z &lt;- 2 * y / (1 + exp(2 * y * f))               </span></span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit the function f^m(x) by a weighted least-squares regression of z to x_i </span></span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># using weights w_i (weak learner is a stump)</span></span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a>    weak_learner_region <span class="ot">&lt;-</span> <span class="fu">rpart</span>(z <span class="sc">~</span> .,</span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>                               <span class="at">data =</span> data_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>Y), </span>
<span id="cb101-42"><a href="#cb101-42" aria-hidden="true" tabindex="-1"></a>                               <span class="co"># we replace Y by z as a target, keeping all X to predict (~.)</span></span>
<span id="cb101-43"><a href="#cb101-43" aria-hidden="true" tabindex="-1"></a>                               <span class="at">control =</span> cntrl,</span>
<span id="cb101-44"><a href="#cb101-44" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method =</span> <span class="st">"anova"</span>)</span>
<span id="cb101-45"><a href="#cb101-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-46"><a href="#cb101-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the leaf weights optimizing the line search once regions are known </span></span>
<span id="cb101-47"><a href="#cb101-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (they match weights computed for LogitBoost)</span></span>
<span id="cb101-48"><a href="#cb101-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Enforce a lower threshold on the weights: w = max(w, 2 × machine-zero).</span></span>
<span id="cb101-49"><a href="#cb101-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># w &lt;- pmax(p * (1 - p), .Machine$double.eps * 2) # flooring with 2 times machine precision as suggested FHT00 p353</span></span>
<span id="cb101-50"><a href="#cb101-50" aria-hidden="true" tabindex="-1"></a>    w <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="fu">abs</span>(z) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">abs</span>(z)), .Machine<span class="sc">$</span>double.eps <span class="sc">*</span> <span class="dv">2</span>) <span class="co"># using Friedman equivalent expression for leaf weigths </span></span>
<span id="cb101-51"><a href="#cb101-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-52"><a href="#cb101-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-53"><a href="#cb101-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Modifying leaf weights within the rpart object (tree regions/splits are left unchanged)</span></span>
<span id="cb101-54"><a href="#cb101-54" aria-hidden="true" tabindex="-1"></a>    leaf_weights <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">y=</span>y, <span class="at">z=</span>z, <span class="at">w=</span>w) <span class="sc">%&gt;%</span> <span class="co"># gathering observations z and w used to compute final weight</span></span>
<span id="cb101-55"><a href="#cb101-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">leaf =</span> weak_learner_region<span class="sc">$</span>where) <span class="sc">%&gt;%</span> <span class="co"># adding regression tree leaf/region for each observation</span></span>
<span id="cb101-56"><a href="#cb101-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(leaf) <span class="sc">%&gt;%</span></span>
<span id="cb101-57"><a href="#cb101-57" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb101-58"><a href="#cb101-58" aria-hidden="true" tabindex="-1"></a>                <span class="at">weight_node =</span> <span class="fu">sum</span>(z)<span class="sc">/</span><span class="fu">sum</span>(w),) <span class="co"># computing the sum_i(z_i) / sum_i(w_i) for each tree leaf</span></span>
<span id="cb101-59"><a href="#cb101-59" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Example for a stump</span></span>
<span id="cb101-60"><a href="#cb101-60" aria-hidden="true" tabindex="-1"></a>      <span class="co"># A tibble: 2 × 3</span></span>
<span id="cb101-61"><a href="#cb101-61" aria-hidden="true" tabindex="-1"></a>      <span class="co">#    leaf     n weight_node</span></span>
<span id="cb101-62"><a href="#cb101-62" aria-hidden="true" tabindex="-1"></a>      <span class="co">#   &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;</span></span>
<span id="cb101-63"><a href="#cb101-63" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 1     2    52      -1.69 </span></span>
<span id="cb101-64"><a href="#cb101-64" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 2     3   148       0.595</span></span>
<span id="cb101-65"><a href="#cb101-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-66"><a href="#cb101-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(verbose){ </span>
<span id="cb101-67"><a href="#cb101-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(leaf_weights)</span>
<span id="cb101-68"><a href="#cb101-68" aria-hidden="true" tabindex="-1"></a>      weak_learner_region_old <span class="ot">&lt;-</span> weak_learner_region}</span>
<span id="cb101-69"><a href="#cb101-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-70"><a href="#cb101-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We modify the rpart object leaf nodes weigths/values with our own</span></span>
<span id="cb101-71"><a href="#cb101-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Leaf 2 (ie left)</span></span>
<span id="cb101-72"><a href="#cb101-72" aria-hidden="true" tabindex="-1"></a>    weak_learner_region<span class="sc">$</span>frame[weak_learner_region<span class="sc">$</span>frame<span class="sc">$</span>n</span>
<span id="cb101-73"><a href="#cb101-73" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">==</span> (leaf_weights[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(n)),</span>
<span id="cb101-74"><a href="#cb101-74" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'yval'</span>] <span class="ot">&lt;-</span> leaf_weights[<span class="dv">1</span>,<span class="dv">3</span>]</span>
<span id="cb101-75"><a href="#cb101-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Leaf 3 (ie left)</span></span>
<span id="cb101-76"><a href="#cb101-76" aria-hidden="true" tabindex="-1"></a>    weak_learner_region<span class="sc">$</span>frame[weak_learner_region<span class="sc">$</span>frame<span class="sc">$</span>n</span>
<span id="cb101-77"><a href="#cb101-77" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">==</span> (leaf_weights[<span class="dv">2</span>,<span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">pull</span>(n)),</span>
<span id="cb101-78"><a href="#cb101-78" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'yval'</span>] <span class="ot">&lt;-</span> leaf_weights[<span class="dv">2</span>,<span class="dv">3</span>]</span>
<span id="cb101-79"><a href="#cb101-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-80"><a href="#cb101-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store modified tree for prediction on new data</span></span>
<span id="cb101-81"><a href="#cb101-81" aria-hidden="true" tabindex="-1"></a>    weak_learner[[m]] <span class="ot">&lt;-</span> weak_learner_region</span>
<span id="cb101-82"><a href="#cb101-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-83"><a href="#cb101-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(verbose){ </span>
<span id="cb101-84"><a href="#cb101-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sanity check: predict modified tree should differ</span></span>
<span id="cb101-85"><a href="#cb101-85" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">bind_cols</span>(<span class="fu">tibble</span>(<span class="at">modified =</span> <span class="fu">predict</span>(weak_learner_region, data_train)),</span>
<span id="cb101-86"><a href="#cb101-86" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tibble</span>(<span class="at">old =</span> <span class="fu">predict</span>(weak_learner_region_old, data_train))))</span>
<span id="cb101-87"><a href="#cb101-87" aria-hidden="true" tabindex="-1"></a>       <span class="co"># A tibble: 200 × 2</span></span>
<span id="cb101-88"><a href="#cb101-88" aria-hidden="true" tabindex="-1"></a>       <span class="co">#   modified    old</span></span>
<span id="cb101-89"><a href="#cb101-89" aria-hidden="true" tabindex="-1"></a>       <span class="co">#      &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb101-90"><a href="#cb101-90" aria-hidden="true" tabindex="-1"></a>       <span class="co"># 1    0.595  0.149</span></span>
<span id="cb101-91"><a href="#cb101-91" aria-hidden="true" tabindex="-1"></a>       <span class="co"># 2   -1.69  -0.423</span></span>
<span id="cb101-92"><a href="#cb101-92" aria-hidden="true" tabindex="-1"></a>       <span class="co"># 3    0.595  0.149</span></span>
<span id="cb101-93"><a href="#cb101-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb101-94"><a href="#cb101-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-95"><a href="#cb101-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict f as weighted least square z~x, weight=w using CART</span></span>
<span id="cb101-96"><a href="#cb101-96" aria-hidden="true" tabindex="-1"></a>    f_m <span class="ot">&lt;-</span> <span class="fu">predict</span>(weak_learner_region)</span>
<span id="cb101-97"><a href="#cb101-97" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb101-98"><a href="#cb101-98" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Updating Newton Boosted Stumps (ie Forward Stagewise Additive Model) and probabilities</span></span>
<span id="cb101-99"><a href="#cb101-99" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> f <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> shrink <span class="sc">*</span> f_m</span>
<span id="cb101-100"><a href="#cb101-100" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> f))</span>
<span id="cb101-101"><a href="#cb101-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-102"><a href="#cb101-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-103"><a href="#cb101-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Output list of weak learners (here stumps) for the predict function</span></span>
<span id="cb101-104"><a href="#cb101-104" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="at">weak_learners=</span>weak_learner, <span class="at">probs=</span>p))</span>
<span id="cb101-105"><a href="#cb101-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-106"><a href="#cb101-106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-107"><a href="#cb101-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-108"><a href="#cb101-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Friedman MART / gbm</span></span>
<span id="cb101-109"><a href="#cb101-109" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.corpart foircem/questions/31296541/understanding-tree-structure-in-r-gbm-package</span></span>
<span id="cb101-110"><a href="#cb101-110" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("gbm-developers/gbm3", build_vignettes = TRUE, force = TRUE)</span></span>
<span id="cb101-111"><a href="#cb101-111" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gbm)</span>
<span id="cb101-112"><a href="#cb101-112" aria-hidden="true" tabindex="-1"></a>gbm_deg <span class="ot">&lt;-</span> <span class="fu">gbm</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2,</span>
<span id="cb101-113"><a href="#cb101-113" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb101-114"><a href="#cb101-114" aria-hidden="true" tabindex="-1"></a>        <span class="at">n.trees =</span> <span class="dv">6</span>, </span>
<span id="cb101-115"><a href="#cb101-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">distribution =</span> <span class="st">"bernoulli"</span>,</span>
<span id="cb101-116"><a href="#cb101-116" aria-hidden="true" tabindex="-1"></a>        <span class="at">interaction.depth =</span> <span class="dv">1</span>,</span>
<span id="cb101-117"><a href="#cb101-117" aria-hidden="true" tabindex="-1"></a>        <span class="co"># n.minobsinnode comparable to rpart minbucket</span></span>
<span id="cb101-118"><a href="#cb101-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">n.minobsinnode =</span> <span class="dv">1</span>,</span>
<span id="cb101-119"><a href="#cb101-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">shrinkage =</span> <span class="dv">1</span>,</span>
<span id="cb101-120"><a href="#cb101-120" aria-hidden="true" tabindex="-1"></a>        <span class="at">bag.fraction =</span> <span class="dv">1</span>)</span>
<span id="cb101-121"><a href="#cb101-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-122"><a href="#cb101-122" aria-hidden="true" tabindex="-1"></a>list_gbm_trees <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-123"><a href="#cb101-123" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_tree){</span>
<span id="cb101-124"><a href="#cb101-124" aria-hidden="true" tabindex="-1"></a>  tree <span class="ot">&lt;-</span> gbm_deg<span class="sc">$</span>trees[[m]]</span>
<span id="cb101-125"><a href="#cb101-125" aria-hidden="true" tabindex="-1"></a>  list_gbm_trees[[m]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">var =</span> <span class="fu">if_else</span>(tree[[<span class="dv">1</span>]][<span class="dv">1</span>]<span class="sc">==</span><span class="dv">0</span>, <span class="st">"x1"</span>, <span class="st">"x2"</span>),</span>
<span id="cb101-126"><a href="#cb101-126" aria-hidden="true" tabindex="-1"></a>         <span class="at">split =</span> tree[[<span class="dv">2</span>]][<span class="dv">1</span>],</span>
<span id="cb101-127"><a href="#cb101-127" aria-hidden="true" tabindex="-1"></a>         <span class="at">left_pred =</span> tree[[<span class="dv">2</span>]][<span class="dv">2</span>],</span>
<span id="cb101-128"><a href="#cb101-128" aria-hidden="true" tabindex="-1"></a>         <span class="at">right_pred =</span> tree[[<span class="dv">2</span>]][<span class="dv">3</span>])</span>
<span id="cb101-129"><a href="#cb101-129" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-130"><a href="#cb101-130" aria-hidden="true" tabindex="-1"></a>gbm_trees <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(list_gbm_trees) <span class="sc">%&gt;%</span> </span>
<span id="cb101-131"><a href="#cb101-131" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">rule =</span> <span class="fu">ifelse</span>(var<span class="sc">==</span><span class="st">"x1"</span>, glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"f0&lt;{round(split,9)}"</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"f1&lt;{round(split,9)}"</span>)))</span>
<span id="cb101-132"><a href="#cb101-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-133"><a href="#cb101-133" aria-hidden="true" tabindex="-1"></a>gbm_trees <span class="sc">%&gt;%</span> <span class="fu">select</span>(rule, left_pred, right_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["rule"],"name":[1],"type":["chr"],"align":["left"]},{"label":["left_pred"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["right_pred"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"f1<0.14412705","2":"-1.69230769","3":"0.5945946"},{"1":"f1<0.927962775","2":"-0.72086776","3":"0.5082013"},{"1":"f0<2.125986653","2":"0.27716240","3":"-1.4367479"},{"1":"f0<0.991148884","2":"-0.40439682","3":"0.5239125"},{"1":"f0<-0.967202093","2":"1.50607816","3":"-0.1575898"},{"1":"f0<3.07754902","2":"-0.01178352","3":"1.2424032"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 6 × 3</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   rule            left_pred right_pred</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 f1&lt;0.14412705     -1.69        0.595</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 f1&lt;0.927962775    -0.721       0.508</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 f0&lt;2.125986653     0.277      -1.44 </span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 f0&lt;0.991148884    -0.404       0.524</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 f0&lt;-0.967202093    1.51       -0.158</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 f0&lt;3.07754902     -0.0118      1.24</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pretty.gbm.tree(gbm_deg, i.tree=1)</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   SplitVar SplitCodePred LeftNode RightNode MissingNode ErrorReduction Weight Prediction</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 0        1     0.1441271        1         2           3       12.57796    200  0.0000000</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 1       -1    -1.6923077       -1        -1          -1        0.00000     52 -1.6923077</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2       -1     0.5945946       -1        -1          -1        0.00000    148  0.5945946</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 3       -1     0.0000000       -1        -1          -1        0.00000    200  0.0000000</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Although the methods are not totally eauivalent (xgboost is Newton, gbm is Gradient based), the underlying stumps roughly agree</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare gbm prediction (with learning rate = 1 etc, and using stumps) </span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="co"># with gradient boosting flavor of logitboost original fit on data_train</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>gbt_mixtures <span class="ot">&lt;-</span> <span class="fu">fit_l01_treeboost</span>(data_train, num_tree, <span class="at">shrink =</span> <span class="fl">1.0</span>, <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
   leaf     n weight_node
  &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
1     2    52      -1.69 
2     3   148       0.595
# A tibble: 2 × 3
   leaf     n weight_node
  &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
1     2   108      -0.721
2     3    92       0.508
# A tibble: 2 × 3
   leaf     n weight_node
  &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
1     2    32      -1.44 
2     3   168       0.277
# A tibble: 2 × 3
   leaf     n weight_node
  &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
1     2   108      -0.404
2     3    92       0.524
# A tibble: 2 × 3
   leaf     n weight_node
  &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
1     2   183      -0.158
2     3    17       1.51 
# A tibble: 2 × 3
   leaf     n weight_node
  &lt;int&gt; &lt;int&gt;       &lt;dbl&gt;
1     2   193     -0.0118
2     3     7      1.24  </code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(gbt_mixtures<span class="sc">$</span>probs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93048</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>p_gbm <span class="ot">&lt;-</span> <span class="fu">predict</span>(gbm_deg,<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(p_gbm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93048</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">abs</span>(<span class="fu">sum</span>(gbt_mixtures<span class="sc">$</span>probs)<span class="sc">-</span><span class="fu">sum</span>(p_gbm)) <span class="sc">&lt;</span> <span class="fl">1e-6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>predict_l01_treeboost <span class="ot">&lt;-</span> <span class="cf">function</span>(fitted_l01_treeboost, new_data, <span class="at">num_tree =</span> <span class="sc">-</span><span class="dv">1</span>){</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Allowing to use m &lt; M number of rounds</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">length</span>(fitted_l01_treeboost<span class="sc">$</span>weak_learners)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_tree <span class="sc">&gt;=</span><span class="dv">1</span> <span class="sc">&amp;</span> num_tree <span class="sc">&lt;</span> M){</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> num_tree</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predicting on new data with Newton Boosted Stumps </span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (ie f function as Forward Stagewise Additive Model of Tress (depth 1)) and probabilities</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>    f_m <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitted_l01_treeboost<span class="sc">$</span>weak_learners[[m]], <span class="at">newdata =</span> new_data)</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> f <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> f_m</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get probability from Newton Boosted Stumps </span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> f))</span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check: Compare predict(data_train) with original fit on data_train</span></span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> <span class="fu">predict_l01_treeboost</span>(gbt_mixtures, data_train, <span class="dv">6</span>)</span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(p_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93048</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(gbt_mixtures<span class="sc">$</span>probs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99.93048</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(p_test) <span class="sc">==</span> <span class="fu">sum</span>(gbt_mixtures<span class="sc">$</span>probs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>MART decision boundaries for various number of boosting iterations:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>tree_number <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>l01_treeboost_M <span class="ot">&lt;-</span> <span class="fu">fit_l01_treeboost</span>(data_train, tree_number, <span class="at">shrink =</span> <span class="fl">1.0</span>, <span class="cn">FALSE</span>)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>tree_number_predict <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_train)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>grid_precision <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, grid_precision), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, grid_precision)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_mart =</span> <span class="fu">predict_l01_treeboost</span>(l01_treeboost_M, grid, <span class="at">num_tree =</span> tree_number_predict))) <span class="sc">%&gt;%</span> </span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>(logitboost_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> grid_precision, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_mart),</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fl">0.5</span><span class="sc">-</span>grid_precision, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_mart), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span><span class="sc">-</span>grid_precision,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>),</span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>),</span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.24</span>, <span class="fl">3.09</span>),</span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>),</span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a>          <span class="co"># https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/</span></span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"black"</span>),</span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"pt"</span>)</span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">stroke=</span><span class="st">"none"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>mart_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">predict_l01_treeboost</span>(l01_treeboost_M, new_mixture, <span class="at">num_tree =</span> tree_number_predict)) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">if_else</span>(class <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>(mart_risk <span class="ot">&lt;-</span> mart_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2525</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>tree_number_predict <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data_train)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>grid_precision <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, grid_precision), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, grid_precision)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_mart =</span> <span class="fu">predict_l01_treeboost</span>(l01_treeboost_M, grid, <span class="at">num_tree =</span> tree_number_predict))) <span class="sc">%&gt;%</span> </span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>(logitboost_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> grid_precision, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_mart),</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fl">0.5</span><span class="sc">-</span>grid_precision, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_mart), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span><span class="sc">-</span>grid_precision,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>),</span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">name=</span><span class="st">"Y"</span>,</span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)) <span class="sc">+</span></span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>),</span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.24</span>, <span class="fl">3.09</span>),</span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>),</span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a>          <span class="co"># https://www.tidyverse.org/blog/2024/02/ggplot2-3-5-0-legends/</span></span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">"black"</span>),</span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.key.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"pt"</span>)</span>
<span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">+</span></span>
<span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">stroke=</span><span class="st">"none"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>mart_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">predict_l01_treeboost</span>(l01_treeboost_M, new_mixture, <span class="at">num_tree =</span> tree_number_predict)) <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fu">if_else</span>(class <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>(mart_risk <span class="ot">&lt;-</span> mart_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2585</code></pre>
</div>
</div>
<p>Train / Test curves for AdaBoost, LogitBoost and MART</p>
<p>We vary the number of tree fitted <span class="math inline">\(M\)</span> and show the empirical risks on training and testing sets together with Bayes risk:</p>
<p>We estimate the Bayes risk on the testing data set simulated before (10k BLUE/ORANGE dots).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>bayes_error_rate <span class="ot">&lt;-</span> new_mixture <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2),</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_oracle, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>bayes_test_risk <span class="ot">&lt;-</span> bayes_error_rate <span class="sc">%&gt;%</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(l01)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>bayes_error_rate_train <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2),</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_oracle, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>bayes_train_risk <span class="ot">&lt;-</span> bayes_error_rate_train <span class="sc">%&gt;%</span></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(l01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We compare below AdaBoost, LogitBoost, MART (Gradient Boosting version of LogitBoost) algorithms in terms of testing set misclassification:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>tree_number <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">as.integer</span>(tree_number<span class="sc">/</span><span class="dv">4</span>), <span class="dv">2</span>),</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq</span>(<span class="fu">as.integer</span>(tree_number<span class="sc">/</span><span class="dv">4</span>), <span class="fu">as.integer</span>(tree_number<span class="sc">/</span><span class="dv">2</span>), <span class="dv">10</span>),</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">seq</span>(<span class="fu">as.integer</span>(tree_number<span class="sc">/</span><span class="dv">2</span>), tree_number, <span class="dv">20</span>))</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>misclass_curve <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>logitboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_logitboost</span>(data_train, tree_number, <span class="cn">FALSE</span>)</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>adaboost_M <span class="ot">&lt;-</span> <span class="fu">fit_original_adaboost</span>(data_ada, tree_number, <span class="cn">FALSE</span>)</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>mart_M <span class="ot">&lt;-</span> <span class="fu">fit_l01_treeboost</span>(data_train, tree_number, <span class="at">shrink =</span> <span class="dv">1</span>, <span class="cn">FALSE</span>)</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (m <span class="cf">in</span> M){</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>  logitboost_error_rate_train <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(data_train,</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">tibble</span>(<span class="at">class_train =</span> <span class="fu">predict_original_logitboost</span>(logitboost_M, data_train, <span class="at">num_tree =</span> m)) <span class="sc">%&gt;%</span></span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">mutate</span>(<span class="at">class_train =</span> <span class="fu">if_else</span>(class_train <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">mutate</span>(<span class="at">l01_train =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class_train, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>  mart_error_rate_train <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(data_train,</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">tibble</span>(<span class="at">class_train =</span> <span class="fu">predict_l01_treeboost</span>(mart_M, data_train, <span class="at">num_tree =</span> m)) <span class="sc">%&gt;%</span></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">mutate</span>(<span class="at">class_train =</span> <span class="fu">if_else</span>(class_train <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">mutate</span>(<span class="at">l01_train =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class_train, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>  adaboost_error_rate_train <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(data_train,</span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">tibble</span>(<span class="at">class_train =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, data_ada, <span class="at">num_tree =</span> m)) <span class="sc">%&gt;%</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">mutate</span>(<span class="at">class_train =</span> <span class="fu">if_else</span>(class_train <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">mutate</span>(<span class="at">l01_train =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class_train, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb123-29"><a href="#cb123-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-30"><a href="#cb123-30" aria-hidden="true" tabindex="-1"></a>  logitboost_error_rate_test <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb123-31"><a href="#cb123-31" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">tibble</span>(<span class="at">class_test =</span> <span class="fu">predict_original_logitboost</span>(logitboost_M, new_mixture, <span class="at">num_tree =</span> m)) <span class="sc">%&gt;%</span></span>
<span id="cb123-32"><a href="#cb123-32" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">mutate</span>(<span class="at">class_test =</span> <span class="fu">if_else</span>(class_test <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb123-33"><a href="#cb123-33" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb123-34"><a href="#cb123-34" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">l01_test =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class_test, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb123-35"><a href="#cb123-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-36"><a href="#cb123-36" aria-hidden="true" tabindex="-1"></a>  adaboost_error_rate_test <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb123-37"><a href="#cb123-37" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">tibble</span>(<span class="at">class_test =</span> <span class="fu">predict_original_adaboost</span>(adaboost_M, new_mixture, <span class="at">num_tree =</span> m))<span class="sc">%&gt;%</span></span>
<span id="cb123-38"><a href="#cb123-38" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">mutate</span>(<span class="at">class_test =</span> <span class="fu">if_else</span>(class_test <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb123-39"><a href="#cb123-39" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb123-40"><a href="#cb123-40" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">l01_test =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class_test, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb123-41"><a href="#cb123-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-42"><a href="#cb123-42" aria-hidden="true" tabindex="-1"></a>  mart_error_rate_test <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb123-43"><a href="#cb123-43" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">tibble</span>(<span class="at">class_test =</span> <span class="fu">predict_l01_treeboost</span>(mart_M, new_mixture, <span class="at">num_tree =</span> m)) <span class="sc">%&gt;%</span></span>
<span id="cb123-44"><a href="#cb123-44" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">mutate</span>(<span class="at">class_test =</span> <span class="fu">if_else</span>(class_test <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb123-45"><a href="#cb123-45" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb123-46"><a href="#cb123-46" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">l01_test =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class_test, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb123-47"><a href="#cb123-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-48"><a href="#cb123-48" aria-hidden="true" tabindex="-1"></a>  (logitboost_risk_train <span class="ot">&lt;-</span> logitboost_error_rate_train  <span class="sc">%&gt;%</span></span>
<span id="cb123-49"><a href="#cb123-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">l01_train =</span> <span class="fu">mean</span>(l01_train)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-50"><a href="#cb123-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(l01_train))</span>
<span id="cb123-51"><a href="#cb123-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-52"><a href="#cb123-52" aria-hidden="true" tabindex="-1"></a>  (logitboost_risk_test <span class="ot">&lt;-</span> logitboost_error_rate_test  <span class="sc">%&gt;%</span></span>
<span id="cb123-53"><a href="#cb123-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01_test =</span> <span class="fu">mean</span>(l01_test)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-54"><a href="#cb123-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01_test))</span>
<span id="cb123-55"><a href="#cb123-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-56"><a href="#cb123-56" aria-hidden="true" tabindex="-1"></a>  (adaboost_risk_train <span class="ot">&lt;-</span> adaboost_error_rate_train  <span class="sc">%&gt;%</span></span>
<span id="cb123-57"><a href="#cb123-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01_train =</span> <span class="fu">mean</span>(l01_train)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-58"><a href="#cb123-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01_train))</span>
<span id="cb123-59"><a href="#cb123-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-60"><a href="#cb123-60" aria-hidden="true" tabindex="-1"></a>  (adaboost_risk_test <span class="ot">&lt;-</span> adaboost_error_rate_test  <span class="sc">%&gt;%</span></span>
<span id="cb123-61"><a href="#cb123-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">l01_test =</span> <span class="fu">mean</span>(l01_test)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-62"><a href="#cb123-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(l01_test))</span>
<span id="cb123-63"><a href="#cb123-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-64"><a href="#cb123-64" aria-hidden="true" tabindex="-1"></a>  (mart_risk_train <span class="ot">&lt;-</span> mart_error_rate_train  <span class="sc">%&gt;%</span></span>
<span id="cb123-65"><a href="#cb123-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01_train =</span> <span class="fu">mean</span>(l01_train)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-66"><a href="#cb123-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01_train))</span>
<span id="cb123-67"><a href="#cb123-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-68"><a href="#cb123-68" aria-hidden="true" tabindex="-1"></a>  (mart_risk_test <span class="ot">&lt;-</span> mart_error_rate_test  <span class="sc">%&gt;%</span></span>
<span id="cb123-69"><a href="#cb123-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">l01_test =</span> <span class="fu">mean</span>(l01_test)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-70"><a href="#cb123-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(l01_test))</span>
<span id="cb123-71"><a href="#cb123-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-72"><a href="#cb123-72" aria-hidden="true" tabindex="-1"></a>  misclass_curve[[m]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">`</span><span class="at">m - Number of Boosted Trees</span><span class="st">`</span> <span class="ot">=</span> m,</span>
<span id="cb123-73"><a href="#cb123-73" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Boosting: Logitboost train</span><span class="st">`</span> <span class="ot">=</span> logitboost_risk_train,</span>
<span id="cb123-74"><a href="#cb123-74" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Boosting: Logitboost test</span><span class="st">`</span> <span class="ot">=</span> logitboost_risk_test,</span>
<span id="cb123-75"><a href="#cb123-75" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Boosting: MART train</span><span class="st">`</span> <span class="ot">=</span> mart_risk_train,</span>
<span id="cb123-76"><a href="#cb123-76" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Boosting: MART test</span><span class="st">`</span> <span class="ot">=</span> mart_risk_test,</span>
<span id="cb123-77"><a href="#cb123-77" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Boosting: Adaboost train</span><span class="st">`</span> <span class="ot">=</span> adaboost_risk_train,</span>
<span id="cb123-78"><a href="#cb123-78" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">`</span><span class="at">Boosting: Adaboost test</span><span class="st">`</span> <span class="ot">=</span> adaboost_risk_test)</span>
<span id="cb123-79"><a href="#cb123-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb123-80"><a href="#cb123-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb123-81"><a href="#cb123-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-82"><a href="#cb123-82" aria-hidden="true" tabindex="-1"></a>misclass_plot <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(misclass_curve) <span class="sc">%&gt;%</span> </span>
<span id="cb123-83"><a href="#cb123-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Bayes test</span><span class="st">`</span> <span class="ot">=</span> bayes_test_risk,</span>
<span id="cb123-84"><a href="#cb123-84" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Bayes train</span><span class="st">`</span> <span class="ot">=</span> bayes_train_risk) <span class="sc">%&gt;%</span> </span>
<span id="cb123-85"><a href="#cb123-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="st">`</span><span class="at">m - Number of Boosted Trees</span><span class="st">`</span>,</span>
<span id="cb123-86"><a href="#cb123-86" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">"Model data"</span>,</span>
<span id="cb123-87"><a href="#cb123-87" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">"Misclass Rate"</span>)</span>
<span id="cb123-88"><a href="#cb123-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-89"><a href="#cb123-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-90"><a href="#cb123-90" aria-hidden="true" tabindex="-1"></a>(boosted_trees_error <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(misclass_plot) <span class="sc">+</span></span>
<span id="cb123-91"><a href="#cb123-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">m - Number of Boosted Trees</span><span class="st">`</span>,</span>
<span id="cb123-92"><a href="#cb123-92" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="st">`</span><span class="at">Misclass Rate</span><span class="st">`</span>,</span>
<span id="cb123-93"><a href="#cb123-93" aria-hidden="true" tabindex="-1"></a>                  <span class="at">col =</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Model data</span><span class="st">`</span>),</span>
<span id="cb123-94"><a href="#cb123-94" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Model data</span><span class="st">`</span>) )) <span class="sc">+</span></span>
<span id="cb123-95"><a href="#cb123-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Bayes test"</span> <span class="ot">=</span> <span class="st">"purple"</span>, <span class="st">"Bayes train"</span> <span class="ot">=</span> <span class="st">"green"</span>,</span>
<span id="cb123-96"><a href="#cb123-96" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Boosting: Logitboost test"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"Boosting: Logitboost train"</span> <span class="ot">=</span> <span class="st">"dodgerblue"</span>,</span>
<span id="cb123-97"><a href="#cb123-97" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Boosting: MART test"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"Boosting: MART train"</span> <span class="ot">=</span> <span class="st">"dodgerblue"</span>,</span>
<span id="cb123-98"><a href="#cb123-98" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Boosting: Adaboost test"</span> <span class="ot">=</span> <span class="st">"orange"</span>, <span class="st">"Boosting: Adaboost train"</span> <span class="ot">=</span> <span class="st">"dodgerblue"</span> )) <span class="sc">+</span></span>
<span id="cb123-99"><a href="#cb123-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Bayes test"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Bayes train"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb123-100"><a href="#cb123-100" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Boosting: Logitboost test"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"Boosting: Logitboost train"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb123-101"><a href="#cb123-101" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Boosting: MART test"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"Boosting: MART train"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb123-102"><a href="#cb123-102" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Boosting: Adaboost test"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"Boosting: Adaboost train"</span> <span class="ot">=</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb123-103"><a href="#cb123-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb123-104"><a href="#cb123-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">col =</span> <span class="cn">NULL</span>, <span class="at">linetype=</span><span class="cn">NULL</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="exercise" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="exercise"><span class="header-section-number">2.4.3</span> Exercise</h3>
<p>Compare testing error on reference data set for various: gradient boosting algorithm / number of boosting iterations / shrink-learning rate parameters (see for example <a href="https://scikit-learn.org/1.5/auto_examples/ensemble/plot_gradient_boosting_regularization.html">here</a>).</p>
</section>
<section id="ping-li-robust-logitboost" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="ping-li-robust-logitboost"><span class="header-section-number">2.4.4</span> Ping Li Robust LogitBoost</h3>
<p>We then investigate a more recent version of LogitBoost algorithm, allowing to partially bridge the gap between the original <span class="citation" data-cites="fht2000">Friedman (<a href="#ref-fht2000" role="doc-biblioref">2000</a>)</span> and the more recent and state of the art <code>xgboost</code> implementation <span class="citation" data-cites="xgboost2016">Chen and Guestrin (<a href="#ref-xgboost2016" role="doc-biblioref">2016</a>)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/robust_logitboost_algo.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/robust_logitboost_gain1.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><img src="images/robust_logitboost_gain2.png" class="img-fluid" data-fig-align="center"> <img src="images/xgboost_gain.png" class="img-fluid" data-fig-align="center"> The underlying idea common to both Robust LogitBoost and <code>xgboost</code> is to take advantage of some simplifications that occur for Gradient Boosting / Newton methods when base learners are Decision Trees. In particular it is possible to show that the problem is equivalent to fitting a Decision Tree using a novel splitting criterion or gain, more precisely using a Sum of Squares criterion (Regression tree) involving the gradient and the hessian of any convex loss.</p>
<p>In the <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span>, authors suggest that AdaBoost or any comparable FSAM can be fitted using specialized trees (ie specific gain used to split), but prefer to follow the approach of Friedman’s Gradient Boosting which at that time was supposed more robust and straightforward: <img src="images/ESL_specialized_trees.png" class="img-fluid" data-fig-align="center"></p>
<p>We implement here the Ping Li Robust LogitBoost method, re-using our implementation from scratch of a Decision Tree at the start of the course.</p>
<p>By slightly modifying the implementation,</p>
<p>First we define specialized <code>xgboost</code> / Robust LogitBoost gains (using Gradient, Hessian, <span class="math inline">\(\lambda\)</span>):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>xgboost_gain <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, y, <span class="at">verbose =</span> <span class="cn">FALSE</span>){</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assumes tbl contains a probability (prob) column and response (r in {0,1}) column</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># allowing to compute - grad = r - prob and hessian = prob * (1 - prob)</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expects lambda parameter (l2 regularization)</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(tbl) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  gain <span class="ot">&lt;-</span> tbl <span class="sc">%&gt;%</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">gain =</span> <span class="sc">-</span> <span class="fu">sum</span>(grad) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> (<span class="fu">sum</span>(hessian) <span class="sc">+</span> <span class="fu">mean</span>(lambda))) <span class="sc">%&gt;%</span> </span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(gain)</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  gain</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we slightly modify the other involved functions to adapt the problem to a regression setting (the implementation at the start of the lesson was dedicated to binary classification problem):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>gain_sum_square <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl_node, y_name, x_name, split_value, <span class="at">min_leaf =</span> <span class="dv">5</span>){</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Whenever any of left/right child node contains less than min_leaf observations we return a default value for impurity</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># excluding de facto the split to be taken into account</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    ret_default <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"impurity_left"</span><span class="ot">=</span><span class="dv">666</span>,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_right"</span><span class="ot">=</span><span class="dv">666</span>,</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_total"</span><span class="ot">=</span><span class="dv">666</span>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>    tbl_left <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name <span class="sc">&lt;</span> <span class="sc">!!</span>split_value)</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>    n_left <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tbl_left)</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_left <span class="sc">&lt;</span> min_leaf){<span class="fu">return</span>(ret_default)} </span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>    impurity_left <span class="ot">&lt;-</span> <span class="fu">xgboost_gain</span>(tbl_left, y_name)</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>    tbl_right <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name <span class="sc">&gt;=!!</span>split_value)</span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>    n_right <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tbl_right)</span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (n_right <span class="sc">&lt;</span> min_leaf){<span class="fu">return</span>(ret_default)}</span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>    impurity_right <span class="ot">&lt;-</span> <span class="fu">xgboost_gain</span>(tbl_right, y_name)</span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"impurity_left"</span> <span class="ot">=</span> impurity_left,</span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_right"</span> <span class="ot">=</span> impurity_right,</span>
<span id="cb125-21"><a href="#cb125-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">"impurity_total"</span> <span class="ot">=</span> impurity_left <span class="sc">+</span> impurity_right))</span>
<span id="cb125-22"><a href="#cb125-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># similar to max_impurity_decrease for decision tree</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>max_gain <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl_node, y_name, x_names, <span class="at">min_leaf =</span> <span class="dv">5</span>, <span class="at">midpoint =</span> <span class="cn">FALSE</span>){</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>    imp_node <span class="ot">=</span> <span class="fu">xgboost_gain</span>(tbl_node, y_name)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    list_all_x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    tbl_res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">feature_split =</span> <span class="st">"zzz"</span>, <span class="at">split_rule =</span> <span class="sc">-</span><span class="dv">666</span>, <span class="at">imp_left =</span> <span class="dv">666</span>, <span class="at">imp_right =</span> <span class="dv">666</span>, <span class="at">imp_total =</span> <span class="dv">666</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (x_name <span class="cf">in</span> x_names){</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>        list_x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>       <span class="co"># print(x_name)</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>        splits <span class="ot">&lt;-</span> <span class="fu">unique</span>(tbl_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x_name))</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># modify the algorithm to split on 'midpoint' value for continuous variable (some decision trees do (CART) other don't (C4.5))</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(midpoint){</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>            splits <span class="ot">&lt;-</span> <span class="fu">sort</span>(splits)</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>            splits <span class="ot">&lt;-</span> splits[<span class="sc">-</span><span class="fu">length</span>(splits)] <span class="sc">+</span> <span class="fu">diff</span>(splits)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (split <span class="cf">in</span> splits){</span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># print(split)</span></span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>            imp_dec <span class="ot">&lt;-</span> <span class="fu">gain_sum_square</span>(tbl_node, y_name, x_name, split, min_leaf)</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a>            <span class="co"># list_x[[j]] &lt;- c(split, imp_dec)</span></span>
<span id="cb126-20"><a href="#cb126-20" aria-hidden="true" tabindex="-1"></a>            tbl_res <span class="ot">&lt;-</span>  <span class="fu">bind_rows</span>(tbl_res,</span>
<span id="cb126-21"><a href="#cb126-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">tibble</span>(<span class="at">feature_split =</span> <span class="fu">as.character</span>(x_name),</span>
<span id="cb126-22"><a href="#cb126-22" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">split_rule =</span> split,</span>
<span id="cb126-23"><a href="#cb126-23" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_node =</span> imp_node,</span>
<span id="cb126-24"><a href="#cb126-24" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_left =</span> imp_dec[[<span class="st">"impurity_left"</span>]],</span>
<span id="cb126-25"><a href="#cb126-25" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_right =</span> imp_dec[[<span class="st">"impurity_right"</span>]],</span>
<span id="cb126-26"><a href="#cb126-26" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">imp_total =</span> imp_dec[[<span class="st">"impurity_total"</span>]]))</span>
<span id="cb126-27"><a href="#cb126-27" aria-hidden="true" tabindex="-1"></a>        }   </span>
<span id="cb126-28"><a href="#cb126-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-29"><a href="#cb126-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-30"><a href="#cb126-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tbl_res)</span>
<span id="cb126-31"><a href="#cb126-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We show below how the best split is performed for a single node using the new criterion / gain:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add pro/hessian, parameters columns for xgboost method</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>tbl_node <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y)),</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob =</span> <span class="fl">0.5</span>,</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad =</span> <span class="sc">-</span>(r <span class="sc">-</span> prob),</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">hessian =</span> prob <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> prob),</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda =</span> <span class="fl">0.0</span>,</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">gamma =</span> <span class="fl">0.0</span>)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a>x_name <span class="ot">=</span> <span class="fu">as.name</span>(<span class="st">"x2"</span>)</span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>split_value <span class="ot">=</span> <span class="fl">0.1441271</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="fu">gain_sum_square</span>(tbl_node, y_name, x_name, split_value, <span class="at">min_leaf =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$impurity_left
[1] -37.23077

$impurity_right
[1] -13.08108

$impurity_total
[1] -50.31185</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">max_gain</span>(tbl_node, y_name, x_names, <span class="at">min_leaf =</span> <span class="dv">1</span>, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>(test <span class="ot">&lt;-</span> test <span class="sc">%&gt;%</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(feature_split<span class="sc">!=</span><span class="st">"zzz"</span>, imp_total <span class="sc">!=</span> <span class="dv">666</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(imp_total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature_split"],"name":[1],"type":["chr"],"align":["left"]},{"label":["split_rule"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["imp_left"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["imp_right"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["imp_total"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["imp_node"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"x2","2":"0.144127050","3":"-37.230769231","4":"-13.081081081","5":"-50.31185031","6":"0"},{"1":"x2","2":"0.547790627","3":"-30.392405063","4":"-19.842975207","5":"-50.23538027","6":"0"},{"1":"x2","2":"0.120182536","3":"-36.254901961","4":"-12.409395973","5":"-48.66429793","6":"0"},{"1":"x2","2":"0.534664626","3":"-29.538461538","4":"-18.885245902","5":"-48.42370744","6":"0"},{"1":"x2","2":"0.554175093","3":"-28.800000000","4":"-19.200000000","5":"-48.00000000","6":"0"},{"1":"x2","2":"0.157958496","3":"-34.886792453","4":"-12.578231293","5":"-47.46502375","6":"0"},{"1":"x2","2":"0.088134465","3":"-35.280000000","4":"-11.760000000","5":"-47.04000000","6":"0"},{"1":"x2","2":"0.515136621","3":"-28.688311688","4":"-17.959349593","5":"-46.64766128","6":"0"},{"1":"x2","2":"0.391519195","3":"-30.228571429","4":"-16.276923077","5":"-46.50549451","6":"0"},{"1":"x2","2":"0.927962775","3":"-21.333333333","4":"-25.043478261","5":"-46.37681159","6":"0"},{"1":"x2","2":"0.185527377","3":"-33.618181818","4":"-12.751724138","5":"-46.36990596","6":"0"},{"1":"x2","2":"0.914579475","3":"-21.735849057","4":"-24.510638298","5":"-46.24648735","6":"0"},{"1":"x2","2":"0.442197569","3":"-29.388888889","4":"-16.531250000","5":"-45.92013889","6":"0"},{"1":"x2","2":"0.571395257","3":"-27.271604938","4":"-18.563025210","5":"-45.83463015","6":"0"},{"1":"x2","2":"0.360105971","3":"-30.223880597","4":"-15.225563910","5":"-45.44944451","6":"0"},{"1":"x2","2":"0.071873079","3":"-34.306122449","4":"-11.132450331","5":"-45.43857278","6":"0"},{"1":"x2","2":"0.211267592","3":"-32.438596491","4":"-12.930069930","5":"-45.36866642","6":"0"},{"1":"x2","2":"0.497828851","3":"-27.842105263","4":"-17.064516129","5":"-44.90662139","6":"0"},{"1":"x2","2":"0.370913398","3":"-29.347826087","4":"-15.458015267","5":"-44.80584135","6":"0"},{"1":"x2","2":"0.174975628","3":"-32.666666667","4":"-12.082191781","5":"-44.74885845","6":"0"},{"1":"x2","2":"0.721642885","3":"-24.820224719","4":"-19.900900901","5":"-44.72112562","6":"0"},{"1":"x2","2":"0.740580234","3":"-24.274725275","4":"-20.266055046","5":"-44.54078032","6":"0"},{"1":"x2","2":"0.948106938","3":"-20.266055046","4":"-24.274725275","5":"-44.54078032","6":"0"},{"1":"x2","2":"0.918941357","3":"-20.644859813","4":"-23.752688172","5":"-44.39754799","6":"0"},{"1":"x2","2":"0.906327130","3":"-21.038095238","4":"-23.252631579","5":"-44.29072682","6":"0"},{"1":"x2","2":"0.408842992","3":"-28.521126761","4":"-15.697674419","5":"-44.21880118","6":"0"},{"1":"x2","2":"0.050957326","3":"-33.333333333","4":"-10.526315789","5":"-43.85964912","6":"0"},{"1":"x2","2":"0.353236783","3":"-29.333333333","4":"-14.447761194","5":"-43.78109453","6":"0"},{"1":"x2","2":"0.196739844","3":"-31.500000000","4":"-12.250000000","5":"-43.75000000","6":"0"},{"1":"x2","2":"0.617774733","3":"-25.804878049","4":"-17.932203390","5":"-43.73708144","6":"0"},{"1":"x2","2":"0.475913812","3":"-27.739726027","4":"-15.944881890","5":"-43.68460792","6":"0"},{"1":"x2","2":"0.487319239","3":"-27.000000000","4":"-16.200000000","5":"-43.20000000","6":"0"},{"1":"x2","2":"0.362280275","3":"-28.470588235","4":"-14.666666667","5":"-43.13725490","6":"0"},{"1":"x2","2":"0.711245492","3":"-24.045454545","4":"-18.892857143","5":"-42.93831169","6":"0"},{"1":"x2","2":"0.976432997","3":"-18.892857143","4":"-24.045454545","5":"-42.93831169","6":"0"},{"1":"x2","2":"0.228074287","3":"-30.413793103","4":"-12.422535211","5":"-42.83632831","6":"0"},{"1":"x2","2":"0.732346059","3":"-23.511111111","4":"-19.236363636","5":"-42.74747475","6":"0"},{"1":"x2","2":"0.960969286","3":"-19.236363636","4":"-23.511111111","5":"-42.74747475","6":"0"},{"1":"x2","2":"0.756999719","3":"-23.000000000","4":"-19.592592593","5":"-42.59259259","6":"0"},{"1":"x2","2":"0.789308371","3":"-22.510638298","4":"-19.962264151","5":"-42.47290245","6":"0"},{"1":"x2","2":"0.893954198","3":"-20.346153846","4":"-22.041666667","5":"-42.38782051","6":"0"},{"1":"x2","2":"0.028450325","3":"-32.361702128","4":"-9.941176471","5":"-42.30287860","6":"0"},{"1":"x2","2":"0.337015046","3":"-28.446153846","4":"-13.696296296","5":"-42.14245014","6":"0"},{"1":"x2","2":"0.018947326","3":"-32.818181818","4":"-9.256410256","5":"-42.07459207","6":"0"},{"1":"x2","2":"0.652135010","3":"-24.397590361","4":"-17.307692308","5":"-41.70528267","6":"0"},{"1":"x2","2":"0.482591480","3":"-26.162162162","4":"-15.365079365","5":"-41.52724153","6":"0"},{"1":"x2","2":"1.017749622","3":"-17.608695652","4":"-23.823529412","5":"-41.43222506","6":"0"},{"1":"x2","2":"0.699303196","3":"-23.275862069","4":"-17.920353982","5":"-41.19621605","6":"0"},{"1":"x2","2":"0.985655055","3":"-17.920353982","4":"-23.275862069","5":"-41.19621605","6":"0"},{"1":"x2","2":"0.967851753","3":"-18.243243243","4":"-22.752808989","5":"-40.99605223","6":"0"},{"1":"x2","2":"0.023951306","3":"-31.391304348","4":"-9.376623377","5":"-40.76792772","6":"0"},{"1":"x2","2":"0.774462760","3":"-21.774193548","4":"-18.925233645","5":"-40.69942719","6":"0"},{"1":"x2","2":"0.805236430","3":"-21.315789474","4":"-19.285714286","5":"-40.60150376","6":"0"},{"1":"x2","2":"0.013437408","3":"-31.837209302","4":"-8.719745223","5":"-40.55695453","6":"0"},{"1":"x2","2":"0.884892391","3":"-19.660194175","4":"-20.876288660","5":"-40.53648283","6":"0"},{"1":"x2","2":"0.324673136","3":"-27.562500000","4":"-12.970588235","5":"-40.53308824","6":"0"},{"1":"x2","2":"0.256760851","3":"-28.491525424","4":"-11.921985816","5":"-40.41351124","6":"0"},{"1":"x2","2":"0.660238420","3":"-23.047619048","4":"-16.689655172","5":"-39.73727422","6":"0"},{"1":"x2","2":"1.032714452","3":"-16.689655172","4":"-23.047619048","5":"-39.73727422","6":"0"},{"1":"x2","2":"0.297217160","3":"-27.557377049","4":"-12.093525180","5":"-39.65090223","6":"0"},{"1":"x2","2":"0.682976119","3":"-22.511627907","4":"-16.982456140","5":"-39.49408405","6":"0"},{"1":"x2","2":"1.000596327","3":"-16.982456140","4":"-22.511627907","5":"-39.49408405","6":"0"},{"1":"x2","2":"0.021578533","3":"-30.422222222","4":"-8.832258065","5":"-39.25448029","6":"0"},{"1":"x2","2":"-0.010036481","3":"-30.857142857","4":"-8.202531646","5":"-39.05967450","6":"0"},{"1":"x2","2":"0.322181212","3":"-26.682539683","4":"-12.270072993","5":"-38.95261268","6":"0"},{"1":"x2","2":"0.811008886","3":"-20.166666667","4":"-18.615384615","5":"-38.78205128","6":"0"},{"1":"x2","2":"0.880098484","3":"-18.980392157","4":"-19.755102041","5":"-38.73549420","6":"0"},{"1":"x2","2":"0.280272002","3":"-26.666666667","4":"-11.428571429","5":"-38.09523810","6":"0"},{"1":"x2","2":"1.039045071","3":"-15.803418803","4":"-22.277108434","5":"-38.08052724","6":"0"},{"1":"x2","2":"0.669131531","3":"-21.752941176","4":"-16.078260870","5":"-37.83120205","6":"0"},{"1":"x2","2":"-0.047145716","3":"-29.878048780","4":"-7.704402516","5":"-37.58245130","6":"0"},{"1":"x2","2":"0.313762761","3":"-25.806451613","4":"-11.594202899","5":"-37.40065451","6":"0"},{"1":"x2","2":"0.813344671","3":"-19.061855670","4":"-17.951456311","5":"-37.01331198","6":"0"},{"1":"x2","2":"0.871949267","3":"-18.306930693","4":"-18.676767677","5":"-36.98369837","6":"0"},{"1":"x2","2":"-0.344325580","3":"-31.000000000","4":"-5.686390533","5":"-36.68639053","6":"0"},{"1":"x2","2":"1.039581815","3":"-14.949152542","4":"-21.512195122","5":"-36.46134766","6":"0"},{"1":"x2","2":"-0.074866436","3":"-28.900000000","4":"-7.225000000","5":"-36.12500000","6":"0"},{"1":"x2","2":"-0.388096913","3":"-30.000000000","4":"-5.294117647","5":"-35.29411765","6":"0"},{"1":"x2","2":"0.833022205","3":"-18.000000000","4":"-17.294117647","5":"-35.29411765","6":"0"},{"1":"x2","2":"0.861386809","3":"-17.640000000","4":"-17.640000000","5":"-35.28000000","6":"0"},{"1":"x2","2":"1.046115947","3":"-14.126050420","4":"-20.753086420","5":"-34.87913684","6":"0"},{"1":"x2","2":"-0.302126088","3":"-29.121212121","4":"-5.754491018","5":"-34.87570314","6":"0"},{"1":"x2","2":"-0.218568171","3":"-28.444444444","4":"-6.243902439","5":"-34.68834688","6":"0"},{"1":"x2","2":"-0.097168978","3":"-27.923076923","4":"-6.763975155","5":"-34.68705208","6":"0"},{"1":"x2","2":"-0.436467654","3":"-29.000000000","4":"-4.918128655","5":"-33.91812865","6":"0"},{"1":"x2","2":"1.168907492","3":"-11.610687023","4":"-22.043478261","5":"-33.65416528","6":"0"},{"1":"x2","2":"1.082508838","3":"-13.114754098","4":"-20.512820513","5":"-33.62757461","6":"0"},{"1":"x2","2":"0.853921283","3":"-16.979797980","4":"-16.643564356","5":"-33.62336234","6":"0"},{"1":"x2","2":"-0.320273225","3":"-28.125000000","4":"-5.357142857","5":"-33.48214286","6":"0"},{"1":"x2","2":"1.055191443","3":"-13.333333333","4":"-20.000000000","5":"-33.33333333","6":"0"},{"1":"x2","2":"-0.277455925","3":"-27.457142857","4":"-5.824242424","5":"-33.28138528","6":"0"},{"1":"x2","2":"-0.137177518","3":"-26.947368421","4":"-6.320987654","5":"-33.26835608","6":"0"},{"1":"x2","2":"1.159886924","3":"-11.790697674","4":"-21.422535211","5":"-33.21323289","6":"0"},{"1":"x2","2":"-0.455308276","3":"-28.000000000","4":"-4.558139535","5":"-32.55813953","6":"0"},{"1":"x2","2":"1.172413276","3":"-10.939393939","4":"-21.235294118","5":"-32.17468806","6":"0"},{"1":"x2","2":"1.087748970","3":"-12.365853659","4":"-19.753246753","5":"-32.11910041","6":"0"},{"1":"x2","2":"-0.289159758","3":"-26.470588235","4":"-5.421686747","5":"-31.89227498","6":"0"},{"1":"x2","2":"-0.165653850","3":"-25.972972973","4":"-5.895705521","5":"-31.86867849","6":"0"},{"1":"x2","2":"1.068990472","3":"-12.570247934","4":"-19.253164557","5":"-31.82341249","6":"0"},{"1":"x2","2":"1.166676782","3":"-11.107692308","4":"-20.628571429","5":"-31.73626374","6":"0"},{"1":"x2","2":"1.151247636","3":"-11.281250000","4":"-20.055555556","5":"-31.33680556","6":"0"},{"1":"x2","2":"-0.467702844","3":"-27.000000000","4":"-4.213872832","5":"-31.21387283","6":"0"},{"1":"x2","2":"1.220099117","3":"-10.140740741","4":"-21.061538462","5":"-31.20227920","6":"0"},{"1":"x2","2":"1.121776001","3":"-11.460317460","4":"-19.513513514","5":"-30.97383097","6":"0"},{"1":"x2","2":"1.187996492","3":"-10.293233083","4":"-20.432835821","5":"-30.72606890","6":"0"},{"1":"x2","2":"1.097114236","3":"-11.645161290","4":"-19.000000000","5":"-30.64516129","6":"0"},{"1":"x2","2":"-0.480683653","3":"-26.000000000","4":"-3.885057471","5":"-29.88505747","6":"0"},{"1":"x2","2":"1.233425640","3":"-9.529411765","4":"-20.250000000","5":"-29.77941176","6":"0"},{"1":"x2","2":"1.141991862","3":"-10.779527559","4":"-18.753424658","5":"-29.53295222","6":"0"},{"1":"x2","2":"1.208719042","3":"-9.671641791","4":"-19.636363636","5":"-29.30800543","6":"0"},{"1":"x2","2":"1.105898997","3":"-10.952000000","4":"-18.253333333","5":"-29.20533333","6":"0"},{"1":"x2","2":"-0.506270920","3":"-25.000000000","4":"-3.571428571","5":"-28.57142857","6":"0"},{"1":"x2","2":"1.246613677","3":"-8.941605839","4":"-19.444444444","5":"-28.38605028","6":"0"},{"1":"x2","2":"1.280043595","3":"-8.140845070","4":"-19.931034483","5":"-28.07187955","6":"0"},{"1":"x2","2":"1.371289347","3":"-7.510344828","4":"-19.800000000","5":"-27.31034483","6":"0"},{"1":"x2","2":"-0.541135679","3":"-24.000000000","4":"-3.272727273","5":"-27.27272727","6":"0"},{"1":"x2","2":"1.250664357","3":"-8.376811594","4":"-18.645161290","5":"-27.02197288","6":"0"},{"1":"x2","2":"1.320283783","3":"-7.615384615","4":"-19.105263158","5":"-26.72064777","6":"0"},{"1":"x2","2":"1.275324281","3":"-7.723404255","4":"-18.457627119","5":"-26.18103137","6":"0"},{"1":"x2","2":"-0.642498845","3":"-23.000000000","4":"-2.988700565","5":"-25.98870056","6":"0"},{"1":"x2","2":"1.384334493","3":"-7.013698630","4":"-18.962962963","5":"-25.97666159","6":"0"},{"1":"x2","2":"1.458952238","3":"-6.364238411","4":"-19.612244898","5":"-25.97648331","6":"0"},{"1":"x2","2":"1.256168135","3":"-7.834532374","4":"-17.852459016","5":"-25.68699139","6":"0"},{"1":"x2","2":"1.357945755","3":"-7.111111111","4":"-18.285714286","5":"-25.39682540","6":"0"},{"1":"x2","2":"1.423046616","3":"-6.449664430","4":"-18.843137255","5":"-25.29280168","6":"0"},{"1":"x2","2":"-0.735261938","3":"-22.000000000","4":"-2.719101124","5":"-24.71910112","6":"0"},{"1":"x2","2":"1.475186518","3":"-5.921052632","4":"-18.750000000","5":"-24.67105263","6":"0"},{"1":"x2","2":"1.391794511","3":"-6.537414966","4":"-18.132075472","5":"-24.66949044","6":"0"},{"1":"x2","2":"1.267556398","3":"-7.314285714","4":"-17.066666667","5":"-24.38095238","6":"0"},{"1":"x2","2":"1.442636931","3":"-6.000000000","4":"-18.000000000","5":"-24.00000000","6":"0"},{"1":"x2","2":"-0.740013975","3":"-21.000000000","4":"-2.463687151","5":"-23.46368715","6":"0"},{"1":"x2","2":"1.490831014","3":"-5.496732026","4":"-17.893617021","5":"-23.39034905","6":"0"},{"1":"x2","2":"1.408584627","3":"-6.081081081","4":"-17.307692308","5":"-23.38877339","6":"0"},{"1":"x2","2":"1.629422811","3":"-4.527950311","4":"-18.692307692","5":"-23.22025800","6":"0"},{"1":"x2","2":"-0.743892544","3":"-20.000000000","4":"-2.222222222","5":"-22.22222222","6":"0"},{"1":"x2","2":"1.518654559","3":"-5.090909091","4":"-17.043478261","5":"-22.13438735","6":"0"},{"1":"x2","2":"1.640319076","3":"-4.172839506","4":"-17.789473684","5":"-21.96231319","6":"0"},{"1":"x2","2":"1.617159997","3":"-4.225000000","4":"-16.900000000","5":"-21.12500000","6":"0"},{"1":"x2","2":"-0.753390373","3":"-19.000000000","4":"-1.994475138","5":"-20.99447514","6":"0"},{"1":"x2","2":"1.548231136","3":"-4.703225806","4":"-16.200000000","5":"-20.90322581","6":"0"},{"1":"x2","2":"1.675857692","3":"-3.834355828","4":"-16.891891892","5":"-20.72624772","6":"0"},{"1":"x2","2":"2.011507493","3":"-2.520000000","4":"-17.640000000","5":"-20.16000000","6":"0"},{"1":"x2","2":"-0.774491034","3":"-18.000000000","4":"-1.780219780","5":"-19.78021978","6":"0"},{"1":"x2","2":"1.558230300","3":"-4.333333333","4":"-15.363636364","5":"-19.69696970","6":"0"},{"1":"x2","2":"1.709499737","3":"-3.512195122","4":"-16.000000000","5":"-19.51219512","6":"0"},{"1":"x2","2":"1.594671197","3":"-3.930817610","4":"-15.243902439","5":"-19.17472005","6":"0"},{"1":"x2","2":"2.028065882","3":"-2.272727273","4":"-16.666666667","5":"-18.93939394","6":"0"},{"1":"x2","2":"1.966265867","3":"-2.549132948","4":"-16.333333333","5":"-18.88246628","6":"0"},{"1":"x1","2":"-0.967202093","3":"-17.000000000","4":"-1.579234973","5":"-18.57923497","6":"0"},{"1":"x2","2":"-0.808774842","3":"-17.000000000","4":"-1.579234973","5":"-18.57923497","6":"0"},{"1":"x2","2":"1.571708599","3":"-3.980891720","4":"-14.534883721","5":"-18.51577544","6":"0"},{"1":"x2","2":"1.716872530","3":"-3.206060606","4":"-15.114285714","5":"-18.32034632","6":"0"},{"1":"x2","2":"2.046892359","3":"-2.039548023","4":"-15.695652174","5":"-17.73520020","6":"0"},{"1":"x2","2":"2.005127989","3":"-2.298850575","4":"-15.384615385","5":"-17.68346596","6":"0"},{"1":"x1","2":"-1.079161601","3":"-16.000000000","4":"-1.391304348","5":"-17.39130435","6":"0"},{"1":"x2","2":"-0.866087056","3":"-16.000000000","4":"-1.391304348","5":"-17.39130435","6":"0"},{"1":"x2","2":"1.579373812","3":"-3.645569620","4":"-13.714285714","5":"-17.35985533","6":"0"},{"1":"x2","2":"1.727154586","3":"-2.915662651","4":"-14.235294118","5":"-17.15095677","6":"0"},{"1":"x2","2":"1.905999401","3":"-2.325581395","4":"-14.285714286","5":"-16.61129568","6":"0"},{"1":"x2","2":"2.064295301","3":"-1.820224719","4":"-14.727272727","5":"-16.54749745","6":"0"},{"1":"x1","2":"-1.149651072","3":"-15.000000000","4":"-1.216216216","5":"-16.21621622","6":"0"},{"1":"x2","2":"-0.902662472","3":"-15.000000000","4":"-1.216216216","5":"-16.21621622","6":"0"},{"1":"x2","2":"1.746327882","3":"-2.640718563","4":"-13.363636364","5":"-16.00435493","6":"0"},{"1":"x1","2":"-0.876494555","3":"-14.222222222","4":"-1.406593407","5":"-15.62881563","6":"0"},{"1":"x2","2":"2.092354630","3":"-1.614525140","4":"-13.761904762","5":"-15.37642990","6":"0"},{"1":"x1","2":"-0.130990783","3":"-11.755555556","4":"-3.412903226","5":"-15.16845878","6":"0"},{"1":"x1","2":"-1.166010838","3":"-14.000000000","4":"-1.053763441","5":"-15.05376344","6":"0"},{"1":"x2","2":"-0.911677940","3":"-14.000000000","4":"-1.053763441","5":"-15.05376344","6":"0"},{"1":"x2","2":"1.781265685","3":"-2.380952381","4":"-12.500000000","5":"-14.88095238","6":"0"},{"1":"x1","2":"-0.193759349","3":"-11.523809524","4":"-3.063291139","5":"-14.58710066","6":"0"},{"1":"x2","2":"1.879666014","3":"-2.111111111","4":"-12.448275862","5":"-14.55938697","6":"0"},{"1":"x1","2":"-0.765685505","3":"-12.800000000","4":"-1.422222222","5":"-14.22222222","6":"0"},{"1":"x2","2":"2.117206048","3":"-1.422222222","4":"-12.800000000","5":"-14.22222222","6":"0"},{"1":"x1","2":"-0.340891635","3":"-11.764705882","4":"-2.409638554","5":"-14.17434444","6":"0"},{"1":"x1","2":"2.008422239","3":"-2.409638554","4":"-11.764705882","5":"-14.17434444","6":"0"},{"1":"x1","2":"-0.160173135","3":"-11.000000000","4":"-3.102564103","5":"-14.10256410","6":"0"},{"1":"x1","2":"-1.212850157","3":"-13.000000000","4":"-0.903743316","5":"-13.90374332","6":"0"},{"1":"x2","2":"-0.967258554","3":"-13.000000000","4":"-0.903743316","5":"-13.90374332","6":"0"},{"1":"x2","2":"1.832690166","3":"-2.136094675","4":"-11.645161290","5":"-13.78125596","6":"0"},{"1":"x1","2":"0.063738864","3":"-9.600000000","4":"-4.114285714","5":"-13.71428571","6":"0"},{"1":"x1","2":"-0.094371255","3":"-10.521739130","4":"-3.142857143","5":"-13.66459627","6":"0"},{"1":"x1","2":"1.631979627","3":"-3.142857143","4":"-10.521739130","5":"-13.66459627","6":"0"},{"1":"x1","2":"-0.306961323","3":"-11.111111111","4":"-2.439024390","5":"-13.55013550","6":"0"},{"1":"x1","2":"-0.198464748","3":"-10.756097561","4":"-2.773584906","5":"-13.52968247","6":"0"},{"1":"x1","2":"-0.369134571","3":"-10.939393939","4":"-2.161676647","5":"-13.10107059","6":"0"},{"1":"x1","2":"2.098259914","3":"-2.161676647","4":"-10.939393939","5":"-13.10107059","6":"0"},{"1":"x1","2":"-0.822331453","3":"-11.842105263","4":"-1.243093923","5":"-13.08519919","6":"0"},{"1":"x2","2":"2.133824458","3":"-1.243093923","4":"-11.842105263","5":"-13.08519919","6":"0"},{"1":"x1","2":"-0.179398113","3":"-10.255813953","4":"-2.808917197","5":"-13.06473115","6":"0"},{"1":"x1","2":"0.023645797","3":"-9.280701754","4":"-3.699300699","5":"-12.98000245","6":"0"},{"1":"x1","2":"-1.260651263","3":"-12.000000000","4":"-0.765957447","5":"-12.76595745","6":"0"},{"1":"x2","2":"-1.018870440","3":"-12.000000000","4":"-0.765957447","5":"-12.76595745","6":"0"},{"1":"x1","2":"0.058664984","3":"-8.966101695","4":"-3.751773050","5":"-12.71787474","6":"0"},{"1":"x2","2":"1.868835835","3":"-1.905882353","4":"-10.800000000","5":"-12.70588235","6":"0"},{"1":"x1","2":"1.641501069","3":"-2.845161290","4":"-9.800000000","5":"-12.64516129","6":"0"},{"1":"x1","2":"-0.312327729","3":"-10.314285714","4":"-2.187878788","5":"-12.50216450","6":"0"},{"1":"x1","2":"1.936000627","3":"-2.187878788","4":"-10.314285714","5":"-12.50216450","6":"0"},{"1":"x1","2":"-0.228909720","3":"-10.000000000","4":"-2.500000000","5":"-12.50000000","6":"0"},{"1":"x1","2":"0.076973489","3":"-8.672131148","4":"-3.805755396","5":"-12.47788654","6":"0"},{"1":"x1","2":"-0.078348907","3":"-9.382978723","4":"-2.882352941","5":"-12.26533166","6":"0"},{"1":"x1","2":"1.618507237","3":"-2.882352941","4":"-9.382978723","5":"-12.26533166","6":"0"},{"1":"x1","2":"0.127503506","3":"-8.396825397","4":"-3.861313869","5":"-12.25813927","6":"0"},{"1":"x1","2":"-0.369901469","3":"-10.125000000","4":"-1.928571429","5":"-12.05357143","6":"0"},{"1":"x1","2":"2.125986653","3":"-1.928571429","4":"-10.125000000","5":"-12.05357143","6":"0"},{"1":"x1","2":"0.011051843","3":"-8.642857143","4":"-3.361111111","5":"-12.00396825","6":"0"},{"1":"x1","2":"-0.298818509","3":"-9.756756757","4":"-2.214723926","5":"-11.97148068","6":"0"},{"1":"x1","2":"-0.721180495","3":"-10.714285714","4":"-1.256983240","5":"-11.97126895","6":"0"},{"1":"x2","2":"2.161795724","3":"-1.076923077","4":"-10.888888889","5":"-11.96581197","6":"0"},{"1":"x1","2":"0.044751447","3":"-8.344827586","4":"-3.408450704","5":"-11.75327829","6":"0"},{"1":"x1","2":"2.245715263","3":"-1.690058480","4":"-9.965517241","5":"-11.65557572","6":"0"},{"1":"x1","2":"1.679038990","3":"-2.564102564","4":"-9.090909091","5":"-11.65501166","6":"0"},{"1":"x1","2":"-1.364775835","3":"-11.000000000","4":"-0.640211640","5":"-11.64021164","6":"0"},{"1":"x2","2":"-1.052589174","3":"-11.000000000","4":"-0.640211640","5":"-11.64021164","6":"0"},{"1":"x1","2":"-0.062362884","3":"-8.647058824","4":"-2.959731544","5":"-11.60679037","6":"0"},{"1":"x1","2":"1.527284148","3":"-2.959731544","4":"-8.647058824","5":"-11.60679037","6":"0"},{"1":"x1","2":"-0.260946478","3":"-9.256410256","4":"-2.242236025","5":"-11.49864628","6":"0"},{"1":"x1","2":"1.519604123","3":"-3.000000000","4":"-8.320754717","5":"-11.32075472","6":"0"},{"1":"x1","2":"0.106318090","3":"-7.806451613","4":"-3.507246377","5":"-11.31369799","6":"0"},{"1":"x1","2":"0.132166544","3":"-7.562500000","4":"-3.558823529","5":"-11.12132353","6":"0"},{"1":"x1","2":"1.745465059","3":"-2.270440252","4":"-8.804878049","5":"-11.07531830","6":"0"},{"1":"x1","2":"0.006687620","3":"-8.018181818","4":"-3.041379310","5":"-11.05956113","6":"0"},{"1":"x1","2":"-0.385535656","3":"-9.322580645","4":"-1.710059172","5":"-11.03263982","6":"0"},{"1":"x1","2":"2.161706725","3":"-1.710059172","4":"-9.322580645","5":"-11.03263982","6":"0"},{"1":"x1","2":"1.925872599","3":"-1.975609756","4":"-9.000000000","5":"-10.97560976","6":"0"},{"1":"x1","2":"-0.075596781","3":"-8.333333333","4":"-2.631578947","5":"-10.96491228","6":"0"},{"1":"x1","2":"1.602268766","3":"-2.631578947","4":"-8.333333333","5":"-10.96491228","6":"0"},{"1":"x2","2":"2.194519351","3":"-0.923497268","4":"-9.941176471","5":"-10.86467374","6":"0"},{"1":"x1","2":"1.720457380","3":"-2.299363057","4":"-8.395348837","5":"-10.69471189","6":"0"},{"1":"x1","2":"-0.071634769","3":"-8.000000000","4":"-2.666666667","5":"-10.66666667","6":"0"},{"1":"x1","2":"1.554617215","3":"-2.666666667","4":"-8.000000000","5":"-10.66666667","6":"0"},{"1":"x1","2":"-0.458471118","3":"-9.142857143","4":"-1.488372093","5":"-10.63122924","6":"0"},{"1":"x1","2":"2.273989564","3":"-1.488372093","4":"-9.142857143","5":"-10.63122924","6":"0"},{"1":"x1","2":"-1.496898212","3":"-10.000000000","4":"-0.526315789","5":"-10.52631579","6":"0"},{"1":"x1","2":"-0.280059514","3":"-8.526315789","4":"-2.000000000","5":"-10.52631579","6":"0"},{"1":"x1","2":"1.884304426","3":"-2.000000000","4":"-8.526315789","5":"-10.52631579","6":"0"},{"1":"x2","2":"-1.089027029","3":"-10.000000000","4":"-0.526315789","5":"-10.52631579","6":"0"},{"1":"x1","2":"0.263437909","3":"-6.722222222","4":"-3.781250000","5":"-10.50347222","6":"0"},{"1":"x1","2":"-0.036633607","3":"-7.692307692","4":"-2.702702703","5":"-10.39501040","6":"0"},{"1":"x1","2":"1.521612332","3":"-2.702702703","4":"-7.692307692","5":"-10.39501040","6":"0"},{"1":"x1","2":"-0.007174166","3":"-7.407407407","4":"-2.739726027","5":"-10.14713343","6":"0"},{"1":"x1","2":"1.514560822","3":"-2.739726027","4":"-7.407407407","5":"-10.14713343","6":"0"},{"1":"x1","2":"1.783006599","3":"-2.025000000","4":"-8.100000000","5":"-10.12500000","6":"0"},{"1":"x1","2":"0.163314997","3":"-6.784615385","4":"-3.266666667","5":"-10.05128205","6":"0"},{"1":"x1","2":"-0.407601693","3":"-8.533333333","4":"-1.505882353","5":"-10.03921569","6":"0"},{"1":"x1","2":"2.212630657","3":"-1.505882353","4":"-8.533333333","5":"-10.03921569","6":"0"},{"1":"x1","2":"-0.698439785","3":"-8.909090909","4":"-1.101123596","5":"-10.01021450","6":"0"},{"1":"x2","2":"2.224876422","3":"-0.782608696","4":"-9.000000000","5":"-9.78260870","6":"0"},{"1":"x1","2":"1.733711767","3":"-2.050632911","4":"-7.714285714","5":"-9.76491863","6":"0"},{"1":"x1","2":"-0.073026734","3":"-7.367346939","4":"-2.390728477","5":"-9.75807542","6":"0"},{"1":"x1","2":"1.584150665","3":"-2.390728477","4":"-7.367346939","5":"-9.75807542","6":"0"},{"1":"x1","2":"-0.528861076","3":"-8.333333333","4":"-1.300578035","5":"-9.63391137","6":"0"},{"1":"x1","2":"2.287653678","3":"-1.300578035","4":"-8.333333333","5":"-9.63391137","6":"0"},{"1":"x1","2":"0.259157162","3":"-6.211267606","4":"-3.418604651","5":"-9.62987226","6":"0"},{"1":"x1","2":"1.911441246","3":"-1.773006135","4":"-7.810810811","5":"-9.58381695","6":"0"},{"1":"x1","2":"0.289113645","3":"-6.041095890","4":"-3.472440945","5":"-9.51353684","6":"0"},{"1":"x1","2":"-1.653015830","3":"-9.000000000","4":"-0.424083770","5":"-9.42408377","6":"0"},{"1":"x2","2":"-1.104715468","3":"-9.000000000","4":"-0.424083770","5":"-9.42408377","6":"0"},{"1":"x1","2":"-0.628745662","3":"-8.166666667","4":"-1.113636364","5":"-9.28030303","6":"0"},{"1":"x1","2":"-0.019714816","3":"-6.811320755","4":"-2.455782313","5":"-9.26710307","6":"0"},{"1":"x1","2":"1.843862464","3":"-1.795031056","4":"-7.410256410","5":"-9.20528747","6":"0"},{"1":"x1","2":"-0.422045625","3":"-7.758620690","4":"-1.315789474","5":"-9.07441016","6":"0"},{"1":"x1","2":"1.498537697","3":"-2.489655172","4":"-6.563636364","5":"-9.05329154","6":"0"},{"1":"x1","2":"0.198736327","3":"-6.060606061","4":"-2.985074627","5":"-9.04568069","6":"0"},{"1":"x1","2":"0.227092261","3":"-5.882352941","4":"-3.030303030","5":"-8.91265597","6":"0"},{"1":"x1","2":"0.257815490","3":"-5.714285714","4":"-3.076923077","5":"-8.79120879","6":"0"},{"1":"x2","2":"2.248765708","3":"-0.654054054","4":"-8.066666667","5":"-8.72072072","6":"0"},{"1":"x1","2":"-0.576393093","3":"-7.538461538","4":"-1.126436782","5":"-8.66489832","6":"0"},{"1":"x1","2":"2.316403943","3":"-1.126436782","4":"-7.538461538","5":"-8.66489832","6":"0"},{"1":"x1","2":"0.315386592","3":"-5.405405405","4":"-3.174603175","5":"-8.58000858","6":"0"},{"1":"x1","2":"-1.786606349","3":"-8.000000000","4":"-0.333333333","5":"-8.33333333","6":"0"},{"1":"x2","2":"-1.137641979","3":"-8.000000000","4":"-0.333333333","5":"-8.33333333","6":"0"},{"1":"x1","2":"-0.675020608","3":"-7.347826087","4":"-0.954802260","5":"-8.30262835","6":"0"},{"1":"x1","2":"0.205323125","3":"-5.388059701","4":"-2.714285714","5":"-8.10234542","6":"0"},{"1":"x1","2":"1.486126253","3":"-2.250000000","4":"-5.785714286","5":"-8.03571429","6":"0"},{"1":"x1","2":"0.252739311","3":"-5.231884058","4":"-2.755725191","5":"-7.98760925","6":"0"},{"1":"x1","2":"1.454775900","3":"-2.281690141","4":"-5.586206897","5":"-7.86789704","6":"0"},{"1":"x1","2":"-0.585701264","3":"-6.760000000","4":"-0.965714286","5":"-7.72571429","6":"0"},{"1":"x1","2":"2.343248052","3":"-0.965714286","4":"-6.760000000","5":"-7.72571429","6":"0"},{"1":"x1","2":"0.321597379","3":"-4.813333333","4":"-2.888000000","5":"-7.70133333","6":"0"},{"1":"x2","2":"2.268426277","3":"-0.537634409","4":"-7.142857143","5":"-7.68049155","6":"0"},{"1":"x1","2":"-1.878533161","3":"-7.000000000","4":"-0.253886010","5":"-7.25388601","6":"0"},{"1":"x2","2":"-1.201689745","3":"-7.000000000","4":"-0.253886010","5":"-7.25388601","6":"0"},{"1":"x1","2":"1.476557023","3":"-2.020979021","4":"-5.070175439","5":"-7.09115446","6":"0"},{"1":"x1","2":"1.439360315","3":"-2.049645390","4":"-4.898305085","5":"-6.94795047","6":"0"},{"1":"x1","2":"0.324487798","3":"-4.263157895","4":"-2.612903226","5":"-6.87606112","6":"0"},{"1":"x1","2":"2.388334977","3":"-0.818181818","4":"-6.000000000","5":"-6.81818182","6":"0"},{"1":"x2","2":"2.287594811","3":"-0.433155080","4":"-6.230769231","5":"-6.66392431","6":"0"},{"1":"x1","2":"0.573081495","3":"-3.600000000","4":"-2.945454545","5":"-6.54545455","6":"0"},{"1":"x1","2":"-1.989175226","3":"-6.000000000","4":"-0.185567010","5":"-6.18556701","6":"0"},{"1":"x2","2":"-1.277999918","3":"-6.000000000","4":"-0.185567010","5":"-6.18556701","6":"0"},{"1":"x2","2":"2.506471896","3":"-0.185567010","4":"-6.000000000","5":"-6.18556701","6":"0"},{"1":"x1","2":"0.346361728","3":"-3.753246753","4":"-2.349593496","5":"-6.10284025","6":"0"},{"1":"x1","2":"1.434207044","3":"-1.828571429","4":"-4.266666667","5":"-6.09523810","6":"0"},{"1":"x1","2":"1.405444352","3":"-1.855072464","4":"-4.129032258","5":"-5.98410472","6":"0"},{"1":"x1","2":"2.457940694","3":"-0.683615819","4":"-5.260869565","5":"-5.94448538","6":"0"},{"1":"x1","2":"0.569344825","3":"-3.247191011","4":"-2.603603604","5":"-5.85079461","6":"0"},{"1":"x1","2":"0.617098440","3":"-3.175824176","4":"-2.651376147","5":"-5.82720032","6":"0"},{"1":"x2","2":"2.463904977","3":"-0.256544503","4":"-5.444444444","5":"-5.70098895","6":"0"},{"1":"x2","2":"2.357760543","3":"-0.340425532","4":"-5.333333333","5":"-5.67375887","6":"0"},{"1":"x1","2":"0.396215077","3":"-3.282051282","4":"-2.098360656","5":"-5.38041194","6":"0"},{"1":"x1","2":"0.434042093","3":"-3.200000000","4":"-2.133333333","5":"-5.33333333","6":"0"},{"1":"x1","2":"1.425836516","3":"-1.618705036","4":"-3.688524590","5":"-5.30722963","6":"0"},{"1":"x1","2":"0.512273572","3":"-2.976744186","4":"-2.245614035","5":"-5.22235822","6":"0"},{"1":"x1","2":"1.388561623","3":"-1.642335766","4":"-3.571428571","5":"-5.21376434","6":"0"},{"1":"x1","2":"0.547757702","3":"-2.909090909","4":"-2.285714286","5":"-5.19480519","6":"0"},{"1":"x1","2":"0.673761909","3":"-2.782608696","4":"-2.370370370","5":"-5.15297907","6":"0"},{"1":"x1","2":"0.692827857","3":"-2.723404255","4":"-2.415094340","5":"-5.13849859","6":"0"},{"1":"x1","2":"-2.045444735","3":"-5.000000000","4":"-0.128205128","5":"-5.12820513","6":"0"},{"1":"x2","2":"-1.360311292","3":"-5.000000000","4":"-0.128205128","5":"-5.12820513","6":"0"},{"1":"x2","2":"2.591893200","3":"-0.128205128","4":"-5.000000000","5":"-5.12820513","6":"0"},{"1":"x1","2":"2.486374030","3":"-0.561797753","4":"-4.545454545","5":"-5.10725230","6":"0"},{"1":"x2","2":"2.427516130","3":"-0.259259259","4":"-4.454545455","5":"-4.71380471","6":"0"},{"1":"x1","2":"0.429529284","3":"-2.848101266","4":"-1.859504132","5":"-4.70760540","6":"0"},{"1":"x2","2":"2.475893727","3":"-0.187500000","4":"-4.500000000","5":"-4.68750000","6":"0"},{"1":"x1","2":"0.436021838","3":"-2.777777778","4":"-1.890756303","5":"-4.66853408","6":"0"},{"1":"x1","2":"0.463075284","3":"-2.710843373","4":"-1.923076923","5":"-4.63392030","6":"0"},{"1":"x1","2":"0.498432285","3":"-2.647058824","4":"-1.956521739","5":"-4.60358056","6":"0"},{"1":"x1","2":"0.522563585","3":"-2.586206897","4":"-1.991150442","5":"-4.57735734","6":"0"},{"1":"x1","2":"0.689918813","3":"-2.419354839","4":"-2.102803738","5":"-4.52215858","6":"0"},{"1":"x1","2":"0.700989298","3":"-2.368421053","4":"-2.142857143","5":"-4.51127820","6":"0"},{"1":"x1","2":"0.760376009","3":"-2.319587629","4":"-2.184466019","5":"-4.50405365","6":"0"},{"1":"x1","2":"1.368437577","3":"-1.441176471","4":"-3.062500000","5":"-4.50367647","6":"0"},{"1":"x1","2":"1.341555767","3":"-1.462686567","4":"-2.969696970","5":"-4.43238354","6":"0"},{"1":"x1","2":"2.490392372","3":"-0.452513966","4":"-3.857142857","5":"-4.30965682","6":"0"},{"1":"x1","2":"-2.121260103","3":"-4.000000000","4":"-0.081632653","5":"-4.08163265","6":"0"},{"1":"x2","2":"-1.420970791","3":"-4.000000000","4":"-0.081632653","5":"-4.08163265","6":"0"},{"1":"x2","2":"2.676542931","3":"-0.081632653","4":"-4.000000000","5":"-4.08163265","6":"0"},{"1":"x1","2":"0.446442078","3":"-2.390243902","4":"-1.661016949","5":"-4.05126085","6":"0"},{"1":"x1","2":"0.479777646","3":"-2.333333333","4":"-1.689655172","5":"-4.02298851","6":"0"},{"1":"x1","2":"0.730537928","3":"-2.041666667","4":"-1.884615385","5":"-3.92628205","6":"0"},{"1":"x1","2":"0.793324533","3":"-2.000000000","4":"-1.921568627","5":"-3.92156863","6":"0"},{"1":"x1","2":"0.883894829","3":"-1.921568627","4":"-2.000000000","5":"-3.92156863","6":"0"},{"1":"x1","2":"0.859702019","3":"-1.960000000","4":"-1.960000000","5":"-3.92000000","6":"0"},{"1":"x1","2":"1.349902069","3":"-1.251851852","4":"-2.600000000","5":"-3.85185185","6":"0"},{"1":"x1","2":"1.318176011","3":"-1.270676692","4":"-2.522388060","5":"-3.79306475","6":"0"},{"1":"x2","2":"2.443501766","3":"-0.189473684","4":"-3.600000000","5":"-3.78947368","6":"0"},{"1":"x2","2":"2.485775494","3":"-0.129533679","4":"-3.571428571","5":"-3.70096225","6":"0"},{"1":"x1","2":"1.274924562","3":"-1.330708661","4":"-2.315068493","5":"-3.64577715","6":"0"},{"1":"x1","2":"2.495410682","3":"-0.355555556","4":"-3.200000000","5":"-3.55555556","6":"0"},{"1":"x1","2":"0.901418015","3":"-1.640776699","4":"-1.742268041","5":"-3.38304474","6":"0"},{"1":"x1","2":"0.829563721","3":"-1.707070707","4":"-1.673267327","5":"-3.38033803","6":"0"},{"1":"x1","2":"0.879468726","3":"-1.673267327","4":"-1.707070707","5":"-3.38033803","6":"0"},{"1":"x1","2":"1.301571730","3":"-1.090909091","4":"-2.117647059","5":"-3.20855615","6":"0"},{"1":"x1","2":"1.292294579","3":"-1.107692308","4":"-2.057142857","5":"-3.16483516","6":"0"},{"1":"x1","2":"1.281219232","3":"-1.125000000","4":"-2.000000000","5":"-3.12500000","6":"0"},{"1":"x1","2":"1.269803255","3":"-1.142857143","4":"-1.945945946","5":"-3.08880309","6":"0"},{"1":"x1","2":"-2.236532118","3":"-3.000000000","4":"-0.045685279","5":"-3.04568528","6":"0"},{"1":"x2","2":"-1.518017451","3":"-3.000000000","4":"-0.045685279","5":"-3.04568528","6":"0"},{"1":"x2","2":"2.704467163","3":"-0.045685279","4":"-3.000000000","5":"-3.04568528","6":"0"},{"1":"x1","2":"0.916050111","3":"-1.384615385","4":"-1.500000000","5":"-2.88461538","6":"0"},{"1":"x1","2":"2.512967809","3":"-0.270718232","4":"-2.578947368","5":"-2.84966560","6":"0"},{"1":"x1","2":"1.299184868","3":"-0.923664122","4":"-1.753623188","5":"-2.67728731","6":"0"},{"1":"x1","2":"1.285150394","3":"-0.937984496","4":"-1.704225352","5":"-2.64220985","6":"0"},{"1":"x1","2":"1.256877675","3":"-0.968000000","4":"-1.613333333","5":"-2.58133333","6":"0"},{"1":"x1","2":"0.931503423","3":"-1.152380952","4":"-1.273684211","5":"-2.42606516","6":"0"},{"1":"x1","2":"2.538769561","3":"-0.197802198","4":"-2.000000000","5":"-2.19780220","6":"0"},{"1":"x1","2":"1.241604219","3":"-0.806451613","4":"-1.315789474","5":"-2.12224109","6":"0"},{"1":"x1","2":"1.138062757","3":"-0.833333333","4":"-1.250000000","5":"-2.08333333","6":"0"},{"1":"x1","2":"-2.390640189","3":"-2.000000000","4":"-0.020202020","5":"-2.02020202","6":"0"},{"1":"x2","2":"-1.621685596","3":"-2.000000000","4":"-0.020202020","5":"-2.02020202","6":"0"},{"1":"x2","2":"2.747784623","3":"-0.020202020","4":"-2.000000000","5":"-2.02020202","6":"0"},{"1":"x1","2":"0.948724479","3":"-0.943396226","4":"-1.063829787","5":"-2.00722601","6":"0"},{"1":"x1","2":"1.231412078","3":"-0.658536585","4":"-1.051948052","5":"-1.71048464","6":"0"},{"1":"x1","2":"1.180052603","3":"-0.669421488","4":"-1.025316456","5":"-1.69473794","6":"0"},{"1":"x1","2":"1.112689789","3":"-0.680672269","4":"-1.000000000","5":"-1.68067227","6":"0"},{"1":"x1","2":"1.082292268","3":"-0.692307692","4":"-0.975903614","5":"-1.66821131","6":"0"},{"1":"x1","2":"1.065107311","3":"-0.716814159","4":"-0.931034483","5":"-1.64784864","6":"0"},{"1":"x1","2":"1.050323185","3":"-0.729729730","4":"-0.910112360","5":"-1.63984209","6":"0"},{"1":"x1","2":"1.034580815","3":"-0.743119266","4":"-0.890109890","5":"-1.63322916","6":"0"},{"1":"x1","2":"0.952549289","3":"-0.757009346","4":"-0.870967742","5":"-1.62797709","6":"0"},{"1":"x1","2":"2.564144790","3":"-0.136612022","4":"-1.470588235","5":"-1.60720026","6":"0"},{"1":"x1","2":"1.217339330","3":"-0.524590164","4":"-0.820512821","5":"-1.34510298","6":"0"},{"1":"x1","2":"3.077549020","3":"-0.046632124","4":"-1.285714286","5":"-1.33234641","6":"0"},{"1":"x1","2":"1.091781037","3":"-0.542372881","4":"-0.780487805","5":"-1.32286069","6":"0"},{"1":"x1","2":"1.078357104","3":"-0.551724138","4":"-0.761904762","5":"-1.31362890","6":"0"},{"1":"x1","2":"1.071951001","3":"-0.561403509","4":"-0.744186047","5":"-1.30558956","6":"0"},{"1":"x1","2":"1.055768674","3":"-0.571428571","4":"-0.727272727","5":"-1.29870130","6":"0"},{"1":"x1","2":"1.044077464","3":"-0.581818182","4":"-0.711111111","5":"-1.29292929","6":"0"},{"1":"x1","2":"0.991148884","3":"-0.592592593","4":"-0.695652174","5":"-1.28824477","6":"0"},{"1":"x1","2":"2.600710697","3":"-0.086956522","4":"-1.000000000","5":"-1.08695652","6":"0"},{"1":"x1","2":"-2.499118647","3":"-1.000000000","4":"-0.005025126","5":"-1.00502513","6":"0"},{"1":"x1","2":"3.904304615","3":"-0.005025126","4":"-1.000000000","5":"-1.00502513","6":"0"},{"1":"x2","2":"-1.821435912","3":"-1.000000000","4":"-0.005025126","5":"-1.00502513","6":"0"},{"1":"x2","2":"2.815498719","3":"-0.005025126","4":"-1.000000000","5":"-1.00502513","6":"0"},{"1":"x1","2":"1.074496460","3":"-0.426086957","4":"-0.576470588","5":"-1.00255754","6":"0"},{"1":"x1","2":"3.335049005","3":"-0.020618557","4":"-0.666666667","5":"-0.68728522","6":"0"},{"1":"x1","2":"2.659257385","3":"-0.048648649","4":"-0.600000000","5":"-0.64864865","6":"0"},{"1":"x1","2":"2.958995108","3":"-0.020833333","4":"-0.500000000","5":"-0.52083333","6":"0"},{"1":"x1","2":"3.586093826","3":"-0.005076142","4":"-0.333333333","5":"-0.33840948","6":"0"},{"1":"x1","2":"2.702350180","3":"-0.021505376","4":"-0.285714286","5":"-0.30721966","6":"0"},{"1":"x1","2":"3.516195330","3":"-0.005128205","4":"-0.200000000","5":"-0.20512821","6":"0"},{"1":"x1","2":"2.910944533","3":"-0.005235602","4":"-0.111111111","5":"-0.11634671","6":"0"},{"1":"x1","2":"2.850492818","3":"-0.005291005","4":"-0.090909091","5":"-0.09620010","6":"0"},{"1":"x1","2":"2.726427990","3":"-0.005347594","4":"-0.076923077","5":"-0.08227067","6":"0"},{"1":"x1","2":"2.777565515","3":"0.000000000","4":"0.000000000","5":"0.00000000","6":"0"},{"1":"x1","2":"2.889986184","3":"0.000000000","4":"0.000000000","5":"0.00000000","6":"0"},{"1":"x1","2":"3.544938591","3":"0.000000000","4":"0.000000000","5":"0.00000000","6":"0"},{"1":"x1","2":"3.624718846","3":"0.000000000","4":"0.000000000","5":"0.00000000","6":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We plot for variables <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> the <code>xgboost</code> gain for each possible split of data:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test , <span class="fu">aes</span>(<span class="at">x=</span>split_rule, <span class="at">y =</span>imp_total, <span class="at">col =</span> feature_split)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then we initialize the root/parent node for the mixture data set in the context of Gradient/Newton boosting</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>tbl_node <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y)),</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob =</span> <span class="fl">0.5</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad =</span> <span class="sc">-</span>(r <span class="sc">-</span> prob),</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">hessian =</span> prob <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> prob),</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda =</span> <span class="fl">0.0</span>,</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">gamma =</span> <span class="fl">0.0</span>)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>node <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_node,</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>             <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">"impurity"</span> <span class="ot">=</span> <span class="fl">0.5</span>,</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>             <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>             <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>             <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>             <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>             <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>             <span class="st">"value"</span> <span class="ot">=</span> <span class="dv">666</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We define a <code>break_at_boost</code> function implementing the Robust Logitboost / <code>xgboost</code> best split for a given node and returning the splitting rule (variable to split, split value):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>break_at_boost <span class="ot">&lt;-</span> <span class="cf">function</span>(node, min_leaf, midpoint, is_root){</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>    tbl_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]]</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>    y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]]</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>    x_names <span class="ot">&lt;-</span> node[[<span class="st">"features"</span>]]</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>    break_node <span class="ot">&lt;-</span> <span class="fu">max_gain</span>(tbl_node, y_name, x_names, min_leaf, midpoint)</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    break_node <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> </span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(feature_split<span class="sc">!=</span><span class="st">"zzz"</span>,</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>               imp_total <span class="sc">!=</span> <span class="dv">666</span>) <span class="sc">%&gt;%</span>  <span class="co">#,</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>               <span class="co">#imp_node != 0) %&gt;% # don't split when node is pure (ie 0 impurity)</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">which.min</span>(imp_total))</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(break_node)</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The function below <code>conditional_split_boost</code> looks at a provided children node (left or right) to check if it is terminal given a stopping rule (either the max tree depth is attained, or there is a single element in the node). If not the tree continues to grow (ie the recursion continues and the recursive function <code>grow_decision_tree_boost</code> defined below is called). It also computes metrics (number of observations per class, probabilities of classes 0-1, vote …) to fill the given node with useful information:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>conditional_split_boost <span class="ot">&lt;-</span> <span class="cf">function</span>(node, depth, max_depth, min_leaf, midpoint)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(node[[<span class="st">"data"</span>]]) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> depth <span class="sc">==</span> max_depth) {</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"is_leaf"</span>]] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set final value for node</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>      val <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarize</span>(<span class="at">val =</span>  <span class="sc">-</span> <span class="fu">sum</span>(grad) <span class="sc">/</span> (<span class="fu">sum</span>(hessian) <span class="sc">+</span> <span class="fu">mean</span>(lambda))) <span class="sc">%&gt;%</span> </span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pull</span>(val)</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"value"</span>]] <span class="ot">&lt;-</span> val</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(node)</span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">grow_decision_tree_boost</span>(node, depth <span class="sc">+</span> <span class="dv">1</span>, max_depth, min_leaf, midpoint)</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>}    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally the function <code>grow_decision_tree_boost</code> implements the recursion, breaking the current node into left and right children nodes and conditionally to the stopping rule splitting each child node:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>grow_decision_tree_boost <span class="ot">&lt;-</span> <span class="cf">function</span>(node, <span class="at">depth =</span> <span class="dv">1</span>, <span class="at">max_depth =</span> <span class="dv">2</span>, <span class="at">min_leaf =</span> <span class="dv">5</span>, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># before split</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  tbl_node <span class="ot">&lt;-</span> node[[<span class="st">"data"</span>]]  </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  x_names  <span class="ot">&lt;-</span> node[[<span class="st">"features"</span>]]  </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  y_name <span class="ot">&lt;-</span> node[[<span class="st">"target"</span>]]  </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># split using break node function</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  break_node <span class="ot">&lt;-</span> <span class="fu">break_at_boost</span>(node, min_leaf, midpoint)</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(break_node) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>      node[[<span class="st">"is_leaf"</span>]] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(node)}</span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  x_name_node <span class="ot">&lt;-</span> <span class="fu">as.name</span>(break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(feature_split))</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  split_value_node <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(split_rule)</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"impurity"</span>]] <span class="ot">&lt;-</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(imp_node)</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"split"</span>]] <span class="ot">&lt;-</span> split_value_node</span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"feature_split"</span>]] <span class="ot">&lt;-</span> x_name_node</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recursion, calling conditional split for left/right children</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  tbl_left <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name_node <span class="sc">&lt;</span> <span class="sc">!!</span>split_value_node)  </span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>  node_left <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_left,</span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"impurity"</span> <span class="ot">=</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(imp_left),</span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>)</span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>  node_left <span class="ot">&lt;-</span> <span class="fu">conditional_split_boost</span>(node_left, depth, max_depth, min_leaf, midpoint)</span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>  tbl_right <span class="ot">&lt;-</span> tbl_node <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span>x_name_node <span class="sc">&gt;=</span> <span class="sc">!!</span>split_value_node)  </span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a>  node_right <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_right,</span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"impurity"</span> <span class="ot">=</span> break_node <span class="sc">%&gt;%</span> <span class="fu">pull</span>(imp_right),</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>)</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>  node_right <span class="ot">&lt;-</span> <span class="fu">conditional_split_boost</span>(node_right, depth, max_depth, min_leaf, midpoint)</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"left"</span>]] <span class="ot">&lt;-</span> node_left</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>  node[[<span class="st">"right"</span>]] <span class="ot">&lt;-</span> node_right</span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(node)</span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We also define a recursive function to print the decision tree (a plot would be better):</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive function to print tree</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>print_regression_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(grown_tree, <span class="at">shift =</span><span class="st">''</span>, <span class="at">precision =</span> <span class="dv">3</span>){</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Node</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (grown_tree<span class="sc">$</span>is_leaf <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>        impurity <span class="ot">&lt;-</span> <span class="fu">round</span>(grown_tree<span class="sc">$</span>impurity,<span class="dv">3</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grown_tree<span class="sc">$</span>data)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>        val <span class="ot">&lt;-</span> <span class="fu">round</span>(grown_tree<span class="sc">$</span>value,<span class="dv">3</span>)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'observations: {n}, gain: {impurity}, value: {val}'</span>))</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Else recurse</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First print the splitting variable and rule</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(shift <span class="sc">==</span> <span class="st">''</span>){</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">'Root'</span> , <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>        split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>split</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>        feature_split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>feature_split</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(glue::glue('Node {feature_split} &lt; {split} Y/N?'))</span></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &lt; {round(split, precision)}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_regression_tree</span>(grown_tree<span class="sc">$</span>left, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &gt;= {round(split, precision)}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_regression_tree</span>(grown_tree<span class="sc">$</span>right, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then test the recursive algorithm on the mixture data set (using stumps, ie <code>max_depth</code> = 1):</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>mixture_node_boost <span class="ot">&lt;-</span> <span class="fu">grow_decision_tree_boost</span>(node, <span class="at">max_depth =</span> <span class="dv">1</span>, <span class="at">min_leaf =</span> <span class="dv">1</span>, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_regression_tree</span>(mixture_node_boost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Root 
   |&gt; x2 &lt; 0.144 
     observations: 52, gain: -37.231, value: -1.692 
   |&gt; x2 &gt;= 0.144 
     observations: 148, gain: -13.081, value: 0.595 </code></pre>
</div>
</div>
<p>Our toy implementation of Robust Logitboost agrees with <code>xgboost</code> in terms of base/weak learners fitted:</p>
<p>Comparing with <code>xgboost</code> for depth 1 weak learners:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>xgb_depth2 <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1, x2)),</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y),</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">max.depth =</span> <span class="dv">1</span>,</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">eta =</span> <span class="dv">1</span>,</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">nthread =</span> <span class="dv">1</span>,</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">nrounds =</span> <span class="dv">1</span>,</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_child_weight =</span> <span class="dv">0</span>, </span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">tree_method =</span> <span class="st">"exact"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-logloss:0.557536 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>xgb_trees_depth2 <span class="ot">&lt;-</span> <span class="fu">xgb.dump</span>(xgb_depth2, <span class="at">with_stats =</span> <span class="cn">TRUE</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>xgb_trees_depth2[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "booster[0]"                                                      
[2] "0:[f1&lt;0.144127041] yes=1,no=2,missing=1,gain=50.3118515,cover=50"
[3] "1:leaf=-1.69230771,cover=13"                                     
[4] "2:leaf=0.594594598,cover=37"                                     </code></pre>
</div>
</div>
<p>Comparing with <code>xgboost</code> for depth 2 weak learners:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>mixture_node_boost <span class="ot">&lt;-</span> <span class="fu">grow_decision_tree_boost</span>(node, <span class="at">max_depth =</span> <span class="dv">2</span>, <span class="at">min_leaf =</span> <span class="dv">1</span>, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print_regression_tree</span>(mixture_node_boost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Root 
   |&gt; x2 &lt; 0.144 
     |&gt; x1 &lt; 2.815 
       observations: 51, gain: -39.706, value: -1.765 
     |&gt; x1 &gt;= 2.815 
       observations: 1, gain: -1, value: 2 
 
   |&gt; x2 &gt;= 0.144 
     |&gt; x1 &lt; 2.246 
       observations: 128, gain: -22.781, value: 0.844 
     |&gt; x1 &gt;= 2.246 
       observations: 20, gain: -5, value: -1 
 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>xgb_depth2 <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> <span class="fu">as.matrix</span>(data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1, x2)),</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">if_else</span>(Y<span class="sc">==</span><span class="st">"0"</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y),</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">max.depth =</span> <span class="dv">2</span>,</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">eta =</span> <span class="dv">1</span>,</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">nthread =</span> <span class="dv">1</span>,</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">nrounds =</span> <span class="dv">1</span>,</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_child_weight =</span> <span class="dv">0</span>, </span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda =</span> <span class="dv">0</span>,</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">tree_method =</span> <span class="st">"exact"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-logloss:0.508785 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>xgb_trees_depth2 <span class="ot">&lt;-</span> <span class="fu">xgb.dump</span>(xgb_depth2, <span class="at">with_stats =</span> <span class="cn">TRUE</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(xgb_trees_depth2[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["xgb_trees_depth2[1:8]"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"booster[0]"},{"1":"0:[f1<0.144127041] yes=1,no=2,missing=1,gain=50.3118515,cover=50"},{"1":"1:[f0<2.81501961] yes=3,no=4,missing=3,gain=3.47511292,cover=13"},{"1":"3:leaf=-1.7647059,cover=12.75"},{"1":"4:leaf=2,cover=0.25"},{"1":"2:[f0<2.24571514] yes=5,no=6,missing=5,gain=14.7001686,cover=37"},{"1":"5:leaf=0.84375,cover=32"},{"1":"6:leaf=-1,cover=5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive function to print tree</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>build_regression_tree_rule <span class="ot">&lt;-</span> <span class="cf">function</span>(grown_tree, list_rules){</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Node</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (grown_tree<span class="sc">$</span>is_leaf <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">list_rules.append</span>()</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>        impurity <span class="ot">&lt;-</span> <span class="fu">round</span>(grown_tree<span class="sc">$</span>impurity,<span class="dv">3</span>)</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(grown_tree<span class="sc">$</span>data)</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>        val <span class="ot">&lt;-</span> <span class="fu">round</span>(grown_tree<span class="sc">$</span>value,<span class="dv">3</span>)</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'observations: {n}, gain: {impurity}, value: {val}'</span>))</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Else recurse</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First print the splitting variable and rule</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(shift <span class="sc">==</span> <span class="st">''</span>){</span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">'Root'</span> , <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb148-17"><a href="#cb148-17" aria-hidden="true" tabindex="-1"></a>        split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>split</span>
<span id="cb148-18"><a href="#cb148-18" aria-hidden="true" tabindex="-1"></a>        feature_split <span class="ot">&lt;-</span> grown_tree<span class="sc">$</span>feature_split</span>
<span id="cb148-19"><a href="#cb148-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb148-20"><a href="#cb148-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(glue::glue('Node {feature_split} &lt; {split} Y/N?'))</span></span>
<span id="cb148-21"><a href="#cb148-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &lt; {round(split, precision)}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb148-22"><a href="#cb148-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_regression_tree</span>(grown_tree<span class="sc">$</span>left, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)),<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb148-23"><a href="#cb148-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb148-24"><a href="#cb148-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">paste0</span>(shift, <span class="st">'  '</span>), glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">'|&gt; {feature_split} &gt;= {round(split, precision)}'</span>), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb148-25"><a href="#cb148-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="fu">print_regression_tree</span>(grown_tree<span class="sc">$</span>right, <span class="fu">paste0</span>(shift, <span class="st">'  '</span>)), <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb148-26"><a href="#cb148-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-27"><a href="#cb148-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We define here a function to extract decision rules at each split, it is the first brick to obtain prediction on new data with the fitted tree:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive function to find root-to-leaf rules and return as a list of strings</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>get_decision_tree_rule <span class="ot">&lt;-</span> <span class="cf">function</span>(node, <span class="at">curr_rule =</span> <span class="fu">list</span>()){</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># current node is NULL return an empty list</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(node)) {</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>())</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># current node is a leaf return the total rule</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (node<span class="sc">$</span>is_leaf) {</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>    condition <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue_collapse</span>(curr_rule, <span class="at">sep =</span> <span class="st">" &amp; "</span>)</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>    value <span class="ot">&lt;-</span> node<span class="sc">$</span>value</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>    rule_str <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{condition} ~ {value}"</span>)</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(rule_str))</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add current node rule to the path and collect rules from both left and right children</span></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>  feature_split <span class="ot">&lt;-</span> node<span class="sc">$</span>feature_split</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>  split <span class="ot">&lt;-</span> node<span class="sc">$</span>split</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>  left_rules <span class="ot">&lt;-</span> <span class="fu">get_decision_tree_rule</span>(node<span class="sc">$</span>left,</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(curr_rule, glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{feature_split} &lt; {split}"</span>)))  </span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>  right_rules <span class="ot">&lt;-</span> <span class="fu">get_decision_tree_rule</span>(node<span class="sc">$</span>right,</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">c</span>(curr_rule, glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"{feature_split} &gt;= {split}"</span>))) </span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(left_rules, right_rules))</span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a>(conds <span class="ot">&lt;-</span> <span class="fu">get_decision_tree_rule</span>(mixture_node_boost))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
x2 &lt; 0.144127050260164 &amp; x1 &lt; 2.81501972474947 ~ -1.76470588235294

[[2]]
x2 &lt; 0.144127050260164 &amp; x1 &gt;= 2.81501972474947 ~ 2

[[3]]
x2 &gt;= 0.144127050260164 &amp; x1 &lt; 2.2457152633087 ~ 0.84375

[[4]]
x2 &gt;= 0.144127050260164 &amp; x1 &gt;= 2.2457152633087 ~ -1</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>predict_decision_tree_boost <span class="ot">&lt;-</span> <span class="cf">function</span>(node, <span class="at">curr_rule =</span> <span class="fu">list</span>()){</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="co"># inspiring from https://forum.posit.co/t/case-when-pattern-dynamically-generated/96790</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>caseArgs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cond =</span> conds) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(cond) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cond=</span>rlang<span class="sc">::</span><span class="fu">parse_exprs</span>(cond))</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>data_train <span class="sc">%&gt;%</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">predict =</span> <span class="fu">case_when</span>(<span class="sc">!!!</span>caseArgs<span class="sc">$</span>cond)</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally implementing Ping Li’s Robust Logitboost (ie <code>xgboost</code> without penalization and without many numerical optimizations) by succesively fitting weak learners using specific criterion/gain to split:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>fit_robust_logitboost <span class="ot">&lt;-</span> <span class="cf">function</span>(data_train, M, <span class="at">min_leaf=</span><span class="dv">1</span>, <span class="at">max_depth =</span> <span class="dv">1</span>, <span class="at">lambda=</span><span class="dv">0</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>){</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expect data with Y column in {0, 1}, with only additional predictors (as we will use formula Y ~ .)</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># should test unique(data %&gt;% pull(Y)) == c(0, 1) and classs(data %&gt;% pull(Y)) is numeric</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract Y</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data_train <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y)</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Length of training data</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span>  <span class="fu">nrow</span>(data_train)</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>  weak_learner <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Initialization of additive function f and probability p</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)             </span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, n)</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Boosting Iterations</span></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initializing the tree to be fitted</span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a>    tbl_node <span class="ot">&lt;-</span> data_mixture_example <span class="sc">%&gt;%</span></span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">r =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y)),</span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">prob =</span> prob,</span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">grad =</span> <span class="sc">-</span>(r <span class="sc">-</span> prob),</span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a>             <span class="co"># Enforce a lower threshold on the Hessian: w = max(w, 2 × machine-zero)</span></span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a>             <span class="co"># flooring with 2 times machine precision as suggested FHT00 p353 for Logitboost</span></span>
<span id="cb152-27"><a href="#cb152-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">hessian =</span> <span class="fu">pmax</span>(prob <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> prob), .Machine<span class="sc">$</span>double.eps <span class="sc">*</span> <span class="dv">2</span>), </span>
<span id="cb152-28"><a href="#cb152-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">lambda =</span> <span class="fl">0.0</span>,</span>
<span id="cb152-29"><a href="#cb152-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">gamma =</span> <span class="fl">0.0</span>)</span>
<span id="cb152-30"><a href="#cb152-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb152-31"><a href="#cb152-31" aria-hidden="true" tabindex="-1"></a>    y_name <span class="ot">&lt;-</span> <span class="fu">as.name</span>(<span class="st">"Y"</span>)</span>
<span id="cb152-32"><a href="#cb152-32" aria-hidden="true" tabindex="-1"></a>    x_names <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">as.name</span>(<span class="st">"x1"</span>), <span class="fu">as.name</span>(<span class="st">"x2"</span>))</span>
<span id="cb152-33"><a href="#cb152-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb152-34"><a href="#cb152-34" aria-hidden="true" tabindex="-1"></a>    node <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"data"</span> <span class="ot">=</span> tbl_node,</span>
<span id="cb152-35"><a href="#cb152-35" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"left"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb152-36"><a href="#cb152-36" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"right"</span> <span class="ot">=</span> <span class="fu">list</span>(),</span>
<span id="cb152-37"><a href="#cb152-37" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"impurity"</span> <span class="ot">=</span> <span class="fl">0.5</span>,</span>
<span id="cb152-38"><a href="#cb152-38" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"target"</span> <span class="ot">=</span> y_name,</span>
<span id="cb152-39"><a href="#cb152-39" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"features"</span> <span class="ot">=</span> x_names,</span>
<span id="cb152-40"><a href="#cb152-40" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"split"</span> <span class="ot">=</span> <span class="dv">666</span>,</span>
<span id="cb152-41"><a href="#cb152-41" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"feature_split"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb152-42"><a href="#cb152-42" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"is_leaf"</span> <span class="ot">=</span> <span class="cn">FALSE</span>,</span>
<span id="cb152-43"><a href="#cb152-43" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"value"</span> <span class="ot">=</span> <span class="dv">666</span>)</span>
<span id="cb152-44"><a href="#cb152-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-45"><a href="#cb152-45" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fit the function f^m(x) by a specialized tree using Ping Li's / xgboost like gain formula</span></span>
<span id="cb152-46"><a href="#cb152-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-47"><a href="#cb152-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  Fitting the tree</span></span>
<span id="cb152-48"><a href="#cb152-48" aria-hidden="true" tabindex="-1"></a>    mixture_node_boost <span class="ot">&lt;-</span> <span class="fu">grow_decision_tree_boost</span>(node, <span class="at">max_depth =</span> max_depth, <span class="at">min_leaf =</span> min_leaf, <span class="at">midpoint =</span> <span class="cn">TRUE</span>)</span>
<span id="cb152-49"><a href="#cb152-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-50"><a href="#cb152-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extracting the rule to predict on new data</span></span>
<span id="cb152-51"><a href="#cb152-51" aria-hidden="true" tabindex="-1"></a>    conds <span class="ot">&lt;-</span> <span class="fu">get_decision_tree_rule</span>(mixture_node_boost)</span>
<span id="cb152-52"><a href="#cb152-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-53"><a href="#cb152-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store rule for predict on new data</span></span>
<span id="cb152-54"><a href="#cb152-54" aria-hidden="true" tabindex="-1"></a>    weak_learner[[m]] <span class="ot">&lt;-</span> conds</span>
<span id="cb152-55"><a href="#cb152-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-56"><a href="#cb152-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict f_m using specialized tree a la Ping Li</span></span>
<span id="cb152-57"><a href="#cb152-57" aria-hidden="true" tabindex="-1"></a>    caseArgs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cond =</span> conds) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(cond) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cond=</span>rlang<span class="sc">::</span><span class="fu">parse_exprs</span>(cond))</span>
<span id="cb152-58"><a href="#cb152-58" aria-hidden="true" tabindex="-1"></a>    f_m <span class="ot">&lt;-</span> data_train <span class="sc">%&gt;%</span></span>
<span id="cb152-59"><a href="#cb152-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">predict =</span> <span class="fu">case_when</span>(<span class="sc">!!!</span>caseArgs<span class="sc">$</span>cond)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(predict)</span>
<span id="cb152-60"><a href="#cb152-60" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb152-61"><a href="#cb152-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Updating Newton Boosted Stumps (ie Forward Stagewise Additive Model) and probabilities</span></span>
<span id="cb152-62"><a href="#cb152-62" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> f <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> f_m</span>
<span id="cb152-63"><a href="#cb152-63" aria-hidden="true" tabindex="-1"></a>    prob <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> f))</span>
<span id="cb152-64"><a href="#cb152-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-65"><a href="#cb152-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-66"><a href="#cb152-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Output list of weak learners (here stumps) for the predict function</span></span>
<span id="cb152-67"><a href="#cb152-67" aria-hidden="true" tabindex="-1"></a><span class="fu">return</span>(<span class="fu">list</span>(<span class="at">weak_learners=</span>weak_learner, <span class="at">probs=</span>prob))</span>
<span id="cb152-68"><a href="#cb152-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-69"><a href="#cb152-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb152-70"><a href="#cb152-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-71"><a href="#cb152-71" aria-hidden="true" tabindex="-1"></a>robust_logitboost_mixture <span class="ot">&lt;-</span> <span class="fu">fit_robust_logitboost</span>(data_train, <span class="dv">6</span>, <span class="at">min_leaf=</span><span class="dv">1</span>, <span class="at">max_depth =</span> <span class="dv">1</span>, <span class="at">lambda=</span><span class="dv">0</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb152-72"><a href="#cb152-72" aria-hidden="true" tabindex="-1"></a>check_vs <span class="ot">&lt;-</span> <span class="fu">fit_original_logitboost</span>(data_train, <span class="dv">6</span>, <span class="cn">FALSE</span>)</span>
<span id="cb152-73"><a href="#cb152-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-74"><a href="#cb152-74" aria-hidden="true" tabindex="-1"></a>predict_robust_logitboost <span class="ot">&lt;-</span> <span class="cf">function</span>(fitted_logitboost, new_data, <span class="at">num_tree =</span> <span class="sc">-</span><span class="dv">1</span>){</span>
<span id="cb152-75"><a href="#cb152-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-76"><a href="#cb152-76" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">length</span>(fitted_logitboost<span class="sc">$</span>weak_learners)</span>
<span id="cb152-77"><a href="#cb152-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_tree <span class="sc">&gt;=</span><span class="dv">1</span> <span class="sc">&amp;</span> num_tree <span class="sc">&lt;</span> M){</span>
<span id="cb152-78"><a href="#cb152-78" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> num_tree</span>
<span id="cb152-79"><a href="#cb152-79" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb152-80"><a href="#cb152-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-81"><a href="#cb152-81" aria-hidden="true" tabindex="-1"></a>  f <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb152-82"><a href="#cb152-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-83"><a href="#cb152-83" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Predicting on new data with Newton Boosted Stumps </span></span>
<span id="cb152-84"><a href="#cb152-84" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (ie f function as Forward Stagewise Additive Model of Tress (depth 1)) and probabilities</span></span>
<span id="cb152-85"><a href="#cb152-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M){</span>
<span id="cb152-86"><a href="#cb152-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-87"><a href="#cb152-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract rule for prediction</span></span>
<span id="cb152-88"><a href="#cb152-88" aria-hidden="true" tabindex="-1"></a>    conds <span class="ot">&lt;-</span> fitted_logitboost<span class="sc">$</span>weak_learners[[m]]</span>
<span id="cb152-89"><a href="#cb152-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-90"><a href="#cb152-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Predict f_m using specialized tree a la Ping Li</span></span>
<span id="cb152-91"><a href="#cb152-91" aria-hidden="true" tabindex="-1"></a>    caseArgs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cond =</span> conds) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(cond) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">cond=</span>rlang<span class="sc">::</span><span class="fu">parse_exprs</span>(cond))</span>
<span id="cb152-92"><a href="#cb152-92" aria-hidden="true" tabindex="-1"></a>    f_m <span class="ot">&lt;-</span> data_train <span class="sc">%&gt;%</span></span>
<span id="cb152-93"><a href="#cb152-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">predict =</span> <span class="fu">case_when</span>(<span class="sc">!!!</span>caseArgs<span class="sc">$</span>cond)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(predict)</span>
<span id="cb152-94"><a href="#cb152-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-95"><a href="#cb152-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Updating Newton Boosted Stumps (ie Forward Stagewise Additive Model) and probabilities</span></span>
<span id="cb152-96"><a href="#cb152-96" aria-hidden="true" tabindex="-1"></a>    f <span class="ot">&lt;-</span> f <span class="sc">+</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> f_m</span>
<span id="cb152-97"><a href="#cb152-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-98"><a href="#cb152-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-99"><a href="#cb152-99" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Get probability from Newton Boosted Stumps </span></span>
<span id="cb152-100"><a href="#cb152-100" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ( <span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> f))</span>
<span id="cb152-101"><a href="#cb152-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-102"><a href="#cb152-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb152-103"><a href="#cb152-103" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb152-104"><a href="#cb152-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-105"><a href="#cb152-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check: Compare predict(data_train) with original fit on data_train</span></span>
<span id="cb152-106"><a href="#cb152-106" aria-hidden="true" tabindex="-1"></a>p_test <span class="ot">&lt;-</span> <span class="fu">predict_original_logitboost</span>(logitboost_mixture, data_train, <span class="dv">6</span>)</span>
<span id="cb152-107"><a href="#cb152-107" aria-hidden="true" tabindex="-1"></a>p_test2 <span class="ot">&lt;-</span> <span class="fu">predict_robust_logitboost</span>(robust_logitboost_mixture, data_train, <span class="dv">6</span>)</span>
<span id="cb152-108"><a href="#cb152-108" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(p_test))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(p_test2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(p_test2)<span class="sc">==</span><span class="fu">sum</span>(robust_logitboost_mixture<span class="sc">$</span>probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare xgboost prediction (without penalties etc, and using stumps) </span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with logitboost original fit on data_train</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>pred_xgb <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_deg, <span class="fu">as.matrix</span>(data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1, x2)))</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(robust_logitboost_mixture<span class="sc">$</span>probs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sum</span>(pred_xgb))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100.8572</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">sum</span>(pred_xgb)<span class="sc">-</span><span class="fu">sum</span>(logitboost_mixture<span class="sc">$</span>probs))<span class="sc">&lt;</span><span class="fl">1e-6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="appendix" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="appendix"><span class="header-section-number">2.5</span> Appendix</h2>
<section id="cp-plots" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="cp-plots"><span class="header-section-number">2.5.1</span> Cp plots</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(mixture_example_CART)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = Y ~ ., data = data_mixture_example, method = "class", 
    control = rpart.control(cp = 1e-06, minsplit = 7, minbucket = 7, 
        maxdepth = 4))

Variables actually used in tree construction:
[1] x1 x2

Root node error: 100/200 = 0.5

n= 200 

       CP nsplit rel error xerror     xstd
1 4.4e-01      0      1.00   1.10 0.070356
2 1.0e-01      1      0.56   0.65 0.066238
3 7.5e-02      2      0.46   0.64 0.065970
4 3.0e-02      4      0.31   0.47 0.059962
5 1.0e-06      5      0.28   0.45 0.059055</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.01</span>,<span class="dv">0</span>), <span class="cf">function</span>(x){</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  X_rpart <span class="ot">=</span> <span class="fu">rpart</span>(</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>    Y <span class="sc">~</span> .,</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"class"</span>,</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_mixture_example,</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> x, <span class="at">minbucket =</span> <span class="dv">7</span>, <span class="at">maxdepth =</span> <span class="dv">4</span>)</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(l)) {</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(l[[i]])</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-97-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="checking-our-implementation-vs-r-packages-and-scikit-learn" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="checking-our-implementation-vs-r-packages-and-scikit-learn"><span class="header-section-number">2.5.2</span> Checking our implementation vs R packages and scikit-learn</h3>
<p>Check using package <code>ada</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ada)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>check_ada <span class="ot">&lt;-</span> ada<span class="sc">::</span><span class="fu">ada</span>(Y<span class="sc">~</span>., <span class="at">data =</span> data_ada, <span class="at">iter=</span><span class="dv">200</span>, <span class="at">bag.frac=</span><span class="dv">1</span>, <span class="at">type=</span><span class="st">"discrete"</span>, <span class="at">nu =</span> <span class="dv">1</span>,</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">control=</span><span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="sc">-</span><span class="dv">1</span> , <span class="at">maxdepth =</span> <span class="dv">1</span> , <span class="at">minsplit =</span> <span class="dv">0</span>))</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>pre <span class="ot">&lt;-</span> <span class="fu">predict</span>(check_ada, data_ada)</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>Y_target <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(data_ada <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y)))</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">tibble</span>(<span class="at">pred=</span>pre, <span class="at">target=</span>Y_target)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    target
pred -1  1
  -1 88  9
  1  12 91</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>grid_precision <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.85</span>, <span class="fl">4.5</span>, grid_precision), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.25</span>, <span class="fl">3.1</span>, grid_precision)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_ADA =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(<span class="fu">predict</span>(check_ada, grid))))) <span class="sc">%&gt;%</span> </span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_ADA =</span> <span class="fl">0.5</span> <span class="sc">*</span> (predict_ADA <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>(ada_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> grid_precision, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA),</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">-</span>grid_precision, <span class="at">col =</span> <span class="st">'black'</span>) <span class="sc">+</span> </span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour_filled</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.99999</span>,<span class="dv">2</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb169-19"><a href="#cb169-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb169-20"><a href="#cb169-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb169-21"><a href="#cb169-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill=</span><span class="cn">NA</span>, <span class="at">size=</span><span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>ada_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(<span class="fu">predict</span>(check_ada, new_mixture)))) <span class="sc">%&gt;%</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fl">0.5</span> <span class="sc">*</span> (class <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>(ada_risk <span class="ot">&lt;-</span> ada_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2626</code></pre>
</div>
</div>
<p>Check using package <code>JOUSBoost</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JOUSBoost)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>check_ada <span class="ot">&lt;-</span> JOUSBoost<span class="sc">::</span><span class="fu">adaboost</span>(<span class="fu">as.matrix</span>(data_ada <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1, x2)),</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>                                 data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y=</span><span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y),</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">tree_depth =</span> <span class="dv">1</span>,</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">n_rounds =</span> <span class="dv">200</span>)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>pre <span class="ot">&lt;-</span> <span class="fu">predict</span>(check_ada, data_ada)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>Y_target <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(data_ada <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y)))</span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">tibble</span>(<span class="at">pred=</span>pre, <span class="at">target=</span>Y_target)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    target
pred -1  1
  -1 88  9
  1  12 91</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.6</span>, <span class="fl">4.2</span>, .<span class="dv">05</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">2.0</span>, <span class="fl">2.9</span>, .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(grid, <span class="fu">tibble</span>(<span class="at">predict_ADA =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(<span class="fu">predict</span>(check_ada, grid))))) <span class="sc">%&gt;%</span> </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">mutate</span>(<span class="at">predict_ADA =</span> <span class="fl">0.5</span> <span class="sc">*</span> (predict_ADA <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>(ada_decision_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_ADA)),</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> <span class="fl">0.05</span>, <span class="at">col =</span> <span class="st">'purple'</span>) <span class="sc">+</span> </span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_ADA),</span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">breaks =</span> <span class="fl">0.05</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span> </span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">data =</span> data_ada <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(<span class="fl">0.5</span><span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.character</span>(Y))<span class="sc">+</span><span class="dv">1</span>))), <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_void</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>ada_error_rate <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(new_mixture,</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">class =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(<span class="fu">predict</span>(check_ada, new_mixture)))) <span class="sc">%&gt;%</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">class =</span> <span class="fl">0.5</span> <span class="sc">*</span> (class <span class="sc">+</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>class, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>(ada_risk <span class="ot">&lt;-</span> ada_error_rate  <span class="sc">%&gt;%</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(l01))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2626</code></pre>
</div>
</div>
<p>Check using <code>Python</code> package <code>scikit-learn</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>Y_sk <span class="ot">=</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(Y)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>X_sk <span class="ot">=</span> data_mixture_example <span class="sc">%&gt;%</span> <span class="fu">select</span>(x1,x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> r.X_sk.to_numpy()</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> r.Y_sk.values.ravel().astype(<span class="bu">int</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>Y[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>array([0, 0, 0, 0, 0])</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adapted from sciki-learn examples</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://scikit-learn.org/stable/auto_examples/ensemble/plot_adaboost_twoclass.html#sphx-glr-auto-examples-ensemble-plot-adaboost-twoclass-py</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> AdaBoostClassifier</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> DecisionBoundaryDisplay</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and fit an AdaBoosted decision tree</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a>bdt <span class="op">=</span> AdaBoostClassifier(</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a>    DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">1</span>), algorithm<span class="op">=</span><span class="st">"SAMME"</span>, n_estimators<span class="op">=</span>M</span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb180-16"><a href="#cb180-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-17"><a href="#cb180-17" aria-hidden="true" tabindex="-1"></a>bdt.fit(X, Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<style>#sk-container-id-3 {color: black;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>AdaBoostClassifier(algorithm='SAMME',
                   estimator=DecisionTreeClassifier(max_depth=1),
                   n_estimators=200)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">AdaBoostClassifier</label><div class="sk-toggleable__content"><pre>AdaBoostClassifier(algorithm='SAMME',
                   estimator=DecisionTreeClassifier(max_depth=1),
                   n_estimators=200)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox"><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: DecisionTreeClassifier</label><div class="sk-toggleable__content"><pre>DecisionTreeClassifier(max_depth=1)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox"><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">DecisionTreeClassifier</label><div class="sk-toggleable__content"><pre>DecisionTreeClassifier(max_depth=1)</pre></div></div></div></div></div></div></div></div></div></div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>plot_colors <span class="op">=</span> [<span class="st">"dodgerblue"</span>, <span class="st">"darkorange"</span>]</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>plot_step <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>class_names <span class="op">=</span> [<span class="st">"BLUE"</span>, <span class="st">"ORANGE"</span>]</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the decision boundaries</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.subplot(<span class="dv">111</span>)</span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> DecisionBoundaryDisplay.from_estimator(</span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>    bdt,</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>    X,</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>plt.cm.Paired,</span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>    response_method<span class="op">=</span><span class="st">"predict"</span>,</span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a>    xlabel<span class="op">=</span><span class="st">"x1"</span>,</span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a>    ylabel<span class="op">=</span><span class="st">"x2"</span>,</span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a>x_min, x_max <span class="op">=</span> disp.xx0.<span class="bu">min</span>(), disp.xx0.<span class="bu">max</span>()</span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>y_min, y_max <span class="op">=</span> disp.xx1.<span class="bu">min</span>(), disp.xx1.<span class="bu">max</span>()</span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">"tight"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(-3.5208196765959814, 5.170746207536664, -2.9998534020399017, 3.8558049669193197)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the training points</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, n, c <span class="kw">in</span> <span class="bu">zip</span>(<span class="bu">range</span>(<span class="dv">2</span>), class_names, plot_colors):</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.where(Y <span class="op">==</span> i)</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>        X[idx, <span class="dv">0</span>],</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>        X[idx, <span class="dv">1</span>],</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>c,</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">"k"</span>,</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f"</span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a>plt.xlim(x_min, x_max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(-3.5208196765959814, 5.170746207536664)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>plt.ylim(y_min, y_max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(-2.9998534020399017, 3.8558049669193197)</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Decision Boundary (</span><span class="sc">{</span>M<span class="sc">}</span><span class="ss"> estimators)"</span>)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="Classification-trees-and-ensemble-methods_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="gradient-boosting-machines" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="gradient-boosting-machines"><span class="header-section-number">2.6</span> Gradient Boosting (Machines)</h2>
<p>breaktrough</p>
<p>Showing importance of trees</p>
<p>Using learning rate eta &lt;1 improves testing error</p>
<p>plus introduction of Relative importance of input variables and PDP (Partial dependence plots)</p>
</section>
</section>
<section id="references" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bartlett2006" class="csl-entry" role="listitem">
Bartlett, Peter L., Michael I. Jordan, and Jon D. Mcauliffe. 2006. <span>“Convexity, Classification, and Risk Bounds.”</span> <em>Journal of the American Statistical Association</em> 101 (473): 138–56. https://doi.org/<a href="https://doi.org/10.1198/016214505000000907">https://doi.org/10.1198/016214505000000907</a>.
</div>
<div id="ref-Breiman83" class="csl-entry" role="listitem">
Breiman, L., J. H. Friedman, R. A. Olshen, and C. J and Stone. 1983. <em>Classification and Regression Trees</em>. Belmont, Ca: Wadsworth.
</div>
<div id="ref-xgboost2016" class="csl-entry" role="listitem">
Chen, Tianqi, and Carlos Guestrin. 2016. <span>“XGBoost: A Scalable Tree Boosting System,”</span> 785–94. <a href="https://doi.org/10.1145/2939672.2939785">https://doi.org/10.1145/2939672.2939785</a>.
</div>
<div id="ref-adaboost1996" class="csl-entry" role="listitem">
Freund, Y., and R. E. Schapire. 1996. <span>“Experiments with a New Boosting Algorithm,”</span> ICML’96, 148–56.
</div>
<div id="ref-fht2000" class="csl-entry" role="listitem">
Friedman, Hastie, J. 2000. <span>“Additive Logistic Regression: A Statistical View of Boosting (with Discussion and a Rejoinder by the Authors).”</span> <em>The Annals of Statistics</em> 28 (2): 337–407. <a href="https://doi.org/10.1214/aos/1016218223">https://doi.org/10.1214/aos/1016218223</a>.
</div>
<div id="ref-hastie2009" class="csl-entry" role="listitem">
Hastie, T., R. Tibshirani, and J. Friedman. 2009. <em>The Elements of Statistical Learning</em>. Springer New York. <a href="https://doi.org/10.1007/978-0-387-84858-7">https://doi.org/10.1007/978-0-387-84858-7</a>.
</div>
<div id="ref-boosting2012" class="csl-entry" role="listitem">
Schapire, Robert E., and Yoav Freund. 2012. <em>Boosting: Foundations and Algorithms</em>. The MIT Press. https://doi.org/<a href="https://doi.org/10.7551/mitpress/8291.001.0001">https://doi.org/10.7551/mitpress/8291.001.0001</a>.
</div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There are ways to cope with non-linearities using Logistic Regression model. We have briefly seen in the first course that one can modify input variables with splines or with binning. Sections 5.6 <code>Nonparametric Logistic Regression</code> and 9.1 <code>Generalized Additive Models</code> of <span class="citation" data-cites="hastie2009">Hastie, Tibshirani, and Friedman (<a href="#ref-hastie2009" role="doc-biblioref">2009</a>)</span> present methods to move beyond linearity in the context of Logistic Regression.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In <a href="https://xgboost.readthedocs.io/en/stable/treemethod.html">XGBoost documentation</a> we find this disclaimer: ‘However, as xgboost is largely driven by community effort, the actual implementations have some differences than pure math description. Result might be slightly different than expectation, which we are currently trying to overcome.’<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>For example in the context signal processing, the matching pursuit algorithm developed by Mallat and Zhang in 1993 is equivalent to a Boosting algorithm (Mallat, S., Zhang, Z. (1993). Matching pursuits with time-frequency dictionaries)<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>