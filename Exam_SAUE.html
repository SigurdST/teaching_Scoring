<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sigurd SAUE">

<title>Exam Scoring</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TPnotéScoring_files/libs/clipboard/clipboard.min.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/quarto.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/popper.min.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TPnotéScoring_files/libs/quarto-html/anchor.min.js"></script>
<link href="TPnotéScoring_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TPnotéScoring_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TPnotéScoring_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TPnotéScoring_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TPnotéScoring_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Exam Scoring</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sigurd SAUE </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="we-first-upload-the-data" class="level3">
<h3 class="anchored" data-anchor-id="we-first-upload-the-data">We first upload the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'exam/data/data_fin_exam.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="desbois-ratios" class="level1">
<h1>Desbois ratios</h1>
<section id="descriptive-statistics" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive statistics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical summary of the data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Y             capx               che                cogs         
 0:4129   Min.   :   -0.03   Min.   :    0.00   Min.   :   -52.0  
 1: 224   1st Qu.:    1.95   1st Qu.:    2.48   1st Qu.:    27.0  
          Median :   10.08   Median :   14.70   Median :   113.0  
          Mean   :  183.30   Mean   :  239.18   Mean   :  1324.9  
          3rd Qu.:   54.44   3rd Qu.:   77.36   3rd Qu.:   487.5  
          Max.   :45110.00   Max.   :41032.00   Max.   :396044.0  
       dp                 act                 lct                 ebit         
 Min.   :    0.000   Min.   :     0.10   Min.   :     0.05   Min.   :-1012.07  
 1st Qu.:    2.213   1st Qu.:    24.46   1st Qu.:    11.96   1st Qu.:    0.67  
 Median :    9.400   Median :    90.31   Median :    43.94   Median :   11.23  
 Mean   :  133.437   Mean   :   839.43   Mean   :   618.92   Mean   :  235.17  
 3rd Qu.:   46.363   3rd Qu.:   334.84   3rd Qu.:   189.98   3rd Qu.:   71.07  
 Max.   :17513.788   Max.   :168618.00   Max.   :119109.00   Max.   :36683.00  
     ebitda               re                  gp                  ib           
 Min.   : -627.82   Min.   :-13340.35   Min.   :  -578.72   Min.   :-7987.000  
 1st Qu.:    3.55   1st Qu.:   -16.08   1st Qu.:    19.67   1st Qu.:   -1.355  
 Median :   22.49   Median :     6.24   Median :    70.92   Median :    3.691  
 Mean   :  368.61   Mean   :   568.90   Mean   :   731.08   Mean   :  126.709  
 3rd Qu.:  124.12   3rd Qu.:    92.66   3rd Qu.:   282.22   3rd Qu.:   29.301  
 Max.   :52075.00   Max.   :188057.00   Max.   :101541.00   Max.   :26592.000  
      xint               dltt                 ni                ppent          
 Min.   :  -0.003   Min.   :     0.00   Min.   :-8101.000   Min.   :     0.00  
 1st Qu.:   0.277   1st Qu.:     0.73   1st Qu.:   -1.559   1st Qu.:     7.88  
 Median :   2.402   Median :    21.12   Median :    3.583   Median :    46.41  
 Mean   :  42.798   Mean   :   643.73   Mean   :  127.192   Mean   :   979.52  
 3rd Qu.:  18.316   3rd Qu.:   229.09   3rd Qu.:   29.419   3rd Qu.:   299.44  
 Max.   :7071.000   Max.   :106540.00   Max.   :26592.000   Max.   :227901.00  
      sale               seq                  at                 lt           
 Min.   :     0.3   Min.   :-12567.00   Min.   :     0.7   Min.   :     0.10  
 1st Qu.:    52.3   1st Qu.:    22.77   1st Qu.:    53.0   1st Qu.:    20.55  
 Median :   205.6   Median :    90.69   Median :   215.4   Median :    93.09  
 Mean   :  2056.0   Mean   :  1052.40   Mean   :  2669.0   Mean   :  1580.22  
 3rd Qu.:   819.4   3rd Qu.:   371.76   3rd Qu.:   968.2   3rd Qu.:   530.50  
 Max.   :467153.0   Max.   :188494.00   Max.   :360325.0   Max.   :275732.00  
      invt                rect                wcap               mktval        
 Min.   :    0.000   Min.   :     0.00   Min.   :-21718.79   Min.   :     0.0  
 1st Qu.:    0.814   1st Qu.:     7.58   1st Qu.:     4.19   1st Qu.:    38.5  
 Median :   11.749   Median :    30.52   Median :    29.90   Median :   167.0  
 Mean   :  200.220   Mean   :   319.63   Mean   :   220.51   Mean   :  2683.9  
 3rd Qu.:   71.336   3rd Qu.:   122.93   3rd Qu.:   126.74   3rd Qu.:   825.5  
 Max.   :30781.000   Max.   :116720.00   Max.   : 49509.00   Max.   :461691.9  
       r1                r2                r3                 r4          
 Min.   :0.02369   Min.   :-2.0803   Min.   :0.008584   Min.   :0.005934  
 1st Qu.:0.33597   1st Qu.: 0.5361   1st Qu.:0.311835   1st Qu.:0.145297  
 Median :0.50457   Median : 0.7476   Median :0.524404   Median :0.221092  
 Mean   :0.51380   Mean   : 0.6997   Mean   :0.551137   Mean   :0.254551  
 3rd Qu.:0.65920   3rd Qu.: 0.9633   3rd Qu.:0.801777   3rd Qu.:0.325875  
 Max.   :1.97206   Max.   : 2.4706   Max.   :1.000000   Max.   :1.444394  
       r5               r6                r7                r8         
 Min.   :0.0000   Min.   :-5.3564   Min.   :-4.1907   Min.   :-3.6310  
 1st Qu.:0.0672   1st Qu.: 0.7865   1st Qu.: 0.1533   1st Qu.: 0.4160  
 Median :0.2227   Median : 1.4141   Median : 0.5961   Median : 0.6189  
 Mean   :0.2593   Mean   : 1.8294   Mean   : 1.0435   Mean   : 0.7859  
 3rd Qu.:0.3971   3rd Qu.: 2.4221   3rd Qu.: 1.4855   3rd Qu.: 0.9710  
 Max.   :1.5422   Max.   :21.1953   Max.   :16.0701   Max.   : 7.9560  
      r11               r12                r14                r17            
 Min.   :-4.3488   Min.   :-1.52136   Min.   :0.007171   Min.   :-1.290e-06  
 1st Qu.: 0.1731   1st Qu.: 0.07408   1st Qu.:0.363975   1st Qu.: 1.231e-02  
 Median : 0.5528   Median : 0.21545   Median :0.545748   Median : 3.060e-02  
 Mean   : 0.6491   Mean   : 0.29417   Mean   :0.643761   Mean   : 3.436e-02  
 3rd Qu.: 0.9955   3rd Qu.: 0.43254   3rd Qu.:0.801389   3rd Qu.: 5.024e-02  
 Max.   : 4.5952   Max.   : 2.12526   Max.   :4.064504   Max.   : 1.812e-01  
      r18                r21                r24                r28         
 Min.   :-0.38286   Min.   :-2.59906   Min.   :-0.63207   Min.   :-2.2963  
 1st Qu.: 0.01088   1st Qu.: 0.01290   1st Qu.: 0.06492   1st Qu.: 0.1859  
 Median : 0.04197   Median : 0.09428   Median : 0.11515   Median : 0.3580  
 Mean   : 0.07284   Mean   : 0.14928   Mean   : 0.10081   Mean   : 0.3343  
 3rd Qu.: 0.10136   3rd Qu.: 0.23631   3rd Qu.: 0.16825   3rd Qu.: 0.5675  
 Max.   : 1.13042   Max.   : 3.18458   Max.   : 0.69067   Max.   : 2.1403  
      r30                r32               r36              r37         
 Min.   :-5.60614   Min.   :-2.5229   Min.   :-8.225   Min.   :-0.5073  
 1st Qu.:-0.06749   1st Qu.: 0.1285   1st Qu.: 0.655   1st Qu.: 0.2221  
 Median : 0.09824   Median : 0.2885   Median : 1.418   Median : 0.3389  
 Mean   : 0.00259   Mean   : 0.2615   Mean   : 2.074   Mean   : 0.3838  
 3rd Qu.: 0.20320   3rd Qu.: 0.4690   3rd Qu.: 2.800   3rd Qu.: 0.4965  
 Max.   : 2.84407   Max.   : 2.3115   Max.   :18.526   Max.   : 1.3997  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between Y and r1:r37</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Y</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(Y))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>data_r<span class="ot">&lt;-</span> data[, <span class="dv">25</span><span class="sc">:</span><span class="fu">ncol</span>(data)]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            r1         r2         r3        r4        r5        r6        r7
[1,] 0.3332894 -0.2732609 -0.0925612 0.1499643 0.2493621 0.3404333 0.2904463
            r8        r11        r12       r14       r17       r18      r21
[1,] 0.2527205 -0.1044007 -0.1317994 0.1653351 0.1708959 0.3654288 0.215301
            r24         r28        r30        r32      r36         r37
[1,] -0.1238764 -0.08072658 -0.2898251 -0.1727997 0.125581 -0.08553172</code></pre>
</div>
</div>
<p>We can see that the correlation between Y and the variables r1 to r37 is very low.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df <span class="sc">%&gt;%</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strong_correlations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Variable1 Variable2 Correlation
1        r32       r28   0.9690406
2        r28       r32   0.9690406
3         r7        r6   0.9269850
4         r6        r7   0.9269850
5         r5        r2  -0.8767279
6         r2        r5  -0.8767279
7         r5        r3  -0.8422275
8         r3        r5  -0.8422275
9         r2        r1  -0.7880348
10        r1        r2  -0.7880348
11       r18        r6   0.7763700
12        r6       r18   0.7763700
13       r18        r7   0.7736328
14        r7       r18   0.7736328
15        r5        r1   0.7709597
16        r1        r5   0.7709597
17       r36        r7   0.7659710
18        r7       r36   0.7659710
19       r36        r6   0.7474222
20        r6       r36   0.7474222
21        r7        r5   0.7326392
22        r5        r7   0.7326392
23       r14       r11  -0.7055432
24       r11       r14  -0.7055432
25       r32       r30   0.7006163
26       r30       r32   0.7006163</code></pre>
</div>
</div>
<p>We observe very strong coreelation (positive, but also negative) between some variables.</p>
<p>Now, we will plot interactions between the response variable Y and some of the numerical features r1 to r37.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>correlation_df_r <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>strongest_corr <span class="ot">&lt;-</span> correlation_df_r <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Var1 Var2        Freq
1     A  r18  0.36542881
2     A   r6  0.34043326
3     A   r1  0.33328939
4     A   r7  0.29044633
5     A  r30 -0.28982515
6     A   r2 -0.27326093
7     A   r8  0.25272052
8     A   r5  0.24936206
9     A  r21  0.21530102
10    A  r32 -0.17279969
11    A  r17  0.17089590
12    A  r14  0.16533509
13    A   r4  0.14996426
14    A  r12 -0.13179936
15    A  r36  0.12558098
16    A  r24 -0.12387635
17    A  r11 -0.10440070
18    A   r3 -0.09256120
19    A  r37 -0.08553172
20    A  r28 -0.08072658</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r18, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r18"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r6, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r6"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r30, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r30"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r28, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r28"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot confirms that r18 and r6 are correlated with Y, while r30 is negatively correlated with Y and r28 is not correlated with Y.</p>
</section>
<section id="cleaning-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-the-dataset">Cleaning the dataset</h3>
<p>Looking for NaN:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span><span class="fu">cbind</span>(Y, data_r)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We delete any rows with NaN values</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We check if there is no duplicate rows</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">distinct</span>(df)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># We remove outliers</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>Q1 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>Y, <span class="fl">0.25</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>Q3 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>Y, <span class="fl">0.75</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>IQR <span class="ot">&lt;-</span> Q3 <span class="sc">-</span> Q1</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Y <span class="sc">&gt;=</span> (Q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR) <span class="sc">&amp;</span> Y <span class="sc">&lt;=</span> (Q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># We remove columns that are too correlated (r32 with r28 and r7 with r6, and r2 with r5)</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r32, r7, r5))</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># We also remove all the variable with a correlation lower than abs(0.2 with Y)</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r2, r17, r14, r4, r12, r36, r24, r11, r3, r37, r28))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic regression</h3>
<p>Now that we have a clean dataset, we can try a logistic regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>full_model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = binomial, data = df, maxit = 1000)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)
(Intercept) -3.157e+01  2.766e+06       0        1
r1          -3.799e-13  5.840e+06       0        1
r6          -5.650e-14  1.471e+06       0        1
r8           1.440e-13  2.469e+06       0        1
r18          1.315e-12  2.458e+07       0        1
r21          1.775e-13  7.084e+06       0        1
r30         -2.932e-14  2.855e+06       0        1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 0.0000e+00  on 4128  degrees of freedom
Residual deviance: 1.8336e-12  on 4122  degrees of freedom
AIC: 14

Number of Fisher Scoring iterations: 30</code></pre>
</div>
</div>
<p>I can’ manage to have a significant model.</p>
</section>
</section>
<section id="altman-ratios" class="level1">
<h1>Altman ratios</h1>
<p>We create the new predictor</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">=</span> data<span class="sc">$</span>wcap <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> data<span class="sc">$</span>re <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">=</span> data<span class="sc">$</span>ebit <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>X4 <span class="ot">=</span> data<span class="sc">$</span>mktval <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>X5 <span class="ot">=</span> data<span class="sc">$</span>sale <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">=</span> <span class="fl">0.012</span><span class="sc">*</span>X1 <span class="sc">+</span> <span class="fl">0.014</span><span class="sc">*</span>X2 <span class="sc">+</span> <span class="fl">0.033</span><span class="sc">*</span>X3 <span class="sc">+</span> <span class="fl">0.006</span><span class="sc">*</span>X4 <span class="sc">+</span> <span class="fl">0.999</span><span class="sc">*</span>X5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit a logistic regression with X1 to X5</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_altman <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">X3 =</span> X3,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">X4 =</span> X4,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">X5 =</span> X5</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>model_altman <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df_altman,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_altman)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = binomial, data = df_altman, maxit = 1000)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -0.5497     0.1787  -3.077  0.00209 ** 
X1           -1.8618     0.3869  -4.813 1.49e-06 ***
X2           -0.1696     0.1267  -1.338  0.18089    
X3           -2.8661     0.5998  -4.779 1.76e-06 ***
X4           -4.9684     0.3819 -13.011  &lt; 2e-16 ***
X5            0.2498     0.1039   2.403  0.01624 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1192.5  on 4347  degrees of freedom
AIC: 1204.5

Number of Fisher Scoring iterations: 9</code></pre>
</div>
</div>
<p>The coefficient for X3 represents the change in the log odds (log ) of the response variable Y for a one-unit increase in X3. Here it’s negative which means a higher value of X3 increase the probability of Y = 0.</p>
<p>The p-value is close to zero, which means that X3 is significant for Y.</p>
<p>Now we calculate a confidence interval at 95% for X3’s coefficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>conf_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(model_altman)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Waiting for profiling to be done...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>x3_conf_int <span class="ot">&lt;-</span> conf_int[<span class="st">"X3"</span>, ]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x3_conf_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.5 %    97.5 % 
-4.036042 -1.679595 </code></pre>
</div>
</div>
</section>
<section id="financial-items-lasso" class="level1">
<h1>Financial Items / Lasso</h1>
<section id="descriptive-statistics-1" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics-1">Descriptive statistics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We create the variable capx/mktval</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data[, <span class="dv">2</span><span class="sc">:</span><span class="dv">24</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>correlations2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            capx         che        cogs          dp         act         lct
[1,] -0.01650222 -0.02111689 -0.00789613 -0.01598514 -0.01986023 -0.01512229
            ebit      ebitda          re          gp          ib       xint
[1,] -0.03379025 -0.02857028 -0.03761522 -0.02745454 -0.05162787 0.02642513
            dltt         ni       ppent        sale         seq          at
[1,] 0.005396866 -0.0538078 -0.01323953 -0.01487638 -0.03302175 -0.01900003
               lt       invt        rect        wcap      mktval
[1,] -0.006062534 -0.0151559 -0.01665686 -0.02369163 -0.03681769</code></pre>
</div>
</div>
<p>We observe rellay low correlations between the variables and Y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>correlation_matrix2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>correlation_df2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix2)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df2 <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strong_correlations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Variable1 Variable2 Correlation
1          ni        ib   0.9979269
2          ib        ni   0.9979269
3      ebitda      ebit   0.9821573
4        ebit    ebitda   0.9821573
5       ppent      capx   0.9716096
6        capx     ppent   0.9716096
7        sale      cogs   0.9688117
8        cogs      sale   0.9688117
9          ib      ebit   0.9634145
10       ebit        ib   0.9634145
11         ni      ebit   0.9609136
12       ebit        ni   0.9609136
13        lct       act   0.9580325
14        act       lct   0.9580325
15         gp    ebitda   0.9525888
16     ebitda        gp   0.9525888
17         lt        at   0.9521162
18         at        lt   0.9521162
19         lt       lct   0.9487960
20        lct        lt   0.9487960
21         gp      ebit   0.9397232
22       ebit        gp   0.9397232
23         at        dp   0.9375303
24         dp        at   0.9375303
25         ib    ebitda   0.9365907
26     ebitda        ib   0.9365907
27         at    ebitda   0.9360263
28     ebitda        at   0.9360263
29     ebitda        dp   0.9357067
30         dp    ebitda   0.9357067
31         ni    ebitda   0.9343453
32     ebitda        ni   0.9343453
33       rect       act   0.9323893
34        act      rect   0.9323893
35         lt       act   0.9316767
36        act        lt   0.9316767
37       dltt      xint   0.9300732
38       xint      dltt   0.9300732
39         lt      dltt   0.9267418
40       dltt        lt   0.9267418
41        seq    ebitda   0.9198920
42     ebitda       seq   0.9198920
43         at       seq   0.9139955
44        seq        at   0.9139955
45         at       lct   0.9131745
46        lct        at   0.9131745
47         at        gp   0.9118580
48         gp        at   0.9118580
49        seq        re   0.9056644
50         re       seq   0.9056644
51         at       act   0.9044135
52        act        at   0.9044135
53        seq      capx   0.9012668
54       capx       seq   0.9012668
55        seq      ebit   0.9007075
56       ebit       seq   0.9007075
57        seq     ppent   0.8965395
58      ppent       seq   0.8965395
59       rect       lct   0.8957187
60        lct      rect   0.8957187
61        seq        ib   0.8898661
62         ib       seq   0.8898661
63        seq        ni   0.8897836
64         ni       seq   0.8897836
65         at      sale   0.8870960
66       sale        at   0.8870960
67         at      ebit   0.8864421
68       ebit        at   0.8864421
69         lt        dp   0.8855352
70         dp        lt   0.8855352
71         gp        dp   0.8835941
72         dp        gp   0.8835941
73     mktval      ebit   0.8822222
74       ebit    mktval   0.8822222
75     mktval        gp   0.8810049
76         gp    mktval   0.8810049
77         ib        re   0.8782920
78         re        ib   0.8782920
79         ib        gp   0.8782005
80         gp        ib   0.8782005
81         ni        gp   0.8776227
82         gp        ni   0.8776227
83         ni        re   0.8772716
84         re        ni   0.8772716
85        seq        gp   0.8758614
86         gp       seq   0.8758614
87         gp       che   0.8717182
88        che        gp   0.8717182
89       sale       lct   0.8659816
90        lct      sale   0.8659816
91        seq        dp   0.8659472
92         dp       seq   0.8659472
93        lct        dp   0.8652059
94         dp       lct   0.8652059
95       invt      sale   0.8645473
96       sale      invt   0.8645473
97         at     ppent   0.8637236
98      ppent        at   0.8637236
99       sale    ebitda   0.8629821
100    ebitda      sale   0.8629821
101        re      ebit   0.8609679
102      ebit        re   0.8609679
103     ppent        dp   0.8603871
104        dp     ppent   0.8603871
105       act       che   0.8571149
106       che       act   0.8571149
107      rect        lt   0.8570417
108        lt      rect   0.8570417
109    mktval    ebitda   0.8565262
110    ebitda    mktval   0.8565262
111        re    ebitda   0.8562288
112    ebitda        re   0.8562288
113        at      dltt   0.8553786
114      dltt        at   0.8553786
115        lt      xint   0.8539562
116      xint        lt   0.8539562
117    mktval        ib   0.8533743
118        ib    mktval   0.8533743
119      ebit        dp   0.8526670
120        dp      ebit   0.8526670
121    mktval        ni   0.8521108
122        ni    mktval   0.8521108
123       seq      sale   0.8510191
124      sale       seq   0.8510191
125      sale       act   0.8470796
126       act      sale   0.8470796
127      invt       lct   0.8445418
128       lct      invt   0.8445418
129        lt    ebitda   0.8425246
130    ebitda        lt   0.8425246
131    ebitda      capx   0.8411829
132      capx    ebitda   0.8411829
133        dp      capx   0.8400819
134      capx        dp   0.8400819
135     ppent    ebitda   0.8383908
136    ebitda     ppent   0.8383908
137        lt        gp   0.8372876
138        gp        lt   0.8372876
139      sale        dp   0.8372292
140        dp      sale   0.8372292
141        gp       act   0.8370020
142       act        gp   0.8370020
143       act        dp   0.8328286
144        dp       act   0.8328286
145      sale      ebit   0.8317350
146      ebit      sale   0.8317350
147        gp       lct   0.8298649
148       lct        gp   0.8298649
149      sale        re   0.8296329
150        re      sale   0.8296329
151      invt       act   0.8271661
152       act      invt   0.8271661
153        at      capx   0.8270086
154      capx        at   0.8270086
155    ebitda       lct   0.8265011
156       lct    ebitda   0.8265011
157      sale     ppent   0.8264854
158     ppent      sale   0.8264854
159      invt        at   0.8263927
160        at      invt   0.8263927
161        at       che   0.8242007
162       che        at   0.8242007
163        at        ni   0.8230116
164        ni        at   0.8230116
165        at        ib   0.8226401
166        ib        at   0.8226401
167      invt      cogs   0.8172078
168      cogs      invt   0.8172078
169        lt      sale   0.8145425
170      sale        lt   0.8145425
171    ebitda       act   0.8120243
172       act    ebitda   0.8120243
173        at        re   0.8113431
174        re        at   0.8113431
175      sale        gp   0.8107684
176        gp      sale   0.8107684
177        ib      capx   0.8072278
178      capx        ib   0.8072278
179        ni      capx   0.8028738
180      capx        ni   0.8028738
181      sale        ib   0.8017974
182        ib      sale   0.8017974
183    ebitda       che   0.8004496
184       che    ebitda   0.8004496
185      sale        ni   0.8002324
186        ni      sale   0.8002324
187      ebit      capx   0.7979303
188      capx      ebit   0.7979303
189        lt       che   0.7960808
190       che        lt   0.7960808
191        ib        dp   0.7947080
192        dp        ib   0.7947080
193        ni        dp   0.7931611
194        dp        ni   0.7931611
195        gp        re   0.7915219
196        re        gp   0.7915219
197      invt        lt   0.7903080
198        lt      invt   0.7903080
199      sale      capx   0.7860795
200      capx      sale   0.7860795
201       lct      cogs   0.7848920
202      cogs       lct   0.7848920
203      dltt       lct   0.7846807
204       lct      dltt   0.7846807
205      dltt        dp   0.7837994
206        dp      dltt   0.7837994
207     ppent      ebit   0.7829709
208      ebit     ppent   0.7829709
209     ppent        re   0.7814930
210        re     ppent   0.7814930
211      ebit       che   0.7798135
212       che      ebit   0.7798135
213    mktval       seq   0.7792575
214       seq    mktval   0.7792575
215        re      capx   0.7785625
216      capx        re   0.7785625
217        at      cogs   0.7778853
218      cogs        at   0.7778853
219     ppent        ib   0.7765768
220        ib     ppent   0.7765768
221        lt      ebit   0.7756868
222      ebit        lt   0.7756868
223      dltt       act   0.7731698
224       act      dltt   0.7731698
225       lct       che   0.7725107
226       che       lct   0.7725107
227     ppent        ni   0.7723554
228        ni     ppent   0.7723554
229     ppent      cogs   0.7702491
230      cogs     ppent   0.7702491
231    mktval        at   0.7667299
232        at    mktval   0.7667299
233      rect        at   0.7646119
234        at      rect   0.7646119
235        at      xint   0.7638213
236      xint        at   0.7638213
237        re        dp   0.7636307
238        dp        re   0.7636307
239      ebit       lct   0.7627938
240       lct      ebit   0.7627938
241    mktval       che   0.7620735
242       che    mktval   0.7620735
243    mktval        re   0.7613424
244        re    mktval   0.7613424
245        dp       che   0.7609053
246       che        dp   0.7609053
247      ebit       act   0.7586139
248       act      ebit   0.7586139
249        gp      capx   0.7576301
250      capx        gp   0.7576301
251       act      cogs   0.7570708
252      cogs       act   0.7570708
253      invt    ebitda   0.7539495
254    ebitda      invt   0.7539495
255        re      cogs   0.7534330
256      cogs        re   0.7534330
257      invt        gp   0.7490809
258        gp      invt   0.7490809
259      invt       seq   0.7480140
260       seq      invt   0.7480140
261        lt       seq   0.7469294
262       seq        lt   0.7469294
263      invt        dp   0.7458626
264        dp      invt   0.7458626
265       seq      cogs   0.7457896
266      cogs       seq   0.7457896
267       seq       che   0.7453187
268       che       seq   0.7453187
269     ppent        gp   0.7420424
270        gp     ppent   0.7420424
271        lt     ppent   0.7410757
272     ppent        lt   0.7410757
273      rect      sale   0.7409564
274      sale      rect   0.7409564
275        ni       che   0.7395539
276       che        ni   0.7395539
277       seq       act   0.7380069
278       act       seq   0.7380069
279        ib       che   0.7366786
280       che        ib   0.7366786
281      dltt    ebitda   0.7291866
282    ebitda      dltt   0.7291866
283       seq       lct   0.7291378
284       lct       seq   0.7291378
285    ebitda      cogs   0.7290051
286      cogs    ebitda   0.7290051
287      wcap       che   0.7279395
288       che      wcap   0.7279395
289      invt        re   0.7276706
290        re      invt   0.7276706
291      xint       lct   0.7274712
292       lct      xint   0.7274712
293    mktval        dp   0.7245863
294        dp    mktval   0.7245863
295        dp      cogs   0.7244234
296      cogs        dp   0.7244234
297      dltt        gp   0.7240934
298        gp      dltt   0.7240934
299      invt      ebit   0.7189673
300      ebit      invt   0.7189673
301      xint        dp   0.7163290
302        dp      xint   0.7163290
303        lt      cogs   0.7142604
304      cogs        lt   0.7142604
305      cogs      capx   0.7106369
306      capx      cogs   0.7106369
307      wcap       act   0.7098784
308       act      wcap   0.7098784
309      dltt       che   0.7079530
310       che      dltt   0.7079530
311     ppent       lct   0.7067706
312       lct     ppent   0.7067706
313      rect        dp   0.7022175
314        dp      rect   0.7022175
315      rect      dltt   0.7005023
316      dltt      rect   0.7005023
317      invt     ppent   0.7004438
318     ppent      invt   0.7004438</code></pre>
</div>
</div>
<p>We observe really strong correlations between a lot of variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>correlation_df_l <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations2))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>strongest_corr2 <span class="ot">&lt;-</span> correlation_df_l <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Var1   Var2         Freq
1     A     ni -0.053807796
2     A     ib -0.051627873
3     A     re -0.037615216
4     A mktval -0.036817694
5     A   ebit -0.033790250
6     A    seq -0.033021745
7     A ebitda -0.028570282
8     A     gp -0.027454542
9     A   xint  0.026425135
10    A   wcap -0.023691629
11    A    che -0.021116892
12    A    act -0.019860234
13    A     at -0.019000030
14    A   rect -0.016656863
15    A   capx -0.016502221
16    A     dp -0.015985144
17    A   invt -0.015155905
18    A    lct -0.015122288
19    A   sale -0.014876377
20    A  ppent -0.013239529
21    A   cogs -0.007896130
22    A     lt -0.006062534
23    A   dltt  0.005396866</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> ni, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"ni"</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> xint, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"xint"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> dltt, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"dltt"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="TPnotéScoring_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot confirms that ni are a bit correlated with Y, while xint is smally negatively correlated with Y and sltt is not correlated with Y.</p>
<p>Now, we delete variables with ro much correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>to_drop <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(correlation_matrix2, <span class="at">cutoff =</span> threshold)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data_l[, <span class="sc">-</span>to_drop]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression-1" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-1">Logistic regression</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>data_lasso <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, data_l)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>full_model_items <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> data_lasso, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = binomial, data = df, maxit = 1000)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)
(Intercept) -3.157e+01  2.766e+06       0        1
r1          -3.799e-13  5.840e+06       0        1
r6          -5.650e-14  1.471e+06       0        1
r8           1.440e-13  2.469e+06       0        1
r18          1.315e-12  2.458e+07       0        1
r21          1.775e-13  7.084e+06       0        1
r30         -2.932e-14  2.855e+06       0        1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 0.0000e+00  on 4128  degrees of freedom
Residual deviance: 1.8336e-12  on 4122  degrees of freedom
AIC: 14

Number of Fisher Scoring iterations: 30</code></pre>
</div>
</div>
<p>I can’t manage to have a good regression again.</p>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb49" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Exam Scoring"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Sigurd SAUE"</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="an">theme:</span><span class="co"> united</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">### We first upload the data</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'exam/data/data_fin_exam.rds'</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE, message = FALSE, warning = FALSE}</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Package names</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"ROCR"</span>, <span class="st">"car"</span>, <span class="st">"aod"</span>, <span class="st">"broom"</span>, <span class="st">"rsample"</span>, <span class="st">"bestglm"</span>, <span class="st">"glmnet"</span>, <span class="st">"glmnetUtils"</span>, <span class="st">"splines"</span>, <span class="st">"dplyr"</span>, <span class="st">"reshape2"</span>, <span class="st">"caret"</span>)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages not yet installed</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>installed_packages <span class="ot">&lt;-</span> packages <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">installed.packages</span>())</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(installed_packages <span class="sc">==</span> <span class="cn">FALSE</span>)) {</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(packages[<span class="sc">!</span>installed_packages]) }</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co"># # Packages loading</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional packages used throughout the course but not needed for the analysis</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>additional_packages <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">"purrr"</span>, <span class="st">"pROC"</span>, <span class="st">"foreign"</span>, <span class="st">"patchwork"</span>, <span class="st">"class"</span>,</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="st">"scales"</span>, <span class="st">"rpart"</span>, <span class="st">"rpart.plot"</span>, <span class="st">"DescTools"</span>)</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="fu"># Desbois ratios</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a><span class="fu">### Descriptive statistics</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical summary of the data</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between Y and r1:r37</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> data<span class="sc">$</span>Y</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(Y))</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>data_r<span class="ot">&lt;-</span> data[, <span class="dv">25</span><span class="sc">:</span><span class="fu">ncol</span>(data)]</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations)</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>We can see that the correlation between Y and the variables r1 to r37 is very low.</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_r, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix)</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df <span class="sc">%&gt;%</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strong_correlations)</span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a>We observe very strong coreelation (positive, but also negative) between some variables.</span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a>Now, we will plot interactions between the response variable Y and some of the numerical features r1 to r37.</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a>correlation_df_r <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations))</span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a>strongest_corr <span class="ot">&lt;-</span> correlation_df_r <span class="sc">%&gt;%</span></span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr)</span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r18, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r18"</span>,</span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r6, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r6"</span>,</span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r30, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-110"><a href="#cb49-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-111"><a href="#cb49-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r30"</span>,</span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> r28, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-120"><a href="#cb49-120" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"r28"</span>,</span>
<span id="cb49-121"><a href="#cb49-121" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true" tabindex="-1"></a>The plot confirms that r18 and r6 are correlated with Y, while r30 is negatively correlated with Y and r28 is not correlated with Y.</span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cleaning the dataset</span></span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true" tabindex="-1"></a>Looking for NaN:</span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-132"><a href="#cb49-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-133"><a href="#cb49-133" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span><span class="fu">cbind</span>(Y, data_r)</span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true" tabindex="-1"></a><span class="co"># We delete any rows with NaN values</span></span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df)</span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true" tabindex="-1"></a><span class="co"># We check if there is no duplicate rows</span></span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">distinct</span>(df)</span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true" tabindex="-1"></a><span class="co"># We remove outliers</span></span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true" tabindex="-1"></a>Q1 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>Y, <span class="fl">0.25</span>)</span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true" tabindex="-1"></a>Q3 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>Y, <span class="fl">0.75</span>)</span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true" tabindex="-1"></a>IQR <span class="ot">&lt;-</span> Q3 <span class="sc">-</span> Q1</span>
<span id="cb49-145"><a href="#cb49-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-146"><a href="#cb49-146" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb49-147"><a href="#cb49-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Y <span class="sc">&gt;=</span> (Q1 <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR) <span class="sc">&amp;</span> Y <span class="sc">&lt;=</span> (Q3 <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> IQR))</span>
<span id="cb49-148"><a href="#cb49-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-149"><a href="#cb49-149" aria-hidden="true" tabindex="-1"></a><span class="co"># We remove columns that are too correlated (r32 with r28 and r7 with r6, and r2 with r5)</span></span>
<span id="cb49-150"><a href="#cb49-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-151"><a href="#cb49-151" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb49-152"><a href="#cb49-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r32, r7, r5))</span>
<span id="cb49-153"><a href="#cb49-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-154"><a href="#cb49-154" aria-hidden="true" tabindex="-1"></a><span class="co"># We also remove all the variable with a correlation lower than abs(0.2 with Y)</span></span>
<span id="cb49-155"><a href="#cb49-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-156"><a href="#cb49-156" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb49-157"><a href="#cb49-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(r2, r17, r14, r4, r12, r36, r24, r11, r3, r37, r28))</span>
<span id="cb49-158"><a href="#cb49-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-159"><a href="#cb49-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-160"><a href="#cb49-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-161"><a href="#cb49-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-162"><a href="#cb49-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-163"><a href="#cb49-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-164"><a href="#cb49-164" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression</span></span>
<span id="cb49-165"><a href="#cb49-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-166"><a href="#cb49-166" aria-hidden="true" tabindex="-1"></a>Now that we have a clean dataset, we can try a logistic regression.</span>
<span id="cb49-167"><a href="#cb49-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-170"><a href="#cb49-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-171"><a href="#cb49-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb49-172"><a href="#cb49-172" aria-hidden="true" tabindex="-1"></a>full_model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb49-173"><a href="#cb49-173" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df, </span>
<span id="cb49-174"><a href="#cb49-174" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb49-175"><a href="#cb49-175" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb49-176"><a href="#cb49-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-177"><a href="#cb49-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb49-178"><a href="#cb49-178" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_desbois)</span>
<span id="cb49-179"><a href="#cb49-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-180"><a href="#cb49-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-181"><a href="#cb49-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-182"><a href="#cb49-182" aria-hidden="true" tabindex="-1"></a>I can' manage to have a significant model.</span>
<span id="cb49-183"><a href="#cb49-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-184"><a href="#cb49-184" aria-hidden="true" tabindex="-1"></a><span class="fu"># Altman ratios</span></span>
<span id="cb49-185"><a href="#cb49-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-186"><a href="#cb49-186" aria-hidden="true" tabindex="-1"></a>We create the new predictor</span>
<span id="cb49-187"><a href="#cb49-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-190"><a href="#cb49-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-191"><a href="#cb49-191" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">=</span> data<span class="sc">$</span>wcap <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb49-192"><a href="#cb49-192" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> data<span class="sc">$</span>re <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb49-193"><a href="#cb49-193" aria-hidden="true" tabindex="-1"></a>X3 <span class="ot">=</span> data<span class="sc">$</span>ebit <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb49-194"><a href="#cb49-194" aria-hidden="true" tabindex="-1"></a>X4 <span class="ot">=</span> data<span class="sc">$</span>mktval <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb49-195"><a href="#cb49-195" aria-hidden="true" tabindex="-1"></a>X5 <span class="ot">=</span> data<span class="sc">$</span>sale <span class="sc">/</span> data<span class="sc">$</span>at</span>
<span id="cb49-196"><a href="#cb49-196" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">=</span> <span class="fl">0.012</span><span class="sc">*</span>X1 <span class="sc">+</span> <span class="fl">0.014</span><span class="sc">*</span>X2 <span class="sc">+</span> <span class="fl">0.033</span><span class="sc">*</span>X3 <span class="sc">+</span> <span class="fl">0.006</span><span class="sc">*</span>X4 <span class="sc">+</span> <span class="fl">0.999</span><span class="sc">*</span>X5</span>
<span id="cb49-197"><a href="#cb49-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-198"><a href="#cb49-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-199"><a href="#cb49-199" aria-hidden="true" tabindex="-1"></a>We fit a logistic regression with X1 to X5</span>
<span id="cb49-200"><a href="#cb49-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-203"><a href="#cb49-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-204"><a href="#cb49-204" aria-hidden="true" tabindex="-1"></a>df_altman <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb49-205"><a href="#cb49-205" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> Y,</span>
<span id="cb49-206"><a href="#cb49-206" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1,</span>
<span id="cb49-207"><a href="#cb49-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2,</span>
<span id="cb49-208"><a href="#cb49-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">X3 =</span> X3,</span>
<span id="cb49-209"><a href="#cb49-209" aria-hidden="true" tabindex="-1"></a>  <span class="at">X4 =</span> X4,</span>
<span id="cb49-210"><a href="#cb49-210" aria-hidden="true" tabindex="-1"></a>  <span class="at">X5 =</span> X5</span>
<span id="cb49-211"><a href="#cb49-211" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-212"><a href="#cb49-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-213"><a href="#cb49-213" aria-hidden="true" tabindex="-1"></a>model_altman <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb49-214"><a href="#cb49-214" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> df_altman,</span>
<span id="cb49-215"><a href="#cb49-215" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb49-216"><a href="#cb49-216" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb49-217"><a href="#cb49-217" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_altman)</span>
<span id="cb49-218"><a href="#cb49-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-219"><a href="#cb49-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-220"><a href="#cb49-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-221"><a href="#cb49-221" aria-hidden="true" tabindex="-1"></a>The coefficient for X3 represents the change in the log odds (log ) of the response variable Y for a one-unit increase in X3. Here it's negative which means a higher value of X3 increase the probability of Y = 0.</span>
<span id="cb49-222"><a href="#cb49-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-223"><a href="#cb49-223" aria-hidden="true" tabindex="-1"></a>The p-value is close to zero, which means that X3 is significant for Y.</span>
<span id="cb49-224"><a href="#cb49-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-225"><a href="#cb49-225" aria-hidden="true" tabindex="-1"></a>Now we calculate a confidence interval at 95% for X3's coefficient.</span>
<span id="cb49-226"><a href="#cb49-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-227"><a href="#cb49-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb49-228"><a href="#cb49-228" aria-hidden="true" tabindex="-1"></a>conf_int <span class="ot">&lt;-</span> <span class="fu">confint</span>(model_altman)</span>
<span id="cb49-229"><a href="#cb49-229" aria-hidden="true" tabindex="-1"></a>x3_conf_int <span class="ot">&lt;-</span> conf_int[<span class="st">"X3"</span>, ]</span>
<span id="cb49-230"><a href="#cb49-230" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x3_conf_int)</span>
<span id="cb49-231"><a href="#cb49-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-232"><a href="#cb49-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-233"><a href="#cb49-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-234"><a href="#cb49-234" aria-hidden="true" tabindex="-1"></a><span class="fu"># Financial Items / Lasso</span></span>
<span id="cb49-235"><a href="#cb49-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-236"><a href="#cb49-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### Descriptive statistics</span></span>
<span id="cb49-237"><a href="#cb49-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-240"><a href="#cb49-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-241"><a href="#cb49-241" aria-hidden="true" tabindex="-1"></a><span class="co"># We create the variable capx/mktval</span></span>
<span id="cb49-242"><a href="#cb49-242" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data[, <span class="dv">2</span><span class="sc">:</span><span class="dv">24</span>]</span>
<span id="cb49-243"><a href="#cb49-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-244"><a href="#cb49-244" aria-hidden="true" tabindex="-1"></a>correlations2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(Y, data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb49-245"><a href="#cb49-245" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(correlations2)</span>
<span id="cb49-246"><a href="#cb49-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-247"><a href="#cb49-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-248"><a href="#cb49-248" aria-hidden="true" tabindex="-1"></a>We observe rellay low correlations between the variables and Y.</span>
<span id="cb49-249"><a href="#cb49-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-252"><a href="#cb49-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-253"><a href="#cb49-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between the variables r1:r37</span></span>
<span id="cb49-254"><a href="#cb49-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-255"><a href="#cb49-255" aria-hidden="true" tabindex="-1"></a>correlation_matrix2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_l, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb49-256"><a href="#cb49-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-257"><a href="#cb49-257" aria-hidden="true" tabindex="-1"></a>correlation_df2 <span class="ot">&lt;-</span> <span class="fu">melt</span>(correlation_matrix2)</span>
<span id="cb49-258"><a href="#cb49-258" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(correlation_df2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable1"</span>, <span class="st">"Variable2"</span>, <span class="st">"Correlation"</span>)</span>
<span id="cb49-259"><a href="#cb49-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-260"><a href="#cb49-260" aria-hidden="true" tabindex="-1"></a><span class="co"># We look for the srongest correlations</span></span>
<span id="cb49-261"><a href="#cb49-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-262"><a href="#cb49-262" aria-hidden="true" tabindex="-1"></a>strong_correlations <span class="ot">&lt;-</span> correlation_df2 <span class="sc">%&gt;%</span></span>
<span id="cb49-263"><a href="#cb49-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">abs</span>(Correlation) <span class="sc">&gt;</span> <span class="fl">0.7</span>, Variable1 <span class="sc">!=</span> Variable2) <span class="sc">%&gt;%</span></span>
<span id="cb49-264"><a href="#cb49-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Correlation)))</span>
<span id="cb49-265"><a href="#cb49-265" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strong_correlations)</span>
<span id="cb49-266"><a href="#cb49-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-267"><a href="#cb49-267" aria-hidden="true" tabindex="-1"></a>We observe really strong correlations between a lot of variables.</span>
<span id="cb49-268"><a href="#cb49-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-269"><a href="#cb49-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-270"><a href="#cb49-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-271"><a href="#cb49-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-272"><a href="#cb49-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-275"><a href="#cb49-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-276"><a href="#cb49-276" aria-hidden="true" tabindex="-1"></a><span class="co"># We first sort the correlations</span></span>
<span id="cb49-277"><a href="#cb49-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-278"><a href="#cb49-278" aria-hidden="true" tabindex="-1"></a>correlation_df_l <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlations2))</span>
<span id="cb49-279"><a href="#cb49-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-280"><a href="#cb49-280" aria-hidden="true" tabindex="-1"></a>strongest_corr2 <span class="ot">&lt;-</span> correlation_df_l <span class="sc">%&gt;%</span></span>
<span id="cb49-281"><a href="#cb49-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(Freq)))</span>
<span id="cb49-282"><a href="#cb49-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-283"><a href="#cb49-283" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(strongest_corr2)</span>
<span id="cb49-284"><a href="#cb49-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-285"><a href="#cb49-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we plot the interactions between Y and the most interesting variables</span></span>
<span id="cb49-286"><a href="#cb49-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-287"><a href="#cb49-287" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> ni, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-288"><a href="#cb49-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-289"><a href="#cb49-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-290"><a href="#cb49-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-291"><a href="#cb49-291" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"ni"</span>,</span>
<span id="cb49-292"><a href="#cb49-292" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb49-293"><a href="#cb49-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-294"><a href="#cb49-294" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> xint, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-295"><a href="#cb49-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-296"><a href="#cb49-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-297"><a href="#cb49-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-298"><a href="#cb49-298" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"xint"</span>,</span>
<span id="cb49-299"><a href="#cb49-299" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb49-300"><a href="#cb49-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-301"><a href="#cb49-301" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> dltt, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb49-302"><a href="#cb49-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                <span class="co"># Scatter points</span></span>
<span id="cb49-303"><a href="#cb49-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span>  <span class="co"># Add a linear regression line</span></span>
<span id="cb49-304"><a href="#cb49-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction of Numerical Feature with Response Variable"</span>,</span>
<span id="cb49-305"><a href="#cb49-305" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"dltt"</span>,</span>
<span id="cb49-306"><a href="#cb49-306" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y"</span>)</span>
<span id="cb49-307"><a href="#cb49-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-308"><a href="#cb49-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-309"><a href="#cb49-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-310"><a href="#cb49-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-311"><a href="#cb49-311" aria-hidden="true" tabindex="-1"></a>The plot confirms that ni are a bit correlated with Y, while xint is smally negatively correlated with Y and sltt is not correlated with Y.</span>
<span id="cb49-312"><a href="#cb49-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-313"><a href="#cb49-313" aria-hidden="true" tabindex="-1"></a>Now, we delete variables with ro much correlation.</span>
<span id="cb49-316"><a href="#cb49-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-317"><a href="#cb49-317" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb49-318"><a href="#cb49-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-319"><a href="#cb49-319" aria-hidden="true" tabindex="-1"></a>to_drop <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(correlation_matrix2, <span class="at">cutoff =</span> threshold)</span>
<span id="cb49-320"><a href="#cb49-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-321"><a href="#cb49-321" aria-hidden="true" tabindex="-1"></a>data_l <span class="ot">&lt;-</span> data_l[, <span class="sc">-</span>to_drop]</span>
<span id="cb49-322"><a href="#cb49-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-323"><a href="#cb49-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-324"><a href="#cb49-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-325"><a href="#cb49-325" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression</span></span>
<span id="cb49-326"><a href="#cb49-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-327"><a href="#cb49-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-330"><a href="#cb49-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-331"><a href="#cb49-331" aria-hidden="true" tabindex="-1"></a>data_lasso <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Y, data_l)</span>
<span id="cb49-332"><a href="#cb49-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-333"><a href="#cb49-333" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the full logistic regression model</span></span>
<span id="cb49-334"><a href="#cb49-334" aria-hidden="true" tabindex="-1"></a>full_model_items <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., </span>
<span id="cb49-335"><a href="#cb49-335" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data =</span> data_lasso, </span>
<span id="cb49-336"><a href="#cb49-336" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> binomial,</span>
<span id="cb49-337"><a href="#cb49-337" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxit =</span> <span class="dv">1000</span>)</span>
<span id="cb49-338"><a href="#cb49-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-339"><a href="#cb49-339" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the model</span></span>
<span id="cb49-340"><a href="#cb49-340" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_desbois)</span>
<span id="cb49-341"><a href="#cb49-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-342"><a href="#cb49-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-343"><a href="#cb49-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-344"><a href="#cb49-344" aria-hidden="true" tabindex="-1"></a>I can't manage to have a good regression again.</span>
<span id="cb49-345"><a href="#cb49-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-346"><a href="#cb49-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-347"><a href="#cb49-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-348"><a href="#cb49-348" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>