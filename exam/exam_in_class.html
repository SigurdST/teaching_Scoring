<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Exam - In class</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="exam_in_class_files/libs/clipboard/clipboard.min.js"></script>
<script src="exam_in_class_files/libs/quarto-html/quarto.js"></script>
<script src="exam_in_class_files/libs/quarto-html/popper.min.js"></script>
<script src="exam_in_class_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="exam_in_class_files/libs/quarto-html/anchor.min.js"></script>
<link href="exam_in_class_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="exam_in_class_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="exam_in_class_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="exam_in_class_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="exam_in_class_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<link href="exam_in_class_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="exam_in_class_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#instructions" id="toc-instructions" class="nav-link" data-scroll-target="#instructions"><span class="header-section-number">2</span> Instructions</a></li>
  <li><a href="#desbois-ratios-15-total-points" id="toc-desbois-ratios-15-total-points" class="nav-link" data-scroll-target="#desbois-ratios-15-total-points"><span class="header-section-number">3</span> “Desbois” ratios (15% total points)</a></li>
  <li><a href="#altman-ratios-5-total-points" id="toc-altman-ratios-5-total-points" class="nav-link" data-scroll-target="#altman-ratios-5-total-points"><span class="header-section-number">4</span> “Altman” ratios (5% total points)</a></li>
  <li><a href="#financial-items-lasso-10-total-points" id="toc-financial-items-lasso-10-total-points" class="nav-link" data-scroll-target="#financial-items-lasso-10-total-points"><span class="header-section-number">5</span> Financial items / Lasso (10% total points)</a></li>
  <li><a href="#models-assessment-10-total-points" id="toc-models-assessment-10-total-points" class="nav-link" data-scroll-target="#models-assessment-10-total-points"><span class="header-section-number">6</span> Models assessment (10% total points)</a></li>
  <li><a href="#exercise-simulation-and-boundary-decision-10-total-points" id="toc-exercise-simulation-and-boundary-decision-10-total-points" class="nav-link" data-scroll-target="#exercise-simulation-and-boundary-decision-10-total-points"><span class="header-section-number">7</span> Exercise: Simulation and boundary decision (10% total points)</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="exam_in_class.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exam - In class</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>The goal of this exam is to build and assess a predictive model to quantify the probability of corporate default <strong>with a 1-year horizon</strong>, using annual financial statement data reported by companies. Financial statement data (both financial statement items and ratios) relating to these companies is available in a data set.</p>
<p>The data set is anonymized, neither companies names/identifiers nor fiscal years are given.</p>
<p>When a corporate default (column <code>Y</code>) occurs for a company during a given fiscal year, say <code>N</code>, the observation (ie row in data set) of the preceding fiscal year (<code>N-1</code>) for this company shows a value of <code>1</code> in the column <code>Y</code>, <code>0</code> otherwise.</p>
<p>Your goal is to predict corporate default with a 1-year horizon.</p>
<p>We briefly describe the columns of the data set (Rows: 4,353 Columns: 44):</p>
<ul>
<li><code>Y</code>: 0 for a healthy company (ie no default during the next fiscal year), 1 for a company in default during the next fiscal year;</li>
</ul>
<p>First a set of financial statements items mainly coming from companies income statements or balance sheets:</p>
<ul>
<li><p><code>capx</code>: Capital Expenditures (see <a href="https://en.wikipedia.org/wiki/Capital_expenditure">here</a>).</p></li>
<li><p><code>che</code>: Cash and Equivalents (see <a href="https://en.wikipedia.org/wiki/Cash_and_cash_equivalents">here</a>).</p></li>
<li><p><code>cogs</code>: Cost of Goods Sold (see <a href="https://en.wikipedia.org/wiki/Cost_of_goods_sold">here</a>).</p></li>
<li><p><code>dp</code>: Depreciation and Amortization (see <a href="https://en.wikipedia.org/wiki/Amortization_(accounting)">here</a>).</p></li>
<li><p><code>act</code>: Current Assets (see <a href="https://en.wikipedia.org/wiki/Current_asset">here</a>.</p></li>
<li><p><code>lct</code>: Current Liabilities (see <a href="https://en.wikipedia.org/wiki/Current_liability">here</a>).</p></li>
<li><p><code>ebit</code>: Earnings Before Interest and Taxes (see <a href="https://en.wikipedia.org/wiki/Earnings_before_interest_and_taxes">here</a>).</p></li>
<li><p><code>ebitda</code>: Earnings Before Interest, Taxes, Depreciation and Amortization (see <a href="https://en.wikipedia.org/wiki/Earnings_before_interest,_taxes,_depreciation_and_amortizations">here</a>).</p></li>
<li><p><code>re</code>: Retained Earnings (see <a href="https://en.wikipedia.org/wiki/Retained_earnings">here</a>).</p></li>
<li><p><code>gp</code>: Gross Profit (see <a href="https://en.wikipedia.org/wiki/Gross_income">here</a>).</p></li>
<li><p><code>ib</code>: (Net) Income Before Extraordinary Items (see <a href="https://www.inc.com/encyclopedia/net-income.html">here</a>).</p></li>
<li><p><code>xint</code>: Interest Expense (see <a href="https://en.wikipedia.org/wiki/Interest_expense">here</a>).</p></li>
<li><p><code>dltt</code>: Long-Term Debt (see <a href="https://www.investopedia.com/terms/l/longtermdebt.asp">here</a>).</p></li>
<li><p><code>ni</code>: Net Income (see <a href="https://en.wikipedia.org/wiki/Net_income">here</a> or <a href="https://www.inc.com/encyclopedia/net-income.html">here</a>).</p></li>
<li><p><code>ppent</code>: Property, Plant, and Equipment (see <a href="https://en.wikipedia.org/wiki/Fixed_asset">here</a>).</p></li>
<li><p><code>sale</code>: Net Sales (see <a href="https://en.wikipedia.org/wiki/Sales_(accounting)">here</a>).</p></li>
<li><p><code>seq</code>: (Total Parent) Stockholders’ Equity (see <a href="https://www.stock-analysis-on.net/Knowledge-Base/Stockholders-Equity-Attributable-to-Parent">here</a>).</p></li>
<li><p><code>at</code>: Total Assets (see <a href="https://corporatefinanceinstitute.com/resources/commercial-lending/total-assets/">here</a>).</p></li>
<li><p><code>lt</code>: Total Liabilities (see <a href="https://www.investopedia.com/terms/t/total-liabilities.asp">here</a>).</p></li>
<li><p><code>invt</code>: Inventories (see <a href="https://www.investopedia.com/terms/i/inventory.asp">here</a>).</p></li>
<li><p><code>rect</code>: (Accounts) Receivables (see <a href="https://www.investopedia.com/terms/a/accountsreceivable.asp">here</a>).</p></li>
<li><p><code>wcap</code>: Working Capital (see <a href="https://corporatefinanceinstitute.com/resources/financial-modeling/working-capital-formula/">here</a>).</p></li>
<li><p><code>mktval</code>: Market Value of Equity (see <a href="https://www.investopedia.com/terms/m/market-value-of-equity.asp#">here</a>).</p></li>
</ul>
<p>Then a set of financial statements ratios, loosely inspired from those of the Desbois case study presented in class (r1 to r37, we keep Desbois presentation):</p>
<p>Capitalization ratios:</p>
<ul>
<li><p><code>r1</code>: Total Liabilities / Total Assets</p></li>
<li><p><code>r2</code>: Stockholders’ Equity / <a href="https://www.investopedia.com/terms/i/invested-capital.asp">Invested Capital</a></p></li>
<li><p><code>r3</code>: Current Liabilities / Total Liabilities</p></li>
<li><p><code>r4</code>: Current Liabilities / Total Assets</p></li>
<li><p><code>r5</code>: (Total Liabilities - Current Liabilities) / Total Assets</p></li>
</ul>
<p>Weight of the debt:</p>
<ul>
<li><p><code>r6</code>: Total Liabilities / Gross Profit</p></li>
<li><p><code>r7</code>: (Total Liabilities - Current Liabilities) / Gross Profit</p></li>
<li><p><code>r8</code>: Current Liabilities / Gross Profit</p></li>
</ul>
<p>Liquidity:</p>
<ul>
<li><p><code>r11</code>: Working Capital / Gross Profit</p></li>
<li><p><code>r12</code>: Working Capital / (Cost of Goods Sold - Interest Expense)</p></li>
<li><p><code>r14</code>: Current Liabilities / Current Assets</p></li>
</ul>
<p>Debt servicing:</p>
<ul>
<li><p><code>r17</code>: Interest Expense / Total Liabilities</p></li>
<li><p><code>r18</code>: Interest Expense / Gross Profit</p></li>
<li><p><code>r21</code>: Interest Expense / EBITDA</p></li>
</ul>
<p>Capital profitability:</p>
<ul>
<li><code>r24</code>: EBITA / Total Assets</li>
</ul>
<p>Earnings:</p>
<ul>
<li><p><code>r28</code>: EBITA / Gross Profit</p></li>
<li><p><code>r30</code>: Net Income / Gross Profit</p></li>
<li><p><code>r32</code>: (EBITA - Interest Expense) / Gross Profit</p></li>
</ul>
<p>Productive activity:</p>
<ul>
<li><p><code>r36</code>: (Total Assets - Current Assets) / Gross Profit</p></li>
<li><p><code>r37</code>: Gross Profit / Total Assets</p></li>
</ul>
<p>We load the data set and briefly inspect it:</p>
<div class="cell" data-hash="exam_in_class_cache/html/unnamed-chunk-2_29b11ef86b5579125a9e646e81a4aad9">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading data and inspecting it:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data_fin_exam <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'data/data_fin_exam.rds'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data_fin_exam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,353
Columns: 44
$ Y      &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ capx   &lt;dbl&gt; 2.301, 60.223, 4.346, 42.619, 32.169, 0.210, 31.845, 0.275, 952…
$ che    &lt;dbl&gt; 3.132, 12.678, 5.082, 58.623, 63.305, 1.482, 18.014, 1.454, 378…
$ cogs   &lt;dbl&gt; 11.378, 332.119, 385.265, 729.995, 1476.918, 8.116, 180.126, 3.…
$ dp     &lt;dbl&gt; 2.040, 53.072, 4.418, 49.681, 28.066, 0.385, 18.260, 0.191, 484…
$ act    &lt;dbl&gt; 6.351, 181.599, 128.932, 692.991, 597.103, 5.882, 171.237, 5.63…
$ lct    &lt;dbl&gt; 2.976, 128.618, 58.159, 358.271, 335.409, 5.233, 65.142, 1.006,…
$ ebit   &lt;dbl&gt; 2.061, 76.904, 29.493, 105.547, 79.014, 0.475, 32.654, 1.383, 1…
$ ebitda &lt;dbl&gt; 4.101, 129.976, 33.911, 155.228, 107.080, 0.860, 50.914, 1.574,…
$ re     &lt;dbl&gt; 6.873, -106.904, 50.140, 72.500, -31.142, -2.850, 55.968, 3.841…
$ gp     &lt;dbl&gt; 9.212, 174.608, 111.464, 567.290, 349.877, 6.415, 91.762, 5.138…
$ ib     &lt;dbl&gt; 1.789, 0.125, 14.158, 19.444, 44.710, -0.054, 15.811, 0.851, 13…
$ xint   &lt;dbl&gt; 0.003, 77.560, 3.446, 63.775, 20.069, 0.131, 9.980, 0.036, 54.2…
$ dltt   &lt;dbl&gt; 0.000, 867.944, 46.700, 782.249, 433.135, 1.737, 140.175, 0.203…
$ ni     &lt;dbl&gt; 1.789, 0.125, 14.158, 13.833, 39.811, -0.054, 15.811, 0.851, 13…
$ ppent  &lt;dbl&gt; 12.150, 554.296, 9.861, 481.554, 232.132, 1.947, 195.958, 0.774…
$ sale   &lt;dbl&gt; 20.590, 506.727, 496.729, 1297.285, 1826.795, 14.531, 271.888, …
$ seq    &lt;dbl&gt; 7.572, 82.717, 106.510, 1131.989, 464.633, 6.742, 186.312, 5.32…
$ at     &lt;dbl&gt; 20.010, 1230.512, 222.119, 2329.268, 1311.587, 13.961, 420.046,…
$ lt     &lt;dbl&gt; 12.438, 1147.795, 115.609, 1197.279, 846.954, 6.970, 233.734, 1…
$ invt   &lt;dbl&gt; 0.115, 77.086, 43.631, 309.277, 229.805, 1.007, 77.577, 1.300, …
$ rect   &lt;dbl&gt; 3.010, 84.345, 74.763, 258.471, 272.424, 2.979, 60.943, 2.808, …
$ wcap   &lt;dbl&gt; 3.375, 52.981, 70.773, 334.720, 261.694, 0.649, 106.095, 4.633,…
$ mktval &lt;dbl&gt; 14.784000, 0.326250, 217.974375, 1045.883400, 682.119000, 24.40…
$ r1     &lt;dbl&gt; 0.6215892, 0.9327784, 0.5204823, 0.5140151, 0.6457475, 0.499247…
$ r2     &lt;dbl&gt; 1.00000000, 0.08700999, 0.69518961, 0.59135228, 0.51754239, 0.7…
$ r3     &lt;dbl&gt; 0.2392668, 0.1120566, 0.5030664, 0.2992377, 0.3960180, 0.750789…
$ r4     &lt;dbl&gt; 0.1487256, 0.1045240, 0.2618371, 0.1538127, 0.2557276, 0.374829…
$ r5     &lt;dbl&gt; 0.472863568, 0.828254418, 0.258645141, 0.360202433, 0.390019877…
$ r6     &lt;dbl&gt; 1.3501954, 6.5735533, 1.0371869, 2.1105237, 2.4207193, 1.086516…
$ r7     &lt;dbl&gt; 1.02713851, 5.83694332, 0.51541305, 1.47897548, 1.46207096, 0.2…
$ r8     &lt;dbl&gt; 0.3230569, 0.7366100, 0.5217738, 0.6315482, 0.9586483, 0.815744…
$ r11    &lt;dbl&gt; 0.36636995, 0.30342825, 0.63494043, 0.59003332, 0.74796000, 0.1…
$ r12    &lt;dbl&gt; 0.20471916, 0.17708086, 0.15406468, 0.31041972, 0.15396971, 0.0…
$ r14    &lt;dbl&gt; 0.4685876, 0.7082528, 0.4510827, 0.5169923, 0.5617272, 0.889663…
$ r17    &lt;dbl&gt; 0.0002411963, 0.0675730422, 0.0298073679, 0.0532666154, 0.02369…
$ r18    &lt;dbl&gt; 0.0003256622, 0.4441949968, 0.0309158114, 0.1124204551, 0.05736…
$ r21    &lt;dbl&gt; 0.0007315289, 0.5967255493, 0.1016189437, 0.4108472698, 0.18742…
$ r24    &lt;dbl&gt; 0.20494753, 0.10562758, 0.15267042, 0.06664240, 0.08164155, 0.0…
$ r28    &lt;dbl&gt; 0.4451802, 0.7443874, 0.3042328, 0.2736308, 0.3060504, 0.134060…
$ r30    &lt;dbl&gt; 0.1942032132, 0.0007158893, 0.1270185890, 0.0243843537, 0.11378…
$ r32    &lt;dbl&gt; 0.44485454, 0.30019243, 0.27331695, 0.16121032, 0.24869025, 0.1…
$ r36    &lt;dbl&gt; 1.4827399, 6.0072448, 0.8360278, 2.8843748, 2.0421005, 1.259392…
$ r37    &lt;dbl&gt; 0.4603698, 0.1418987, 0.5018211, 0.2435486, 0.2667585, 0.459494…</code></pre>
</div>
</div>
</section>
<section id="instructions" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Instructions</h1>
<ul>
<li>The exam is open documents, open browser. If copying large chunks of codes from the browser, give a reference (link to website, stackoverflow, stats.stackexchange, copy ChatGPT Q/A in appendix etc). You can reuse code from the two first lessons hosted here: <a href="https://github.com/louis-olive/teaching_Scoring/" class="uri">https://github.com/louis-olive/teaching_Scoring/</a>, click on Code/Download ZIP for the last version:</li>
</ul>
<p><img src="../assets/github_repo.png" class="img-fluid"></p>
<ul>
<li><p>The first parts of the exam are to be performed in-class (<strong>TO DO in-class</strong> in the exam document). The in-class exam will last two hours (10:30-12:30).</p></li>
<li><p>You must use the R programming language, preferably through RStudio. Your code for analysis should use one of the following formats: preferably quarto Markdown (.qmd, as done in the course), but you might prefer R Markdown (.Rmd) or an R file (.R).</p></li>
<li><p>Packages that you may need besides <code>base R</code> and <code>stats</code> (<code>glm()</code>, <code>step()</code>) that have been used in the course include:</p></li>
</ul>
<p><code>tidyverse</code>, <code>broom</code>, <code>class</code>, <code>ROCR</code>, <code>car</code>, <code>aod</code>, <code>rsample</code>, <code>bestglm</code>, <code>glmnet</code>, <code>glmnetUtils</code>, <code>splines</code>, <code>rpart</code>, <code>rpart.plot</code>, <code>ada</code>, <code>gbm</code>, <code>xgboost</code></p>
<p>You can install them using the following code (uncomment):</p>
<div class="cell" data-hash="exam_in_class_cache/html/unnamed-chunk-3_6d2bee0202c167e96eb25c1ab9e47c08">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # UNCOMMENT IF NEEDED</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # https://statsandr.com/blog/an-efficient-way-to-install-and-load-r-packages/</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Package names</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># packages &lt;- c("tidyverse", "ROCR", "car", "aod", "broom", "rsample", "bestglm", </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># "glmnet", "glmnetUtils", "splines")</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Install packages not yet installed</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># installed_packages &lt;- packages %in% rownames(installed.packages())</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># if (any(installed_packages == FALSE)) {</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   install.packages(packages[!installed_packages])</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # Packages loading</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># invisible(lapply(packages, library, character.only = TRUE))</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># # Additional packages used throughout the course but not needed for the analysis</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># additional_packages &lt;- c( "purrr", "pROC", "foreign", "patchwork", "class",</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># "scales", "rpart", "rpart.plot", "DescTools")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check that it works on your computer before the course.</p>
<ul>
<li><p>For your report: either render a .html file of your analysis (when using .qmd/.Rmd) or provide a rich document with your text plus tables/plots of your analysis (.docx or .pdf). In case you don’t want to work with markdown/notebooks, no recommendation but <a href="https://www.libreoffice.org/download/download-libreoffice/">LibreOffice</a> is free and runs cross-platforms.</p></li>
<li><p>The code file and report’s general readability especially for the take home will impact the grading as well as the richness of their content (do not hesitate to comment on your intents, assumptions, findings, conclusions, especially in the take home part).</p></li>
<li><p>The .html file for report should be readable in a standard web browser (Chrome, Safari, Firefox, Edge …), alternatively .docx/.pdf should be valid. The .qmd/.Rmd/.R code file should run without errors (if something is not working as you wish, comment in the code with your intents). They should be posted before 12:30 on 2 October 2024 for the in-class part to my two email addresses <code>louis.olive@ut-capitole.fr</code>, <code>louis.olive@gmail.com</code> (in case the first one encounters issues) with subject <code>SCORING EXAM - YOUR NAME</code>. You can prepare your email in advance to save time at the end of exam.</p></li>
<li><p>Allow yourself at least 15 minutes before the end to check your .qmd/.Rmd/.R file is running and you have a readable report or code. If you finish before the end, and are happy with the result post me your code/report and take a well deserved rest!</p></li>
<li><p>If you are not happy with some or all parts of the in-class analysis, you might complete/correct/improve it at home, if it improves your grading a maximum of half of points will be given (for each relevant improvement).</p></li>
<li><p>For the take-home part the deadline is 9 October 2024 08:00.</p></li>
<li><p>Regarding the grading:</p>
<ul>
<li><p>50% of the total points for the in-class part, 50% for the at-home part</p></li>
<li><p>in-class data analysis (40%): 15% / 5% / 10% / 10% of the total points for each parts: “Desbois” ratios, “Altman” ratios, Lasso on financial statements items and Models assessment on holdout dataset</p></li>
<li><p>in-class extra exercise (10%): simulating data and assessing boundary decisions</p></li>
</ul></li>
</ul>
<p>You should follow the following plan in you report:</p>
</section>
<section id="desbois-ratios-15-total-points" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> “Desbois” ratios (15% total points)</h1>
<p><strong>TO DO in-class</strong></p>
<ul>
<li><p>First explore the data set using variables <code>Y</code> and `r1:r37``, for example:</p>
<ul>
<li><p>providing descriptive statistics,</p></li>
<li><p>showing correlated features,</p></li>
<li><p>showing/plotting individual features “interaction” with the response variable</p></li>
</ul>
<p>Visualizations are expected.</p>
<p>After this step, you can remove observations (rows) from data if justified.</p>
<p>You might also need to remove some feature variables is perfectly co-linear or any other reason.</p></li>
<li><p>Secondly fit a “full” logistic regression model (<strong>full_model_desbois</strong>) on the data set using variables <code>Y</code> and kept features from exploration step among <code>r1:r37</code>.</p></li>
<li><p>Then use stepwise logistic regression (forward or backward, using the penalization/criterion of your choice) (<strong>stepwise_model_desbois</strong>) on the data set using variables <code>Y</code> and kept features from exploration step among <code>r1:r37</code>.</p></li>
<li><p>Compare the <strong>full_model_desbois</strong> and <strong>stepwise_model_desbois</strong> using a Likelihood Ratio Test (LRT), ie test if <strong>full_model_desbois</strong> fits significantly better than the <strong>stepwise_model_desbois</strong>.</p></li>
<li><p>Compare predicted probabilities to observed probabilities for <strong>stepwise_model_desbois</strong> using either Hosmer &amp; Lemeshow test or a Calibration Plot.</p></li>
</ul>
</section>
<section id="altman-ratios-5-total-points" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> “Altman” ratios (5% total points)</h1>
<p><strong>TO DO in-class</strong></p>
<ul>
<li>First, using the data set at hand, create new predictors closest as possible as Altman’s Z-Score components (X1-X5) as shown below:</li>
</ul>
<p><img src="../assets/altman_zscore.png" class="img-fluid"></p>
<ul>
<li>Secondly, fit a logistic regression model <strong>model_altman</strong> using only these predictors, then:
<ul>
<li>give an interpretation for the coefficient <code>X3 = EBIT / Total Assets</code></li>
<li>assess the “significance” of <code>X3 = EBIT / Total Assets</code> coefficient</li>
<li>give a confidence interval for <code>X3 = EBIT / Total Assets</code></li>
</ul></li>
</ul>
</section>
<section id="financial-items-lasso-10-total-points" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Financial items / Lasso (10% total points)</h1>
<p><strong>TO DO in-class</strong></p>
<ul>
<li><p>First explore the data set using variables <code>Y</code> and <code>capx:mktval</code>, for example:</p>
<ul>
<li><p>providing descriptive statistics,</p></li>
<li><p>showing correlated features,</p></li>
<li><p>showing/plotting individual features “interaction” with the response variable</p></li>
</ul>
<p>Visualizations are expected.</p>
<p>After this step, you can remove observations (rows) from data if justified.</p>
<p>You might also need to remove some feature variables is perfectly co-linear or any other reason.</p></li>
<li><p>Secondly fit a “full” logistic regression model (<strong>full_model_items</strong>) on the data set using variables <code>Y</code> and kept features from last step among <code>capx:mktval</code>.</p></li>
<li><p>Then using function <a href="https://glmnet.stanford.edu/reference/cv.glmnet.html"><code>glmnet::cv.glmnet</code></a> or more conveniently <code>glmnetUtils::cv.glmnet</code> as shown in lesson 2 (for example in the cross-validation function defined at the end of the lesson): select a “best value” for the lasso parameter “lambda” giving a penalized model <strong>lasso_model_items</strong>.</p></li>
</ul>
<p>Functions <code>glmnet::cv.glmnet</code> / <code>glmnetUtils::cv.glmnet</code> fit the lasso path (ie multiple penalized models for multiple values of lambda) with the selection of the best lambda by K-Fold Cross-Validation (by default 10-fold) using a given criterion such as the AUC (<code>type.measure = "auc"</code>).</p>
<p>The function computes two optimal values: <code>lambda.min</code> is the value of lambda that gives minimum mean Cross-validated criterion; <code>lambda.1se</code> is the value of lambda that gives the most regularized model (highest lambda) such that the Cross-validated criterion for this lambda is within one standard error of the minimum, it favours penalization/parsimony versus <code>lambda.min</code> (see <a href="https://stats.stackexchange.com/questions/138569/why-is-lambda-within-one-standard-error-from-the-minimum-is-a-recommended-valu">here</a>).</p>
<p>(example usage <code>model_cv_glmnet &lt;- glmnetUtils::cv.glmnet(Y ~ ., data= YOUR_DATA, family="binomial", alpha=1, type.measure = "auc")</code>).</p>
<p>By default the <code>predict</code> function for a <code>cv.glmnet</code> model uses <code>lambda.1se</code>, but we can specify any value of lambda, in particular <code>lambda.min</code>, also note that the predict function outputs a <code>matrix</code> (<code>predict</code> functions in <code>R</code> outputs a vector in general) that might need to be converted to a vector (for latter use with <code>ROCR</code> package).</p>
<p>(example usage <code>predicted_proba &lt;- as.vector(predict(model_cv_glmnet, newdata = YOUR_(NEW)_DATA, s = model_cv_glmnet$lambda.1se, type = "response")</code>)</p>
</section>
<section id="models-assessment-10-total-points" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Models assessment (10% total points)</h1>
<p><strong>TO DO in-class</strong></p>
<p>You are given a holdout/testing data set to assess the preceding models.</p>
<ul>
<li><p>First (if you have already completed the task) create the Altman’s predictors for this data set.</p></li>
<li><p>Then plot the ROC Curves and compare the AUC of <strong>full_model_desbois</strong>, <strong>stepwise_model_desbois</strong>, <strong>model_altman</strong>, <strong>full_model_items</strong>, <strong>lasso_model_items</strong></p></li>
</ul>
<p>We load the holdout/testing data set and briefly inspect it:</p>
<div class="cell" data-hash="exam_in_class_cache/html/unnamed-chunk-4_c2f26ed8b206dd3f8bbf38c28699b18a">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading data and inspecting it:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'data/data_fin_holdout.rds'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data_fin_holdout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 461
Columns: 44
$ Y      &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ capx   &lt;dbl&gt; 960.000, 68.097, 882.000, 94.900, 598.000, 681.000, 2928.000, 3…
$ che    &lt;dbl&gt; 1236.000, 25.539, 5926.000, 532.700, 1806.000, 1832.000, 7388.0…
$ cogs   &lt;dbl&gt; 6193.000, 377.460, 57762.000, 2164.800, 9203.000, 5521.000, 261…
$ dp     &lt;dbl&gt; 398.000, 55.714, 900.000, 102.500, 678.000, 773.000, 3033.000, …
$ act    &lt;dbl&gt; 1787.000, 199.987, 21045.000, 1762.000, 4884.000, 5919.000, 319…
$ lct    &lt;dbl&gt; 2942.000, 75.301, 13173.000, 1496.500, 5577.000, 2836.000, 2613…
$ ebit   &lt;dbl&gt; 775.000, 46.263, 1663.000, 246.600, 1176.000, 1767.000, 2750.00…
$ ebitda &lt;dbl&gt; 1173.000, 101.977, 2563.000, 349.100, 1854.000, 2540.000, 5783.…
$ re     &lt;dbl&gt; 4086.000, 685.476, 14846.000, 1203.900, 4893.000, 11202.000, 25…
$ gp     &lt;dbl&gt; 2071.000, 130.741, 4584.000, 3238.100, 2271.000, 5606.000, 1242…
$ ib     &lt;dbl&gt; 437.000, 50.943, 1279.000, -19.500, 566.000, 1630.000, -67.000,…
$ xint   &lt;dbl&gt; 91.000, 18.871, 313.000, 134.600, 317.000, 105.000, 1108.000, 2…
$ dltt   &lt;dbl&gt; 1617.000, 258.458, 6504.000, 1581.600, 6518.000, 3473.000, 2281…
$ ni     &lt;dbl&gt; 437.000, 50.943, 1279.000, -19.500, 566.000, 1624.000, -67.000,…
$ ppent  &lt;dbl&gt; 6781.000, 726.251, 9758.000, 570.200, 4709.000, 4542.000, 15322…
$ sale   &lt;dbl&gt; 8264.000, 508.201, 62346.000, 5402.900, 11474.000, 11127.000, 3…
$ seq    &lt;dbl&gt; 3751.000, 702.555, 17173.000, -412.400, 2949.000, 7794.000, 131…
$ at     &lt;dbl&gt; 10912.000, 1111.893, 39769.000, 3010.000, 17360.000, 15641.000,…
$ lt     &lt;dbl&gt; 7161.000, 409.338, 22564.000, 3414.700, 14341.000, 7825.000, 61…
$ invt   &lt;dbl&gt; 60.000, 8.187, 8831.000, 542.000, 1274.000, 1653.000, 8614.000,…
$ rect   &lt;dbl&gt; 366.000, 160.289, 4405.000, 418.900, 1631.000, 1812.000, 14503.…
$ wcap   &lt;dbl&gt; -1155.000, 124.686, 7872.000, 265.500, -693.000, 3083.000, 5835…
$ mktval &lt;dbl&gt; 7496.35490, 487.19096, 26157.45000, 672.44800, 20994.14545, 337…
$ r1     &lt;dbl&gt; 0.6562500, 0.3681451, 0.5673766, 1.1344518, 0.8260945, 0.500287…
$ r2     &lt;dbl&gt; 0.6987705, 0.7310567, 0.7243241, -0.3504121, 0.3092167, 0.69040…
$ r3     &lt;dbl&gt; 0.41083648, 0.18395800, 0.58380606, 0.43825226, 0.38888501, 0.3…
$ r4     &lt;dbl&gt; 0.26961144, 0.06772324, 0.33123790, 0.49717608, 0.32125576, 0.1…
$ r5     &lt;dbl&gt; 0.38663856, 0.30042189, 0.23613870, 0.63727575, 0.50483871, 0.3…
$ r6     &lt;dbl&gt; 3.4577499, 3.1309077, 4.9223386, 1.0545382, 6.3148393, 1.395825…
$ r7     &lt;dbl&gt; 2.03718011, 2.55495216, 2.04864747, 0.59238442, 3.85909291, 0.8…
$ r8     &lt;dbl&gt; 1.4205698, 0.5759555, 2.8736911, 0.4621537, 2.4557464, 0.505886…
$ r11    &lt;dbl&gt; -0.55770159, 0.95368706, 1.71727749, 0.08199253, -0.30515192, 0…
$ r12    &lt;dbl&gt; -0.16500000, 0.32189243, 0.13236926, 0.05397219, -0.07449210, 0…
$ r14    &lt;dbl&gt; 1.6463346, 0.3765295, 0.6259444, 0.8493190, 1.1418919, 0.479135…
$ r17    &lt;dbl&gt; 0.012707722, 0.046101266, 0.013871654, 0.039417811, 0.022104456…
$ r18    &lt;dbl&gt; 0.043940126, 0.144338807, 0.068280977, 0.041567586, 0.139586085…
$ r21    &lt;dbl&gt; 0.07757886, 0.18505153, 0.12212251, 0.38556288, 0.17098166, 0.0…
$ r24    &lt;dbl&gt; 0.10749633, 0.09171476, 0.06444718, 0.11598007, 0.10679724, 0.1…
$ r28    &lt;dbl&gt; 0.5663930, 0.7799925, 0.5591187, 0.1078101, 0.8163804, 0.453086…
$ r30    &lt;dbl&gt; 0.211009174, 0.389648236, 0.279013962, -0.006022050, 0.24922941…
$ r32    &lt;dbl&gt; 0.52245292, 0.63565370, 0.49083770, 0.06624255, 0.67679436, 0.4…
$ r36    &lt;dbl&gt; 4.4060840, 6.9749046, 4.0846422, 0.3854112, 5.4936151, 1.734213…
$ r37    &lt;dbl&gt; 0.1897911, 0.1175842, 0.1152657, 1.0757807, 0.1308180, 0.358417…</code></pre>
</div>
</div>
</section>
<section id="exercise-simulation-and-boundary-decision-10-total-points" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Exercise: Simulation and boundary decision (10% total points)</h1>
<p><strong>TO DO in-class</strong></p>
<p>Write a function simulating the following data set:</p>
<ul>
<li><p>Class 0: mixture (ie two buckets a,b chosen randomly with probability <span class="math inline">\(\frac{1}{2}\)</span>) of Gaussian <span class="math inline">\(\mu_{0a}=\begin{bmatrix} 1 \\ 4 \end{bmatrix}\)</span> or <span class="math inline">\(\mu_{0b}=\begin{bmatrix} 1 \\ -4 \end{bmatrix}\)</span> and <span class="math inline">\(\Sigma_{0a}=\Sigma_{0b}=\begin{bmatrix} 2 &amp; 0 \\ 0 &amp; 2 \end{bmatrix}\)</span></p></li>
<li><p>Class 1: Gaussian with <span class="math inline">\(\mu_{1}=\begin{bmatrix} 4 \\ 0 \end{bmatrix}\)</span> and <span class="math inline">\(\Sigma_{1}=\begin{bmatrix} 2 &amp; 0 \\ 0 &amp; 4 \end{bmatrix}\)</span></p></li>
</ul>
<p>Simulate a training test of 200 observations (100 for each Class 0/1).</p>
<p>Simulate a testing test of 2000 observations (1000 for each Class 0/1).</p>
<p>Fit a logistic regression (<code>Y ~ x1 + x2</code>) on the training set (<strong>model1</strong>).</p>
<p>Then a logistic regression model with interactions (<code>Y ~ x1 + x2 + I(x1*x2) + I(x1^2) + I(x2^2)</code>) (<strong>model2</strong>).</p>
<p>Assess the misclassification error on the testing set.</p>
<p>Bonus <strong>TO DO at home</strong> (5% total points): derive the expression of the Bayes boundary decision, show it on a bivariate (x1, x2) plot together with training set and <strong>model1</strong>/<strong>model2</strong> boundary decisions.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>